"use strict";(self.webpackChunkreact_arcgis_wmws=self.webpackChunkreact_arcgis_wmws||[]).push([[3722],{19141:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{z:()=>k});var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(36663),_core_maybe_js__WEBPACK_IMPORTED_MODULE_22__=(__webpack_require__(39994),__webpack_require__(61681)),_core_Logger_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(13802),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__=(__webpack_require__(7283),__webpack_require__(81977)),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(12571),_core_arrayUtils_js__WEBPACK_IMPORTED_MODULE_8__=(__webpack_require__(3466),__webpack_require__(12173),__webpack_require__(51876),__webpack_require__(7753)),_core_Accessor_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(53443),_geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(14685),_geometry_support_webMercatorUtils_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(39536),_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__=(__webpack_require__(91957),__webpack_require__(6766)),_core_watchUtils_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(15071),_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(17321),_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(24568),_geometry_projection_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(83614),_core_sql_WhereClause_js__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(3362),_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(37116),_layers_support_FeatureFilter_js__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(37034),_I3SUtil_js__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(78565);const v=_core_Logger_js__WEBPACK_IMPORTED_MODULE_1__.Z.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter");let O,k=class extends _core_Accessor_js__WEBPACK_IMPORTED_MODULE_9__.Z{constructor(e){super(e),this._projectionEngineLoaded=!1}initialize(){(0,_core_watchUtils_js__WEBPACK_IMPORTED_MODULE_14__.N1)(this,"filter.geometry").then((()=>this.loadAsyncModule(async function W(){return function G(){return!!O}()||(O=await Promise.all([__webpack_require__.e(9067),__webpack_require__.e(7700)]).then(__webpack_require__.bind(__webpack_require__,17700))),O}().then((e=>{this.destroyed||(this._geometryEngine=e,this.applyFilters())})))))}get sortedObjectIds(){if((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_22__.Wi)(this.filter.objectIds))return null;const e=new Float64Array(this.filter.objectIds);return e.sort(),e}get parsedWhereClause(){const e=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_22__.pC)(this.filter)?this.filter.where:null;if((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_22__.Wi)(e)||!e)return null;try{return _core_sql_WhereClause_js__WEBPACK_IMPORTED_MODULE_18__.WhereClause.create(e,this.layerFieldsIndex)}catch(s){v.error(`Failed to parse filter where clause: ${s}`)}return null}addFilters(e,t,s,i){const n=this.sortedObjectIds;(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_22__.pC)(n)&&e.push((e=>(0,_I3SUtil_js__WEBPACK_IMPORTED_MODULE_21__.Yb)(n,!0,e))),this.addSqlFilter(e,this.parsedWhereClause);const o=this.parsedGeometry;if((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_22__.pC)(o)){const r=this.spatialRelationship;e.push(((e,n)=>function T(e,t,r,s,i,n,o){const a=n[0].spatialReference||s.spatialReference;if(!(0,_geometry_projection_js__WEBPACK_IMPORTED_MODULE_17__.st)(t.node.mbs,i,V,a))return void v.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter");const c=q(V,a),l=function U(e,t,r,s,i){const n=t.renderSpatialReference,o=new Map,a={rings:[[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],hasZ:!1,hasM:!1,type:"polygon",spatialReference:r};a.rings[0][3]=a.rings[0][0];const c={indices:null,data:null,stride:0,startIndex:0,endIndex:0};let l,p;switch(e){case"intersects":l=(e,t)=>O.intersects(e,t)?0:2,p=$;break;case"contains":l=(e,t)=>O.contains(e,t)?2:1,p=$;break;default:l=(e,t)=>O.disjoint(e,t)?2:1,p=z}return{collection:s,object:i,type:e,maskSR:r,renderSR:n,aabbCache:o,triangle:a,positions:c,triangleTest:l,geometryTest:p}}(o,s,a,r,t.objectHandle);for(const p of n){if(0===e.length)return;switch(Z(p,c,o)){case 1:return void(e.length=0);case 0:continue}(0,_I3SUtil_js__WEBPACK_IMPORTED_MODULE_21__.hv)(e,t.featureIds,(e=>P(p,e,l)))}}(e,n,i,t,s,o,r)))}}isMBSGeoemtryVisible(e,t,s){const i=this.parsedGeometry;if((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_22__.pC)(i)){const r=this.spatialRelationship,n=i[0].spatialReference||t;return(0,_geometry_projection_js__WEBPACK_IMPORTED_MODULE_17__.st)(e,s,V,n)?function A(e,t,r,s){const i=q(e,r);return t.every((e=>1!==Z(e,i,s)))}(V,i,n,r):(v.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)}return!0}get parsedGeometry(){if((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_22__.Wi)(this.filter))return null;if(!this._geometryEngine)return null;const{geometry:e}=this.filter;if((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_22__.Wi)(e))return null;const{distance:r,units:s}=this.filter,i=this.spatialRelationship,n="mesh"===e.type?e.extent:e;if((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_22__.Wi)(r)||0===r)return C(n,i);const o=s||(0,_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_15__.qE)(n.spatialReference);if(n.spatialReference.isWGS84)return C(this._geometryEngine.geodesicBuffer(n,r,o),i);if((0,_geometry_support_webMercatorUtils_js__WEBPACK_IMPORTED_MODULE_11__.Q8)(n,_geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_10__.Z.WGS84))return C((0,_geometry_support_webMercatorUtils_js__WEBPACK_IMPORTED_MODULE_11__.iV)(this._geometryEngine.geodesicBuffer((0,_geometry_support_webMercatorUtils_js__WEBPACK_IMPORTED_MODULE_11__.iV)(n,_geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_10__.Z.WGS84),r,o),n.spatialReference),i);if(!this._projectionEngineLoaded&&(this.loadAsyncModule((0,_geometry_projection_js__WEBPACK_IMPORTED_MODULE_17__.zD)().then((()=>this._projectionEngineLoaded=!0))),!this._projectionEngineLoaded))return null;let a=null;try{a=(0,_geometry_projection_js__WEBPACK_IMPORTED_MODULE_17__.iV)(n,_geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_10__.Z.WGS84)}catch(c){}if(a)try{a=(0,_geometry_projection_js__WEBPACK_IMPORTED_MODULE_17__.iV)(this._geometryEngine.geodesicBuffer(a,r,o),n.spatialReference)}catch(c){a=null}return a||v.error(`Filter by geodesic buffer (distance) unsupported, failed to project input geometry (${n.spatialReference.wkid}) to WGS84.`),C(a,i)}get spatialRelationship(){return(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_22__.pC)(this.filter)?this.filter.spatialRelationship:"intersects"}static checkSupport(e){return e.timeExtent?(v.warn("Filters with a timeExtent are not supported for mesh scene layers"),!1):!!function L(e){return null!=e&&B.indexOf(e)>=0}(e.spatialRelationship)||(v.warn(`Filters with spatialRelationship other than ${B.join(", ")} are not supported for mesh scene layers`),!1)}};(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_23__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({type:_layers_support_FeatureFilter_js__WEBPACK_IMPORTED_MODULE_20__.Z})],k.prototype,"filter",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_23__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)()],k.prototype,"layerFieldsIndex",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_23__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)()],k.prototype,"loadAsyncModule",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_23__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)()],k.prototype,"applyFilters",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_23__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)()],k.prototype,"addSqlFilter",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_23__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({readOnly:!0})],k.prototype,"sortedObjectIds",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_23__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({readOnly:!0})],k.prototype,"parsedWhereClause",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_23__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({readOnly:!0})],k.prototype,"parsedGeometry",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_23__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({readOnly:!0})],k.prototype,"spatialRelationship",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_23__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)()],k.prototype,"_projectionEngineLoaded",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_23__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)()],k.prototype,"_geometryEngine",void 0),k=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_23__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_4__.j)("esri.views.3d.layers.i3s.I3SMeshViewFilter")],k);const B=["contains","intersects","disjoint"];function C(e,t){if(!e)return null;if("disjoint"===t&&"polygon"===e.type){const t=new Array(e.rings.length);for(let i=0;i<e.rings.length;++i){const r=(0,_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_16__.al)(1/0,1/0,-1/0,-1/0);(0,_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_16__.Wi)(r,e.rings[i]),t[i]={type:"polygon",rings:[e.rings[i]],spatialReference:e.spatialReference,aabr:r}}t.sort(((e,t)=>e.aabr[0]-t.aabr[0]));const r=new Set,s=new _core_arrayUtils_js__WEBPACK_IMPORTED_MODULE_8__.SO;for(let e=0;e<t.length;++e){const i=t[e];for(let s=e+1;s<t.length;++s){const e=t[s];if(e.aabr[0]>=i.aabr[2])break;r.add(e)}r.forEach((e=>{if(i!==e)if(e.aabr[2]<=i.aabr[0])r.delete(e);else if(O.intersects(i,e)){i.rings=i.rings.concat(e.rings),(0,_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_16__.jn)(i.aabr,e.aabr),delete i._geVersion,r.delete(e);const n=(0,_core_arrayUtils_js__WEBPACK_IMPORTED_MODULE_8__.cq)(t,e,t.length,s);t.splice(n,1)}})),r.add(i)}for(const e of t)delete e.aabr;return t}return[e]}const V=[0,0,0,0];function q(e,t){const r={x:e[0],y:e[1],hasZ:!1,hasM:!1,type:"point",spatialReference:t},s=t.isWGS84||t.isWebMercator?O.geodesicBuffer(r,e[3],1):O.buffer(r,e[3],1);return s.type="polygon",s}function Z(e,t,r){switch(r){case"intersects":case"contains":return $(e,t);case"disjoint":return z(e,t)}}function $(e,t){return O.intersects(e,t)?O.contains(e,t)?0:2:1}function z(e,t){return O.intersects(e,t)?O.contains(e,t)?1:2:0}function P(e,t,r){const{collection:s,object:i,renderSR:n,maskSR:o,geometryTest:a,aabbCache:c}=r;let l=c.get(t);if(!l){const e=s.getObjectTransform(i);s.getComponentAabb(i,t,D);const r=[[D[0],D[1],0],[D[0],D[4],0],[D[3],D[4],0],[D[3],D[1],0]];for(let t=0;t<4;++t)(0,_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.t)(r[t],r[t],e.rotationScale),(0,_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.b)(r[t],r[t],e.position),(0,_geometry_projection_js__WEBPACK_IMPORTED_MODULE_17__.SH)(r[t],n,r[t],o);l={rings:[r],hasZ:!1,hasM:!1,type:"polygon",spatialReference:o},l.rings[0][4]=l.rings[0][0],c.set(t,l)}switch(a(e,l)){case 1:return!1;case 0:return!0}const{triangle:p,triangleTest:u,positions:h}=r,y=p.rings[0][0],m=p.rings[0][1],j=p.rings[0][2],b=s.getObjectTransform(i);s.getComponentPositions(i,t,h);const{indices:S,data:R,stride:w,startIndex:F,endIndex:x}=h;for(let I=F;I<x;I+=3){const t=w*S[I+0],r=w*S[I+1],s=w*S[I+2];(0,_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.s)(y,R[t+0],R[t+1],R[t+2]),(0,_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.s)(m,R[r+0],R[r+1],R[r+2]),(0,_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.s)(j,R[s+0],R[s+1],R[s+2]),(0,_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.t)(y,y,b.rotationScale),(0,_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.t)(m,m,b.rotationScale),(0,_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.t)(j,j,b.rotationScale),(0,_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.b)(y,y,b.position),(0,_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.b)(m,m,b.position),(0,_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.b)(j,j,b.position),(0,_geometry_projection_js__WEBPACK_IMPORTED_MODULE_17__.SH)(y,n,y,o),(0,_geometry_projection_js__WEBPACK_IMPORTED_MODULE_17__.SH)(m,n,m,o),(0,_geometry_projection_js__WEBPACK_IMPORTED_MODULE_17__.SH)(j,n,j,o);const i=m[0]-y[0],a=m[1]-y[1],c=j[0]-y[0],l=j[1]-y[1];if(!(Math.abs(i*l-a*c)<2.3283064365386963e-10))switch(delete p._geVersion,u(e,p)){case 1:return!1;case 0:return!0}}return"intersects"!==r.type}const D=(0,_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_19__.Ue)()},61498:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(36663),_core_maybe_js__WEBPACK_IMPORTED_MODULE_15__=(__webpack_require__(39994),__webpack_require__(61681)),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__=(__webpack_require__(13802),__webpack_require__(7283),__webpack_require__(81977)),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(12571),_core_Error_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(70375),_core_Accessor_js__WEBPACK_IMPORTED_MODULE_9__=(__webpack_require__(3466),__webpack_require__(12173),__webpack_require__(51876),__webpack_require__(53443)),_geometry_Extent_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(91772),_core_Handles_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(44584),_tasks_support_FeatureSet_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(41017),_tasks_support_Query_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(27746);const l=__webpack_require__(61280).Z;let p=class extends _core_Accessor_js__WEBPACK_IMPORTED_MODULE_9__.Z{constructor(e){super(e),this._dataQueryEngineInstance=null,this._handles=new _core_Handles_js__WEBPACK_IMPORTED_MODULE_11__.Z}get defaultQueryJSON(){return new _tasks_support_Query_js__WEBPACK_IMPORTED_MODULE_13__.Z({outSpatialReference:this.spatialReference}).toJSON()}get dataQueryEngine(){return this.ensureDataQueryEngine()}initialize(){this._handles.add(this.layerView.on("visible-geometry-changed",(()=>this.spatialIndex.events.emit("changed"))))}destroy(){this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null),this._handles&&(this._handles.destroy(),this._handles=null),this._set("layerView",null)}async executeQueryForCount(e,t){return this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(e),t)}async executeQueryForExtent(e,t){const{count:r,extent:s}=await this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(e),t);return{count:r,extent:_geometry_Extent_js__WEBPACK_IMPORTED_MODULE_10__.Z.fromJSON(s)}}async executeQueryForIds(e,t){return this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(e),t)}async executeQuery(e,t){const r=this._ensureQueryJSON(e);if(r.returnGeometry)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_5__.Z("feature-store:unsupported-query","returnGeometry is not yet supported for mesh scene layer queries");if(r.returnCentroid)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_5__.Z("feature-store:unsupported-query","returnCentroid is not yet supported for mesh scene layer queries");const s=await this.dataQueryEngine.executeQuery(r,t),o=_tasks_support_FeatureSet_js__WEBPACK_IMPORTED_MODULE_12__.default.fromJSON(s);return o.features.forEach((e=>{e.geometry=null})),o}_ensureQueryJSON(e){if((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_15__.Wi)(e))return this.defaultQueryJSON;const r=e.toJSON();return r.outSpatialReference||(e.outSpatialReference=this.spatialReference),r}ensureDataQueryEngine(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const e=this.layer.objectIdField||"OBJECTID",r=this.layer.fields.map((e=>e.toJSON())),s=this.layerView.view.resourceController.scheduler,n=this.spatialReference.toJSON(),o=this.task,a=this.spatialIndex;return this._dataQueryEngineInstance=new l({hasZ:!0,hasM:!1,geometryType:"esriGeometryPolygon",fields:r,timeInfo:null,spatialReference:n,objectIdField:e,featureStore:a,scheduler:s,task:o}),this._dataQueryEngineInstance}};(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({constructOnly:!0})],p.prototype,"layerView",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({constructOnly:!0})],p.prototype,"task",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({constructOnly:!0})],p.prototype,"spatialIndex",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],p.prototype,"spatialReference",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({readOnly:!0,aliasOf:"layerView.i3slayer"})],p.prototype,"layer",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({readOnly:!0})],p.prototype,"defaultQueryJSON",null),p=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_4__.j)("esri.views.3d.layers.i3s.I3SQueryEngine")],p);const __WEBPACK_DEFAULT_EXPORT__=p},5002:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{u:()=>n});var _core_maybe_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(61681),_layers_graphics_OptimizedGeometry_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(15540),_layers_graphics_centroid_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(33480),_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(37116),_I3SUtil_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(78565);class n{constructor(t){this.objectIdField=t.objectIdField,this.getFeatureExtent=t.getFeatureExtent}getObjectId(t){return t.id}getAttributes(e){const{meta:r,index:o}=e,n={};this.objectIdField&&(n[this.objectIdField]=e.id);const s=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_2__.pC)(r.attributeInfo)&&r.attributeInfo.attributeData;if((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_2__.pC)(s))for(const t of Object.keys(s))n[t]=(0,_I3SUtil_js__WEBPACK_IMPORTED_MODULE_1__.Jx)(s[t],o);return n}getAttribute(e,r){if(r===this.objectIdField)return e.id;const{meta:o,index:n}=e,s=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_2__.pC)(o.attributeInfo)&&o.attributeInfo.attributeData;return(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_2__.pC)(s)?(0,_I3SUtil_js__WEBPACK_IMPORTED_MODULE_1__.Jx)(s[r],n):null}getGeometry(t){if(t.geometry)return t.geometry;const[r,o,i,n,a]=this.getFeatureExtent(t,s);return new _layers_graphics_OptimizedGeometry_js__WEBPACK_IMPORTED_MODULE_3__.Z([5],[r,o,i,n,o,i,n,a,i,r,a,i,r,o,i])}getCentroid(t,o){if(t.geometry)return(0,_layers_graphics_centroid_js__WEBPACK_IMPORTED_MODULE_4__.Y)(new _layers_graphics_OptimizedGeometry_js__WEBPACK_IMPORTED_MODULE_3__.Z,t.geometry,o.hasZ,o.hasM);const[i,n,a,m,u,d]=this.getFeatureExtent(t,s);return new _layers_graphics_OptimizedGeometry_js__WEBPACK_IMPORTED_MODULE_3__.Z([0],[(i+m)/2,(n+u)/2,(a+d)/2])}cloneWithGeometry(t,e){const{id:r,index:o,meta:i}=t;return{id:r,index:o,meta:i,geometry:e}}}const s=(0,_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_0__.Ue)()},57602:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(36663),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__=(__webpack_require__(39994),__webpack_require__(13802),__webpack_require__(7283),__webpack_require__(81977)),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(12571),_core_Accessor_js__WEBPACK_IMPORTED_MODULE_8__=(__webpack_require__(3466),__webpack_require__(12173),__webpack_require__(51876),__webpack_require__(53443)),_core_Evented_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(31355),_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(24568),_geometry_projection_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(83614),_chunks_vec4f64_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(1983),_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(37116);let m=class extends _core_Accessor_js__WEBPACK_IMPORTED_MODULE_8__.Z{constructor(r){super(r),this.events=new _core_Evented_js__WEBPACK_IMPORTED_MODULE_9__.Z}destroy(){}forEach(r){this.forAllFeatures((e=>(r(e),1)))}forEachBounds(r,e,t){const o=this.getFeatureExtent;for(const s of r)e(o(s,t))}forEachInBounds(r,e){this.forAllFeatures((t=>{const o=this.getFeatureExtent(t,l);return(0,_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_10__.kK)(r,(0,_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_13__.y8)(o,d))&&e(t),1}),(e=>{if((0,_geometry_projection_js__WEBPACK_IMPORTED_MODULE_11__.st)(e.node.mbs,this.sourceSpatialReference,f,this.viewSpatialReference),f[0]>=r[0]&&f[2]<=r[2]&&f[1]>=r[1]&&f[3]<=r[3])return 1;const t=Math.max(r[0],Math.min(f[0],r[2])),o=Math.max(r[1],Math.min(f[1],r[3])),s=f[0]-t,c=f[1]-o;return s*s+c*c<=f[3]*f[3]?1:2}))}};(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_14__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({constructOnly:!0})],m.prototype,"featureAdapter",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_14__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({constructOnly:!0})],m.prototype,"forAllFeatures",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_14__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({constructOnly:!0})],m.prototype,"getFeatureExtent",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_14__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({constructOnly:!0})],m.prototype,"sourceSpatialReference",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_14__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({constructOnly:!0})],m.prototype,"viewSpatialReference",void 0),m=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_14__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_4__.j)("esri.views.3d.layers.i3s.I3SQueryFeatureStore")],m);const f=(0,_chunks_vec4f64_js__WEBPACK_IMPORTED_MODULE_12__.a)(),l=(0,_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_13__.Ue)(),d=(0,_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_10__.Ue)();const __WEBPACK_DEFAULT_EXPORT__=m},7933:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{l:()=>p});var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(36663),_core_Logger_js__WEBPACK_IMPORTED_MODULE_1__=(__webpack_require__(39994),__webpack_require__(13802)),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__=(__webpack_require__(7283),__webpack_require__(81977)),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(12571),_core_sql_WhereClause_js__WEBPACK_IMPORTED_MODULE_8__=(__webpack_require__(3466),__webpack_require__(12173),__webpack_require__(51876),__webpack_require__(3362)),_i3s_I3SUtil_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(78565);const t=_core_Logger_js__WEBPACK_IMPORTED_MODULE_1__.Z.getLogger("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView"),p=e=>{let p=class extends e{constructor(){super(...arguments),this._definitionExpressionErrors=0,this._maxDefinitionExpressionErrors=20,this.logError=r=>{this._definitionExpressionErrors<this._maxDefinitionExpressionErrors&&t.error("Error while evaluating definitionExpression: "+r),this._definitionExpressionErrors++,this._definitionExpressionErrors===this._maxDefinitionExpressionErrors&&t.error("Further errors are ignored")}}get parsedDefinitionExpression(){if(!this.i3slayer||!this.i3slayer.definitionExpression)return null;try{const r=_core_sql_WhereClause_js__WEBPACK_IMPORTED_MODULE_8__.WhereClause.create(this.i3slayer.definitionExpression,this.i3slayer.fieldsIndex);if(!r.isStandardized)return t.error("definitionExpression is using non standard function"),null;const e=[],i=r.fieldNames;return(0,_i3s_I3SUtil_js__WEBPACK_IMPORTED_MODULE_9__.e8)(i,this.i3slayer.fields,{missingFields:e}),e.length>0?(t.error(`definitionExpression references unknown fields: ${e.join(", ")}`),null):(this._definitionExpressionErrors=0,r)}catch(r){return t.error("Failed to parse definitionExpression: "+r),null}}get definitionExpressionFields(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:null}_evaluateClause(r,e){try{return r.testFeature(e)}catch(i){return this.logError(i),!1}}_addDefinitionExpressionToQuery(r){if(!this.parsedDefinitionExpression)return r;const e=this.i3slayer.definitionExpression,i=r.clone();return i.where?i.where=`(${e}) AND (${i.where})`:i.where=e,i}};return(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_10__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)()],p.prototype,"i3slayer",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_10__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({readOnly:!0})],p.prototype,"parsedDefinitionExpression",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_10__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({readOnly:!0})],p.prototype,"definitionExpressionFields",null),p=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_10__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_4__.j)("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],p),p}},37034:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var d,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(36663),_core_lang_js__WEBPACK_IMPORTED_MODULE_1__=(__webpack_require__(39994),__webpack_require__(67134)),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__(13802),__webpack_require__(7283),__webpack_require__(81977)),_core_jsonMap_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(25709),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(12571),_core_accessorSupport_decorators_writer_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(39835),_core_JSONSupport_js__WEBPACK_IMPORTED_MODULE_10__=(__webpack_require__(3466),__webpack_require__(12173),__webpack_require__(51876),__webpack_require__(49004)),_geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(53736),_geometry_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(91957),_TimeExtent_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(37956),_tasks_support_Query_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(27746);const m=new _core_jsonMap_js__WEBPACK_IMPORTED_MODULE_15__.Xn({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),u=new _core_jsonMap_js__WEBPACK_IMPORTED_MODULE_15__.Xn({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let h=d=class extends _core_JSONSupport_js__WEBPACK_IMPORTED_MODULE_10__.wq{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.hiddenIds=new Set,this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null,this.enabled=!1}writeWhere(e,t){t.where=e||"1=1"}enable(){this._set("enabled",!0)}createQuery(e={}){const{where:r,geometry:i,spatialRelationship:s,timeExtent:o,objectIds:n,units:a,distance:p}=this;return new _tasks_support_Query_js__WEBPACK_IMPORTED_MODULE_14__.Z({geometry:(0,_core_lang_js__WEBPACK_IMPORTED_MODULE_1__.d9)(i),objectIds:(0,_core_lang_js__WEBPACK_IMPORTED_MODULE_1__.d9)(n),spatialRelationship:s,timeExtent:(0,_core_lang_js__WEBPACK_IMPORTED_MODULE_1__.d9)(o),where:r,units:a,distance:p,...e})}clone(){const{where:e,geometry:r,spatialRelationship:i,hiddenIds:s,timeExtent:o,objectIds:n,units:a,distance:p}=this,l=new Set;return s.forEach((e=>l.add(e))),new d({geometry:(0,_core_lang_js__WEBPACK_IMPORTED_MODULE_1__.d9)(r),hiddenIds:l,objectIds:(0,_core_lang_js__WEBPACK_IMPORTED_MODULE_1__.d9)(n),spatialRelationship:i,timeExtent:(0,_core_lang_js__WEBPACK_IMPORTED_MODULE_1__.d9)(o),where:e,units:a,distance:p})}};(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.Cb)({type:String})],h.prototype,"where",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_writer_js__WEBPACK_IMPORTED_MODULE_6__.c)("where")],h.prototype,"writeWhere",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.Cb)({types:_geometry_js__WEBPACK_IMPORTED_MODULE_12__.qM,json:{read:_geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_11__.im,write:!0}})],h.prototype,"geometry",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.Cb)({type:String,json:{read:{source:"spatialRel",reader:m.read},write:{target:"spatialRel",writer:m.write}}})],h.prototype,"spatialRelationship",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.Cb)({json:{write:(e,t,r)=>t[r]=Array.from(e),read:e=>new Set(e)}})],h.prototype,"hiddenIds",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.Cb)({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],h.prototype,"distance",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.Cb)({type:[Number],json:{write:!0}})],h.prototype,"objectIds",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.Cb)({type:String,json:{read:u.read,write:{writer:u.write,overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],h.prototype,"units",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.Cb)({type:_TimeExtent_js__WEBPACK_IMPORTED_MODULE_13__.Z,json:{write:!0}})],h.prototype,"timeExtent",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.Cb)({readOnly:!0})],h.prototype,"enabled",void 0),h=d=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_5__.j)("esri.views.layers.support.FeatureFilter")],h);const __WEBPACK_DEFAULT_EXPORT__=h},59439:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{V:()=>d,e:()=>i});var _core_maybe_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(61681),_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(14845);async function i(i,d=i.popupTemplate){if(!(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_1__.pC)(d))return[];const o=await d.getRequiredFields(i.fields),{lastEditInfoEnabled:s}=d,{objectIdField:u,typeIdField:a,globalIdField:n,relationships:f}=i;if(o.includes("*"))return["*"];const r=s?await(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.CH)(i):[],m=(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.Q0)(i.fields,[...o,...r]);return a&&m.push(a),m&&u&&(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.cT)(i.fields,u)&&-1===m.indexOf(u)&&m.push(u),m&&n&&(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.cT)(i.fields,n)&&-1===m.indexOf(n)&&m.push(n),f&&f.forEach((e=>{const{keyField:p}=e;m&&p&&(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.cT)(i.fields,p)&&-1===m.indexOf(p)&&m.push(p)})),m}function d(p,l){return p.popupTemplate?p.popupTemplate:(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_1__.pC)(l)&&l.defaultPopupTemplateEnabled&&(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_1__.pC)(p.defaultPopupTemplate)?p.defaultPopupTemplate:null}}}]);