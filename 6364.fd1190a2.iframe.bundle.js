(self.webpackChunkreact_arcgis_wmws=self.webpackChunkreact_arcgis_wmws||[]).push([[6364],{78540:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{m:()=>f});var has=__webpack_require__(95830),promiseUtils=__webpack_require__(39105),request=__webpack_require__(36654),ItemCache=__webpack_require__(65353),workers=__webpack_require__(21562),TileKey=__webpack_require__(5201),TileIndex=__webpack_require__(95723),Texture=(__webpack_require__(5627),__webpack_require__(23660),__webpack_require__(8634)),Rect=(__webpack_require__(84570),__webpack_require__(89998));const RectangleBinPack=class e{constructor(e,t){this._width=0,this._height=0,this._free=[],this._width=e,this._height=t,this._free.push(new Rect.Z(0,0,e,t))}get width(){return this._width}get height(){return this._height}allocate(e,t){if(e>this._width||t>this._height)return new Rect.Z;let i=null,s=-1;for(let h=0;h<this._free.length;++h){const w=this._free[h];e<=w.width&&t<=w.height&&(null===i||w.y<=i.y&&w.x<=i.x)&&(i=w,s=h)}return null===i?new Rect.Z:(this._free.splice(s,1),i.width<i.height?(i.width>e&&this._free.push(new Rect.Z(i.x+e,i.y,i.width-e,t)),i.height>t&&this._free.push(new Rect.Z(i.x,i.y+t,i.width,i.height-t))):(i.width>e&&this._free.push(new Rect.Z(i.x+e,i.y,i.width-e,i.height)),i.height>t&&this._free.push(new Rect.Z(i.x,i.y+t,e,i.height-t))),new Rect.Z(i.x,i.y,e,t))}release(h){for(let e=0;e<this._free.length;++e){const t=this._free[e];if(t.y===h.y&&t.height===h.height&&t.x+t.width===h.x)t.width+=h.width;else if(t.x===h.x&&t.width===h.width&&t.y+t.height===h.y)t.height+=h.height;else if(h.y===t.y&&h.height===t.height&&h.x+h.width===t.x)t.x=h.x,t.width+=h.width;else{if(h.x!==t.x||h.width!==t.width||h.y+h.height!==t.y)continue;t.y=h.y,t.height+=h.height}this._free.splice(e,1),this.release(h)}this._free.push(h)}};const GlyphMosaic=class s{constructor(t,e,s){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphIndex={},this._textures=[],this._rangePromises=new Map,this.width=t,this.height=e,this._glyphSource=s,this._binPack=new RectangleBinPack(t-4,e-4),this._glyphData.push(new Uint8Array(t*e)),this._dirties.push(!0),this._textures.push(void 0)}getGlyphItems(t,s){const h=[],r=this._glyphSource,n=new Set;for(const e of s){const t=Math.floor(.00390625*e);n.add(t)}const a=[];return n.forEach((e=>{if(e<=256){const i=t+e;if(this._rangePromises.has(i))a.push(this._rangePromises.get(i));else{const s=r.getRange(t,e).then((()=>{this._rangePromises.delete(i)}),(()=>{this._rangePromises.delete(i)}));this._rangePromises.set(i,s),a.push(s)}}})),Promise.all(a).then((()=>{let n=this._glyphIndex[t];n||(n={},this._glyphIndex[t]=n);for(const o of s){const s=n[o];if(s){h[o]={sdf:!0,rect:s.rect,metrics:s.metrics,page:s.page,code:o};continue}const a=r.getGlyph(t,o);if(!a||!a.metrics)continue;const c=a.metrics;let l;if(0===c.width)l=new Rect.Z(0,0,0,0);else{const t=3,e=c.width+2*t,s=c.height+2*t;let h=e%4?4-e%4:4,r=s%4?4-s%4:4;1===h&&(h=5),1===r&&(r=5),l=this._binPack.allocate(e+h,s+r),l.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new RectangleBinPack(this.width-4,this.height-4),l=this._binPack.allocate(e+h,s+r));const n=this._glyphData[this._currentPage],o=a.bitmap;let g,_;if(o)for(let i=0;i<s;i++){g=e*i,_=this.width*(l.y+i+1)+l.x;for(let t=0;t<e;t++)n[_+t+1]=o[g+t]}}n[o]={rect:l,metrics:c,tileIDs:null,page:this._currentPage},h[o]={sdf:!0,rect:l,metrics:c,page:this._currentPage,code:o},this._dirties[this._currentPage]=!0}return h}))}removeGlyphs(t){for(const e in this._glyphIndex){const i=this._glyphIndex[e];if(!i)continue;let s;for(const e in i)if(s=i[e],s.tileIDs.delete(t),0===s.tileIDs.size){const t=this._glyphData[s.page],h=s.rect;let r,n;for(let e=0;e<h.height;e++)for(r=this.width*(h.y+e)+h.x,n=0;n<h.width;n++)t[r+n]=0;delete i[e],this._dirties[s.page]=!0}}}bind(e,i,s,h=0){this._textures[s]||(this._textures[s]=new Texture.Z(e,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));const r=this._textures[s];r.setSamplingMode(i),this._dirties[s]&&r.setData(this._glyphData[s]),e.bindTexture(r,h),this._dirties[s]=!1}dispose(){this._binPack=null;for(const t of this._textures)t&&t.dispose();this._textures.length=0}};var pbf=__webpack_require__(90011);class GlyphSource_s{constructor(t){if(this._metrics=[],this._bitmaps=[],t)for(;t.next();)switch(t.tag()){case 1:{const e=t.getMessage();for(;e.next();)switch(e.tag()){case 3:{const t=e.getMessage();let s,a,r,n,i,c,g;for(;t.next();)switch(t.tag()){case 1:s=t.getUInt32();break;case 2:a=t.getBytes();break;case 3:r=t.getUInt32();break;case 4:n=t.getUInt32();break;case 5:i=t.getSInt32();break;case 6:c=t.getSInt32();break;case 7:g=t.getUInt32();break;default:t.skip()}t.release(),s&&(this._metrics[s]={width:r,height:n,left:i,top:c,advance:g},this._bitmaps[s]=a);break}default:e.skip()}e.release();break}default:t.skip()}}getMetrics(t){return this._metrics[t]}getBitmap(t){return this._bitmaps[t]}}class a{constructor(){this._ranges=[]}getRange(t){return this._ranges[t]}addRange(t,e){this._ranges[t]=e}}const GlyphSource=class r{constructor(t){this._glyphInfo={},this._baseURL=t}getRange(a,r){const n=this._getFontStack(a);if(n.getRange(r))return Promise.resolve();const i=256*r,c=i+255,g=this._baseURL.replace("{fontstack}",a).replace("{range}",i+"-"+c);return(0,request.default)(g,{responseType:"array-buffer"}).then((t=>{n.addRange(r,new GlyphSource_s(new pbf.Z(new Uint8Array(t.data),new DataView(t.data))))})).catch((()=>{n.addRange(r,new GlyphSource_s)}))}getGlyph(t,e){const s=this._getFontStack(t);if(!s)return;const a=Math.floor(e/256);if(a>256)return;const r=s.getRange(a);return r?{metrics:r.getMetrics(e),bitmap:r.getBitmap(e)}:void 0}_getFontStack(t){let e=this._glyphInfo[t];return e||(e=this._glyphInfo[t]=new a),e}};class SpriteMosaic_s{constructor(t,i,s=0){this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,(t<=0||i<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=t,this._pageHeight=i,s>0&&(this._maxItemSize=s),this._binPack=new RectangleBinPack(t-4,i-4)}getWidth(t){return t>=this._size.length?-1:this._size[t][0]}getHeight(t){return t>=this._size.length?-1:this._size[t][1]}setSpriteSource(t){if(this.dispose(),this.pixelRatio=t.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new RectangleBinPack(this._pageWidth-4,this._pageHeight-4);const t=Math.floor(this._pageWidth),i=Math.floor(this._pageHeight),s=new Uint32Array(t*i);this._mosaicsData[0]=s,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=t}getSpriteItem(t,i=!1){let e=this._mosaicRects[t];if(e)return e;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;const s=this._sprites.getSpriteInfo(t);if(!s||!s.width||!s.height||s.width<0||s.height<0)return null;const h=s.width,a=s.height,[r,o,_]=this._allocateImage(h,a);return r.width<=0?null:(this._copy(r,s,o,_,i),e={rect:r,width:h,height:a,sdf:s.sdf,simplePattern:!1,pixelRatio:s.pixelRatio,page:o},this._mosaicRects[t]=e,e)}getSpriteItems(t){const i={};for(const e of t)i[e]=this.getSpriteItem(e);return i}getMosaicItemPosition(t,i){const e=this.getSpriteItem(t,i),s=e&&e.rect;if(!s)return null;s.width=e.width,s.height=e.height;const h=e.width,a=e.height,o=this._size[e.page];return{size:[e.width,e.height],tl:[(s.x+2)/o[0],(s.y+2)/o[1]],br:[(s.x+2+h)/o[0],(s.y+2+a)/o[1]],page:e.page}}bind(i,e,s=0,h=0){this._textures[s]||(this._textures[s]=new Texture.Z(i,{pixelFormat:6408,dataType:5121,wrapMode:33071,width:this._size[s][0],height:this._size[s][1]},new Uint8Array(this._mosaicsData[s].buffer)));const a=this._textures[s];a.setSamplingMode(e),this._dirties[s]&&a.setData(new Uint8Array(this._mosaicsData[s].buffer)),i.bindTexture(a,h),this._dirties[s]=!1}static _copyBits(t,i,e,s,h,a,r,o,_,n,g){let c=s*i+e,p=o*a+r;if(g){p-=a;for(let r=-1;r<=n;r++,c=((r+n)%n+s)*i+e,p+=a)for(let i=-1;i<=_;i++)h[p+i]=t[c+(i+_)%_]}else for(let l=0;l<n;l++){for(let i=0;i<_;i++)h[p+i]=t[c+i];c+=i,p+=a}}_copy(t,i,e,h,a,r){if(!this._sprites||"loaded"!==this._sprites.loadStatus||e>=this._mosaicsData.length)return;const o=new Uint32Array(r?r.buffer:this._sprites.image.buffer),_=this._mosaicsData[e];_&&o||console.error("Source or target images are uninitialized!");const g=r?i.width:this._sprites.width;SpriteMosaic_s._copyBits(o,g,i.x,i.y,_,h[0],t.x+2,t.y+2,i.width,i.height,a),this._dirties[e]=!0}_allocateImage(t,s){t+=2,s+=2;const h=Math.max(t,s);if(this._maxItemSize&&this._maxItemSize<h){const e=new Rect.Z(0,0,t,s);return this._mosaicsData.push(new Uint32Array(t*s)),this._dirties.push(!0),this._size.push([t,s]),this._textures.push(void 0),[e,this._mosaicsData.length-1,[t,s]]}let a=t%4?4-t%4:4,r=s%4?4-s%4:4;1===a&&(a=5),1===r&&(r=5);const o=this._binPack.allocate(t+a,s+r);return o.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new RectangleBinPack(this._pageWidth-4,this._pageHeight-4),this._allocateImage(t,s)):[o,this._currentPage,[this._pageWidth,this._pageHeight]]}dispose(){this._binPack=null,this._mosaicRects={};for(const t of this._textures)t&&t.dispose();this._textures.length=0}}const SpriteMosaic=SpriteMosaic_s;var debugging=__webpack_require__(48018);const p=new ItemCache.Z(10),y=new Map;class f{constructor(e,t,s){this._vectorTileLayer=e,this._styleRepository=t,this.devicePixelRatio=s,this._spriteMosaic=null,this._glyphMosaic=null,this._connection=null}destroy(){this._connection&&(this._connection.close(),this._connection=null),this._styleRepository=null,this._vectorTileLayer=null,this._spriteMosaic&&(this._spriteMosaic=null),this._glyphMosaic&&(this._glyphMosaic=null)}get spriteMosaic(){return this._spriteSourcePromise.then((()=>this._spriteMosaic))}get glyphMosaic(){return this._glyphMosaic}async start(t){const s=this._vectorTileLayer,r=s.sourceNameToSource,i=[];for(const e in r)i.push(this._fetchTileMap(r[e],t));this._spriteSourcePromise=this._vectorTileLayer.loadSpriteSource(this.devicePixelRatio,t),this._spriteSourcePromise.then((e=>{this._spriteMosaic=new SpriteMosaic(1024,1024,250),this._spriteMosaic.setSpriteSource(e)}));const a=this._styleRepository,l=new GlyphSource(a.glyphs);return this._glyphMosaic=new GlyphMosaic(1024,1024,l),this._broadcastPromise=(0,workers.bA)("WorkerTileHandler",{client:this,scheduler:t.scheduler,signal:t.signal}).then((r=>(this._connection=r,Promise.all(this._connection.broadcast("setStyle",{style:s.currentStyleInfo.style,vectorTileLayerMaxBuffers:(0,has.Z)("vectortilelayer-max-buffers")},t))))),Promise.all(i)}async updateStyle(e){return await this._broadcastPromise,this._broadcastPromise=new Promise(((t,s)=>{Promise.all(this._connection.broadcast("updateStyle",e)).then(t,s)})),this._broadcastPromise}async setStyle(t,s){await this._broadcastPromise,this._styleRepository=t;const r=this._vectorTileLayer.sourceNameToSource,i=[];for(const e in r)i.push(this._fetchTileMap(r[e],null));this._spriteSourcePromise=this._vectorTileLayer.loadSpriteSource(this.devicePixelRatio,null),this._spriteSourcePromise.then((e=>{this._spriteMosaic=new SpriteMosaic(1024,1024,250),this._spriteMosaic.setSpriteSource(e)}));const o=new GlyphSource(t.glyphs);return this._glyphMosaic=new GlyphMosaic(1024,1024,o),this._broadcastPromise=new Promise(((t,r)=>{Promise.all(this._connection.broadcast("setStyle",{style:s,vectorTileLayerMaxBuffers:(0,has.Z)("vectortilelayer-max-buffers")})).then(t,r)})),i.push(this._broadcastPromise),Promise.all(i)}fetchTileData(e,t){return this._getRefKeys(e,t).then((e=>{const s=this._vectorTileLayer.sourceNameToSource,r=[];for(const t in s)r.push(t);return this._getSourcesData(r,e,t)}))}parseTileData(e,t){const s=e&&e.data;if(!s)return Promise.resolve(null);const{sourceName2DataAndRefKey:r,transferList:i}=s;return 0===Object.keys(r).length?Promise.resolve(null):this._broadcastPromise.then((()=>this._connection.getAvailableClient().then((s=>s.invoke("createTileAndParse",{key:e.key.id,sourceName2DataAndRefKey:r,styleLayerUIDs:e.styleLayerUIDs},{...t,transferList:i}).then((e=>({tileData:e})))))))}async getSprites(e){return await this._spriteSourcePromise,this._spriteMosaic.getSpriteItems(e)}getGlyphs(e){return this._glyphMosaic.getGlyphItems(e.font,e.codePoints)}perfReport({key:e,milliseconds:t}){(0,debugging.uA)(e,t,"ms")}async _getTilePayload(e,s,r){const i=TileKey.Z.pool.acquire(e.id),o=this._vectorTileLayer.sourceNameToSource[s].getSourceTileUrl(i.level,i.row,i.col);TileKey.Z.pool.release(i);try{return{protobuff:await this.request(o,r),sourceName:s}}catch(l){if((0,promiseUtils.D_)(l))throw l;return{protobuff:null,sourceName:s}}}request(e,t){return(0,request.default)(e,{responseType:"array-buffer",...t}).then((({data:e})=>e))}async _fetchTileMap(e,s){if(e.capabilities.operations.supportsTileMap&&e.tileIndex)return Promise.resolve();if(!e.tileMapURL)return;const i=p.get(e.tileMapURL);if(i)return void(e.tileIndex=i);let o;if(y.has(e.tileMapURL)){try{o=await y.get(e.tileMapURL),e.tileIndex=new TileIndex.Z(o.data)}catch(n){if((0,promiseUtils.D_)(n))throw n}return}const a=(0,request.default)(e.tileMapURL,s);y.set(e.tileMapURL,a);try{o=await a,y.delete(e.tileMapURL),p.put(e.tileMapURL,e.tileIndex),e.tileIndex=new TileIndex.Z(o.data)}catch(n){if(y.delete(e.tileMapURL),(0,promiseUtils.D_)(n))throw n}}_getRefKeys(e,t){const r=this._vectorTileLayer.sourceNameToSource,i=new Array;for(const s in r){const o=r[s].getRefKey(e,t);i.push(o)}return(0,promiseUtils.as)(i)}_getSourcesData(e,t,r){const i=[];for(let s=0;s<t.length;s++)if(null==t[s].value||null==e[s])i.push(null);else{const o=this._getTilePayload(t[s].value,e[s],r);i.push(o)}return(0,promiseUtils.as)(i).then((e=>{const s={},r=[];for(let i=0;i<e.length;i++)if(e[i].value&&e[i].value&&e[i].value.protobuff&&e[i].value.protobuff.byteLength>0){const o=t[i].value.id;s[e[i].value.sourceName]={refKey:o,protobuff:e[i].value.protobuff},r.push(e[i].value.protobuff)}return{sourceName2DataAndRefKey:s,transferList:r}}))}}},12559:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{g:()=>i});var _core_maybe_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(59472),_config_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(41658);function t(o,e){if(o.priority-e.priority)return o.priority-e.priority;const t=o.tile.key,i=e.tile.key;return t.world-i.world?t.world-i.world:t.level-i.level?t.level-i.level:t.row-i.row?t.row-i.row:t.col-i.col?t.col-i.col:o.xTile-e.xTile?o.xTile-e.xTile:o.yTile-e.yTile}class i{constructor(o,e,t,i,s,r){this._visibleTiles=o,this._symbolRepository=e,this._createCollisionJob=t,this._assignTileSymbolsOpacity=i,this._symbolLayerSorter=s,this._isLayerVisible=r,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}get running(){return this._running}setScreenSize(o,e){this._screenWidth===o&&this._screenHeight===e||this.restart(),this._screenWidth=o,this._screenHeight=e}restart(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}continue(o){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){const e=performance.now();if(!this._selectionJob.work(o))return!1;if(this._selectionJobCompleted=!0,0===(o=Math.max(0,o-(performance.now()-e))))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){const e=performance.now();if(!this._collisionJob.work(o))return!1;if(this._collisionJobCompleted=!0,0===(o=Math.max(0,o-(performance.now()-e))))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){const e=performance.now();if(!this._opacityJob.work(o))return!1;if(this._opacityJobCompleted=!0,0===(o=Math.max(0,o-(performance.now()-e))))return!1}return this._running=!1,!0}_createSelectionJob(){const o=this._symbolRepository.uniqueSymbols,e=[];let i=0,s=0;const r=this._isLayerVisible;const l=this._symbolLayerSorter;return{work:function n(n){let l;const c=performance.now();for(;s<o.length;s++,i=0){const t=o[s],h=t.styleLayerUID;if(!r(h)){e[s]||(e[s]={styleLayerUID:h,symbols:[]});continue}e[s]=e[s]||{styleLayerUID:h,symbols:[]};const a=e[s];for(;i<t.uniqueSymbols.length;i++){if(l=t.uniqueSymbols[i],i%100==99&&performance.now()-c>n)return!1;let o=null,e=!1,s=!1;for(const t of l.tileSymbols)if(t.selectedForRendering=!1,!s||!e){const i=t.tile;(!o||i.isCoverage||i.neededForCoverage&&!e)&&(o=t,(i.neededForCoverage||i.isCoverage)&&(s=!0),i.isCoverage&&(e=!0))}if(o.selectedForRendering=!0,s){a.symbols.push(o),l.show=!0;for(const o of l.parts)o.show=!0}else l.show=!1}}for(const o of e)o.symbols.sort(t);return!0},get sortedSymbols(){return e.sort(l)}}}_createOpacityJob(){const e=this._assignTileSymbolsOpacity,t=this._visibleTiles;let i=0;function r(o,t){const i=o.symbols;for(const[e,r]of i)s(r,t);e(o,t);for(const e of o.childrenTiles)r(e,t)}return{work(e){const s=performance.now();for(;i<t.length;i++){if(performance.now()-s>e)return!1;const n=t[i];(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_0__.pC)(n.parentTile)||r(n,performance.now())}return!0}}}}function s(o,t){for(const i of o){const o=i.unique;for(const i of o.parts){const s=i.targetOpacity>.5?1:-1;i.startOpacity+=s*((t-i.startTime)/_config_js__WEBPACK_IMPORTED_MODULE_1__.nN),i.startOpacity=Math.min(Math.max(i.startOpacity,0),1),i.startTime=t,i.targetOpacity=o.show&&i.show?1:0}}}},49922:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{L:()=>r});var _core_maybe_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(59472),_util_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(17441);class r{constructor(e,s,o){this.tileCoordRange=e,this._visibleTiles=s,this._createUnique=o,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}get uniqueSymbols(){return(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_0__.Wi)(this._uniqueSymbolLayerArray)&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}add(e,s){this._uniqueSymbolLayerArray=null;let t=this._tiles.get(e.id);t||(t={symbols:new Map},this._tiles.set(e.id,t));const r=new Map;if(s)for(const o of s)t.symbols.has(o)&&(r.set(o,t.symbols.get(o)),t.symbols.delete(o));else for(const[o,l]of e.layerData)t.symbols.has(o)&&(r.set(o,t.symbols.get(o)),t.symbols.delete(o));this._removeSymbols(r);const y=e.symbols,a=new Map;for(const[f,c]of y){let e=c.length;if(e>=32){let s=this.tileCoordRange;do{s/=2,e/=4}while(e>8&&s>64);const l=new _util_js__WEBPACK_IMPORTED_MODULE_1__.HX(this.tileCoordRange,this.tileCoordRange,s);a.set(f,{flat:c,index:l}),t.symbols.set(f,{flat:c,index:l});for(const e of c)l.getCell(e.xTile,e.yTile).push(e)}else a.set(f,{flat:c}),t.symbols.set(f,{flat:c})}this._addSymbols(e.key,y)}deleteStyleLayers(e){this._uniqueSymbolLayerArray=null;for(const[s,o]of this._tiles){const t=new Map;for(const s of e)o.symbols.has(s)&&(t.set(s,o.symbols.get(s)),o.symbols.delete(s));this._removeSymbols(t),0===o.symbols.size&&this._tiles.delete(s)}}removeTile(e){this._uniqueSymbolLayerArray=null;const s=this._tiles.get(e.id);if(!s)return;const o=new Map;for(const[t,l]of e.symbols)s.symbols.has(t)&&(o.set(t,s.symbols.get(t)),s.symbols.delete(t));this._removeSymbols(o),0===s.symbols.size&&this._tiles.delete(e.id)}_removeSymbols(e){for(const[s,{flat:o}]of e)for(const e of o){const o=e.unique,t=o.tileSymbols,l=t.length-1;for(let s=0;s<l;s++)if(t[s]===e){t[s]=t[l];break}if(t.length=l,0===l){const e=this._uniqueSymbolsReferences.get(s);e.delete(o),0===e.size&&this._uniqueSymbolsReferences.delete(s)}e.unique=null}}_addSymbols(s,o){if(0===o.size)return;const t=this._visibleTiles;for(const e of t)e.parentTile||e.key.world!==s.world||e.key.level===s.level&&!e.key.equals(s)||this._matchSymbols(e,s,o);for(const[l,i]of o)for(const s of i)if((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_0__.Wi)(s.unique)){const e=this._createUnique();s.unique=e,e.tileSymbols.push(s);let o=this._uniqueSymbolsReferences.get(l);o||(o=new Set,this._uniqueSymbolsReferences.set(l,o)),o.add(e)}}_matchSymbols(e,o,l){if(e.key.level>o.level){const s=e.key.level-o.level;if(e.key.row>>s!==o.row||e.key.col>>s!==o.col)return}if(o.level>e.key.level){const s=o.level-e.key.level;if(o.row>>s!==e.key.row||o.col>>s!==e.key.col)return}if(o.equals(e.key)){for(const s of e.childrenTiles)this._matchSymbols(s,o,l);return}const i=new Map;for(const[n,r]of l){const l=[];for(const s of r){const i=(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.co)(this.tileCoordRange,s.xTile,o.level,o.col,e.key.level,e.key.col),n=(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.co)(this.tileCoordRange,s.yTile,o.level,o.row,e.key.level,e.key.row);i>=0&&i<this.tileCoordRange&&n>=0&&n<this.tileCoordRange&&l.push({symbol:s,xTransformed:i,yTransformed:n})}const y=[],a=e.key.level<o.level?1:1<<e.key.level-o.level,f=this._tiles.get(e.id).symbols.get(n);if(f){const e=f.flat;for(const o of l){let t,l=!1;const i=o.xTransformed,n=o.yTransformed;t=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_0__.pC)(f.index)?f.index.getCell(i,n):e;const r=o.symbol,c=r.hash;for(const e of t)if(c===e.hash&&Math.abs(i-e.xTile)<=a&&Math.abs(n-e.yTile)<=a){const s=e.unique;r.unique=s,s.tileSymbols.push(r),l=!0;break}l||y.push(r)}}y.length>0&&i.set(n,y)}for(const s of e.childrenTiles)this._matchSymbols(s,o,i)}_createUniqueSymbolLayerArray(){const e=this._uniqueSymbolsReferences,s=new Array(e.size);let o,t=0;for(const[l,i]of e){const e=new Array(i.size);o=0;for(const s of i)e[o++]=s;s[t]={styleLayerUID:l,uniqueSymbols:e},t++}return s}}},48018:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";function t(t,e,n,o,l,i){t.fillStyle=e,t.fillRect(n,o,l,i)}function e(t,e,n,o,l,i){t.strokeStyle=e,t.strokeRect(n,o,l,i)}function n(t,e){t.strokeStyle="black";const n=e.cellSize,o=e.rows,l=e.columns;for(let i=0;i<o;i++){const o=e.cells[i],r=i*n,s=(i+1)*n;for(let e=0;e<l;e++){const l=o[e],i=e*n,d=(e+1)*n;t.strokeRect(i,r,d-i,s-r),t.fillText(`cells:${l.length}`,i+4,r+12)}}}function o(n,o){const l=window.COLLISION_XRAY;for(let i=0;i<o.length;++i){const r=!o[i].unique.show;if(l||!r)for(const s of o[i].colliders){if(!s.enabled)continue;const d=!o[i].unique.parts[s.partIndex].show;if(!l&&d)continue;const a=s.xScreen,c=s.yScreen,m=s.dxScreen,h=s.dyScreen;n.globalAlpha=r||d?.2:1,t(n,"green",a-1,c-1,3,3),e(n,"red",a+m,c+h,s.width,s.height),t(n,"blue",a+m-1,c+h-1,3,3),n.globalAlpha=1}}}function l(t,e,n){if(!window.PERFORMANCE_RECORDING_STORAGE)return;const o=window.PERFORMANCE_RECORDING_STORAGE;o.perf=o.perf||{};const l=o.perf;l[t]=l[t]||{start:null,time:0,min:void 0,max:void 0,samples:[],unit:n},l[t].time+=e,l[t].samples.push(e),(null==l[t].min||e<l[t].min)&&(l[t].min=e),(null==l[t].max||e>l[t].max)&&(l[t].max=e)}__webpack_require__.d(__webpack_exports__,{uF:()=>o,GF:()=>n,uA:()=>l})},84959:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{f:()=>r});var _chunks_mat3f32_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(55955),_config_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(41658),_util_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(17441);function o(e,t,n,o,r,s){const{iconRotationAlignment:i,textRotationAlignment:l,iconTranslate:a,iconTranslateAnchor:c,textTranslate:h,textTranslateAnchor:u}=o;let d=0;for(const y of e.colliders){const[e,o]=0===y.partIndex?a:h,x=0===y.partIndex?c:u,g=y.minLod<=s&&s<=y.maxLod;d+=g?0:1,y.enabled=g,y.xScreen=y.xTile*r[0]+y.yTile*r[3]+r[6],y.yScreen=y.xTile*r[1]+y.yTile*r[4]+r[7],0===x?(y.xScreen+=n*e-t*o,y.yScreen+=t*e+n*o):(y.xScreen+=e,y.yScreen+=o),1===(0===y.partIndex?i:l)?(y.dxScreen=y.dxPixels,y.dyScreen=y.dyPixels):(y.dxScreen=n*(y.dxPixels+y.width/2)-t*(y.dyPixels+y.height/2)-y.width/2,y.dyScreen=t*(y.dxPixels+y.width/2)+n*(y.dyPixels+y.height/2)-y.height/2)}e.colliders.length>0&&d===e.colliders.length&&(e.unique.show=!1)}class r{constructor(o,r,s,i,l,a){this._symbols=o,this._styleRepository=i,this._zoom=l,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new _util_js__WEBPACK_IMPORTED_MODULE_1__.HX(r,s,_config_js__WEBPACK_IMPORTED_MODULE_2__.PF),this._si=Math.sin(Math.PI*a/180),this._co=Math.cos(Math.PI*a/180);for(const t of o)for(const n of t.symbols)this._allNeededMatrices.has(n.tile)||this._allNeededMatrices.set(n.tile,(0,_chunks_mat3f32_js__WEBPACK_IMPORTED_MODULE_0__.a)(n.tile.transforms.tileUnitsToPixels))}work(e){const t=this._gridIndex;function n(e){const n=e.xScreen+e.dxScreen,o=e.yScreen+e.dyScreen,r=n+e.width,s=o+e.height,[i,l,a,c]=t.getCellSpan(n,o,r,s);for(let h=l;h<=c;h++)for(let e=i;e<=a;e++){const i=t.cells[h][e];for(const e of i){const t=e.xScreen+e.dxScreen,i=e.yScreen+e.dyScreen,l=t+e.width,a=i+e.height;if(!(r<t||n>l||s<i||o>a))return!0}}return!1}const r=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const t=this._symbols[this._currentLayerCursor],s=this._getProperties(t.styleLayerUID);for(;this._currentSymbolCursor<t.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-r>e)return!1;const i=t.symbols[this._currentSymbolCursor];if(!i.unique.show)continue;o(i,this._si,this._co,s,this._allNeededMatrices.get(i.tile),this._zoom);const l=i.unique;if(!l.show)continue;const{iconAllowOverlap:a,iconIgnorePlacement:c,textAllowOverlap:h,textIgnorePlacement:u}=s;for(const e of i.colliders){if(!e.enabled)continue;const t=l.parts[e.partIndex];t.show&&(!(e.partIndex?h:a)&&n(e)&&(e.hard?l.show=!1:t.show=!1))}if(l.show)for(const e of i.colliders){if(!e.enabled)continue;if(e.partIndex?u:c)continue;if(!l.parts[e.partIndex].show)continue;const t=e.xScreen+e.dxScreen,n=e.yScreen+e.dyScreen,o=t+e.width,r=n+e.height,[s,i,a,h]=this._gridIndex.getCellSpan(t,n,o,r);for(let l=i;l<=h;l++)for(let t=s;t<=a;t++)this._gridIndex.cells[l][t].push(e)}}}return!0}_getProperties(e){const t=this._styleProps.get(e);if(t)return t;const n=this._zoom,o=this._styleRepository.getStyleLayerByUID(e),r=0!==o.getLayoutValue("symbol-placement",n);let s=o.getLayoutValue("icon-rotation-alignment",n);2===s&&(s=r?0:1);let i=o.getLayoutValue("text-rotation-alignment",n);2===i&&(i=r?0:1);const l=o.getPaintValue("icon-translate",n),a=o.getPaintValue("icon-translate-anchor",n),c=o.getPaintValue("text-translate",n),h=o.getPaintValue("text-translate-anchor",n),u={iconAllowOverlap:o.getLayoutValue("icon-allow-overlap",n),iconIgnorePlacement:o.getLayoutValue("icon-ignore-placement",n),textAllowOverlap:o.getLayoutValue("text-allow-overlap",n),textIgnorePlacement:o.getLayoutValue("text-ignore-placement",n),iconRotationAlignment:s,textRotationAlignment:i,iconTranslateAnchor:a,iconTranslate:l,textTranslateAnchor:h,textTranslate:c};return this._styleProps.set(e,u),u}}},89998:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});const __WEBPACK_DEFAULT_EXPORT__=class t{constructor(t=0,h=0,i=0,s=0){this.x=t,this.y=h,this.width=i,this.height=s}get isEmpty(){return this.width<=0||this.height<=0}union(t){this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.width=Math.max(this.width,t.width),this.height=Math.max(this.height,t.height)}}}}]);
//# sourceMappingURL=6364.fd1190a2.iframe.bundle.js.map