"use strict";(self.webpackChunkreact_arcgis_wmws=self.webpackChunkreact_arcgis_wmws||[]).push([[4520],{6415:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{I:()=>n,b:()=>s});var _views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23410),_views_3d_webgl_engine_core_shaderLibrary_Transform_glsl_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4731),_views_3d_webgl_engine_core_shaderModules_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(3961),_views_3d_webgl_engine_core_shaderLibrary_util_ColorConversion_glsl_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(32394),_views_3d_webgl_engine_core_shaderLibrary_Slice_glsl_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(5885),_views_3d_webgl_engine_core_shaderLibrary_output_ReadLinearDepth_glsl_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(6665),_views_3d_webgl_engine_core_shaderLibrary_util_AlphaDiscard_glsl_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(41272),_views_3d_webgl_engine_core_shaderLibrary_shading_MultipassTerrainTest_glsl_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(73393);function s(s){const n=new _views_3d_webgl_engine_core_shaderModules_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_2__.kG;return n.include(_views_3d_webgl_engine_core_shaderLibrary_Transform_glsl_js__WEBPACK_IMPORTED_MODULE_1__.w,{linearDepth:!1}),n.vertex.uniforms.add("proj","mat4").add("view","mat4"),n.attributes.add("position","vec3"),n.attributes.add("uv0","vec2"),n.varyings.add("vpos","vec3"),s.multipassTerrainEnabled&&n.varyings.add("depth","float"),n.vertex.uniforms.add("textureCoordinateScaleFactor","vec2"),n.vertex.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_0__.H`
    void main(void) {
      vpos = position;
      ${s.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      vTexCoord = uv0 * textureCoordinateScaleFactor;
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),n.include(_views_3d_webgl_engine_core_shaderLibrary_Slice_glsl_js__WEBPACK_IMPORTED_MODULE_4__.p,s),s.multipassTerrainEnabled&&(n.fragment.include(_views_3d_webgl_engine_core_shaderLibrary_output_ReadLinearDepth_glsl_js__WEBPACK_IMPORTED_MODULE_5__.S),n.include(_views_3d_webgl_engine_core_shaderLibrary_shading_MultipassTerrainTest_glsl_js__WEBPACK_IMPORTED_MODULE_7__.l,s)),n.fragment.uniforms.add("tex","sampler2D"),n.fragment.uniforms.add("opacity","float"),n.varyings.add("vTexCoord","vec2"),7===s.output?n.fragment.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_0__.H`
    void main() {
      discardBySlice(vpos);
      ${s.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

      float alpha = texture2D(tex, vTexCoord).a * opacity;
      if (alpha  < ${_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_0__.H.float(_views_3d_webgl_engine_core_shaderLibrary_util_AlphaDiscard_glsl_js__WEBPACK_IMPORTED_MODULE_6__.F)}) {
        discard;
      }

      gl_FragColor = vec4(alpha);
    }
    `):(n.fragment.include(_views_3d_webgl_engine_core_shaderLibrary_util_ColorConversion_glsl_js__WEBPACK_IMPORTED_MODULE_3__.Y),n.fragment.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_0__.H`
    void main() {
      discardBySlice(vpos);
      ${s.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
      gl_FragColor = texture2D(tex, vTexCoord) * opacity;

      if (gl_FragColor.a < ${_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_0__.H.float(_views_3d_webgl_engine_core_shaderLibrary_util_AlphaDiscard_glsl_js__WEBPACK_IMPORTED_MODULE_6__.F)}) {
        discard;
      }

      gl_FragColor = highlightSlice(gl_FragColor, vpos);
      ${s.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    }
    `)),n}var n=Object.freeze({__proto__:null,build:s})},59468:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{function t(t,e){return e?"xoffset"in e&&e.xoffset?Math.max(t,Math.abs(e.xoffset)):"yoffset"in e&&e.yoffset?Math.max(t,Math.abs(e.yoffset||0)):t:t}function n(t,n){return"number"==typeof t?t:t&&t.stops&&t.stops.length?function e(t){let e=0,n=0;for(let r=0;r<t.length;r++){const s=t[r].size;"number"==typeof s&&(e+=s,n++)}return e/n}(t.stops):n}function r(t,e){if(!e)return t;const r=e.filter((t=>"size"===t.type)).map((e=>{const{maxSize:r,minSize:s}=e;return(n(r,t)+n(s,t))/2}));let s=0;const o=r.length;if(0===o)return t;for(let n=0;n<o;n++)s+=r[n];const f=Math.floor(s/o);return Math.max(f,t)}function s(e){const n=e&&e.renderer,s="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!n)return s;const o="visualVariables"in n?r(s,n.visualVariables):s;if("simple"===n.type)return t(o,n.symbol);if("unique-value"===n.type){let e=o;return n.uniqueValueInfos.forEach((n=>{e=t(e,n.symbol)})),e}if("class-breaks"===n.type){let e=o;return n.classBreakInfos.forEach((n=>{e=t(e,n.symbol)})),e}return n.type,o}__webpack_require__.d(__webpack_exports__,{k:()=>s})},65425:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>DynamicLayerView3D});var tslib_es6=__webpack_require__(36663),Logger=(__webpack_require__(39994),__webpack_require__(13802)),property=(__webpack_require__(7283),__webpack_require__(81977)),subclass=__webpack_require__(12571),promiseUtils=(__webpack_require__(3466),__webpack_require__(12173),__webpack_require__(51876),__webpack_require__(78668)),Extent=__webpack_require__(91772),asyncUtils=__webpack_require__(67979),watchUtils=__webpack_require__(15071),aaBoundingRect=__webpack_require__(24568),RefreshableLayerView=__webpack_require__(55068),debugFlags=__webpack_require__(3289),RenderGeometry=__webpack_require__(13304),Texture=__webpack_require__(44101),LayerView3D=__webpack_require__(19654),LayerView=__webpack_require__(26216),GLMaterialTexture=__webpack_require__(11327),MaterialUtil=__webpack_require__(25584),Material=__webpack_require__(7358),OrderIndependentTransparency=__webpack_require__(12045),DefaultBufferWriter=__webpack_require__(89339),ReloadableShaderModule=__webpack_require__(9969),ShaderTechnique=__webpack_require__(52756),ShaderTechniqueConfiguration=__webpack_require__(67197),DefaultVertexAttributeLocations=__webpack_require__(5474),Program=__webpack_require__(69002),renderState=__webpack_require__(17346),View_glsl=__webpack_require__(84614),Slice_glsl=__webpack_require__(5885),MultipassTerrainTest_glsl=__webpack_require__(73393),StencilUtils=__webpack_require__(79040),ImageMaterial_glsl=__webpack_require__(6415);class j extends ShaderTechnique.A{initializeProgram(e){const t=j.shader.get(),r=this.configuration,i=t.build({output:r.output,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,OITEnabled:0===r.transparencyPassType,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new Program.Z(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),DefaultVertexAttributeLocations.i)}bindPass(e,t,r){View_glsl.G.bindProjectionMatrix(this.program,r.camera.projectionMatrix),this.program.setUniform1f("opacity",t.opacity),r.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",r.camera.nearFar),this.program.setUniform2fv("inverseViewport",r.inverseViewport),(0,MultipassTerrainTest_glsl.C)(this.program,e,r))}bindDraw(e){View_glsl.G.bindView(this.program,e),Slice_glsl.p.bindUniformsWithOrigin(this.program,this.configuration,e)}setPipelineState(e,t){const r=this.configuration,i=3===e,s=2===e;return(0,renderState.sm)({blending:0!==r.output&&7!==r.output||!r.transparent?null:i?S:(0,OrderIndependentTransparency.$L)(e),culling:(e=>0!==e&&{face:1===e?1028:1029,mode:2305})(r.cullFace),depthTest:{func:(0,OrderIndependentTransparency.$x)(e)},depthWrite:i?r.writeDepth&&renderState.LZ:(0,OrderIndependentTransparency.Vc)(e),colorWrite:renderState.BK,stencilWrite:r.sceneHasOcludees?StencilUtils.s3:null,stencilTest:r.sceneHasOcludees?t?StencilUtils.eD:StencilUtils.RY:null,polygonOffset:i||s?null:(0,OrderIndependentTransparency.je)(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}j.shader=new ReloadableShaderModule.J(ImageMaterial_glsl.I,(()=>__webpack_require__.e(7204).then(__webpack_require__.bind(__webpack_require__,47204))));const S=(0,renderState.if)(1,771);class w extends ShaderTechniqueConfiguration.m{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!0}}(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)({count:8})],w.prototype,"output",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)({count:3})],w.prototype,"cullFace",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)()],w.prototype,"slicePlaneEnabled",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)()],w.prototype,"transparent",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)()],w.prototype,"enableOffset",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)()],w.prototype,"writeDepth",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)()],w.prototype,"sceneHasOcludees",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)({count:4})],w.prototype,"transparencyPassType",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)()],w.prototype,"multipassTerrainEnabled",void 0),(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)()],w.prototype,"cullAboveGround",void 0);class c extends Material.F5{constructor(e){super(e,o),this.supportsEdges=!0,this.techniqueConfig=new w}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<OrderIndependentTransparency.ve,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!t||t.cullAboveGround,this.techniqueConfig}intersect(e,i,a,s,r,n,u){(0,MaterialUtil.Bw)(e,i,s,r,n,void 0,u)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output?new l(e):void 0}createBufferWriter(){return new DefaultBufferWriter.G_(DefaultBufferWriter.W1)}}class l extends GLMaterialTexture.Z{constructor(e){super({...e,...e.material.params}),this.updateParameters()}updateParameters(e){const t=this.material.params;this.updateTexture(t.textureId),this.technique=this.techniqueRep.acquireAndReleaseExisting(j,this.material.getTechniqueConfig(this.output,e),this.technique)}beginSlot(e){return 4===this.output?3===e:e===(this.technique.configuration.transparent?this.technique.configuration.writeDepth?5:8:3)}_updateOccludeeState(e){e.hasOccludees!==this.material.params.sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters(e))}ensureParameters(e){0!==this.output&&7!==this.output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){e.bindProgram(this.technique.program),this.bindTexture(e,this.technique.program),this.bindTextureScale(e,this.technique.program),this.technique.bindPass(e,this.material.params,t)}getPipelineState(e,t){return this.technique.getPipelineState(t)}}const o={transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,opacity:1,textureId:null,initTextureTransparent:!0,...Material.zh};var Geometry=__webpack_require__(47562),GeometryUtil=__webpack_require__(6087);function overlayImageUtils_a(t,e){const n=[[t[0],t[1],e],[t[2],t[1],e],[t[2],t[3],e],[t[0],t[3],e]];return GeometryUtil.Z.createSquareGeometry(n)}function h(t,e,o){if(!(0,aaBoundingRect.kK)(t,e))return overlayImageUtils_a(e,o);const r=[t[1]-e[1],Math.min(t[3],e[3])-Math.max(t[1],e[1]),e[3]-t[3],123456],h=[t[0]-e[0],Math.min(t[2],e[2])-Math.max(t[0],e[0]),e[2]-t[2],123456],u=e[2]-e[0],l=e[3]-e[1],c=h[0]>0&&h[2]>0?3:2,m=r[0]>0&&r[2]>0?3:2,g=(m+1)*(c+1),w=new Float64Array(3*g),d=new Float32Array(2*g),f=new Uint32Array(6*(m*c-1));let p=0,y=0,x=0,M=0,v=0;for(let n=0;n<4;n++){const t=r[n];if(t<=0)continue;let i=0;for(let r=0;r<4;r++){const t=h[r];t<=0||(w[y++]=e[0]+i,w[y++]=e[1]+p,w[y++]=o,d[x++]=i/u,d[x++]=p/l,r<3&&n<3&&(1!==r||1!==n)&&(f[v++]=M,f[v++]=M+1,f[v++]=M+c+1,f[v++]=M+1,f[v++]=M+c+2,f[v++]=M+c+1),M++,i+=t)}p+=t}const b=new Uint32Array(f.length);return new Geometry.Z([["position",{size:3,data:w,exclusive:!0}],["normal",{size:3,data:s,exclusive:!0}],["uv0",{size:2,data:d,exclusive:!0}]],[["position",f],["normal",b],["uv0",f]])}const s=[0,0,1];var projectExtentUtils=__webpack_require__(53986);const M=Logger.Z.getLogger("esri.views.3d.layers.DynamicLayerView3D");let T=class extends((0,RefreshableLayerView.yc)((0,LayerView3D.A)(LayerView.Z))){constructor(){super(...arguments),this.drapeSourceType=0,this.fullExtentInLocalViewSpatialReference=null,this.maximumDataResolution=null,this._images=new Array,this._extents=new Array,this._overlayExtents=new Array,this.updateWhenStationary=!0}initialize(){this.addResolvingPromise((0,projectExtentUtils.E)(this).then((e=>this._set("fullExtentInLocalViewSpatialReference",e)))),this.updatingHandles.add(this,"suspended",(()=>this._suspendedChangeHandler())),this.handles.add(this.view.resourceController.scheduler.registerIdleStateCallbacks((()=>{this._isScaleRangeActive()&&this.notifyChange("suspended")}),(()=>{}))),this._isScaleRangeLayer()&&this.updatingHandles.add(this.layer,"scaleRangeId",(()=>this.notifyChange("suspended"))),"local"===this.view.viewingMode&&this.updatingHandles.add(this.view.basemapTerrain,"extent",(()=>this._overlayExtents.forEach(((e,t)=>this._updateImageExtent(t)))))}destroy(){this.clear()}setDrapingExtent(e,t,i,r,a,s){this._overlayExtents[e]={extent:(0,aaBoundingRect.Ue)(t),spatialReference:i,resolution:r,renderLocalOrigin:a,pixelRatio:s},this._updateImageExtent(e)}_updateImageExtent(e){const t=this._overlayExtents[e],i=this._clippedExtent(t.extent,H),r=function overlayImageUtils_r(n,i,o){const r=(0,aaBoundingRect.bf)(n)/(0,aaBoundingRect.Cb)(n),a={width:o,height:o};return r>1.0001?a.height=o/r:r<.9999&&(a.width=o*r),a.width=Math.round(a.width/((0,aaBoundingRect.bf)(n)/(0,aaBoundingRect.bf)(i))),a.height=Math.round(a.height/((0,aaBoundingRect.Cb)(n)/(0,aaBoundingRect.Cb)(i))),a}(t.extent,i,t.resolution);let s=t.pixelRatio*this.view.pixelRatio;if("imageMaxWidth"in this.layer||"imageMaxHeight"in this.layer){const e=this.layer.imageMaxWidth,t=this.layer.imageMaxHeight;if(r.width>e){const t=e/r.width;r.height=Math.floor(r.height*t),r.width=e,s*=t}if(r.height>t){const e=t/r.height;r.width=Math.floor(r.width*e),r.height=t,s*=e}}const n=this._extents[e];n&&(0,aaBoundingRect.fS)(n.extent,i)&&!this._imageSizeDiffers(i,n.imageSize,r)||(this._extents[e]={extent:(0,aaBoundingRect.Ue)(i),spatialReference:t.spatialReference,imageSize:r,pixelRatio:s},this.suspended||this._fetch(e).catch((e=>{(0,promiseUtils.D_)(e)||M.error(e)})))}clear(){for(let e=0;e<this._images.length;e++)this._clearImage(e)}async doRefresh(e){if(this.suspended)return;const t=[];for(let i=0;i<this._extents.length;i++)this._extents[i]&&t.push(this._fetch(i,e));await(0,promiseUtils.as)(t)}canResume(){if(!super.canResume())return!1;if(this._isScaleRangeLayer()){const{minScale:e,maxScale:t}=this.layer;if(e>0||t>0){const i=this.view.scale;if(i<t||e>0&&i>e)return!1}}return!0}isUpdating(){return this._images.some((e=>!!e.loadingPromise))}async processResult(e,t,i){(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)&&(e.image=t)}findExtentInfoAt(e){for(const t of this._extents){const i=t.extent;if(new Extent.Z(i[0],i[1],i[2],i[3],t.spatialReference).contains(e))return t}return null}getFetchOptions(){}async redraw(e,t){await(0,asyncUtils.Ed)(this._images,(async(i,r)=>{i&&(await e(i,t),this._createStageObjects(r,i.image))}))}_imageSizeDiffers(e,t,i){if(!this.maximumDataResolution)return!0;if(debugFlags.Z.TESTS_DISABLE_UPDATE_THRESHOLDS)return!0;const r=(0,aaBoundingRect.bf)(e)/this.maximumDataResolution.x,a=(0,aaBoundingRect.Cb)(e)/this.maximumDataResolution.y,s=r/t.width,n=a/t.height,o=r/i.width,l=a/i.height,h=Math.abs(s-o),m=Math.abs(n-l);return h>1.5||m>1.5}async _fetch(e,t){if(this.suspended)return;const i=this._overlayExtents[e],r=this._extents[e],s=r.extent,d=new Extent.Z(s[0],s[1],s[2],s[3],r.spatialReference);this._images[e]||(this._images[e]={texture:null,material:null,rendergeometry:null,loadingPromise:null,loadingAbortController:null,image:null,pixelData:null,renderExtent:(0,aaBoundingRect.Ue)(s)});const g=this._images[e];if(g.loadingAbortController&&(g.loadingAbortController.abort(),g.loadingAbortController=null),0===d.width||0===d.height)return void this._clearImage(e);const u=(0,promiseUtils.yi)();g.loadingAbortController=u,(0,promiseUtils.fu)(t,(()=>u.abort()));const y=u.signal,f=this._waitFetchReady(y).then((()=>{const e={requestAsImageElement:!0,pixelRatio:i.pixelRatio,...this.getFetchOptions(),signal:y},{height:t,width:a}=r.imageSize;return e.timestamp=this.refreshTimestamp,this.layer.fetchImage(d,a,t,e)})).then((e=>{if((0,promiseUtils.Hc)(y))throw M.warnOnce("A call to fetchImage resolved even though the request was aborted. fetchImage should not resolve if options.signal.aborted is true."),(0,promiseUtils.zE)();return this.processResult(g,e)}));g.loadingPromise=f,(0,promiseUtils.Bx)(f,(()=>{f===g.loadingPromise&&(g.loadingPromise=null,g.loadingAbortController=null)}));const x=f.then((()=>{(0,aaBoundingRect.t8)(g.renderExtent,s),this._createStageObjects(e,g.image),this.notifyChange("updating")})).catch((e=>{throw e&&!(0,promiseUtils.D_)(e)&&M.error(e),this.notifyChange("updating"),e}));this.notifyChange("updating"),await x}_clearImage(e){const t=this._images[e],i=this.view._stage;t&&(t.rendergeometry&&(this.view.basemapTerrain.overlayManager.renderer.removeGeometries([t.rendergeometry],this,2),t.rendergeometry=null),t.texture&&(i.remove(t.texture),t.texture=null),t.material&&(i.remove(t.material),t.material=null),t.loadingAbortController&&(t.loadingAbortController.abort(),t.loadingAbortController=null),t.loadingPromise=null,t.image=null,t.pixelData=null)}_createStageObjects(e,t){const i=this.view._stage,r=this._images[e];r.texture&&(i.remove(r.texture),r.texture=null),t?(r.texture=new Texture.x(t,{width:t.width,height:t.height,preMultiplyAlpha:!0,wrap:{s:33071,t:33071}}),i.add(r.texture)):r.material&&(i.remove(r.material),r.material=null),!r.material&&r.texture?(r.material=new c({transparent:!0,textureId:r.texture.id}),i.add(r.material)):r.material&&t&&r.material.setParameterValues({textureId:r.texture.id});const a=this.view.basemapTerrain.overlayManager.renderer;if(r.material){const t=-1;let i;const s=this._overlayExtents[e].renderLocalOrigin;if(0===e)i=overlayImageUtils_a(r.renderExtent,t);else{if(1!==e)return void console.error("DynamicLayerView3D._createStageObjects: Invalid extent idx");{const e=this._extents[0].extent;if(!e)return;i=h(e,r.renderExtent,t)}}const n=new RenderGeometry.z(i,r.material);n.origin=s,a.addGeometries([n],this,2),r.rendergeometry&&a.removeGeometries([r.rendergeometry],this,2),r.rendergeometry=n}else r.rendergeometry&&(a.removeGeometries([r.rendergeometry],this,2),r.rendergeometry=null)}_isScaleRangeLayer(){return"minScale"in this.layer&&"maxScale"in this.layer}_isScaleRangeActive(){return!!this._isScaleRangeLayer()&&(this.layer.minScale>0||this.layer.maxScale>0)}_clippedExtent(e,t){if("local"!==this.view.viewingMode)return(0,aaBoundingRect.t8)(t,e);const i=this.view.basemapTerrain,r=i.extent;return i.ready&&r?(0,aaBoundingRect.jV)(e,r,t):(0,aaBoundingRect.t8)(t,e)}_suspendedChangeHandler(){this.suspended?this.clear():this.refresh()}async _waitFetchReady(e){this.updateWhenStationary&&await(0,watchUtils.N1)(this.view,"stationary",e),(0,promiseUtils.k_)(e)}};(0,tslib_es6._)([(0,property.Cb)()],T.prototype,"layer",void 0),(0,tslib_es6._)([(0,property.Cb)()],T.prototype,"suspended",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],T.prototype,"fullExtentInLocalViewSpatialReference",void 0),(0,tslib_es6._)([(0,property.Cb)()],T.prototype,"updating",void 0),T=(0,tslib_es6._)([(0,subclass.j)("esri.views.3d.layers.DynamicLayerView3D")],T);const H=(0,aaBoundingRect.Ue)();const DynamicLayerView3D=T},34520:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(36663),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__(39994),__webpack_require__(13802),__webpack_require__(7283),__webpack_require__(81977),__webpack_require__(12571)),_support_drapedUtils_js__WEBPACK_IMPORTED_MODULE_8__=(__webpack_require__(3466),__webpack_require__(12173),__webpack_require__(51876),__webpack_require__(99621)),_layers_MapImageLayerView_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(82512),_DynamicLayerView3D_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(65425);let i=class extends((0,_layers_MapImageLayerView_js__WEBPACK_IMPORTED_MODULE_9__.m)(_DynamicLayerView3D_js__WEBPACK_IMPORTED_MODULE_10__.Z)){constructor(){super(...arguments),this.updateWhenStationary=!0}initialize(){this.updatingHandles.add(this,"exportImageVersion",(()=>this.updatingHandles.addPromise(this.refreshDebounced())))}createFetchPopupFeaturesQueryGeometry(e,r){return(0,_support_drapedUtils_js__WEBPACK_IMPORTED_MODULE_8__.K)(e,r,this.view)}getFetchOptions(){return{timeExtent:this.timeExtent,timestamp:this.refreshTimestamp}}};i=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_11__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_4__.j)("esri.views.3d.layers.MapImageLayerView3D")],i);const __WEBPACK_DEFAULT_EXPORT__=i},53986:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{E:()=>t});var _geometry_support_webMercatorUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(39536),_portal_support_geometryServiceUtils_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(8060);function t(t){const l=t.view.spatialReference,s=t.layer.fullExtent,i=s&&s.spatialReference;return i?i.equals(l)?Promise.resolve(s.clone()):(0,_geometry_support_webMercatorUtils_js__WEBPACK_IMPORTED_MODULE_0__.Q8)(i,l)?Promise.resolve((0,_geometry_support_webMercatorUtils_js__WEBPACK_IMPORTED_MODULE_0__.iV)(s,l)):t.view.state.isLocal?(0,_portal_support_geometryServiceUtils_js__WEBPACK_IMPORTED_MODULE_1__.projectGeometry)(s,l,t.layer.portalItem).then((e=>!t.destroyed&&e?e:void 0)).catch((()=>null)):Promise.resolve(null):Promise.resolve(null)}},82512:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{m:()=>c});var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(36663),_core_maybe_js__WEBPACK_IMPORTED_MODULE_14__=(__webpack_require__(39994),__webpack_require__(61681)),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__=(__webpack_require__(13802),__webpack_require__(7283),__webpack_require__(81977)),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(12571),_core_Error_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(70375),_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_9__=(__webpack_require__(3466),__webpack_require__(12173),__webpack_require__(51876),__webpack_require__(78668)),_support_arcadeOnDemand_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(30879),_layers_support_commonProperties_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(23072),_layers_support_ExportImageParameters_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(24065),_renderers_support_clickToleranceUtils_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(59468),_support_popupUtils_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(59439);const c=c=>{let y=class extends c{initialize(){this.exportImageParameters=new _layers_support_ExportImageParameters_js__WEBPACK_IMPORTED_MODULE_12__.R({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get exportImageVersion(){var e;return null==(e=this.exportImageParameters)||e.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}async fetchPopupFeatures(e,t){const{layer:o}=this;if(!e)return Promise.reject(new _core_Error_js__WEBPACK_IMPORTED_MODULE_5__.Z("mapimagelayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:o}));const p=this.get("view.scale"),i=[],m=async e=>{const o=0===e.minScale||p<=e.minScale,s=0===e.maxScale||p>=e.maxScale;if(e.visible&&o&&s)if(e.sublayers)e.sublayers.forEach(m);else if(e.popupEnabled){const o=(0,_support_popupUtils_js__WEBPACK_IMPORTED_MODULE_13__.V)(e,{...t,defaultPopupTemplateEnabled:!1});(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_14__.pC)(o)&&i.unshift({sublayer:e,popupTemplate:o})}},c=o.sublayers.toArray().reverse().map(m);await Promise.all(c);const y=i.map((async({sublayer:o,popupTemplate:s})=>{await o.load().catch((()=>{}));const a=o.createQuery(),p=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_14__.pC)(t)?t.event:null,i=(0,_renderers_support_clickToleranceUtils_js__WEBPACK_IMPORTED_MODULE_15__.k)({renderer:o.renderer,event:p}),m=this.createFetchPopupFeaturesQueryGeometry(e,i);a.geometry=m,a.outFields=await(0,_support_popupUtils_js__WEBPACK_IMPORTED_MODULE_13__.e)(o,s);const n=await this._loadArcadeModules(s);return n&&n.arcadeUtils.hasGeometryOperations(s)||(a.maxAllowableOffset=m.width/i),(await o.queryFeatures(a)).features}));return(await(0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_9__.as)(y)).reduce(((e,r)=>r.value?[...e,...r.value]:e),[]).filter((e=>null!=e))}canResume(){var e;return!(!super.canResume()||null!=(e=this.timeExtent)&&e.isEmpty)}_loadArcadeModules(e){if(e.get("expressionInfos.length"))return(0,_support_arcadeOnDemand_js__WEBPACK_IMPORTED_MODULE_10__.LC)()}};return(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)()],y.prototype,"exportImageParameters",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({readOnly:!0})],y.prototype,"exportImageVersion",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)()],y.prototype,"layer",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)()],y.prototype,"suspended",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)(_layers_support_commonProperties_js__WEBPACK_IMPORTED_MODULE_11__.qG)],y.prototype,"timeExtent",void 0),y=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_4__.j)("esri.views.layers.MapImageLayerView")],y),y}},59439:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{V:()=>d,e:()=>i});var _core_maybe_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(61681),_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(14845);async function i(i,d=i.popupTemplate){if(!(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_1__.pC)(d))return[];const o=await d.getRequiredFields(i.fields),{lastEditInfoEnabled:s}=d,{objectIdField:u,typeIdField:a,globalIdField:n,relationships:f}=i;if(o.includes("*"))return["*"];const r=s?await(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.CH)(i):[],m=(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.Q0)(i.fields,[...o,...r]);return a&&m.push(a),m&&u&&(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.cT)(i.fields,u)&&-1===m.indexOf(u)&&m.push(u),m&&n&&(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.cT)(i.fields,n)&&-1===m.indexOf(n)&&m.push(n),f&&f.forEach((e=>{const{keyField:p}=e;m&&p&&(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.cT)(i.fields,p)&&-1===m.indexOf(p)&&m.push(p)})),m}function d(p,l){return p.popupTemplate?p.popupTemplate:(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_1__.pC)(l)&&l.defaultPopupTemplateEnabled&&(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_1__.pC)(p.defaultPopupTemplate)?p.defaultPopupTemplate:null}},99621:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{K:()=>a});var _core_maybe_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(61681),_geometry_Extent_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(91772),_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_2__=(__webpack_require__(91957),__webpack_require__(17321));function a(t,i,a,o=new _geometry_Extent_js__WEBPACK_IMPORTED_MODULE_0__.Z){let s;if("2d"===a.type)s=i*a.resolution;else if("3d"===a.type){const r=a.overlayPixelSizeInMapUnits(t),o=a.basemapSpatialReference;s=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_3__.pC)(o)&&!o.equals(a.spatialReference)?(0,_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_2__.c9)(o)/(0,_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_2__.c9)(a.spatialReference):i*r}const m=t.x-s,p=t.y-s,c=t.x+s,l=t.y+s,{spatialReference:f}=a;return o.xmin=Math.min(m,c),o.ymin=Math.min(p,l),o.xmax=Math.max(m,c),o.ymax=Math.max(p,l),o.spatialReference=f,o}new _geometry_Extent_js__WEBPACK_IMPORTED_MODULE_0__.Z}}]);
//# sourceMappingURL=4520.99dcb40b.iframe.bundle.js.map