"use strict";(self.webpackChunkreact_arcgis_wmws=self.webpackChunkreact_arcgis_wmws||[]).push([[2587],{59468:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{function t(t,e){return e?"xoffset"in e&&e.xoffset?Math.max(t,Math.abs(e.xoffset)):"yoffset"in e&&e.yoffset?Math.max(t,Math.abs(e.yoffset||0)):t:t}function n(t,n){return"number"==typeof t?t:t&&t.stops&&t.stops.length?function e(t){let e=0,n=0;for(let r=0;r<t.length;r++){const s=t[r].size;"number"==typeof s&&(e+=s,n++)}return e/n}(t.stops):n}function r(t,e){if(!e)return t;const r=e.filter((t=>"size"===t.type)).map((e=>{const{maxSize:r,minSize:s}=e;return(n(r,t)+n(s,t))/2}));let s=0;const o=r.length;if(0===o)return t;for(let n=0;n<o;n++)s+=r[n];const f=Math.floor(s/o);return Math.max(f,t)}function s(e){const n=e&&e.renderer,s="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!n)return s;const o="visualVariables"in n?r(s,n.visualVariables):s;if("simple"===n.type)return t(o,n.symbol);if("unique-value"===n.type){let e=o;return n.uniqueValueInfos.forEach((n=>{e=t(e,n.symbol)})),e}if("class-breaks"===n.type){let e=o;return n.classBreakInfos.forEach((n=>{e=t(e,n.symbol)})),e}return n.type,o}__webpack_require__.d(__webpack_exports__,{k:()=>s})},86602:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{e:()=>_});__webpack_require__(39994);var _chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1662),_chunks_mat3f32_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(19710),_chunks_vec2f32_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(55542),_webgl_Texture_js__WEBPACK_IMPORTED_MODULE_6__=(__webpack_require__(88338),__webpack_require__(6174),__webpack_require__(43487)),_DisplayObject_js__WEBPACK_IMPORTED_MODULE_8__=(__webpack_require__(18567),__webpack_require__(51118)),_ImageryBitmapSource_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(7349);function x(t,e,i){const s={target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071};return e&&i&&(s.width=e,s.height=i),new _webgl_Texture_js__WEBPACK_IMPORTED_MODULE_6__.Z(t,s)}class _ extends _DisplayObject_js__WEBPACK_IMPORTED_MODULE_8__.s{constructor(t=null,e,i=!0){super(),this.requestRenderOnSourceChangedEnabled=i,this._textureInvalidated=!0,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.transforms={dvs:(0,_chunks_mat3f32_js__WEBPACK_IMPORTED_MODULE_2__.c)()},this.blendFunction=e,this.source=t,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null)}get isSourceScaled(){return this.width!==this.sourceWidth||this.height!==this.sourceHeight}get height(){return void 0!==this._height?this._height:this.sourceHeight}set height(t){this._height=t}get source(){return this._source}set source(t){this._source=t,this.invalidateTexture()}get sourceHeight(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height}get sourceWidth(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width}get width(){return void 0!==this._width?this._width:this.sourceWidth}set width(t){this._width=t}beforeRender(t){super.beforeRender(t),this.updateTexture(t)}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRenderOnSourceChangedEnabled&&this.requestRender())}setTransform(h){const o=(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.i)(this.transforms.dvs),[u,a]=h.toScreenNoRotation([0,0],this.x,this.y),d=this.resolution/this.pixelRatio/h.resolution,c=d*this.width,l=d*this.height,x=Math.PI*this.rotation/180;(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.a)(o,o,(0,_chunks_vec2f32_js__WEBPACK_IMPORTED_MODULE_3__.f)(u,a)),(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.a)(o,o,(0,_chunks_vec2f32_js__WEBPACK_IMPORTED_MODULE_3__.f)(c/2,l/2)),(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.r)(o,o,-x),(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.a)(o,o,(0,_chunks_vec2f32_js__WEBPACK_IMPORTED_MODULE_3__.f)(-c/2,-l/2)),(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.j)(o,o,(0,_chunks_vec2f32_js__WEBPACK_IMPORTED_MODULE_3__.f)(c,l)),(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.m)(this.transforms.dvs,h.displayViewMat3,o)}setSamplingProfile(t){this._texture&&(t.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(t.samplingMode))}bind({context:t},e){this._texture&&t.bindTexture(this._texture,e)}updateTexture({context:t}){var e;if(!this.stage)return null==(e=this._texture)||e.dispose(),void(this._texture=null);if(!this._textureInvalidated)return;this._textureInvalidated=!1,this._texture||(this.source?this._texture=x(t,this.sourceWidth,this.sourceHeight):this._texture=x(t));const i=this.source;if(i){if(this._texture.resize(this.sourceWidth,this.sourceHeight),function d(t){return t&&"render"in t}(i))if(i instanceof _ImageryBitmapSource_js__WEBPACK_IMPORTED_MODULE_9__.Z){const t=i.getRenderedRasterPixels();this._texture.setData(t.renderedRasterPixels)}else this._texture.setData(function l(t){const e=document.createElement("canvas");return e.width=t.width,e.height=t.height,t.render(e.getContext("2d")),e}(i));else(function c(t){return t&&!("render"in t)})(i)&&this._texture.setData(i);this.ready()}else this._texture.setData(null)}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}}},12688:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{c:()=>t});var _webgl_enums_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(38716),_brushes_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(96467),_webgl_WGLContainer_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(10994);class t extends _webgl_WGLContainer_js__WEBPACK_IMPORTED_MODULE_2__.Z{get requiresDedicatedFBO(){return this.children.some((e=>"additive"===e.blendFunction))}prepareRenderPasses(s){const t=s.registerRenderPass({name:"bitmap",brushes:[_brushes_js__WEBPACK_IMPORTED_MODULE_1__.U.bitmap],target:()=>this.children,drawPhase:_webgl_enums_js__WEBPACK_IMPORTED_MODULE_0__.jx.MAP});return[...super.prepareRenderPasses(s),t]}}},7349:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});const __WEBPACK_DEFAULT_EXPORT__=class e{constructor(e,t,i){this.pixelBlock=e,this.extent=t,this.originalPixelBlock=i}get width(){return this.pixelBlock?this.pixelBlock.width:0}get height(){return this.pixelBlock?this.pixelBlock.height:0}render(e){const t=this.pixelBlock;if(!t)return;const i=this.filter({pixelBlock:t}),l=i.pixelBlock.getAsRGBA(),h=e.createImageData(i.pixelBlock.width,i.pixelBlock.height);h.data.set(l),e.putImageData(h,0,0)}getRenderedRasterPixels(){const e=this.filter({pixelBlock:this.pixelBlock});return{width:e.pixelBlock.width,height:e.pixelBlock.height,renderedRasterPixels:new Uint8Array(e.pixelBlock.getAsRGBA().buffer)}}}},80347:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{y:()=>LayerView2D_l});var tslib_es6=__webpack_require__(36663),property=(__webpack_require__(39994),__webpack_require__(13802),__webpack_require__(7283),__webpack_require__(81977)),subclass=__webpack_require__(12571),Collection=(__webpack_require__(3466),__webpack_require__(12173),__webpack_require__(51876),__webpack_require__(66591)),collectionUtils=__webpack_require__(58811),watchUtils=__webpack_require__(15071),JSONSupport=__webpack_require__(49004);let e=class extends JSONSupport.wq{};e=(0,tslib_es6._)([(0,subclass.j)("esri.views.layers.support.ClipArea")],e);const ClipArea=e;var s;let i=s=class extends ClipArea{constructor(){super(...arguments),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new s({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}get version(){return(this._get("version")||0)+1}};(0,tslib_es6._)([(0,property.Cb)({type:[Number,String],json:{write:!0}})],i.prototype,"left",void 0),(0,tslib_es6._)([(0,property.Cb)({type:[Number,String],json:{write:!0}})],i.prototype,"right",void 0),(0,tslib_es6._)([(0,property.Cb)({type:[Number,String],json:{write:!0}})],i.prototype,"top",void 0),(0,tslib_es6._)([(0,property.Cb)({type:[Number,String],json:{write:!0}})],i.prototype,"bottom",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],i.prototype,"version",null),i=s=(0,tslib_es6._)([(0,subclass.j)("esri.views.layers.support.ClipRect")],i);const ClipRect=i;var y,Container=__webpack_require__(10530),Geometry=__webpack_require__(20031),Extent=__webpack_require__(91772),Polygon=__webpack_require__(89542),jsonUtils=__webpack_require__(53736);__webpack_require__(91957);const c={base:Geometry.Z,key:"type",typeMap:{extent:Extent.Z,polygon:Polygon.Z}};let n=y=class extends ClipArea{constructor(){super(...arguments),this.type="geometry",this.geometry=null}get version(){return(this._get("version")||0)+1}clone(){return new y({geometry:this.geometry.clone()})}};(0,tslib_es6._)([(0,property.Cb)({types:c,json:{read:jsonUtils.im,write:!0}})],n.prototype,"geometry",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],n.prototype,"version",null),n=y=(0,tslib_es6._)([(0,subclass.j)("esri.views.layers.support.Geometry")],n);const support_Geometry=n;let Path_e=class extends ClipArea{constructor(){super(...arguments),this.type="path",this.path=[]}get version(){return(this._get("version")||0)+1}};(0,tslib_es6._)([(0,property.Cb)({type:[[[Number]]],json:{write:!0}})],Path_e.prototype,"path",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],Path_e.prototype,"version",null),Path_e=(0,tslib_es6._)([(0,subclass.j)("esri.views.layers.support.Path")],Path_e);const Path=Path_e,LayerView2D_c=Collection.Z.ofType({key:"type",base:ClipArea,typeMap:{rect:ClipRect,path:Path,geometry:support_Geometry}}),LayerView2D_l=i=>{let a=class extends i{constructor(){super(...arguments),this.clips=new LayerView2D_c,this.moving=!1,this.attached=!1,this.lastUpdateId=-1,this.updateRequested=!1}initialize(){var t;this.container||(this.container=new Container.W),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([(0,watchUtils.S1)(this,"suspended",(t=>{this.container&&(this.container.visible=!t),this.view&&!t&&this.updateRequested&&this.view.requestUpdate()}),!0),(0,watchUtils.S1)(this,["layer.opacity","container"],(()=>{var t,e;this.container&&(this.container.opacity=null!=(t=null==(e=this.layer)?void 0:e.opacity)?t:1)}),!0),(0,watchUtils.S1)(this,["layer.blendMode"],(t=>{this.container&&(this.container.blendMode=t)}),!0),(0,watchUtils.S1)(this,["layer.effect"],(t=>{this.container&&(this.container.effect=t)}),!0),this.clips.on("change",(()=>{this.container.clips=this.clips,this.notifyChange("clips")}))]),null!=(t=this.view)&&t.whenLayerView?this.view.whenLayerView(this.layer).then((t=>{t!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)}),(()=>{})):this.when().then((()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)}),(()=>{}))}destroy(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}get updating(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}isVisibleAtScale(t){let e=!0;const s=this.layer,i=s.minScale,r=s.maxScale;if(null!=i&&null!=r){let s=!i,o=!r;!s&&t<=i&&(s=!0),!o&&t>=r&&(o=!0),e=s&&o}return e}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(t){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",t),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(t))):this.updateRequested=!1}isUpdating(){return!1}isRendering(){return!1}canResume(){return!!super.canResume()&&this.isVisibleAtScale(this.view.scale)}};return(0,tslib_es6._)([(0,property.Cb)({type:LayerView2D_c,set(t){const e=(0,collectionUtils.Z)(t,this._get("clips"),LayerView2D_c);this._set("clips",e)}})],a.prototype,"clips",void 0),(0,tslib_es6._)([(0,property.Cb)()],a.prototype,"moving",void 0),(0,tslib_es6._)([(0,property.Cb)()],a.prototype,"attached",void 0),(0,tslib_es6._)([(0,property.Cb)()],a.prototype,"container",void 0),(0,tslib_es6._)([(0,property.Cb)()],a.prototype,"suspended",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],a.prototype,"updateParameters",void 0),(0,tslib_es6._)([(0,property.Cb)()],a.prototype,"updateRequested",void 0),(0,tslib_es6._)([(0,property.Cb)()],a.prototype,"updating",null),(0,tslib_es6._)([(0,property.Cb)()],a.prototype,"view",void 0),a=(0,tslib_es6._)([(0,subclass.j)("esri.views.2d.layers.LayerView2D")],a),a}},32587:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>MapImageLayerView2D});var tslib_es6=__webpack_require__(36663),Logger=(__webpack_require__(39994),__webpack_require__(13802)),property=(__webpack_require__(7283),__webpack_require__(81977)),subclass=__webpack_require__(12571),promiseUtils=(__webpack_require__(3466),__webpack_require__(12173),__webpack_require__(51876),__webpack_require__(78668)),GraphicsCollection=__webpack_require__(94449),RefreshableLayerView=__webpack_require__(55068),LayerView=__webpack_require__(26216),drapedUtils=__webpack_require__(99621),GraphicsView2D=__webpack_require__(33500),MapImageLayerView=__webpack_require__(82512),BitmapContainer=__webpack_require__(12688),LayerView2D=__webpack_require__(80347),ExportStrategy=__webpack_require__(23134),enums=__webpack_require__(38716),BaseGraphicContainer=__webpack_require__(28715);let o=class extends BaseGraphicContainer.Z{renderChildren(r){if(r.drawPhase!==enums.jx.HIGHLIGHT)return;if(this.attributeView.bindTextures(r.context),!this.children.some((r=>r.hasData)))return;super.renderChildren(r);const{painter:e}=r,t=e.effects.highlight;t.bind(r),r.context.setColorMask(!0,!0,!0,!0),r.context.clear(16384),this._renderChildren(r,t.defines.concat(["highlightAll"])),t.draw(r),t.unbind()}};o=(0,tslib_es6._)([(0,subclass.j)("esri.views.2d.layers.support.HighlightGraphicContainer")],o);const HighlightGraphicContainer=o,l=Logger.Z.getLogger("esri.views.2d.layers.MapImageLayerView2D");let y=class extends((0,MapImageLayerView.m)((0,RefreshableLayerView.yc)((0,LayerView2D.y)(LayerView.Z)))){constructor(){super(...arguments),this._highlightGraphics=new GraphicsCollection.ZP}hitTest(){return null}update(e){this.strategy.update(e).catch((e=>{(0,promiseUtils.D_)(e)||l.error(e)}))}attach(){const{imageMaxWidth:e,imageMaxHeight:t,version:r}=this.layer,i=r>=10.3,s=r>=10;this._bitmapContainer=new BitmapContainer.c,this.container.addChild(this._bitmapContainer);const a=new GraphicsView2D.Z({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new HighlightGraphicContainer(this.view.featuresTilingScheme)});this.container.addChild(a.container),this.strategy=new ExportStrategy.Z({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:e,imageMaxHeight:t,imageRotationSupported:i,imageNormalizationSupported:s,hidpi:!0}),this.handles.add(this.watch("exportImageVersion",(()=>this.requestUpdate())),"exportImageVersion"),this.requestUpdate()}detach(){this.handles.remove("exportImageVersion"),this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}highlight(e,t){return this._highlightGraphics.add(e),{remove:()=>{this._highlightGraphics.remove(e)}}}createFetchPopupFeaturesQueryGeometry(e,t){return(0,drapedUtils.K)(e,t,this.view)}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(e,t,r,i){return this.layer.fetchImage(e,t,r,{timeExtent:this.timeExtent,timestamp:this.refreshTimestamp,...i})}};(0,tslib_es6._)([(0,property.Cb)()],y.prototype,"strategy",void 0),(0,tslib_es6._)([(0,property.Cb)()],y.prototype,"updating",void 0),y=(0,tslib_es6._)([(0,subclass.j)("esri.views.2d.layers.MapImageLayerView2D")],y);const MapImageLayerView2D=y},23134:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>ExportStrategy});var tslib_es6=__webpack_require__(36663),property=(__webpack_require__(39994),__webpack_require__(13802),__webpack_require__(7283),__webpack_require__(81977)),subclass=__webpack_require__(12571),promiseUtils=(__webpack_require__(3466),__webpack_require__(12173),__webpack_require__(51876),__webpack_require__(78668)),Accessor=__webpack_require__(53443),spatialReferenceUtils=__webpack_require__(35925),Extent=__webpack_require__(91772),aaBoundingRect=__webpack_require__(24568),TileInfo=__webpack_require__(81590),TileKey=__webpack_require__(87241),TileInfoView=__webpack_require__(64970);const t=Math.PI/180;function n(n){return n*t}function viewStateUtils_r(t,o){const r=n(o.rotation),u=Math.abs(Math.cos(r)),a=Math.abs(Math.sin(r)),[s,c]=o.size;return t[0]=Math.round(c*a+s*u),t[1]=Math.round(c*u+s*a),t}var Bitmap=__webpack_require__(86602);const ExportStrategy_u=(0,aaBoundingRect.Ue)(),g=[0,0],f=new TileKey.Z(0,0,0,0),x_imageMaxWidth=2048,x_imageMaxHeight=2048,x_imageRotationSupported=!1,x_imageNormalizationSupported=!1,x_hidpi=!1;let y=class extends Accessor.Z{constructor(t){super(t),this._imagePromise=null,this.hidpi=x_hidpi,this.imageMaxWidth=x_imageMaxWidth,this.imageMaxHeight=x_imageMaxHeight,this.imageRotationSupported=x_imageRotationSupported,this.imageNormalizationSupported=x_imageNormalizationSupported,this.update=(0,promiseUtils.Ds)((async(t,e)=>{const i=t.state,o=(0,spatialReferenceUtils.C5)(i.spatialReference),r=this.hidpi?t.pixelRatio:1;if(!t.stationary||this.destroyed)return null;this.imageRotationSupported?(g[0]=i.size[0],g[1]=i.size[1]):viewStateUtils_r(g,i);const a=Math.floor(g[0]*r)>this.imageMaxWidth||Math.floor(g[1]*r)>this.imageMaxHeight,p=o&&(i.extent.xmin<o.valid[0]||i.extent.xmax>o.valid[1]),n=!this.imageNormalizationSupported&&p,m=!a&&!n,l=this.imageRotationSupported?i.rotation:0;if(m)this._imagePromise=this._singleExport(i,g,l,r,e);else{let t=Math.min(this.imageMaxWidth,this.imageMaxHeight);n&&(t=Math.min(i.worldScreenWidth,t)),this._imagePromise=this._tiledExport(i,t,l,r,e)}return this._imagePromise.then((async t=>{if(this._imagePromise=null,!this.destroyed){for(const e of this.container.children)t.includes(e)||e.fadeOut().then((()=>{e.remove()}));for(const e of t)this.container.addChild(e),e.fadeIn()}})).catch((t=>{throw this._imagePromise=null,t}))}),5e3)}destroy(){}get updating(){return null!==this._imagePromise}updateExports(t){for(const e of this.container.children){if(!e.visible||!e.stage)return;t(e)?console.error("ExportStrategy.updateExports doesn't support promise yet"):(e.invalidateTexture(),e.requestRender())}}_export(t,e,i,o,r,s){return Promise.resolve().then((()=>this.fetchSource(t,Math.floor(e*r),Math.floor(i*r),{rotation:o,pixelRatio:r,signal:s}))).then((i=>{const s=new Bitmap.e(i,"additive");return s.x=t.xmin,s.y=t.ymax,s.resolution=t.width/e,s.rotation=o,s.pixelRatio=r,s}))}_singleExport(t,e,i,o,r){!function u(t,n,o,r){const[u,a]=n,[s,c]=r,i=.5*o;return t[0]=u-i*s,t[1]=a-i*c,t[2]=u+i*s,t[3]=a+i*c,t}(ExportStrategy_u,t.center,t.resolution,e);const s=new Extent.Z(ExportStrategy_u[0],ExportStrategy_u[1],ExportStrategy_u[2],ExportStrategy_u[3],t.spatialReference);return this._export(s,e[0],e[1],i,o,r).then((t=>[t]))}_tiledExport(t,e,i,o,r){const s=TileInfo.Z.create({size:e,spatialReference:t.spatialReference,scales:[t.scale]}),p=new TileInfoView.Z(s),m=p.getTileCoverage(t);if(!m)return null;const h=[];return m.forEach(((s,n,m,l)=>{f.set(s,n,m,l),p.getTileBounds(ExportStrategy_u,f);const d=new Extent.Z(ExportStrategy_u[0],ExportStrategy_u[1],ExportStrategy_u[2],ExportStrategy_u[3],t.spatialReference);h.push(this._export(d,e,e,i,o,r))})),Promise.all(h)}};(0,tslib_es6._)([(0,property.Cb)()],y.prototype,"_imagePromise",void 0),(0,tslib_es6._)([(0,property.Cb)()],y.prototype,"container",void 0),(0,tslib_es6._)([(0,property.Cb)()],y.prototype,"fetchSource",void 0),(0,tslib_es6._)([(0,property.Cb)()],y.prototype,"hidpi",void 0),(0,tslib_es6._)([(0,property.Cb)()],y.prototype,"imageMaxWidth",void 0),(0,tslib_es6._)([(0,property.Cb)()],y.prototype,"imageMaxHeight",void 0),(0,tslib_es6._)([(0,property.Cb)()],y.prototype,"imageRotationSupported",void 0),(0,tslib_es6._)([(0,property.Cb)()],y.prototype,"imageNormalizationSupported",void 0),(0,tslib_es6._)([(0,property.Cb)()],y.prototype,"requestUpdate",void 0),(0,tslib_es6._)([(0,property.Cb)()],y.prototype,"updating",null),y=(0,tslib_es6._)([(0,subclass.j)("esri.views.2d.layers.support.ExportStrategy")],y);const ExportStrategy=y},82512:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{m:()=>c});var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(36663),_core_maybe_js__WEBPACK_IMPORTED_MODULE_14__=(__webpack_require__(39994),__webpack_require__(61681)),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__=(__webpack_require__(13802),__webpack_require__(7283),__webpack_require__(81977)),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(12571),_core_Error_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(70375),_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_9__=(__webpack_require__(3466),__webpack_require__(12173),__webpack_require__(51876),__webpack_require__(78668)),_support_arcadeOnDemand_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(30879),_layers_support_commonProperties_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(23072),_layers_support_ExportImageParameters_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(24065),_renderers_support_clickToleranceUtils_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(59468),_support_popupUtils_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(59439);const c=c=>{let y=class extends c{initialize(){this.exportImageParameters=new _layers_support_ExportImageParameters_js__WEBPACK_IMPORTED_MODULE_12__.R({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get exportImageVersion(){var e;return null==(e=this.exportImageParameters)||e.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}async fetchPopupFeatures(e,t){const{layer:o}=this;if(!e)return Promise.reject(new _core_Error_js__WEBPACK_IMPORTED_MODULE_5__.Z("mapimagelayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:o}));const p=this.get("view.scale"),i=[],m=async e=>{const o=0===e.minScale||p<=e.minScale,s=0===e.maxScale||p>=e.maxScale;if(e.visible&&o&&s)if(e.sublayers)e.sublayers.forEach(m);else if(e.popupEnabled){const o=(0,_support_popupUtils_js__WEBPACK_IMPORTED_MODULE_13__.V)(e,{...t,defaultPopupTemplateEnabled:!1});(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_14__.pC)(o)&&i.unshift({sublayer:e,popupTemplate:o})}},c=o.sublayers.toArray().reverse().map(m);await Promise.all(c);const y=i.map((async({sublayer:o,popupTemplate:s})=>{await o.load().catch((()=>{}));const a=o.createQuery(),p=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_14__.pC)(t)?t.event:null,i=(0,_renderers_support_clickToleranceUtils_js__WEBPACK_IMPORTED_MODULE_15__.k)({renderer:o.renderer,event:p}),m=this.createFetchPopupFeaturesQueryGeometry(e,i);a.geometry=m,a.outFields=await(0,_support_popupUtils_js__WEBPACK_IMPORTED_MODULE_13__.e)(o,s);const n=await this._loadArcadeModules(s);return n&&n.arcadeUtils.hasGeometryOperations(s)||(a.maxAllowableOffset=m.width/i),(await o.queryFeatures(a)).features}));return(await(0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_9__.as)(y)).reduce(((e,r)=>r.value?[...e,...r.value]:e),[]).filter((e=>null!=e))}canResume(){var e;return!(!super.canResume()||null!=(e=this.timeExtent)&&e.isEmpty)}_loadArcadeModules(e){if(e.get("expressionInfos.length"))return(0,_support_arcadeOnDemand_js__WEBPACK_IMPORTED_MODULE_10__.LC)()}};return(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)()],y.prototype,"exportImageParameters",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({readOnly:!0})],y.prototype,"exportImageVersion",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)()],y.prototype,"layer",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)()],y.prototype,"suspended",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)(_layers_support_commonProperties_js__WEBPACK_IMPORTED_MODULE_11__.qG)],y.prototype,"timeExtent",void 0),y=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_16__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_4__.j)("esri.views.layers.MapImageLayerView")],y),y}},59439:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{V:()=>d,e:()=>i});var _core_maybe_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(61681),_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(14845);async function i(i,d=i.popupTemplate){if(!(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_1__.pC)(d))return[];const o=await d.getRequiredFields(i.fields),{lastEditInfoEnabled:s}=d,{objectIdField:u,typeIdField:a,globalIdField:n,relationships:f}=i;if(o.includes("*"))return["*"];const r=s?await(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.CH)(i):[],m=(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.Q0)(i.fields,[...o,...r]);return a&&m.push(a),m&&u&&(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.cT)(i.fields,u)&&-1===m.indexOf(u)&&m.push(u),m&&n&&(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.cT)(i.fields,n)&&-1===m.indexOf(n)&&m.push(n),f&&f.forEach((e=>{const{keyField:p}=e;m&&p&&(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.cT)(i.fields,p)&&-1===m.indexOf(p)&&m.push(p)})),m}function d(p,l){return p.popupTemplate?p.popupTemplate:(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_1__.pC)(l)&&l.defaultPopupTemplateEnabled&&(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_1__.pC)(p.defaultPopupTemplate)?p.defaultPopupTemplate:null}},99621:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{K:()=>a});var _core_maybe_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(61681),_geometry_Extent_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(91772),_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_2__=(__webpack_require__(91957),__webpack_require__(17321));function a(t,i,a,o=new _geometry_Extent_js__WEBPACK_IMPORTED_MODULE_0__.Z){let s;if("2d"===a.type)s=i*a.resolution;else if("3d"===a.type){const r=a.overlayPixelSizeInMapUnits(t),o=a.basemapSpatialReference;s=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_3__.pC)(o)&&!o.equals(a.spatialReference)?(0,_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_2__.c9)(o)/(0,_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_2__.c9)(a.spatialReference):i*r}const m=t.x-s,p=t.y-s,c=t.x+s,l=t.y+s,{spatialReference:f}=a;return o.xmin=Math.min(m,c),o.ymin=Math.min(p,l),o.xmax=Math.max(m,c),o.ymax=Math.max(p,l),o.spatialReference=f,o}new _geometry_Extent_js__WEBPACK_IMPORTED_MODULE_0__.Z}}]);