"use strict";(self.webpackChunkreact_arcgis_wmws=self.webpackChunkreact_arcgis_wmws||[]).push([[2618],{39947:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{r:()=>i});var _quickselect_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(80657);function i(t,n){if(!(this instanceof i))return new i(t,n);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),n&&("function"==typeof n?this.toBBox=n:this._initFormat(n)),this.clear()}function n(t,i,n){if(!n)return i.indexOf(t);for(var h=0;h<i.length;h++)if(n(t,i[h]))return h;return-1}function h(t,i){a(t,0,t.children.length,i,t)}function a(t,i,n,h,a){a||(a=x(null)),a.minX=1/0,a.minY=1/0,a.maxX=-1/0,a.maxY=-1/0;for(var e,o=i;o<n;o++)e=t.children[o],r(a,t.leaf?h(e):e);return a}function r(t,i){return t.minX=Math.min(t.minX,i.minX),t.minY=Math.min(t.minY,i.minY),t.maxX=Math.max(t.maxX,i.maxX),t.maxY=Math.max(t.maxY,i.maxY),t}function e(t,i){return t.minX-i.minX}function o(t,i){return t.minY-i.minY}function s(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function l(t){return t.maxX-t.minX+(t.maxY-t.minY)}function m(t,i){return(Math.max(i.maxX,t.maxX)-Math.min(i.minX,t.minX))*(Math.max(i.maxY,t.maxY)-Math.min(i.minY,t.minY))}function c(t,i){var n=Math.max(t.minX,i.minX),h=Math.max(t.minY,i.minY),a=Math.min(t.maxX,i.maxX),r=Math.min(t.maxY,i.maxY);return Math.max(0,a-n)*Math.max(0,r-h)}function u(t,i){return t.minX<=i.minX&&t.minY<=i.minY&&i.maxX<=t.maxX&&i.maxY<=t.maxY}function f(t,i){return i.minX<=t.maxX&&i.minY<=t.maxY&&i.maxX>=t.minX&&i.maxY>=t.minY}function x(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function d(i,n,h,a,r){for(var e,o=[n,h];o.length;)(h=o.pop())-(n=o.pop())<=a||(e=n+Math.ceil((h-n)/a/2)*a,(0,_quickselect_js__WEBPACK_IMPORTED_MODULE_0__.q)(i,e,n,h,r),o.push(n,e,e,h))}i.prototype={all:function(){return this._all(this.data,[])},search:function(t){var i=this.data,n=[],h=this.toBBox;if(!f(t,i))return n;for(var a,r,e,o,s=[];i;){for(a=0,r=i.children.length;a<r;a++)e=i.children[a],f(t,o=i.leaf?h(e):e)&&(i.leaf?n.push(e):u(t,o)?this._all(e,n):s.push(e));i=s.pop()}return n},collides:function(t){var i=this.data,n=this.toBBox;if(!f(t,i))return!1;for(var h,a,r,e,o=[];i;){for(h=0,a=i.children.length;h<a;h++)if(r=i.children[h],f(t,e=i.leaf?n(r):r)){if(i.leaf||u(t,e))return!0;o.push(r)}i=o.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var i=0,n=t.length;i<n;i++)this.insert(t[i]);return this}var h=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===h.height)this._splitRoot(this.data,h);else{if(this.data.height<h.height){var a=this.data;this.data=h,h=a}this._insert(h,this.data.height-h.height-1,!0)}else this.data=h;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=x([]),this},remove:function(t,i){if(!t)return this;for(var h,a,r,e,o=this.data,s=this.toBBox(t),l=[],m=[];o||l.length;){if(o||(o=l.pop(),a=l[l.length-1],h=m.pop(),e=!0),o.leaf&&-1!==(r=n(t,o.children,i)))return o.children.splice(r,1),l.push(o),this._condense(l),this;e||o.leaf||!u(o,s)?a?(h++,o=a.children[h],e=!1):o=null:(l.push(o),m.push(h),h=0,a=o,o=o.children[0])}return this},toBBox:function(t){return t},compareMinX:e,compareMinY:o,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,i){for(var n=[];t;)t.leaf?i.push.apply(i,t.children):n.push.apply(n,t.children),t=n.pop();return i},_build:function(t,i,n,a){var r,e=n-i+1,o=this._maxEntries;if(e<=o)return h(r=x(t.slice(i,n+1)),this.toBBox),r;a||(a=Math.ceil(Math.log(e)/Math.log(o)),o=Math.ceil(e/Math.pow(o,a-1))),(r=x([])).leaf=!1,r.height=a;var s,l,m,c,u=Math.ceil(e/o),f=u*Math.ceil(Math.sqrt(o));for(d(t,i,n,f,this.compareMinX),s=i;s<=n;s+=f)for(d(t,s,m=Math.min(s+f-1,n),u,this.compareMinY),l=s;l<=m;l+=u)c=Math.min(l+u-1,m),r.children.push(this._build(t,l,c,a-1));return h(r,this.toBBox),r},_chooseSubtree:function(t,i,n,h){for(var a,r,e,o,l,c,u,f;h.push(i),!i.leaf&&h.length-1!==n;){for(u=f=1/0,a=0,r=i.children.length;a<r;a++)l=s(e=i.children[a]),(c=m(t,e)-l)<f?(f=c,u=l<u?l:u,o=e):c===f&&l<u&&(u=l,o=e);i=o||i.children[0]}return i},_insert:function(t,i,n){var h=this.toBBox,a=n?t:h(t),e=[],o=this._chooseSubtree(a,this.data,i,e);for(o.children.push(t),r(o,a);i>=0&&e[i].children.length>this._maxEntries;)this._split(e,i),i--;this._adjustParentBBoxes(a,e,i)},_split:function(t,i){var n=t[i],a=n.children.length,r=this._minEntries;this._chooseSplitAxis(n,r,a);var e=this._chooseSplitIndex(n,r,a),o=x(n.children.splice(e,n.children.length-e));o.height=n.height,o.leaf=n.leaf,h(n,this.toBBox),h(o,this.toBBox),i?t[i-1].children.push(o):this._splitRoot(n,o)},_splitRoot:function(t,i){this.data=x([t,i]),this.data.height=t.height+1,this.data.leaf=!1,h(this.data,this.toBBox)},_chooseSplitIndex:function(t,i,n){var h,r,e,o,l,m,u,f;for(m=u=1/0,h=i;h<=n-i;h++)o=c(r=a(t,0,h,this.toBBox),e=a(t,h,n,this.toBBox)),l=s(r)+s(e),o<m?(m=o,f=h,u=l<u?l:u):o===m&&l<u&&(u=l,f=h);return f},_chooseSplitAxis:function(t,i,n){var h=t.leaf?this.compareMinX:e,a=t.leaf?this.compareMinY:o;this._allDistMargin(t,i,n,h)<this._allDistMargin(t,i,n,a)&&t.children.sort(h)},_allDistMargin:function(t,i,n,h){t.children.sort(h);var e,o,s=this.toBBox,m=a(t,0,i,s),c=a(t,n-i,n,s),u=l(m)+l(c);for(e=i;e<n-i;e++)o=t.children[e],r(m,t.leaf?s(o):o),u+=l(m);for(e=n-i-1;e>=i;e--)o=t.children[e],r(c,t.leaf?s(o):o),u+=l(c);return u},_adjustParentBBoxes:function(t,i,n){for(var h=n;h>=0;h--)r(i[h],t)},_condense:function(t){for(var i,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(i=t[n-1].children).splice(i.indexOf(t[n]),1):this.clear():h(t[n],this.toBBox)},_initFormat:function(t){var i=["return a"," - b",";"];this.compareMinX=new Function("a","b",i.join(t[0])),this.compareMinY=new Function("a","b",i.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}},37727:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{J:()=>l,g:()=>n});const n=(n,l)=>n&&((...n)=>l.warn("DEBUG:",...n))||(()=>null),l=!1},41657:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{a:()=>o});var _core_Logger_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(13802),_core_Error_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(70375),_enums_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(38716),_Utils_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(15875);const l=_core_Logger_js__WEBPACK_IMPORTED_MODULE_0__.Z.getLogger("esri.views.2d.engine.webgl");function o(e){return(0,_Utils_js__WEBPACK_IMPORTED_MODULE_3__.hj)(e.minDataValue)&&(0,_Utils_js__WEBPACK_IMPORTED_MODULE_3__.hj)(e.maxDataValue)&&null!=e.minSize&&null!=e.maxSize?_enums_js__WEBPACK_IMPORTED_MODULE_2__.X.SIZE_MINMAX_VALUE:(e.expression&&"view.scale"===e.expression||e.valueExpression&&"$view.scale"===e.valueExpression)&&Array.isArray(e.stops)?_enums_js__WEBPACK_IMPORTED_MODULE_2__.X.SIZE_SCALE_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&(Array.isArray(e.stops)||"levels"in e&&e.levels)?_enums_js__WEBPACK_IMPORTED_MODULE_2__.X.SIZE_FIELD_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&null!=e.valueUnit?_enums_js__WEBPACK_IMPORTED_MODULE_2__.X.SIZE_UNIT_VALUE:(l.error(new _core_Error_js__WEBPACK_IMPORTED_MODULE_1__.Z("mapview-bad-type","Found invalid size VisualVariable",e)),_enums_js__WEBPACK_IMPORTED_MODULE_2__.X.NONE)}},10289:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{ZP:()=>__WEBPACK_DEFAULT_EXPORT__,jL:()=>M,nE:()=>v});var _core_has_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(39994),_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(61681),_core_Logger_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(13802),_core_Error_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(70375),_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(78668),_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(19431),_core_accessorSupport_diffUtils_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(27281),_layers_support_FieldsIndex_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(28790),_engine_webgl_definitions_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(14266),_engine_webgl_Utils_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(15875),_engine_webgl_util_debug_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(37727),_tileRenderers_support_visualVariablesUtils_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(54465);const w=_core_Logger_js__WEBPACK_IMPORTED_MODULE_1__.Z.getLogger("esri.views.layers.2d.features.support.AttributeStore"),A=(0,_engine_webgl_util_debug_js__WEBPACK_IMPORTED_MODULE_9__.g)(_engine_webgl_util_debug_js__WEBPACK_IMPORTED_MODULE_9__.J,w),C=t=>(2147483648&t)>>>31,M=t=>2147483647&t;function v(t){return 1===C(t)}const j={sharedArrayBuffer:(0,_core_has_js__WEBPACK_IMPORTED_MODULE_0__.Z)("esri-shared-array-buffer"),atomics:(0,_core_has_js__WEBPACK_IMPORTED_MODULE_0__.Z)("esri-atomics")};function I(t,e){return i=>e(t(i))}class P{constructor(t,e,i,s){this.size=0,this.texelSize=4;const{pixelType:r,layout:a,textureOnly:o}=s;this.textureOnly=o||!1,this.pixelType=r,this._ctype=e,this.layout=a,this._resetRange(),this._shared=t,this.size=i,o||(this.data=this._initData(r,i,t,e))}get buffer(){return(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__.Po)(this.data,(t=>t.buffer))}unsetComponentAllTexels(t,e){const i=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__.Wg)(this.data);for(let s=0;s<this.size*this.size;s++)i[s*this.texelSize+t]&=~e;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(t,e){const i=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__.Wg)(this.data);for(let s=0;s<this.size*this.size;s++)i[s*this.texelSize+t]|=255&e;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponent(t,e,i){const s=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__.Wg)(this.data);for(const r of i)s[r*this.texelSize+t]|=e,this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,r)}setComponentTexel(t,e,i){(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__.Wg)(this.data)[i*this.texelSize+t]|=e,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)}unsetComponentTexel(t,e,i){(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__.Wg)(this.data)[i*this.texelSize+t]&=~e,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)}getData(t,e){const i=M(t);return(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__.Wg)(this.data)[i*this.texelSize+e]}setData(t,e,i){const s=M(t),r=1<<e;0!=(this.layout&r)?(this.data[s*this.texelSize+e]=i,this.dirtyStart=Math.min(this.dirtyStart,s),this.dirtyEnd=Math.max(this.dirtyEnd,s)):w.error("mapview-attributes-store","Tried to set a value for a texel's readonly component")}lock(){5121===this.pixelType&&this._shared&&j.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,1)}unlock(){5121===this.pixelType&&this._shared&&j.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,0)}expand(t){if(this.size=t,!this.textureOnly){const e=this._initData(this.pixelType,t,this._shared,this._ctype),i=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__.Wg)(this.data);e.set(i),this.data=e}}toMessage(){const t=this.dirtyStart,e=this.dirtyEnd,i=this.texelSize;if(t>e)return null;this._resetRange();const s=!(this._shared||"local"===this._ctype),r=this.pixelType,a=this.layout,n=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__.Wg)(this.data);return n.slice?{start:t,end:e,data:s&&n.slice(t*i,(e+1)*i)||null,pixelType:r,layout:a}:s?{start:t,end:e,data:new((0,_engine_webgl_Utils_js__WEBPACK_IMPORTED_MODULE_7__.UK)(this.pixelType))(Array.prototype.slice.call(this.data,t*i,(e+1)*i)),pixelType:r,layout:a}:{start:t,end:e,data:null,pixelType:r,layout:a}}_initData(t,e,i,s){const r=i&&"local"!==s?SharedArrayBuffer:ArrayBuffer,a=(0,_engine_webgl_Utils_js__WEBPACK_IMPORTED_MODULE_7__.UK)(t),o=new a(new r(e*e*4*a.BYTES_PER_ELEMENT));for(let n=0;n<o.length;n+=4)o[n+1]=255;return o}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}}const __WEBPACK_DEFAULT_EXPORT__=class O{constructor(t,e){this._client=t,this.config=e,this._attributeComputeMap=new Map,this._blocks=new Array,this._filters=new Array(_engine_webgl_definitions_js__WEBPACK_IMPORTED_MODULE_6__.m4),this._targetType=0,this._abortController=(0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_3__.yi)(),this._hasScaleExpr=!1,this._size=32,this._idsToHighlight=new Set;const i=e.supportsTextureFloat?5126:5121;A(`Creating AttributeStore ${j.sharedArrayBuffer?"with":"without"} shared memory`),this._blockDescriptors=[{pixelType:5121,layout:1},{pixelType:5121,layout:15,textureOnly:!0},{pixelType:i,layout:15},{pixelType:i,layout:15}],this._blocks=this._blockDescriptors.map((()=>null))}destroy(){this._abortController.abort()}get hasScaleExpr(){return this._hasScaleExpr}get _signal(){return this._abortController.signal}update(i,s){this.config=s;const r=s.schema.processors[0].storage,a=(0,_core_accessorSupport_diffUtils_js__WEBPACK_IMPORTED_MODULE_5__.Hg)(this._schema,r);if((i.targets.feature||i.targets.aggregate)&&(i.storage.data=!0),a&&((0,_core_has_js__WEBPACK_IMPORTED_MODULE_0__.Z)("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:",a),i.storage.data=!0,this._schema=r,this._attributeComputeMap.clear(),!(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__.Wi)(r))){switch(r.target){case"feature":this._targetType=0;break;case"aggregate":this._targetType=1}for(const t of r.mapping)this._bindAttribute(t)}}onTileData(t,i){if((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__.Wi)(i.addOrUpdate))return;const s=i.addOrUpdate.getCursor();for(;s.next();){const t=s.getDisplayId();this.setAttributeData(t,s)}}invalidateResources(){this._createResourcesPromise=null,this._abortController.abort(),this._abortController=(0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_3__.yi)()}async setHighlight(t,e){const s=this._getBlock(0),r=e.map((t=>M(t)));s.lock(),s.unsetComponentAllTexels(0,1),s.setComponent(0,1,r),s.unlock(),this._idsToHighlight.clear();for(const a of t)this._idsToHighlight.add(a);await this.sendUpdates()}async updateFilters(e,i){const{config:s,service:r,spatialReference:a}=i,{filters:o}=s,n=o.map(((t,e)=>this._updateFilter(t,e,r,a)));(await Promise.all(n)).some((t=>t))&&(e.storage.filters=!0,(0,_core_has_js__WEBPACK_IMPORTED_MODULE_0__.Z)("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:","Filters changed"))}setData(t,e,i,s){const r=M(t);this._ensureSizeForTexel(r),this._getBlock(e).setData(t,i,s)}getData(t,e,i){return this._getBlock(e).getData(t,i)}getHighlightFlag(t){return this._idsToHighlight.has(t)?_engine_webgl_definitions_js__WEBPACK_IMPORTED_MODULE_6__.uG:0}unsetAttributeData(t){const e=M(t);this._getBlock(0).setData(e,0,0)}setAttributeData(t,e){const i=M(t);if(this._ensureSizeForTexel(i),this._getBlock(0).setData(i,0,this.getFilterFlags(e)),this._targetType!==C(t))return;const s=this._attributeComputeMap,r=this.config.supportsTextureFloat?1:2;s.size&&s.forEach(((t,s)=>{const o=s*r%4,n=Math.floor(s*r/4),l=this._getBlock(n+_engine_webgl_definitions_js__WEBPACK_IMPORTED_MODULE_6__.aK),h=t(e);if(this.config.supportsTextureFloat)l.setData(i,o,h);else if(h===_engine_webgl_definitions_js__WEBPACK_IMPORTED_MODULE_6__.AI)l.setData(i,o,255),l.setData(i,o+1,255);else{const t=(0,_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_4__.uZ)(Math.round(h),-32767,32766)+32768,e=255&t,s=(65280&t)>>8;l.setData(i,o,e),l.setData(i,o+1,s)}}))}sendUpdates(){if(this._nextUpdate)return this._nextUpdate.promise;if(this._currUpdate)return this._nextUpdate=(0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_3__.hh)(),this._nextUpdate.promise;const t={blocks:this._blocks.map((t=>(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__.pC)(t)?t.toMessage():null))};return this._currUpdate=this._createResources().then((()=>{const e=()=>{if(this._currUpdate=null,this._nextUpdate){const t=this._nextUpdate;this._nextUpdate=null,this.sendUpdates().then((()=>t.resolve()))}},i=this._client.update(t,this._signal).then(e).catch(e);return this._client.render(this._signal),i})).catch((t=>(0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_3__.D_)(t)?(this._createResourcesPromise=null,this._createResources()):(w.error(new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.Z("mapview-attribute-store","Encountered an error during client update",t)),Promise.resolve()))),this._currUpdate}_ensureSizeForTexel(t){for(;t>=this._size*this._size;)if(this._expand())return}_bindAttribute(t){let s;if(null!=t.fieldIndex)s=function i(){return t.normalizationField&&w.warn("mapview-arcade","Ignoring normalizationField specified with an arcade expression which is not supported."),e=>e.getComputedNumericAtIndex(t.fieldIndex)}();else{if(!t.field)return;s=function e(){return t.normalizationField?e=>{const i=e.readAttribute(t.normalizationField);return i?e.readAttribute(t.field)/i:null}:e=>e.readAttribute(t.field)}()}t.valueRepresentation&&(s=I(s,(e=>(0,_tileRenderers_support_visualVariablesUtils_js__WEBPACK_IMPORTED_MODULE_8__.qc)(e,t.valueRepresentation))));this._attributeComputeMap.set(t.binding,I(s,(t=>null===t||isNaN(t)||t===1/0?_engine_webgl_definitions_js__WEBPACK_IMPORTED_MODULE_6__.AI:t)))}_createResources(){if((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__.pC)(this._createResourcesPromise))return this._createResourcesPromise;this._getBlock(_engine_webgl_definitions_js__WEBPACK_IMPORTED_MODULE_6__.xl),A("Initializing AttributeStore");const t={shared:j.sharedArrayBuffer&&!("local"===this._client.type),size:this._size,blocks:(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__.Fd)(this._blocks,(t=>({textureOnly:t.textureOnly,buffer:t.buffer,pixelType:t.pixelType})))},r=this._client.initialize(t,this._signal).catch((t=>{(0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_3__.D_)(t)?this._createResourcesPromise=null:w.error(new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.Z("mapview-attribute-store","Encountered an error during client initialization",t))}));return this._createResourcesPromise=r,r.then((()=>(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__.Wi)(this._createResourcesPromise)?this._createResources():void 0)),r}_getBlock(t){const e=this._blocks[t];if((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__.pC)(e))return e;A(`Initializing AttributeBlock at index ${t}`);const s=j.sharedArrayBuffer,r=this._client.type,a=new P(s,r,this._size,this._blockDescriptors[t]);return this._blocks[t]=a,this._createResourcesPromise=null,a}_expand(){if(this._size<this.config.maxTextureSize){const t=this._size<<=1;return A("Expanding block size to",t,this._blocks),(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__.JR)(this._blocks,(e=>e.expand(t))),this._createResourcesPromise=null,this._size=t,0}return w.error(new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.Z("mapview-limitations","Maximum number of onscreen features exceeded.")),-1}async _updateFilter(t,s,r,a){const o=this._filters[s],n=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__.pC)(o)&&o.hash;if(!o&&!t)return!1;if(n===JSON.stringify(t))return!1;if((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__.Wi)(t)){const t=1<<s+1,e=this._getBlock(0);return this._filters[s]=null,e.setComponentAllTexels(0,t),this.sendUpdates(),!0}const l=await this._getFilter(s,r);return await l.update(t,a),!0}async _getFilter(t,e){const s=this._filters[t];if((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__.pC)(s))return s;const{default:r}=await __webpack_require__.e(5560).then(__webpack_require__.bind(__webpack_require__,35560)),a=new r({geometryType:e.geometryType,hasM:!1,hasZ:!1,timeInfo:e.timeInfo,fieldsIndex:new _layers_support_FieldsIndex_js__WEBPACK_IMPORTED_MODULE_11__.Z(e.fields)});return this._filters[t]=a,a}isVisible(t){return!!(2&this._getBlock(0).getData(t,0))}getFilterFlags(t){let i=0;const s=(t=>1===C(t)?254:255)(t.getDisplayId());for(let a=0;a<this._filters.length;a++){const r=!!(s&1<<a),o=this._filters[a];i|=(!r||(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_10__.Wi)(o)||o.check(t)?1:0)<<a}let r=0;if(this._idsToHighlight.size){const e=t.getObjectId();r=this.getHighlightFlag(e)}return i<<1|r}}},3383:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{O:()=>ComputedAttributeStorage_u});var StaticBitSet=__webpack_require__(63483);const t=2147483648;class d{constructor(){this._freeIds=[],this._idCounter=1}createId(e=!1){return function u(e,r){return((r?t:0)|e)>>>0}(this._getFreeId(),e)}releaseId(e){this._freeIds.push(e)}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}}function ComputedAttributeStorage_s(t,e,s){if(!(t.length>e))for(;t.length<=e;)t.push(s)}class ComputedAttributeStorage_u{constructor(){this._numerics=[],this._strings=[],this._idGenerator=new d,this._allocatedSize=256,this._bitsets=[],this._instanceIds=[],this._bounds=[]}createBitset(){const e=this._bitsets.length;return this._bitsets.push(StaticBitSet.p.create(this._allocatedSize,2147483647)),e+1}getBitset(t){return this._bitsets[t-1]}_expand(){this._allocatedSize<<=1;for(const t of this._bitsets)t.resize(this._allocatedSize)}_ensureNumeric(t,e){this._numerics[t]||(this._numerics[t]=[]),ComputedAttributeStorage_s(this._numerics[t],e,0)}_ensureInstanceId(t){ComputedAttributeStorage_s(this._instanceIds,t,0)}_ensureString(t,e){this._strings[t]||(this._strings[t]=[]),ComputedAttributeStorage_s(this._strings[t],e,null)}createDisplayId(t=!1){const e=this._idGenerator.createId();return e>this._allocatedSize&&this._expand(),((t,e)=>((e?2147483648:0)|t)>>>0)(e,t)}releaseDisplayId(t){for(const e of this._bitsets)e.unset(t);return this._idGenerator.releaseId(2147483647&t)}getComputedNumeric(t,e){return this.getComputedNumericAtIndex(2147483647&t,0)}setComputedNumeric(t,e,s){return this.setComputedNumericAtIndex(2147483647&t,s,0)}getComputedString(t,e){return this.getComputedStringAtIndex(2147483647&t,0)}setComputedString(t,e,s){return this.setComputedStringAtIndex(2147483647&t,0,s)}getComputedNumericAtIndex(t,e){const s=2147483647&t;return this._ensureNumeric(e,s),this._numerics[e][s]}setComputedNumericAtIndex(t,e,s){const n=2147483647&t;this._ensureNumeric(e,n),this._numerics[e][n]=s}getInstanceId(t){const e=2147483647&t;return this._ensureInstanceId(e),this._instanceIds[e]}setInstanceId(t,e){const s=2147483647&t;this._ensureInstanceId(s),this._instanceIds[s]=e}getComputedStringAtIndex(t,e){const s=2147483647&t;return this._ensureString(e,s),this._strings[e][s]}setComputedStringAtIndex(t,e,s){const n=2147483647&t;this._ensureString(e,n),this._strings[e][n]=s}getXMin(t){return this._bounds[4*(2147483647&t)]}getYMin(t){return this._bounds[4*(2147483647&t)+1]}getXMax(t){return this._bounds[4*(2147483647&t)+2]}getYMax(t){return this._bounds[4*(2147483647&t)+3]}setBounds(t,e){const n=e.readHydratedGeometry();if(!n||!n.coords.length)return!1;let r=1/0,u=1/0,h=-1/0,o=-1/0;n.forEachVertex(((t,e)=>{r=Math.min(r,t),u=Math.min(u,e),h=Math.max(h,t),o=Math.max(o,e)}));const d=2147483647&t;return ComputedAttributeStorage_s(this._bounds,4*d+4,0),this._bounds[4*d]=r,this._bounds[4*d+1]=u,this._bounds[4*d+2]=h,this._bounds[4*d+3]=o,!0}}},98416:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{s:()=>d});__webpack_require__(39994);var _core_maybe_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(61681),_geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(53736),_layers_graphics_OptimizedGeometry_js__WEBPACK_IMPORTED_MODULE_7__=(__webpack_require__(91957),__webpack_require__(15540)),_layers_graphics_featureConversionUtils_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(12065),_layers_graphics_centroid_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(33480),_StaticBitSet_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(63483);let h=0;class d{constructor(t){this.type="FeatureSetReader",this.seen=!1,this.instance=0,this._tx=0,this._ty=0,this._sx=1,this._sy=1,this._xmin=-1,this._xmax=0,this._ymin=0,this._ymax=0,this._deleted=null,this._joined=[],this.instance=t}static createInstance(){return h++,h=h>65535?0:h,h}get isEmpty(){return(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.pC)(this._deleted)&&this._deleted.countSet()===this.getApproximateSize()}get _hasFilter(){return-1!==this._xmin}setArcadeSpatialReference(t){this._arcadeSpatialReference=t}attachStorage(t){this._storage=t}getQuantizationTransform(){throw new Error("Unable to find transform for featureSet")}getStorage(){return this._storage}getComputedNumeric(t){return this.getComputedNumericAtIndex(0)}setComputedNumeric(t,e){return this.setComputedNumericAtIndex(e,0)}getComputedString(t){return this.getComputedStringAtIndex(0)}setComputedString(t,e){return this.setComputedStringAtIndex(0,e)}getComputedNumericAtIndex(t){return this._storage.getComputedNumericAtIndex(this.getDisplayId(),t)}setComputedNumericAtIndex(t,e){this._storage.setComputedNumericAtIndex(this.getDisplayId(),t,e)}getComputedStringAtIndex(t){return this._storage.getComputedStringAtIndex(this.getDisplayId(),t)}setComputedStringAtIndex(t,e){return this._storage.setComputedStringAtIndex(this.getDisplayId(),t,e)}transform(t,e,r,i){const s=this.copy();return s._tx+=t,s._ty+=e,s._sx*=r,s._sy*=i,s}extent(t,e,r,i){const s=this.copy();return s._xmin=t,s._xmax=r,s._ymin=e,s._ymax=i,s}hasFilter(){return this._hasFilter}readAttribute(t,e=!1){const r=this._readAttribute(t,e);if(void 0!==r)return r;for(const i of this._joined){i.setIndex(this.getIndex());const r=i._readAttribute(t,e);if(void 0!==r)return r}}readAttributes(){return this._readAttributes()}joinAttributes(t){this._joined.push(t)}readArcadeFeature(){return this}geometry(){const t=this.readHydratedGeometry(),e=(0,_layers_graphics_featureConversionUtils_js__WEBPACK_IMPORTED_MODULE_3__.di)(t,this.geometryType,this.hasZ,this.hasM),r=(0,_geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_1__.im)(e);return r.spatialReference=this._arcadeSpatialReference,r}field(t){return this.readAttribute(t,!0)}hasField(t){return!0}setField(t,e){}keys(){return[]}castToText(){return""}removeAtIndex(t){(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.Wi)(this._deleted)&&(this._deleted=_StaticBitSet_js__WEBPACK_IMPORTED_MODULE_5__.p.create(this.getApproximateSize())),this._deleted.set(t)}_getExists(){return(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.Wi)(this._deleted)||!this._deleted.has(this.getIndex())}_computeCentroid(){if("esriGeometryPolygon"!==this.geometryType)return null;const t=this.readUnquantizedGeometry();if(!t||t.hasIndeterminateRingOrder)return null;const e=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.Pt)(this.getQuantizationTransform(),null);return(0,_layers_graphics_centroid_js__WEBPACK_IMPORTED_MODULE_6__.Y)(new _layers_graphics_OptimizedGeometry_js__WEBPACK_IMPORTED_MODULE_7__.Z,t,this.hasM,this.hasZ,e)}copyInto(t){t.seen=this.seen,t._storage=this._storage,t._arcadeSpatialReference=this._arcadeSpatialReference,t._joined=this._joined,t._tx=this._tx,t._ty=this._ty,t._sx=this._sx,t._sy=this._sy,t._xmin=this._xmin,t._xmax=this._xmax,t._ymin=this._ymin,t._ymax=this._ymax}}},4094:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{i:()=>c});var _core_maybe_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(61681),_layers_graphics_featureConversionUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(12065),_FeatureSetReader_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(98416);class c extends _FeatureSetReader_js__WEBPACK_IMPORTED_MODULE_1__.s{constructor(t,e,r){super(t),this._featureIndex=-1,this._dateFields=new Set,this._geometryType=r,this._features=e}static fromFeatures(t,e,s){const i=(0,_layers_graphics_featureConversionUtils_js__WEBPACK_IMPORTED_MODULE_0__.Yn)([],t,e,!1,!1,s);for(let r=0;r<i.length;r++)i[r].displayId=t[r].displayId;return c.fromOptimizedFeatures(i,e)}static fromFeatureSet(t,e){const r=(0,_layers_graphics_featureConversionUtils_js__WEBPACK_IMPORTED_MODULE_0__.h_)(t,e);return c.fromOptimizedFeatureSet(r)}static fromOptimizedFeatureSet(t){const{features:e,geometryType:r}=t,s=c.fromOptimizedFeatures(e,r);s._exceededTransferLimit=t.exceededTransferLimit,s._transform=t.transform;for(const i of t.fields)"esriFieldTypeDate"===i.type&&s._dateFields.add(i.name);return s}static fromOptimizedFeatures(t,e,r){const s=_FeatureSetReader_js__WEBPACK_IMPORTED_MODULE_1__.s.createInstance(),i=new c(s,t,e);return i._transform=r,i}get _current(){return this._features[this._featureIndex]}get geometryType(){return this._geometryType}get hasFeatures(){return!!this._features.length}get hasNext(){return this._featureIndex+1<this._features.length}get exceededTransferLimit(){return this._exceededTransferLimit}get hasZ(){return!1}get hasM(){return!1}getApproximateSize(){return this._features.length}getCursor(){return this.copy()}getQuantizationTransform(){return this._transform}getAttributeHash(){let t="";for(const e in this._current.attributes)t+=this._current.attributes[e];return t}getIndex(){return this._featureIndex}setIndex(t){this._featureIndex=t}getObjectId(){return this._current.objectId}getDisplayId(){return this._current.displayId}setDisplayId(t){this._current.displayId=t}getGroupId(){return this._current.groupId}setGroupId(t){this._current.groupId=t}copy(){const t=new c(this.instance,this._features,this.geometryType);return this.copyInto(t),t}next(){for(;++this._featureIndex<this._features.length&&!this._passesFilter()&&!this._getExists(););return this._featureIndex<this._features.length}readLegacyFeature(){return(0,_layers_graphics_featureConversionUtils_js__WEBPACK_IMPORTED_MODULE_0__.EI)(this._current,this.geometryType,this.hasZ,this.hasM)}readOptimizedFeature(){return this._current}readLegacyPointGeometry(){return this.readGeometry()?{x:this.getX(),y:this.getY()}:null}readLegacyGeometry(){const t=this.readGeometry();return(0,_layers_graphics_featureConversionUtils_js__WEBPACK_IMPORTED_MODULE_0__.di)(t,this.geometryType,this.hasZ,this.hasM)}readLegacyCentroid(){const t=this.readCentroid();return t?{x:t.coords[0]*this._sx+this._tx,y:t.coords[1]*this._sy+this._ty}:null}readGeometryArea(){return(0,_layers_graphics_featureConversionUtils_js__WEBPACK_IMPORTED_MODULE_0__.lz)(this._current.geometry,2)}readUnquantizedGeometry(){const t=this.readGeometry();if("esriGeometryPoint"===this.geometryType||!t)return t;const e=t.clone();return function h({coords:t,lengths:e}){let r=0;for(const s of e){for(let e=1;e<s;e++)t[2*(r+e)]+=t[2*(r+e)-2],t[2*(r+e)+1]+=t[2*(r+e)-1];r+=s}}(e),e}readHydratedGeometry(){const e=this._current.geometry;if(!e)return null;const r=e.clone();return(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_2__.pC)(this._transform)&&(0,_layers_graphics_featureConversionUtils_js__WEBPACK_IMPORTED_MODULE_0__.$g)(r,r,this.hasZ,this.hasM,this._transform),r}getXHydrate(){const t=this._current.geometry.coords[0],r=this.getQuantizationTransform();return(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_2__.Wi)(r)?t:t*r.scale[0]+r.translate[0]}getYHydrate(){const t=this._current.geometry.coords[1],r=this.getQuantizationTransform();return(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_2__.Wi)(r)?t:r.translate[1]-t*r.scale[1]}getX(){return this._current.geometry.coords[0]*this._sx+this._tx}getY(){return this._current.geometry.coords[1]*this._sy+this._ty}readGeometry(){if(!this._current.hasGeometry)return null;const t=this._current.geometry.clone();if(t.isPoint)return t.coords[0]=t.coords[0]*this._sx+this._tx,t.coords[1]=t.coords[1]*this._sy+this._ty,t;let e=0;for(const r of t.lengths)t.coords[2*e]=t.coords[2*e]*this._sx+this._tx,t.coords[2*e+1]=t.coords[2*e+1]*this._sy+this._ty,e+=r;return t}readCentroid(){if(!this._current.hasGeometry)return null;if(!this._current.centroid){const t=this._computeCentroid();if(!t)return null;t.coords[0]=(t.coords[0]-this._tx)/this._sx,t.coords[1]=(t.coords[1]-this._ty)/this._sy,this._current.centroid=t}const t=this._current.centroid.clone();return t.coords[0]=t.coords[0]*this._sx+this._tx,t.coords[1]=t.coords[1]*this._sx+this._ty,t}_readAttribute(t,e){const r=this._current.attributes[t];if(void 0!==r)return null!=r&&e&&this._dateFields.has(t)?new Date(r):r;const s=this.readAttributes(),i=t.toLocaleLowerCase().trim();for(const n in s)if(n.toLocaleLowerCase().trim()===i){const t=this._current.attributes[n];return null!=t&&e&&this._dateFields.has(n)?new Date(t):t}}copyInto(t){super.copyInto(t),t._featureIndex=this._featureIndex,t._transform=this._transform,t._dateFields=this._dateFields}_readAttributes(){return this._current.attributes}_passesFilter(){if(!this._hasFilter)return!0;let t=0,e=0;switch(this.geometryType){case"esriGeometryPoint":{const r=this._current.geometry;if(!r)return!1;[t,e]=r.coords;break}case"esriGeometryPolygon":{const r=this.readCentroid();if(!r)return!1;[t,e]=r.coords,t-=this._tx,e-=this._ty;break}default:return!1}return t>=this._xmin&&t<=this._xmax&&e>=this._ymin&&e<=this._ymax}}},63483:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{p:()=>t});class t{constructor(t,e){this._mask=0,this._buf=t,this._mask=e}static fromBuffer(e,s){return new t(e,s)}static create(e,s=4294967295){const r=new Uint32Array(Math.ceil(e/32));return new t(r,s)}_getIndex(t){return Math.floor(t/32)}has(t){const e=this._mask&t;return!!(this._buf[this._getIndex(e)]&1<<e%32)}hasRange(t,e){let s=t,r=e;for(;s%32&&s!==r;){if(this.has(s))return!0;s++}for(;r%32&&s!==r;){if(this.has(s))return!0;r--}if(s===r)return!1;for(let h=s/32;h!==r/32;h++)if(this._buf[h])return!0;return!1}set(t){const e=this._mask&t,s=this._getIndex(e),r=1<<e%32;this._buf[s]|=r}setRange(t,e){let s=t,r=e;for(;s%32&&s!==r;)this.set(s++);for(;r%32&&s!==r;)this.set(r--);if(s!==r)for(let h=s/32;h!==r/32;h++)this._buf[h]=4294967295}unset(t){const e=this._mask&t,s=this._getIndex(e),r=1<<e%32;this._buf[s]&=4294967295^r}resize(t){const e=this._buf,s=new Uint32Array(Math.ceil(t/32));s.set(e),this._buf=s}or(t){for(let e=0;e<this._buf.length;e++)this._buf[e]|=t._buf[e];return this}and(t){for(let e=0;e<this._buf.length;e++)this._buf[e]&=t._buf[e];return this}xor(t){for(let e=0;e<this._buf.length;e++)this._buf[e]^=t._buf[e];return this}ior(t){for(let e=0;e<this._buf.length;e++)this._buf[e]|=~t._buf[e];return this}iand(t){for(let e=0;e<this._buf.length;e++)this._buf[e]&=~t._buf[e];return this}ixor(t){for(let e=0;e<this._buf.length;e++)this._buf[e]^=~t._buf[e];return this}any(){for(let t=0;t<this._buf.length;t++)if(this._buf[t])return!0;return!1}copy(t){for(let e=0;e<this._buf.length;e++)this._buf[e]=t._buf[e];return this}clone(){return new t(this._buf.slice(),this._mask)}clear(){for(let t=0;t<this._buf.length;t++)this._buf[t]=0}forEachSet(t){for(let e=0;e<this._buf.length;e++){let s=this._buf[e],r=32*e;if(s)for(;s;)1&s&&t(r),s>>>=1,r++}}countSet(){let t=0;return this.forEachSet((e=>{t++})),t}}},2290:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{n9:()=>l});var _core_ArrayPool_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(50904),_geometry_Extent_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(91772),_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(24568),_tasks_support_QuantizationParameters_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(688),_tiling_TileKey_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(87241);class l{constructor(e,t){this.key=new _tiling_TileKey_js__WEBPACK_IMPORTED_MODULE_4__.Z(0,0,0,0),this.bounds=(0,_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_2__.Ue)(),this.objectIds=new Set,this.key.set(t);const s=e.getLODInfoAt(this.key);this.tileInfoView=e,this.tileInfoView.getTileBounds(this.bounds,this.key,!0),this.resolution=s.resolution,this.scale=s.scale,this.level=s.level,this.needsClear=!0}get id(){return this.key.id}get extent(){return _geometry_Extent_js__WEBPACK_IMPORTED_MODULE_1__.Z.fromBounds(this.bounds,this.tileInfoView.tileInfo.spatialReference)}get transform(){return{originPosition:"upperLeft",scale:[this.resolution,this.resolution],translate:[this.bounds[0],this.bounds[3]]}}get bbox(){const e=this.bounds;return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}clone(){return new l(this.tileInfoView,this.key)}createChildTiles(){const t=this.key.getChildKeys(),i=_core_ArrayPool_js__WEBPACK_IMPORTED_MODULE_0__.Z.acquire();for(let e=0;e<t.length;e++)i[e]=new l(this.tileInfoView,t[e]);return i}getQuantizationParameters(){return _tasks_support_QuantizationParameters_js__WEBPACK_IMPORTED_MODULE_3__.Z.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})}}},17397:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _core_has_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(39994),_core_Evented_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(31355),_tiling_TileKey_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(87241),_tiling_TileCoverage_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(88782),_Tile_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(2290),_chunks_rbush_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(39947);const h={added:[],removed:[]},r=new Set,d=new _tiling_TileKey_js__WEBPACK_IMPORTED_MODULE_2__.Z(0,0,0,0);class l extends _core_Evented_js__WEBPACK_IMPORTED_MODULE_1__.Z{constructor(t){super(),this._tiles=new Map,this._index=(0,_chunks_rbush_js__WEBPACK_IMPORTED_MODULE_5__.r)(9,(0,_core_has_js__WEBPACK_IMPORTED_MODULE_0__.Z)("csp-restrictions")?e=>({minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this.tiles=[],this.tileScheme=t}destroy(){this.clear()}clear(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}has(e){return this._tiles.has(e)}get(e){return this._tiles.get(e)}findByKey(e){return this._tiles.get(e.id)}minLOD(){return Math.min(...this.tiles.map((e=>e.level)))}intersections(e,t){const s="string"==typeof e?this.get(e):e;if(!s)return[];const i=t*s.resolution,n=s.bounds[0]-i,o=s.bounds[1]-i,h=s.bounds[2]+i,r=s.bounds[3]+i,d=[];for(const l of this._index.search({minX:n,minY:o,maxX:h,maxY:r})){const e=l.bounds.slice();e[0]=Math.max(e[0],n),e[1]=Math.max(e[1],o),e[2]=Math.min(e[2],h),e[3]=Math.min(e[3],r),e[2]-e[0]>0&&e[3]-e[1]>0&&d.push({bounds:e,tile:l})}return d}boundsIntersections(e){return this._index.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]})}updateTiles(e){const t={added:[],removed:[]};for(const s of e.added)if(!this.has(s)){const e=new _Tile_js__WEBPACK_IMPORTED_MODULE_4__.n9(this.tileScheme,s);this._tiles.set(s,e),this._index.insert(e),t.added.push(e)}for(const s of e.removed)if(this.has(s)){const e=this.get(s);this._tiles.delete(s),this._index.remove(e),t.removed.push(e)}this.tiles.length=0,this._tiles.forEach((e=>this.tiles.push(e))),(t.added.length||t.removed.length)&&this.emit("update",t)}setViewState(e){const t=this.tileScheme.getTileCoverage(e,0);if(!t)return;const{spans:s,lodInfo:o}=t,{level:l}=o;if(s.length>0)for(const{row:i,colFrom:a,colTo:m}of s)for(let e=a;e<=m;e++){const t=d.set(l,i,o.normalizeCol(e),o.getWorldForColumn(e)).id;if(r.add(t),!this.has(t)){const e=new _Tile_js__WEBPACK_IMPORTED_MODULE_4__.n9(this.tileScheme,t);this._tiles.set(t,e),this._index.insert(e),this.tiles.push(e),h.added.push(e)}}for(let i=this.tiles.length-1;i>=0;i--){const e=this.tiles[i];r.has(e.id)||(this._tiles.delete(e.id),this.tiles.splice(i,1),this._index.remove(e),h.removed.push(e))}(h.added.length||h.removed.length)&&this.emit("update",h),_tiling_TileCoverage_js__WEBPACK_IMPORTED_MODULE_3__.Z.pool.release(t),r.clear(),h.added.length=0,h.removed.length=0}}const __WEBPACK_DEFAULT_EXPORT__=l},54465:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{I:()=>m,qc:()=>r});var _core_maybe_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(61681),_core_screenUtils_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(95550),_engine_webgl_definitions_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(14266),_engine_webgl_enums_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(38716),_engine_webgl_color_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(62173),_engine_webgl_visualVariablesUtils_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(41657);function r(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e}function u(e){return e.map((e=>function a(e){return{value:e.value,size:(0,_core_screenUtils_js__WEBPACK_IMPORTED_MODULE_4__.t_)(e.size)}}(e)))}function c(e){if("string"==typeof e||"number"==typeof e)return(0,_core_screenUtils_js__WEBPACK_IMPORTED_MODULE_4__.t_)(e);const s=e;return{type:"size",expression:s.expression,stops:u(s.stops)}}const f=e=>{const t=[],o=[],i=u(e),l=i.length;for(let r=0;r<6;r++){const e=i[Math.min(r,l-1)];t.push(e.value),o.push(null==e.size?_engine_webgl_definitions_js__WEBPACK_IMPORTED_MODULE_0__.AI:(0,_core_screenUtils_js__WEBPACK_IMPORTED_MODULE_4__.F2)(e.size))}return{values:new Float32Array(t),sizes:new Float32Array(o)}};function m(e){const t=e&&e.length>0?{}:null,s=t?{}:null;if(!t)return{vvFields:t,vvRanges:s};for(const n of e)if(n.field&&(t[n.type]=n.field),"size"===n.type){s.size||(s.size={});const e=n;switch((0,_engine_webgl_visualVariablesUtils_js__WEBPACK_IMPORTED_MODULE_3__.a)(e)){case _engine_webgl_enums_js__WEBPACK_IMPORTED_MODULE_1__.X.SIZE_MINMAX_VALUE:s.size.minMaxValue={minDataValue:e.minDataValue,maxDataValue:e.maxDataValue,minSize:c(e.minSize),maxSize:c(e.maxSize)};break;case _engine_webgl_enums_js__WEBPACK_IMPORTED_MODULE_1__.X.SIZE_SCALE_STOPS:s.size.scaleStops={stops:u(e.stops)};break;case _engine_webgl_enums_js__WEBPACK_IMPORTED_MODULE_1__.X.SIZE_FIELD_STOPS:if(e.levels){const t={};for(const s in e.levels)t[s]=f(e.levels[s]);s.size.fieldStops={type:"level-dependent",levels:t}}else s.size.fieldStops={type:"static",...f(e.stops)};break;case _engine_webgl_enums_js__WEBPACK_IMPORTED_MODULE_1__.X.SIZE_UNIT_VALUE:s.size.unitValue={unit:e.valueUnit,valueRepresentation:e.valueRepresentation}}}else if("color"===n.type)s.color=y(n);else if("opacity"===n.type)s.opacity=v(n);else if("rotation"===n.type){const e=n;s.rotation={type:e.rotationType}}return{vvFields:t,vvRanges:s}}function v(e){const t={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;{if(e.stops.length>8)return null;const s=e.stops;for(let e=0;e<8;++e){const n=s[Math.min(e,s.length-1)];t.values[e]=n.value,t.opacities[e]=n.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return null;{const s=e.stops&&e.stops.length>=0&&e.stops[0].opacity;for(let e=0;e<8;e++)t.values[e]=1/0,t.opacities[e]=s}}return t}function g(e,t,s){e[4*t+0]=s.r/255,e[4*t+1]=s.g/255,e[4*t+2]=s.b/255,e[4*t+3]=s.a}function y(t){if((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_5__.Wi)(t))return null;if(t.normalizationField)return null;const s={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if("string"==typeof t.field){if(!t.stops)return null;{if(t.stops.length>8)return null;s.field=t.field;const e=t.stops;for(let t=0;t<8;++t){const n=e[Math.min(t,e.length-1)];s.values[t]=n.value,g(s.colors,t,n.color)}}}else{if(!(t.stops&&t.stops.length>=0))return null;{const e=t.stops&&t.stops.length>=0&&t.stops[0].color;for(let t=0;t<8;t++)s.values[t]=1/0,g(s.colors,t,e)}}for(let e=0;e<32;e+=4)(0,_engine_webgl_color_js__WEBPACK_IMPORTED_MODULE_2__.pr)(s.colors,e,!0);return s}}}]);