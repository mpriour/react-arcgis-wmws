"use strict";(self.webpackChunkreact_arcgis_wmws=self.webpackChunkreact_arcgis_wmws||[]).push([[5945],{15945:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>FeatureLayerViewBase3D});var tslib_es6=__webpack_require__(36663),compilerUtils=(__webpack_require__(39994),__webpack_require__(27755)),maybe=__webpack_require__(61681),property=(__webpack_require__(13802),__webpack_require__(7283),__webpack_require__(81977)),subclass=__webpack_require__(12571),core_Error=__webpack_require__(70375),watchUtils=(__webpack_require__(3466),__webpack_require__(12173),__webpack_require__(51876),__webpack_require__(15071)),RefreshableLayerView=__webpack_require__(55068),hydratedFeatures=__webpack_require__(45043),LayerView3D=__webpack_require__(19654),layerViewUpdatingProperties=__webpack_require__(72035),LayerView=__webpack_require__(26216),FeatureLayerView=__webpack_require__(79917),FeatureTileController3D=__webpack_require__(44675),EventedSet=__webpack_require__(71774),FeatureLikeLayerView3D=__webpack_require__(14264),FeatureTileFetcher3D=__webpack_require__(80529),aliasOf=__webpack_require__(42730),promiseUtils=__webpack_require__(78668),Accessor=__webpack_require__(53443),query=__webpack_require__(28500),dehydratedFeatures=__webpack_require__(48358),SpatialReference=__webpack_require__(14685),Graphic=__webpack_require__(80085),Scheduler=__webpack_require__(55839),Field=__webpack_require__(12512),WorkerHandle=__webpack_require__(12916);class PBFDecoder_a{constructor(e){this._handle=new i(e),this._frameTask=e.registerTask(Scheduler.iQ.REMOTE_CLIENT,(e=>this._frameTask.processQueue(e)),(()=>!1))}destroy(){this._frameTask.remove(),this._handle.destroy()}invoke(s,o){return s.buffer&&0!==s.buffer.byteLength?(s.options.sourceSpatialReference&&s.options.sourceSpatialReference instanceof SpatialReference.Z&&(s.options={...s.options,sourceSpatialReference:s.options.sourceSpatialReference.toJSON()}),this._handle.invoke(s,o).then((s=>this._frameTask.schedule((()=>{if(s.spatialReference=SpatialReference.Z.fromJSON(s.spatialReference),s.fields)for(let e=0;e<s.fields.length;e++)s.fields[e]=Field.Z.fromJSON(s.fields[e]);const o=s.spatialReference;for(const e of s.features)e.uid=Graphic.Z.generateUID(),e.geometry&&(e.geometry.spatialReference=o);return s}))))):Promise.resolve(null)}}class i extends WorkerHandle.q{constructor(e){super("PBFDecoderWorker","_parseFeatureQuery",e)}getTransferList(e){return[e.buffer]}}let m=class extends Accessor.Z{get queryFeaturesDehydrated(){const e=this.layer.capabilities,s=e&&e.query;if(s&&s.supportsFormatPBF){var o,a;(0,maybe.Wi)(this._decoder)&&(this._decoder=new PBFDecoder_a(this.scheduler));const e={sourceSpatialReference:null!=(o=null==(a=this.layer.spatialReference)?void 0:a.toJSON())?o:null,applyTransform:!0,maxStringAttributeLength:1024};return(r,s)=>(0,query.runQuery)(this.layer.parsedUrl,r,"pbf",s).then((r=>((0,promiseUtils.k_)(s),(0,maybe.pC)(this._decoder)?this._decoder.invoke({buffer:r.data,options:e},s.signal):Promise.reject((0,promiseUtils.zE)()))))}return(e,r)=>(0,query.executeQuery)(this.layer.parsedUrl,e,this.layer.spatialReference,r).then((e=>(0,dehydratedFeatures.PA)(e.data)))}queryFeatureCount(e,r){return this.layer.queryFeatureCount(e,r)}destroy(){this._decoder=(0,maybe.SC)(this._decoder)}};(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0})],m.prototype,"layer",void 0),(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0})],m.prototype,"scheduler",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],m.prototype,"queryFeaturesDehydrated",null),m=(0,tslib_es6._)([(0,subclass.j)("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],m);let h=class extends Accessor.Z{queryFeaturesDehydrated(e,r){return this.layer.queryFeatures(e,r)}};(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0})],h.prototype,"layer",void 0),h=(0,tslib_es6._)([(0,subclass.j)("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],h);let f=class extends Accessor.Z{destroy(){}queryFeaturesDehydrated(e,r){return this.source.queryFeaturesJSON(e,r).then(dehydratedFeatures.PA,(t=>{if(t&&"query-features-json:unsupported"===t.name)return this.layer.queryFeatures(e,r);throw t}))}queryFeatureCount(e,r){return this.layer.queryFeatureCount(e,r)}};(0,tslib_es6._)([(0,property.Cb)({constructOnly:!0})],f.prototype,"layer",void 0),(0,tslib_es6._)([(0,aliasOf.B)("layer.source")],f.prototype,"source",void 0),f=(0,tslib_es6._)([(0,subclass.j)("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],f);class a{constructor(e){this._memoryCache=null,this._capabilities=null;const r=e.layerView.layer;this.layerView=e.layerView,this.objectIdField=r.objectIdField,this.returnZ=e.returnZ,this.returnM=e.returnM;const t=this.layerView.view.resourceController;this.query=function j(e,r){switch(e.source.type){case"feature-layer":return new m({layer:e,scheduler:r});case"memory":case"csv":case"geojson":return new f({layer:e});case"ogc-feature":return new h({layer:e});case"stream-layer":throw new Error("Tile based queries unsupported for stream sources")}}(r,t.scheduler),t&&this.memoryCacheEnabled&&(this._memoryCache=t.memoryController.getMemCache(r.uid))}get memoryCacheEnabled(){switch(this.layerView.layer.source.type){case"feature-layer":case"ogc-feature":return!0;case"csv":case"geojson":case"memory":case"stream-layer":return!1}}destroy(){this._memoryCache=(0,maybe.SC)(this._memoryCache),this.query.destroy()}createQuery(){const e=this.layerView.layer.createQuery();return e.outFields=this.layerView.availableFields,e.returnZ=this.returnZ,e.returnM=this.returnM,e.outSpatialReference=this.tilingScheme.spatialReference,e}get memoryCache(){return this._memoryCache}get viewingMode(){return this.layerView.view.state.mode}get tilingScheme(){return this.layerView.view.featureTiles.tilingScheme}get scheduler(){const e=this.layerView.view.resourceController;return e?e.scheduler:null}get geometryType(){return this.layerView.layer.geometryType}get fullExtent(){return this.layerView.layer.fullExtent}get tileMaxRecordCount(){return this.layerView.layer.capabilities.query.tileMaxRecordCount}get maxRecordCount(){return this.layerView.layer.capabilities.query.maxRecordCount}get capabilities(){return(0,maybe.pC)(this._capabilities)||(this._capabilities=(0,FeatureTileFetcher3D.AD)(this.layerView.layer)),this._capabilities}logFetchError(e,r){e.error("#fetchTile()",this.layerView.layer,r&&r.message?r.message:r)}}let FeatureLayerViewBase3D_f=class extends((0,RefreshableLayerView.yc)((0,FeatureLikeLayerView3D.R)((0,FeatureLayerView.T)((0,LayerView3D.A)(LayerView.Z))))){constructor(e){super(e),this._controllerTotal=0,this._graphicsCoreTotal=0,this.suspendResumeExtentMode="data"}initialize(){this.updatingHandles.add(this,"view.floors",(()=>this.graphics3d.filterVisibility.filterChanged()))}destroy(){this.fetcherContext&&(this.fetcherContext.destroy(),this.fetcherContext=null)}get updatingProgressValue(){let e=1;if(this.controller&&this.controller.updating){const r=this.controller.updatingRemaining,t=this.controller.updatingTotal;t>0&&(this._controllerTotal=Math.max(t,this._controllerTotal),e=(t-r)/t)}let r=1;if(this.graphics3d&&this.graphics3d.graphicsCore){const e=this.graphics3d.graphicsCore.updatingRemaining,t=this.graphics3d.graphicsCore.updatingTotal;t>0&&(this._graphicsCoreTotal=Math.max(t,this._graphicsCoreTotal),r=(t-e)/t)}return 1===e&&1===r&&(this._controllerTotal=0,this._graphicsCoreTotal=0),.5*(e+r)}get maximumNumberOfFeatures(){var e,r;return null!=(e=null==(r=this.controller)?void 0:r.maximumNumberOfFeatures)?e:this._get("maximumNumberOfFeatures")}set maximumNumberOfFeatures(e){this._set("maximumNumberOfFeatures",e),this.controller&&(this.controller.maximumNumberOfFeatures=e)}get maximumNumberOfFeaturesExceeded(){return!!this.controller&&!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded)}get asyncGraphicsUpdates(){if(this.controller)switch(this.controller.mode){case"snapshot":{const e=F[this.layer.geometryType];return null==e||this.controller.serviceDataCount>e}case"tiles":return!0;default:(0,compilerUtils.Bg)(this.controller.mode)}return!0}get hasZ(){const e=this.layer,r=e.capabilities&&e.capabilities.data;return!(!r||!r.supportsZ)&&("returnZ"in e&&null!=e.returnZ?e.returnZ:r.supportsZ)}get hasM(){const e=this.layer,r=e.capabilities&&e.capabilities.data;return!(!r||!r.supportsM)&&"returnM"in e&&null!=e.returnM&&e.returnM}async fetchPopupFeatures(e,r){const t=this.validateFetchPopupFeatures(r);return t?Promise.reject(t):this.fetchClientPopupFeatures(r)}setVisibility(e,r){this.graphics3d&&this.graphics3d.graphicsCore.setObjectIdVisibility(e,r)}createQuery(){return super.createQuery()}queryFeatures(e,r){const t=()=>super.queryFeatures(e,r);return"mesh"===this.layer.geometryType?this._queryFeaturesMesh(this._ensureQuery(e),t):t()}beforeSetController(e){e.maximumNumberOfFeatures=this.maximumNumberOfFeatures}createController(){this.fetcherContext=new a({layerView:this,returnZ:this.hasZ,returnM:this.hasM});const e=new FeatureTileController3D.Z({layerView:this,context:this.fetcherContext,graphics:new EventedSet.g,extent:this.clippingExtent});return this.updatingHandles.add(e,"serviceDataExtent",(e=>{this.graphics3d&&(this.graphics3d.dataExtent=e)}),2),this.handles.add((0,watchUtils.S1)(this,"suspended",(r=>{r?e.suspend():e.resume()}),!0)),this.updatingHandles.add(this.graphics3d.graphicsCore,"displayFeatureLimit",(()=>this.updateDisplayFeatureLimit(e)),2),this.handles.add(this.view.resourceController.memoryController.events.on("quality-changed",(()=>this.updateDisplayFeatureLimit()))),e}async doRefresh(){!this.suspended&&this.controller&&this.controller.refetch()}getUsedMemory(){const e=this.graphics3d&&this.graphics3d.graphicsCore;return(e?e.usedMemory:0)+(this.controller?this.controller.memoryForUnusedFeatures:0)}getUnloadedMemory(){const e=this.graphics3d&&this.graphics3d.graphicsCore;return(e?e.unprocessedMemoryEstimate:0)+(this.controller?this.controller.expectedFeatureDiff*e.usedMemoryPerGraphic:0)}ignoresMemoryFactor(){return this.controller&&this.controller.hasMaximumNumberOfFeaturesOverride}updateDisplayFeatureLimit(e=this.controller){if(!e||!this.graphics3d||!this.graphics3d.graphicsCore)return;const r=this.graphics3d.graphicsCore.displayFeatureLimit,t=this.view.resourceController.memoryController.memoryFactor;if(1===t)e.displayFeatureLimit=r;else{const s=Math.ceil(r.maximumNumberOfFeatures*t),i=Math.ceil(r.maximumTotalNumberOfFeatures*t),o=Math.ceil(r.minimumTotalNumberOfFeatures*t);e.displayFeatureLimit={...r,maximumNumberOfFeatures:s,maximumTotalNumberOfFeatures:i,minimumTotalNumberOfFeatures:o}}}async _queryFeaturesMesh(e,r){await this._validateQueryFeaturesMesh(e);const t=await r();if(e&&e.outStatistics)return t;const s=this.layer.objectIdField,i=this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID,o=[];for(const a of t.features)if(a.geometry){const e=i.get(a.attributes[s]);e&&(a.geometry=(0,hydratedFeatures.kB)(e.graphic.geometry),o.push(a))}else o.push(a);return t.features=o,t}async _validateQueryFeaturesMesh(e){if(!e)return;const r=e=>{throw new core_Error.Z("feature-layer-view:unsupported-query",`Queries on Mesh feature collection layers do not support '${e}'`)},s=["quantizationParameters","geometryPrecision","maxAllowableOffset"];for(const t of s)null!=e[t]&&r(t);"returnM"in e&&e.returnM&&r("returnM"),"returnCentroid"in e&&e.returnCentroid&&r("returnCentroid"),(0,maybe.pC)(e.outSpatialReference)&&!e.outSpatialReference.equals(this.view.spatialReference)&&r("outSpatialReference")}get performanceInfo(){const e=this.controller&&this.controller.displayFeatureLimit,r=(0,maybe.pC)(e)&&e.averageSymbolComplexity,s=(0,maybe.pC)(r)?`f:${r.primitivesPerFeature},v:${r.primitivesPerCoordinate}`:"n/a",i={...this._getResourceInfo(),storedFeatures:0,totalVertices:0,partial:this.maximumNumberOfFeaturesExceeded,mode:this.controller?this.controller.mode:"n/a",symbolComplexity:s,nodes:this.controller?this.controller.tileDescriptors.length:0};if(this.controller&&i.displayedNumberOfFeatures){const e=this.controller.debug;i.storedFeatures=e.storedFeatures,i.totalVertices=e.totalVertices}return i}};(0,tslib_es6._)([(0,property.Cb)()],FeatureLayerViewBase3D_f.prototype,"layer",void 0),(0,tslib_es6._)([(0,property.Cb)()],FeatureLayerViewBase3D_f.prototype,"controller",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0,dependsOn:["controller.updatingRemaining","controller.updatingTotal","graphics3d.graphicsCore.updatingRemaining","graphics3d.graphicsCore.updatingTotal"]})],FeatureLayerViewBase3D_f.prototype,"updatingProgressValue",null),(0,tslib_es6._)([(0,property.Cb)()],FeatureLayerViewBase3D_f.prototype,"maximumNumberOfFeatures",null),(0,tslib_es6._)([(0,property.Cb)()],FeatureLayerViewBase3D_f.prototype,"maximumNumberOfFeaturesExceeded",null),(0,tslib_es6._)([(0,property.Cb)(layerViewUpdatingProperties.q)],FeatureLayerViewBase3D_f.prototype,"updatingProgress",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],FeatureLayerViewBase3D_f.prototype,"asyncGraphicsUpdates",null),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],FeatureLayerViewBase3D_f.prototype,"hasZ",null),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],FeatureLayerViewBase3D_f.prototype,"hasM",null),(0,tslib_es6._)([(0,property.Cb)()],FeatureLayerViewBase3D_f.prototype,"suspendResumeExtentMode",void 0),FeatureLayerViewBase3D_f=(0,tslib_es6._)([(0,subclass.j)("esri.views.3d.layers.FeatureLayerViewBase3D")],FeatureLayerViewBase3D_f);const F={point:5e3,polygon:500,polyline:1e3};const FeatureLayerViewBase3D=FeatureLayerViewBase3D_f},79917:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{T:()=>R});var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(36663),_core_maybe_js__WEBPACK_IMPORTED_MODULE_18__=(__webpack_require__(39994),__webpack_require__(61681)),_core_Logger_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(13802),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__=(__webpack_require__(7283),__webpack_require__(81977)),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(12571),_core_Error_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(70375),_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_9__=(__webpack_require__(3466),__webpack_require__(12173),__webpack_require__(51876),__webpack_require__(78668)),_support_arcadeOnDemand_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(30879),_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(14845),_core_watchUtils_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(15071),_layers_support_commonProperties_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(23072),_tasks_support_Query_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(27746),_support_FeatureFilter_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(37034),_support_FeatureEffect_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(31851),_support_popupUtils_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(59439);const q=_core_Logger_js__WEBPACK_IMPORTED_MODULE_1__.Z.getLogger("esri.views.layers.FeatureLayerView"),R=r=>{let R=class extends r{constructor(...e){super(...e),this._updatingRequiredFieldsPromise=null,this.effect=null,this.filter=null,this.timeExtent=null,this.layer=null,this.requiredFields=[],this.view=null}initialize(){(0,_core_watchUtils_js__WEBPACK_IMPORTED_MODULE_12__.S1)(this,["layer.renderer","layer.labelingInfo","layer.elevationInfo.featureExpressionInfo","layer.displayField","filter","effect","layer.timeInfo","layer.floorInfo","timeExtent"],(()=>this._handleRequiredFieldsChange()),!0),(0,_core_watchUtils_js__WEBPACK_IMPORTED_MODULE_12__.on)(this,"view.floors","change",(()=>this._handleRequiredFieldsChange()))}get availableFields(){const{layer:e,layer:{fields:t},requiredFields:r}=this;return"outFields"in e&&e.outFields?(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_11__.Q0)(t,[...(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_11__.Lk)(t,e.outFields),...r]):(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_11__.Q0)(t,r)}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(e){q.error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")}get maximumNumberOfFeaturesExceeded(){return!1}highlight(e){throw new Error("missing implementation")}createQuery(){const e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},r=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_18__.pC)(this.filter)?this.filter.createQuery(e):new _tasks_support_Query_js__WEBPACK_IMPORTED_MODULE_14__.Z(e);return(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_18__.pC)(this.timeExtent)&&(r.timeExtent=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_18__.pC)(r.timeExtent)?r.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),r}queryFeatures(e,t){throw new Error("missing implementation")}queryObjectIds(e,t){throw new Error("missing implementation")}queryFeatureCount(e,t){throw new Error("missing implementation")}queryExtent(e,t){throw new Error("missing implementation")}_loadArcadeModules(e){if(e.get("expressionInfos.length"))return(0,_support_arcadeOnDemand_js__WEBPACK_IMPORTED_MODULE_10__.LC)()}_handleRequiredFieldsChange(){const e=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",e),e.then((()=>{this._updatingRequiredFieldsPromise===e&&this._set("_updatingRequiredFieldsPromise",null)}))}async _updateRequiredFields(){if(!this.layer||!this.view)return;const e="3d"===this.view.type,{layer:r,layer:{fields:i,objectIdField:s,renderer:o,displayField:a}}=this,n=r.featureReduction,u=new Set,h=await(0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_9__.as)([o?o.collectRequiredFields(u,i):null,(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_11__.Mu)(u,r),e?(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_11__.vl)(u,r):null,(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_18__.pC)(this.filter)?(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_11__.Ll)(u,r,this.filter):null,this.effect?(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_11__.Ll)(u,r,this.effect.filter):null,n?(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_11__.ZV)(u,r,n):null]);r.timeInfo&&this.timeExtent&&(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_11__.gd)(u,r.fields,[r.timeInfo.startField,r.timeInfo.endField]),"feature"===r.type&&r.floorInfo&&(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_11__.gd)(u,r.fields,[r.floorInfo.floorField]);for(const t of h)t.error&&q.error(t.error);(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_11__.AB)(u,i,s),e&&a&&(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_11__.AB)(u,i,a);const F=Array.from(u).sort();this._set("requiredFields",F)}validateFetchPopupFeatures(e){const{layer:t,layer:{popupEnabled:r}}=this;return r?(0,_support_popupUtils_js__WEBPACK_IMPORTED_MODULE_17__.V)(this.layer,e)?void 0:new _core_Error_js__WEBPACK_IMPORTED_MODULE_5__.Z("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:t}):new _core_Error_js__WEBPACK_IMPORTED_MODULE_5__.Z("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:t})}async fetchClientPopupFeatures(e){const r=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_18__.pC)(e)?e.clientGraphics:null;if(!r||0===r.length)return Promise.resolve([]);const i=[],s=[],{layer:o}=this,l=(0,_support_popupUtils_js__WEBPACK_IMPORTED_MODULE_17__.V)(o,e);if(!(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_18__.pC)(l))return Promise.resolve([]);const a=await this._loadArcadeModules(l),n=a&&a.arcadeUtils.hasGeometryOperations(l),p=await this.createPopupQuery(e),m=(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_11__.Lk)(o.fields,p.outFields);for(const t of r)n||!(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_11__.R9)(m,t)?s.push(t):i.push(t);return"stream"===o.type||0===s.length?Promise.resolve(i):(p.objectIds=s.map((e=>e.attributes[o.objectIdField])),o.queryFeatures(p).then((e=>i.concat(e.features))).catch((()=>s)))}async createPopupQuery(e){const r=this.layer,i=r.createQuery(),s=(0,_support_popupUtils_js__WEBPACK_IMPORTED_MODULE_17__.V)(r,e),o=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_18__.pC)(s)&&await this._loadArcadeModules(s),l=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_18__.pC)(s)&&o&&o.arcadeUtils.hasGeometryOperations(s),a=!("point"!==r.geometryType&&!l);return i.returnGeometry=a,i.returnZ=a,i.returnM=a,i.outFields=await(0,_support_popupUtils_js__WEBPACK_IMPORTED_MODULE_17__.e)(this.layer,s),i.outSpatialReference=this.view.spatialReference,i}canResume(){return!(!super.canResume()||(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_18__.pC)(this.timeExtent)&&this.timeExtent.isEmpty)}};return(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_19__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)()],R.prototype,"_updatingRequiredFieldsPromise",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_19__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({readOnly:!0})],R.prototype,"availableFields",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_19__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({type:_support_FeatureEffect_js__WEBPACK_IMPORTED_MODULE_16__.Z})],R.prototype,"effect",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_19__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({type:_support_FeatureFilter_js__WEBPACK_IMPORTED_MODULE_15__.Z})],R.prototype,"filter",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_19__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)(_layers_support_commonProperties_js__WEBPACK_IMPORTED_MODULE_13__.qG)],R.prototype,"timeExtent",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_19__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)()],R.prototype,"layer",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_19__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({type:Number})],R.prototype,"maximumNumberOfFeatures",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_19__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({readOnly:!0,type:Boolean})],R.prototype,"maximumNumberOfFeaturesExceeded",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_19__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({readOnly:!0})],R.prototype,"requiredFields",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_19__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)()],R.prototype,"suspended",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_19__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)()],R.prototype,"view",void 0),R=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_19__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_4__.j)("esri.views.layers.FeatureLayerView")],R),R}},31851:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var i,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(36663),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__=(__webpack_require__(39994),__webpack_require__(13802),__webpack_require__(7283),__webpack_require__(81977)),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(12571),_core_JSONSupport_js__WEBPACK_IMPORTED_MODULE_8__=(__webpack_require__(3466),__webpack_require__(12173),__webpack_require__(51876),__webpack_require__(49004)),_FeatureFilter_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(37034);let c=i=class extends _core_JSONSupport_js__WEBPACK_IMPORTED_MODULE_8__.wq{constructor(){super(...arguments),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}clone(){return new i({filter:this.filter&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_10__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({type:_FeatureFilter_js__WEBPACK_IMPORTED_MODULE_9__.Z,json:{write:!0}})],c.prototype,"filter",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_10__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({json:{write:!0}})],c.prototype,"includedEffect",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_10__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({json:{write:!0}})],c.prototype,"excludedEffect",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_10__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({type:Boolean,json:{write:!0}})],c.prototype,"excludedLabelsVisible",void 0),c=i=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_10__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_4__.j)("esri.views.layers.support.FeatureEffect")],c);const __WEBPACK_DEFAULT_EXPORT__=c},59439:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{V:()=>d,e:()=>i});var _core_maybe_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(61681),_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(14845);async function i(i,d=i.popupTemplate){if(!(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_1__.pC)(d))return[];const o=await d.getRequiredFields(i.fields),{lastEditInfoEnabled:s}=d,{objectIdField:u,typeIdField:a,globalIdField:n,relationships:f}=i;if(o.includes("*"))return["*"];const r=s?await(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.CH)(i):[],m=(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.Q0)(i.fields,[...o,...r]);return a&&m.push(a),m&&u&&(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.cT)(i.fields,u)&&-1===m.indexOf(u)&&m.push(u),m&&n&&(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.cT)(i.fields,n)&&-1===m.indexOf(n)&&m.push(n),f&&f.forEach((e=>{const{keyField:p}=e;m&&p&&(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.cT)(i.fields,p)&&-1===m.indexOf(p)&&m.push(p)})),m}function d(p,l){return p.popupTemplate?p.popupTemplate:(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_1__.pC)(l)&&l.defaultPopupTemplateEnabled&&(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_1__.pC)(p.defaultPopupTemplate)?p.defaultPopupTemplate:null}}}]);