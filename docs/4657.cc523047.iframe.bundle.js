(self.webpackChunkreact_arcgis_wmws=self.webpackChunkreact_arcgis_wmws||[]).push([[4657],{83302:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{mR:()=>_,C$:()=>R,e2:()=>O,wO:()=>Z,Mk:()=>q,cM:()=>re,Z_:()=>te,ws:()=>K,xV:()=>P,UK:()=>Y,Yw:()=>W,$_:()=>T,nU:()=>S,$K:()=>N,hj:()=>k,Y8:()=>C});__webpack_require__(95830);var Logger=__webpack_require__(36544),Error=__webpack_require__(32656),enums=(__webpack_require__(33655),__webpack_require__(9037),__webpack_require__(23660),__webpack_require__(8634),__webpack_require__(84570),__webpack_require__(31514)),ObjectPool=(__webpack_require__(51482),__webpack_require__(38035));class h{constructor(){this.color=[0,0,0,0],this.haloColor=[0,0,0,0],this.haloSize=0,this.size=12,this.angle=0,this.offsetX=0,this.offsetY=0,this.hAnchor=0,this.vAnchor=0}acquire(o,h,s,t,i,l,r,e,c){this.color=o,this.haloColor=h,this.haloSize=s,this.size=t,this.angle=i,this.offsetX=l,this.offsetY=r,this.hAnchor=e,this.vAnchor=c}release(){this.color[0]=this.color[1]=this.color[2]=this.color[3]=0,this.haloColor[0]=this.haloColor[1]=this.haloColor[2]=this.haloColor[3]=0,this.haloSize=0,this.size=0,this.angle=0,this.offsetX=0,this.offsetY=0,this.hAnchor=0,this.vAnchor=0}}h.pool=new ObjectPool.Z(h);const u=Logger.Z.getLogger("esri.views.2d.engine.webgl.Utils"),f="geometry",p=[{name:f,strideInBytes:32,divisor:0}],Utils_h=[{name:f,strideInBytes:12,divisor:0}],w=[{name:f,strideInBytes:36,divisor:0}],v=[{name:f,strideInBytes:32,divisor:0}],y=[{name:f,strideInBytes:36,divisor:0}];function g(e){const r={};for(const t of e)r[t.name]=t.strideInBytes;return r}const b=g([{name:f,strideInBytes:32,divisor:0}]),L=g(p),A=g(Utils_h),I=g(w),E=g(v),j=g(y);function T(e,r){switch(e){case enums.LW.MARKER:return b;case enums.LW.FILL:return r?A:L;case enums.LW.LINE:return I;case enums.LW.TEXT:return E;case enums.LW.LABEL:return j}}const x=[f],F=[f],M=[f],U=[f],B=[f];function z(e){switch(e){case enums.LW.MARKER:return x;case enums.LW.FILL:return F;case enums.LW.LINE:return M;case enums.LW.TEXT:return U;case enums.LW.LABEL:return B}}function C(e){switch(e%4){case 0:case 2:return 4;case 1:case 3:return 1}}function R(e,r){switch(r%4){case 0:case 2:return new Uint32Array(Math.floor(e*r/4));case 1:case 3:return new Uint8Array(e*r)}}function O(e,r){switch(r%4){case 0:case 2:return new Uint32Array(e);case 1:case 3:return new Uint8Array(e)}}function N(e){return null!=e}function k(e){return"number"==typeof e}function K(e,t){switch(e){case"butt":return 0;case"round":return t?2:1;case"square":return 2;default:return u.error(new Error.Z("mapview-invalid-type",`Cap type ${e} is not a valid option. Defaulting to round`)),1}}function P(e){switch(e){case"miter":return 2;case"bevel":return 0;case"round":return 1;default:return u.error(new Error.Z("mapview-invalid-type",`Join type ${e} is not a valid option. Defaulting to round`)),1}}function S(e){switch(e){case"opacity":return enums.pc.OPACITY;case"color":return enums.pc.COLOR;case"rotation":return enums.pc.ROTATION;case"size":return enums.pc.SIZE;default:return u.error(`Cannot interpret unknown vv: ${e}`),null}}function Z(e,r,t,n,o,s,i){for(const c in s){const r=s[c].stride,n=C(r),i=s[c].data,a=t[c].data,u=r*o.vertexCount/n,f=r*e/n,l=r*o.vertexFrom/n;for(let e=0;e<u;++e)a[e+f]=i[e+l]}const a=o.indexCount;for(let c=0;c<a;++c)n[c+r]=i[c+o.indexFrom]-o.vertexFrom+e}const _={[f]:35044};function q(e,r){const t=[];for(let n=0;n<5;++n){const o=z(n),s={};for(const e of o)s[e]={data:r(n,e)};t.push({data:e(n),buffers:s})}return t}function J(e){switch(e){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5126:case 5124:case 5125:return 4}}function W(e){switch(e){case 5121:return 1;case 32819:return 2;case 5126:return 4;default:return void u.error(new Error.Z("webgl-utils",`Unable to handle type ${e}`))}}function Y(e){switch(e){case 5121:return Uint8Array;case 32819:return Uint16Array;case 5126:return Float32Array;default:return void u.error(new Error.Z("webgl-utils",`Unable to handle type ${e}`))}}const Q=e=>{const r={};for(const t in e)for(const n of e[t])r[n.name]=n.location;return r},V=e=>{const r={};for(const t in e){const n=e[t];r[t]=n.length?n[0].stride:0}return r},ee=new Map,re=(e,r)=>{if(!ee.has(e)){const t=function H(e){const r={};for(const t in e){const n=e[t];let o=0;r[t]=n.map((e=>{const r={...e,normalized:e.normalized||!1,divisor:e.divisor||0,offset:o,stride:0};return o+=e.count*J(e.type),r})),r[t].forEach((e=>e.stride=o))}return r}(r),n={strides:V(t),bufferLayouts:t,attributes:Q(r)};ee.set(e,n)}return ee.get(e)};function te(e){e(enums.LW.MARKER),e(enums.LW.FILL),e(enums.LW.LINE),e(enums.LW.TEXT),e(enums.LW.LABEL)}},51482:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{pr:()=>o,t2:()=>i,aH:()=>f});var _number_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(53986);function o(r,n=0,t=!1){const u=r[n+3];return r[n+0]*=u,r[n+1]*=u,r[n+2]*=u,t||(r[n+3]*=255),r}function i(n){if(!n)return 0;const{r:t,g:u,b:o,a:c}=n;return(0,_number_js__WEBPACK_IMPORTED_MODULE_0__.Jz)(t*c,u*c,o*c,255*c)}function f(n){if(!n)return 0;const[t,u,o,c]=n;return(0,_number_js__WEBPACK_IMPORTED_MODULE_0__.Jz)(t*(c/255),u*(c/255),o*(c/255),c)}},31514:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";var E,T,I,L,A,_,O;__webpack_require__.d(__webpack_exports__,{Un:()=>O,pc:()=>L,jx:()=>I,LW:()=>E,X:()=>A,mf:()=>_}),function(E){E[E.FILL=0]="FILL",E[E.LINE=1]="LINE",E[E.MARKER=2]="MARKER",E[E.TEXT=3]="TEXT",E[E.LABEL=4]="LABEL"}(E||(E={})),function(E){E[E.SUCCEEDED=0]="SUCCEEDED",E[E.FAILED_OUT_OF_MEMORY=1]="FAILED_OUT_OF_MEMORY"}(T||(T={})),function(E){E[E.NONE=0]="NONE",E[E.MAP=1]="MAP",E[E.LABEL=2]="LABEL",E[E.LABEL_ALPHA=4]="LABEL_ALPHA",E[E.HITTEST=8]="HITTEST",E[E.HIGHLIGHT=16]="HIGHLIGHT",E[E.CLIP=32]="CLIP",E[E.DEBUG=64]="DEBUG",E[E.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES"}(I||(I={})),function(E){E[E.SIZE=0]="SIZE",E[E.COLOR=1]="COLOR",E[E.OPACITY=2]="OPACITY",E[E.ROTATION=3]="ROTATION"}(L||(L={})),function(E){E[E.NONE=0]="NONE",E[E.OPACITY=1]="OPACITY",E[E.COLOR=2]="COLOR",E[E.ROTATION=4]="ROTATION",E[E.SIZE_MINMAX_VALUE=8]="SIZE_MINMAX_VALUE",E[E.SIZE_SCALE_STOPS=16]="SIZE_SCALE_STOPS",E[E.SIZE_FIELD_STOPS=32]="SIZE_FIELD_STOPS",E[E.SIZE_UNIT_VALUE=64]="SIZE_UNIT_VALUE"}(A||(A={})),function(E){E[E.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE",E[E.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE",E[E.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE",E[E.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"}(_||(_={})),function(E){E[E.SPRITE=0]="SPRITE",E[E.GLYPH=1]="GLYPH"}(O||(O={}))},9709:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{dk:()=>C,Gq:()=>N,a:()=>b,mE:()=>w,m2:()=>_,qr:()=>F,jj:()=>A,hF:()=>f});var _core_Error_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(32656),_enums_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(31514),_mesh_templates_meshUtils_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(49269);function a(t,s=!1){const r=_enums_js__WEBPACK_IMPORTED_MODULE_1__.X.SIZE_FIELD_STOPS|_enums_js__WEBPACK_IMPORTED_MODULE_1__.X.SIZE_MINMAX_VALUE|_enums_js__WEBPACK_IMPORTED_MODULE_1__.X.SIZE_SCALE_STOPS|_enums_js__WEBPACK_IMPORTED_MODULE_1__.X.SIZE_UNIT_VALUE,a=(t&(_enums_js__WEBPACK_IMPORTED_MODULE_1__.mf.FIELD_TARGETS_OUTLINE|_enums_js__WEBPACK_IMPORTED_MODULE_1__.mf.MINMAX_TARGETS_OUTLINE|_enums_js__WEBPACK_IMPORTED_MODULE_1__.mf.SCALE_TARGETS_OUTLINE|_enums_js__WEBPACK_IMPORTED_MODULE_1__.mf.UNIT_TARGETS_OUTLINE))>>>4;return s?r&a:r&~a}function A(t,e,i,r,a){switch(t){case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.FILL:return C.from(e,r);case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.LINE:return b.from(e,i);case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.MARKER:return w.from(e);case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.TEXT:return F.from(e);case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.LABEL:return N.from(e,a);default:throw new Error(`Unable to createMaterialKey for unknown geometryType ${t}`)}}function f(t){switch(_.load(t).geometryType){case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.MARKER:return new w(t);case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.FILL:return new C(t);case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.LINE:return new b(t);case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.TEXT:return new F(t);case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.LABEL:return new N(t)}}class _{constructor(t){this._data=0,this._data=t}static load(t){const e=this.shared;return e.data=t,e}set data(t){this._data=t}get data(){return this._data}get geometryType(){return this.bits(8,11)}set geometryType(t){this.setBits(t,8,11)}get mapAligned(){return!!this.bit(20)}set mapAligned(t){this.setBit(20,t)}get sdf(){return!!this.bit(11)}set sdf(t){this.setBit(11,t)}get pattern(){return!!this.bit(12)}set pattern(t){this.setBit(12,t)}get textureBinding(){return this.bits(0,8)}set textureBinding(t){this.setBits(t,0,8)}get geometryTypeString(){switch(this.geometryType){case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.FILL:return"fill";case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.MARKER:return"marker";case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.LINE:return"line";case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.TEXT:return"text";case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.LABEL:return"label";default:throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.Z(`Unable to handle unknown geometryType: ${this.geometryType}`)}}setBit(t,e){const i=1<<t;e?this._data|=i:this._data&=~i}bit(t){return(this._data&1<<t)>>t}setBits(t,e,i){for(let s=e,r=0;s<i;s++,r++)this.setBit(s,0!=(t&1<<r))}bits(t,e){let i=0;for(let s=t,r=0;s<e;s++,r++)i|=this.bit(s)<<r;return i}hasVV(){return!1}setVV(t,e){}getVariation(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf}}getVariationHash(){return this._data&~(7&this.textureBinding)}}_.shared=new _(0);const x=t=>class extends t{get vvSizeMinMaxValue(){return 0!==this.bit(16)}set vvSizeMinMaxValue(t){this.setBit(16,t)}get vvSizeScaleStops(){return 0!==this.bit(17)}set vvSizeScaleStops(t){this.setBit(17,t)}get vvSizeFieldStops(){return 0!==this.bit(18)}set vvSizeFieldStops(t){this.setBit(18,t)}get vvSizeUnitValue(){return 0!==this.bit(19)}set vvSizeUnitValue(t){this.setBit(19,t)}hasVV(){return super.hasVV()||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue}setVV(t,i){super.setVV(t,i);const s=a(t,i)&t;this.vvSizeMinMaxValue=!!(s&_enums_js__WEBPACK_IMPORTED_MODULE_1__.X.SIZE_MINMAX_VALUE),this.vvSizeFieldStops=!!(s&_enums_js__WEBPACK_IMPORTED_MODULE_1__.X.SIZE_FIELD_STOPS),this.vvSizeUnitValue=!!(s&_enums_js__WEBPACK_IMPORTED_MODULE_1__.X.SIZE_UNIT_VALUE),this.vvSizeScaleStops=!!(s&_enums_js__WEBPACK_IMPORTED_MODULE_1__.X.SIZE_SCALE_STOPS)}},R=t=>class extends t{get vvRotation(){return 0!==this.bit(15)}set vvRotation(t){this.setBit(15,t)}hasVV(){return super.hasVV()||this.vvRotation}setVV(t,i){super.setVV(t,i),this.vvRotation=!i&&!!(t&_enums_js__WEBPACK_IMPORTED_MODULE_1__.X.ROTATION)}},U=t=>class extends t{get vvColor(){return 0!==this.bit(13)}set vvColor(t){this.setBit(13,t)}hasVV(){return super.hasVV()||this.vvColor}setVV(t,i){super.setVV(t,i),this.vvColor=!i&&!!(t&_enums_js__WEBPACK_IMPORTED_MODULE_1__.X.COLOR)}},B=t=>class extends t{get vvOpacity(){return 0!==this.bit(14)}set vvOpacity(t){this.setBit(14,t)}hasVV(){return super.hasVV()||this.vvOpacity}setVV(t,i){super.setVV(t,i),this.vvOpacity=!i&&!!(t&_enums_js__WEBPACK_IMPORTED_MODULE_1__.X.OPACITY)}};class C extends(U(B(_))){static load(t){const e=this.shared;return e.data=t,e}static from(t,e){const i=this.load(0);return i.geometryType=_enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.FILL,e?i.dotDensity=!0:i.setVV(t,!1),i.data}getVariation(){return{...super.getVariation(),dotDensity:this.dotDensity,vvColor:this.vvColor,vvOpacity:this.vvOpacity}}get dotDensity(){return!!this.bit(15)}set dotDensity(t){this.setBit(15,t)}}C.shared=new C(0);class w extends(U(B(R(x(_))))){static load(t){const e=this.shared;return e.data=t,e}static from(t){const e=this.load(0);return e.geometryType=_enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.MARKER,e.setVV(t,!1),e.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvRotation:this.vvRotation,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}w.shared=new w(0);class b extends(U(B(x(_)))){static load(t){const e=this.shared;return e.data=t,e}static from(t,e){const i=this.load(0);return i.geometryType=_enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.LINE,i.setVV(t,e),i.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}b.shared=new b(0);class F extends(U(B(R(x(_))))){static load(t){const e=this.shared;return e.data=t,e}static from(t){const e=this.load(t);return e.geometryType=_enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.TEXT,e.setVV(t,!1),e.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}F.shared=new F(0);class N extends(x(_)){static load(t){const e=this.shared;return e.data=t,e}static from(t,e){const i=this.load(0);return i.geometryType=_enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.LABEL,i.setVV(t,!1),i.mapAligned=!!(0,_mesh_templates_meshUtils_js__WEBPACK_IMPORTED_MODULE_2__.N)(e),i.data}getVariation(){return{...super.getVariation(),vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}N.shared=new N(0)},49269:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";function e(e){switch(e){case"above-along":case"below-along":case"center-along":return 1;default:return 0}}__webpack_require__.d(__webpack_exports__,{N:()=>e})},53986:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{UJ:()=>m,Jz:()=>w,Au:()=>M});const n=new Float32Array(1);new Uint32Array(n.buffer);function M(n){return[255&n,(65280&n)>>>8,(16711680&n)>>>16,(4278190080&n)>>>24]}function m(n,r){return 65535&n|r<<16}function w(n,r,t,u){return 255&n|(255&r)<<8|(255&t)<<16|u<<24}},54598:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>VectorTileLayerView3D});var tslib_es6=__webpack_require__(56140),maybe=(__webpack_require__(95830),__webpack_require__(59472)),property=(__webpack_require__(36544),__webpack_require__(68055),__webpack_require__(79881)),subclass=__webpack_require__(87566),promiseUtils=(__webpack_require__(10923),__webpack_require__(57002),__webpack_require__(86035),__webpack_require__(39105)),watchUtils=__webpack_require__(80621),SchemaHelper=__webpack_require__(70),StyleRepository=__webpack_require__(6017),terrainUtils=__webpack_require__(1524),LayerView3D=__webpack_require__(9355),TiledLayerView3D=__webpack_require__(19131),LayerView=__webpack_require__(48164),aaBoundingRect=__webpack_require__(50897),MemCache=__webpack_require__(92823),TileKey=__webpack_require__(5201),mat3f32=__webpack_require__(55955),VectorTile=__webpack_require__(57498),TileHandler=__webpack_require__(78540),core=__webpack_require__(16086),util=__webpack_require__(17441),jobs=__webpack_require__(84959),SymbolDeclutterer=__webpack_require__(12559),SymbolRepository=__webpack_require__(49922);class g extends TileHandler.m{constructor(e,t,o,i,s){super(e,t,o),this._memCache=i,this._loader=s,this._ongoingTileRequests=new Map,this._ongoingRequestToController=new Map}destroy(){this._ongoingRequestToController.forEach((e=>e.abort())),this._ongoingRequestToController.clear(),this._ongoingTileRequests.clear()}async getVectorTile(l,g,h,c){const m=new TileKey.Z(l,g,h,0);let u=this._memCache.get(m.id);if((0,maybe.pC)(u))return u.retain(),u;const _=await this._getVectorTileData(m);if((0,promiseUtils.k_)(c),!this._vectorTileLayer)return null;if(u=this._memCache.get(m.id),(0,maybe.pC)(u))return u.retain(),u;const T=this._vectorTileLayer.tileInfo.getTileBounds((0,aaBoundingRect.Ue)(),m);return u=new VectorTile.i(m,this._styleRepository,T,[512,512],this._memCache),(0,maybe.pC)(_)&&_.tileData?(u.setData(_.tileData),u.retain(),this._memCache.put(m.id,u,u.getMemoryUsage()*u.referenced,MemCache.an)):u.setData(null),u.neededForCoverage=!0,u.transforms.tileUnitsToPixels=(0,mat3f32.f)(1/8,0,0,0,1/8,0,0,0,1),function i(i,p){const a=[],y=new SymbolRepository.L(4096,a,(()=>{const e=new core.J;return e.show=!1,e.parts.push({startTime:0,startOpacity:0,targetOpacity:0,show:!1}),e.parts.push({startTime:0,startOpacity:0,targetOpacity:0,show:!1}),e})),m=new SymbolDeclutterer.g(a,y,((t,e,o)=>new jobs.f(t,e,o,i.styleRepository,i.key.level,0)),((t,r)=>{(0,util.C$)(t,r,!1)}),(()=>0),(t=>{const e=p.getStyleLayerByUID(t).getLayoutProperty("visibility");return!e||1!==e.getValue()}));a.push(i),y.add(i),m.setScreenSize(512,512),m.continue(1/0)}(u,this._styleRepository),u}_getVectorTileData(e){const t=e.id;if(this._ongoingTileRequests.has(t))return this._ongoingTileRequests.get(t);const o=new AbortController,i={signal:o.signal},s=this._getParsedVectorTileData(e,i).then((e=>(this._ongoingTileRequests.delete(t),this._ongoingRequestToController.delete(t),e))).catch((()=>(this._ongoingTileRequests.delete(t),this._ongoingRequestToController.delete(t),null)));return this._ongoingTileRequests.set(t,s),this._ongoingRequestToController.set(t,o),s}_getParsedVectorTileData(e,t){return this.fetchTileData(e,t).then((o=>this.parseTileData({key:e,data:o},t)))}request(e,t){return this._loader.request(e,"binary",t)}}const TileHandler3D=g;var brushes=__webpack_require__(32825),VTLMaterialManager=__webpack_require__(95138);const s=1e-6;const VTLPainter3D=class a{constructor(e,t){this.spriteMosaic=e,this.glyphMosaic=t,this._brushCache=new Map,this._vtlMaterialManager=new VTLMaterialManager.Z}dispose(){this._brushCache&&(this._brushCache.forEach((e=>e.dispose())),this._brushCache=null),this._vtlMaterialManager=(0,maybe.O3)(this._vtlMaterialManager),this.spriteMosaic.dispose(),this.glyphMosaic.dispose()}get vectorTilesMaterialManager(){return this._vtlMaterialManager}drawTile(e,t,r){const{context:s}=e,a=r.layers;r.backgroundBucketIds.length>0&&(e.renderPass="background",r.backgroundBucketIds.forEach((s=>this._renderStyleLayer(r.getLayerById(s),e,t,!0)))),s.setBlendingEnabled(!1),s.setDepthTestEnabled(!0),s.setDepthWriteEnabled(!0),s.setDepthFunction(515),e.renderPass="opaque";for(let i=a.length-1;i>=0;i--)this._renderStyleLayer(a[i],e,t,!1);s.setDepthWriteEnabled(!1),s.setBlendingEnabled(!0),s.setBlendFunctionSeparate(1,771,1,771),e.renderPass="translucent";for(let i=0;i<a.length;i++)this._renderStyleLayer(a[i],e,t,!1);s.setDepthTestEnabled(!1),e.renderPass="symbol";for(let i=0;i<a.length;i++)this._renderStyleLayer(a[i],e,t,!1);s.bindVAO()}_renderStyleLayer(e,t,r,a=!1){if(!(a||e&&r.layerData.has(e.uid)))return;const i=e.getLayoutProperty("visibility");if(i&&1===i.getValue())return;const{renderPass:n}=t;let l;switch(e.type){case 0:if("background"!==n)return;l="vtlBackground";break;case 1:if("opaque"!==n&&"translucent"!==t.renderPass)return;l="vtlFill";break;case 2:if("translucent"!==n)return;l="vtlLine";break;case 4:if("symbol"!==n)return;l="vtlCircle";break;case 3:if("symbol"!==n)return;l="vtlSymbol"}const h=t.displayLevel;void 0!==e.minzoom&&e.minzoom>h+s||void 0!==e.maxzoom&&e.maxzoom<=h-s||(t.styleLayerUID=e.uid,t.styleLayer=e,this.drawWithBrush(t,r,l))}drawWithBrush(e,r,s){if(!this._brushCache.has(s)){const e=brushes.J[s];this._brushCache.set(s,new e)}this._brushCache.get(s).drawMany(e,[r])}};let f=class extends((0,TiledLayerView3D.r)((0,LayerView3D.A)(LayerView.Z))){constructor(e){super(e)}initialize(){const e=terrainUtils.Bu.force512VTL?this.layer.tileInfo:this.layer.compatibleTileInfo256,t=this._getTileInfoSupportError(e,this.layer.fullExtent);if(t)return void this.addResolvingPromise(Promise.reject(t));const{basemapTerrain:r,spatialReference:i,pixelRatio:l}=this.view,c=(0,watchUtils.LR)(this.view,"basemapTerrain.tilingSchemeLocked").then((()=>{const e=r.tilingScheme,t=e.pixelSize;let l;this.schemaHelper=new SchemaHelper.Z(t,i.isGeographic),l=256===t?this.layer.compatibleTileInfo256:this.view.spatialReference.isGeographic?this.layer.compatibleTileInfo512:this.layer.tileInfo;const s=this._getTileInfoCompatibilityError(l,e);if(s)throw s;this._set("tileInfo",l)}));this._tileHandlerController=(0,promiseUtils.yi)();const{memoryController:m,scheduler:d}=this.view.resourceController;this._memCache=m.getMemCache(this.layer.uid,(e=>e.release()));const{style:f,spriteUrl:g,glyphsUrl:H}=this.layer.currentStyleInfo,v=new StyleRepository.Z(f,{spriteUrl:g,glyphsUrl:H}),j=r.mapTileRequester;this.tileHandler=new TileHandler3D(this.layer,v,l,this._memCache,j);const C=this._tileHandlerController.signal,_=this.tileHandler.start({signal:C,scheduler:d}),w=this.tileHandler.spriteMosaic;w.then((e=>{!(0,promiseUtils.Hc)(C)&&this.tileHandler&&(this.painter=new VTLPainter3D(e,this.tileHandler.glyphMosaic))})),_.then((()=>this._tileHandlerController=null));const T=()=>{this._tileHandlerController&&this._tileHandlerController.abort(),this._tileHandlerController=(0,promiseUtils.yi)(),this._memCache.clear();const{style:e,spriteUrl:t,glyphsUrl:r}=this.layer.currentStyleInfo,i=new StyleRepository.Z(e,{spriteUrl:t,glyphsUrl:r}),o=new TileHandler3D(this.layer,i,l,this._memCache,j),a=o.start({signal:this._tileHandlerController.signal,scheduler:d}),n=o.spriteMosaic;a.then((()=>this._tileHandlerController=null)),this.updatingHandles.addPromise(Promise.all([a,n]).then((([,e])=>{const t=this.tileHandler,r=this.painter;this.painter=new VTLPainter3D(e,o.glyphMosaic),this.tileHandler=o,this.emit("data-changed"),t.destroy(),r&&r.dispose()})))};this.updatingHandles.add(this,"layer.currentStyleInfo",T),this.updatingHandles.add(this,"view.pixelRatio",T);const I=Promise.all([c,_,w]);this.addResolvingPromise(I)}destroy(){this.painter=(0,maybe.O3)(this.painter),this._tileHandlerController&&(this._tileHandlerController.abort(),this._tileHandlerController=null),(0,maybe.SC)(this.tileHandler),this._memCache=(0,maybe.SC)(this._memCache),this.tileHandler=null}get dataLevelRange(){const e=this.tileInfo.lods,t=e[0].scale,r=e[e.length-1].scale,i=this.levelRangeFromScaleRange(t,r);return 1===i.minLevel&&256===this.tileInfo.size[0]&&(i.minLevel=0),i}};(0,tslib_es6._)([(0,property.Cb)({aliasOf:"layer.fullExtent"})],f.prototype,"fullExtent",void 0),(0,tslib_es6._)([(0,property.Cb)()],f.prototype,"layer",void 0),(0,tslib_es6._)([(0,property.Cb)()],f.prototype,"tileInfo",void 0),(0,tslib_es6._)([(0,property.Cb)()],f.prototype,"dataLevelRange",null),(0,tslib_es6._)([(0,property.Cb)()],f.prototype,"updatingProgressValue",void 0),f=(0,tslib_es6._)([(0,subclass.j)("esri.views.3d.layers.VectorTileLayerView3D")],f);const VectorTileLayerView3D=f}}]);
//# sourceMappingURL=4657.cc523047.iframe.bundle.js.map