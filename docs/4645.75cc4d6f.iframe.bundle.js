(self.webpackChunkreact_arcgis_wmws=self.webpackChunkreact_arcgis_wmws||[]).push([[4645],{96540:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{vX:()=>g,s5:()=>M,k3:()=>P,Or:()=>h});Number.POSITIVE_INFINITY;const t=Math.PI,o=128/t,N=1/Math.LN2;function a(n,t){return(n%=t)>=0?n:n+t}function h(n){return a(n*o,256)}function M(n){return a(.7111111111111111*n,256)}function P(n){return Math.log(n)*N}function g(n,t,r){return n>=t&&n<=r||n>=r&&n<=t}},90200:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Ki:()=>c,Ao:()=>l,yB:()=>n,Hn:()=>h,GF:()=>r});var _core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(33655),_layers_features_support_StaticBitSet_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(21252),_definitions_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(71286);const h=0,r=1,n=2;class c{constructor(t,e){this.width=t,this.height=e;const i=Math.ceil(t/1),h=Math.ceil(e/1);this._cols=i,this._rows=h,this._cells=_layers_features_support_StaticBitSet_js__WEBPACK_IMPORTED_MODULE_2__.p.create(i*h)}insertMetrics(t){const s=this._hasCollision(t);return s===h&&this._markMetrics(t),s}getCellId(t,s){return t+s*this._cols}has(t){return this._cells.has(t)}hasRange(t,s){return this._cells.hasRange(t,s)}set(t){this._cells.set(t)}setRange(t,s){this._cells.setRange(t,s)}_hasCollision(t){const s=t.id;let e=0,o=0;t.save();do{const s=t.boundsCount;e+=s;for(let e=0;e<s;e++){const s=t.boundsComputedAnchorX(e),h=t.boundsComputedAnchorY(e),c=t.boundsWidth(e)+2,l=t.boundsHeight(e)+2;switch(this._collide(s,h,c,l)){case n:return n;case r:o++}}}while(t.peekId()===s&&t.next());return t.restore(),e===o?r:h}_collide(s,e,i,c){const l=s-i/2,_=s+i/2,a=e-c/2,u=e+c/2;if(_<0||u<0||l>this.width||a>this.height)return r;const d=(0,_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__.uZ)(Math.floor(l/1),0,this._cols),g=(0,_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__.uZ)(Math.floor(a/1),0,this._rows),f=(0,_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__.uZ)(Math.ceil(_/1),0,this._cols),m=(0,_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__.uZ)(Math.ceil(u/1),0,this._rows);for(let t=g;t<=m;t++)for(let s=d;s<=f;s++){const e=this.getCellId(s,t);if(this.has(e))return n}return h}_mark(s,e,i,h){const r=s-i/2,n=s+i/2,c=e-h/2,l=e+h/2,_=(0,_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__.uZ)(Math.floor(r/1),0,this._cols),a=(0,_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__.uZ)(Math.floor(c/1),0,this._rows),u=(0,_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__.uZ)(Math.ceil(n/1),0,this._cols),d=(0,_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_0__.uZ)(Math.ceil(l/1),0,this._rows);for(let t=a;t<=d;t++)for(let s=_;s<=u;s++){const e=this.getCellId(s,t);this.set(e)}return!1}_markMetrics(t){const s=t.id;do{const s=t.boundsCount;for(let e=0;e<s;e++){const s=t.boundsComputedAnchorX(e),o=t.boundsComputedAnchorY(e),h=t.boundsWidth(e)+2,r=t.boundsHeight(e)+2;this._mark(s,o,h,r)}}while(t.peekId()===s&&t.next())}}class l{constructor(t,s=2){this._bucketSize=t,this._rowsLength=_definitions_js__WEBPACK_IMPORTED_MODULE_1__.I_/t,this._colsLength=_definitions_js__WEBPACK_IMPORTED_MODULE_1__.I_/t,this._elementsPerBucket=s,this._grid=this._initGrid()}checkOverlap(t,s){const e=Math.floor(t/this._bucketSize),i=Math.floor(s/this._bucketSize);return e<0||e>=this._rowsLength||i<0||i>=this._colsLength||this._grid[i*this._colsLength+e]>=this._elementsPerBucket}markUsed(t,s){const e=Math.floor(t/this._bucketSize),i=Math.floor(s/this._bucketSize);this._grid[i*this._colsLength+e]+=1}reset(){this._grid=this._initGrid()}_initGrid(){return new Uint8Array(this._rowsLength*this._colsLength)}}},9709:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{dk:()=>C,Gq:()=>N,a:()=>b,mE:()=>w,m2:()=>_,qr:()=>F,jj:()=>A,hF:()=>f});var _core_Error_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(32656),_enums_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(31514),_mesh_templates_meshUtils_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(49269);function a(t,s=!1){const r=_enums_js__WEBPACK_IMPORTED_MODULE_1__.X.SIZE_FIELD_STOPS|_enums_js__WEBPACK_IMPORTED_MODULE_1__.X.SIZE_MINMAX_VALUE|_enums_js__WEBPACK_IMPORTED_MODULE_1__.X.SIZE_SCALE_STOPS|_enums_js__WEBPACK_IMPORTED_MODULE_1__.X.SIZE_UNIT_VALUE,a=(t&(_enums_js__WEBPACK_IMPORTED_MODULE_1__.mf.FIELD_TARGETS_OUTLINE|_enums_js__WEBPACK_IMPORTED_MODULE_1__.mf.MINMAX_TARGETS_OUTLINE|_enums_js__WEBPACK_IMPORTED_MODULE_1__.mf.SCALE_TARGETS_OUTLINE|_enums_js__WEBPACK_IMPORTED_MODULE_1__.mf.UNIT_TARGETS_OUTLINE))>>>4;return s?r&a:r&~a}function A(t,e,i,r,a){switch(t){case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.FILL:return C.from(e,r);case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.LINE:return b.from(e,i);case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.MARKER:return w.from(e);case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.TEXT:return F.from(e);case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.LABEL:return N.from(e,a);default:throw new Error(`Unable to createMaterialKey for unknown geometryType ${t}`)}}function f(t){switch(_.load(t).geometryType){case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.MARKER:return new w(t);case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.FILL:return new C(t);case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.LINE:return new b(t);case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.TEXT:return new F(t);case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.LABEL:return new N(t)}}class _{constructor(t){this._data=0,this._data=t}static load(t){const e=this.shared;return e.data=t,e}set data(t){this._data=t}get data(){return this._data}get geometryType(){return this.bits(8,11)}set geometryType(t){this.setBits(t,8,11)}get mapAligned(){return!!this.bit(20)}set mapAligned(t){this.setBit(20,t)}get sdf(){return!!this.bit(11)}set sdf(t){this.setBit(11,t)}get pattern(){return!!this.bit(12)}set pattern(t){this.setBit(12,t)}get textureBinding(){return this.bits(0,8)}set textureBinding(t){this.setBits(t,0,8)}get geometryTypeString(){switch(this.geometryType){case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.FILL:return"fill";case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.MARKER:return"marker";case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.LINE:return"line";case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.TEXT:return"text";case _enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.LABEL:return"label";default:throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.Z(`Unable to handle unknown geometryType: ${this.geometryType}`)}}setBit(t,e){const i=1<<t;e?this._data|=i:this._data&=~i}bit(t){return(this._data&1<<t)>>t}setBits(t,e,i){for(let s=e,r=0;s<i;s++,r++)this.setBit(s,0!=(t&1<<r))}bits(t,e){let i=0;for(let s=t,r=0;s<e;s++,r++)i|=this.bit(s)<<r;return i}hasVV(){return!1}setVV(t,e){}getVariation(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf}}getVariationHash(){return this._data&~(7&this.textureBinding)}}_.shared=new _(0);const x=t=>class extends t{get vvSizeMinMaxValue(){return 0!==this.bit(16)}set vvSizeMinMaxValue(t){this.setBit(16,t)}get vvSizeScaleStops(){return 0!==this.bit(17)}set vvSizeScaleStops(t){this.setBit(17,t)}get vvSizeFieldStops(){return 0!==this.bit(18)}set vvSizeFieldStops(t){this.setBit(18,t)}get vvSizeUnitValue(){return 0!==this.bit(19)}set vvSizeUnitValue(t){this.setBit(19,t)}hasVV(){return super.hasVV()||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue}setVV(t,i){super.setVV(t,i);const s=a(t,i)&t;this.vvSizeMinMaxValue=!!(s&_enums_js__WEBPACK_IMPORTED_MODULE_1__.X.SIZE_MINMAX_VALUE),this.vvSizeFieldStops=!!(s&_enums_js__WEBPACK_IMPORTED_MODULE_1__.X.SIZE_FIELD_STOPS),this.vvSizeUnitValue=!!(s&_enums_js__WEBPACK_IMPORTED_MODULE_1__.X.SIZE_UNIT_VALUE),this.vvSizeScaleStops=!!(s&_enums_js__WEBPACK_IMPORTED_MODULE_1__.X.SIZE_SCALE_STOPS)}},R=t=>class extends t{get vvRotation(){return 0!==this.bit(15)}set vvRotation(t){this.setBit(15,t)}hasVV(){return super.hasVV()||this.vvRotation}setVV(t,i){super.setVV(t,i),this.vvRotation=!i&&!!(t&_enums_js__WEBPACK_IMPORTED_MODULE_1__.X.ROTATION)}},U=t=>class extends t{get vvColor(){return 0!==this.bit(13)}set vvColor(t){this.setBit(13,t)}hasVV(){return super.hasVV()||this.vvColor}setVV(t,i){super.setVV(t,i),this.vvColor=!i&&!!(t&_enums_js__WEBPACK_IMPORTED_MODULE_1__.X.COLOR)}},B=t=>class extends t{get vvOpacity(){return 0!==this.bit(14)}set vvOpacity(t){this.setBit(14,t)}hasVV(){return super.hasVV()||this.vvOpacity}setVV(t,i){super.setVV(t,i),this.vvOpacity=!i&&!!(t&_enums_js__WEBPACK_IMPORTED_MODULE_1__.X.OPACITY)}};class C extends(U(B(_))){static load(t){const e=this.shared;return e.data=t,e}static from(t,e){const i=this.load(0);return i.geometryType=_enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.FILL,e?i.dotDensity=!0:i.setVV(t,!1),i.data}getVariation(){return{...super.getVariation(),dotDensity:this.dotDensity,vvColor:this.vvColor,vvOpacity:this.vvOpacity}}get dotDensity(){return!!this.bit(15)}set dotDensity(t){this.setBit(15,t)}}C.shared=new C(0);class w extends(U(B(R(x(_))))){static load(t){const e=this.shared;return e.data=t,e}static from(t){const e=this.load(0);return e.geometryType=_enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.MARKER,e.setVV(t,!1),e.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvRotation:this.vvRotation,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}w.shared=new w(0);class b extends(U(B(x(_)))){static load(t){const e=this.shared;return e.data=t,e}static from(t,e){const i=this.load(0);return i.geometryType=_enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.LINE,i.setVV(t,e),i.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}b.shared=new b(0);class F extends(U(B(R(x(_))))){static load(t){const e=this.shared;return e.data=t,e}static from(t){const e=this.load(t);return e.geometryType=_enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.TEXT,e.setVV(t,!1),e.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}F.shared=new F(0);class N extends(x(_)){static load(t){const e=this.shared;return e.data=t,e}static from(t,e){const i=this.load(0);return i.geometryType=_enums_js__WEBPACK_IMPORTED_MODULE_1__.LW.LABEL,i.setVV(t,!1),i.mapAligned=!!(0,_mesh_templates_meshUtils_js__WEBPACK_IMPORTED_MODULE_2__.N)(e),i.data}getVariation(){return{...super.getVariation(),vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}N.shared=new N(0)},49269:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";function e(e){switch(e){case"above-along":case"below-along":case"center-along":return 1;default:return 0}}__webpack_require__.d(__webpack_exports__,{N:()=>e})},31887:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(56140),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__=(__webpack_require__(95830),__webpack_require__(36544),__webpack_require__(68055),__webpack_require__(79881)),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(87566),_core_HandleOwner_js__WEBPACK_IMPORTED_MODULE_8__=(__webpack_require__(10923),__webpack_require__(57002),__webpack_require__(86035),__webpack_require__(77204));let s=class extends _core_HandleOwner_js__WEBPACK_IMPORTED_MODULE_8__.r{initialize(){}destroy(){}get supportsTileUpdates(){return!1}get spatialReference(){const e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null}};(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_9__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({readOnly:!0})],s.prototype,"supportsTileUpdates",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_9__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({constructOnly:!0})],s.prototype,"remoteClient",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_9__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({constructOnly:!0})],s.prototype,"service",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_9__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)()],s.prototype,"spatialReference",null),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_9__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({constructOnly:!0})],s.prototype,"tileInfo",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_9__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({constructOnly:!0})],s.prototype,"tileStore",void 0),s=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_9__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_4__.j)("esri.views.2d.layers.features.processors.BaseProcessor")],s);const __WEBPACK_DEFAULT_EXPORT__=s},50353:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__(56140),_core_has_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(95830),_core_maybe_js__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(59472),_core_Logger_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(36544),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__(68055),__webpack_require__(79881),__webpack_require__(87566)),_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_9__=(__webpack_require__(32656),__webpack_require__(10923),__webpack_require__(57002),__webpack_require__(86035),__webpack_require__(39105)),_geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(73032),_core_accessorSupport_diffUtils_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(23229),_engine_webgl_definitions_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(71286),_engine_webgl_util_BidiText_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(84767),_engine_webgl_collisions_CollisionGrid_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(90200),_engine_webgl_Utils_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(83302),_engine_webgl_cpuMapped_DisplayRecordReader_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(48041),_support_AttributeStore_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(28487),_engine_webgl_mesh_MeshData_js__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(80264),_engine_webgl_mesh_factories_matcherUtils_js__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(44055),_textUtils_js__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(44840),_engine_webgl_mesh_templates_WGLTemplateStore_js__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(10321),_engine_webgl_mesh_factories_WGLMeshFactory_js__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(45672),_BaseProcessor_js__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(31887);function x(e){const t=e.message,i={message:{data:{},tileKey:t.tileKey},transferList:new Array};for(const o in t.data){const e=t.data[o];if(i.message.data[o]=null,(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_23__.pC)(e)){const t=e.stride,r=e.indices.slice(0),a=e.vertices.slice(0),n=e.records.slice(0),c={stride:t,indices:r,vertices:a,records:n,metrics:(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_23__.Po)(e.metrics,(e=>e.slice(0)))};i.transferList.push(r,a,n),i.message.data[o]=c}}return i}_core_Logger_js__WEBPACK_IMPORTED_MODULE_1__.Z.getLogger("esri.views.2d.layers.features.processors.SymbolProcessor");let C=class extends _BaseProcessor_js__WEBPACK_IMPORTED_MODULE_22__.Z{constructor(){super(...arguments),this.type="symbol",this._matchers={feature:null,aggregate:null},this._bufferData=new Map}initialize(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])}destroy(){}get supportsTileUpdates(){return!0}async update(e,r){const s=r.schema.processors[0];if("symbol"!==s.type)return;const i=(0,_core_accessorSupport_diffUtils_js__WEBPACK_IMPORTED_MODULE_11__.Hg)(this._schema,s);(0,_core_accessorSupport_diffUtils_js__WEBPACK_IMPORTED_MODULE_11__.uD)(i,"mesh")&&((0,_core_has_js__WEBPACK_IMPORTED_MODULE_0__.Z)("esri-2d-update-debug")&&console.debug("Applying Update - Processor:",i),e.mesh=!0,e.why.mesh.push("Symbology changed"),this._schema=s,this._factory=this._createFactory(s),this._factory.update(s,this.tileStore.tileScheme.tileInfo))}onTileMessage(e,t,r,s){return(0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_9__.k_)(s),this._onTileData(e,t,r,s)}onTileClear(e){return this._bufferData.delete(e.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:{clear:!0}})}onTileError(e,t,r){const s=r.signal,i={tileKey:e.id,error:t};return this.remoteClient.invoke("tileRenderer.onTileError",i,{signal:s})}onTileUpdate(e){for(const t of e.removed)this._bufferData.has(t.key.id)&&(this._bufferData.get(t.key.id).forEach((e=>{const t=new Set;(0,_engine_webgl_Utils_js__WEBPACK_IMPORTED_MODULE_15__.Z_)((s=>{const i=e.message.data[s];if((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_23__.pC)(i)){const e=_engine_webgl_cpuMapped_DisplayRecordReader_js__WEBPACK_IMPORTED_MODULE_16__.$.from(i.records).getCursor();for(;e.next();)t.add(e.id)}}));const s=e.message.tileKey;return this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:s,data:{type:"update",addOrUpdate:null}})})),this._bufferData.delete(t.key.id));for(const t of e.added)this._bufferData.forEach((e=>{for(const r of e)r.message.tileKey===t.id&&this._updateTileMesh("append",t,x(r),[],!1,!1,null)}))}_addBufferData(e,t){this._bufferData.has(e)||this._bufferData.set(e,[]),this._bufferData.get(e).push(x(t))}_createFactory(e){const{geometryType:t,objectIdField:r,fields:i}=this.service,a={geometryType:t,fields:i,spatialReference:_geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_10__.Z.fromJSON(this.spatialReference)},n=new _engine_webgl_mesh_templates_WGLTemplateStore_js__WEBPACK_IMPORTED_MODULE_20__.W(((e,t)=>this.remoteClient.invoke("tileRenderer.getMaterialItems",e,t)),!1),{matcher:c,aggregateMatcher:l}=e.mesh;return this._store=n,this._matchers.feature=(0,_engine_webgl_mesh_factories_matcherUtils_js__WEBPACK_IMPORTED_MODULE_19__.f)(c,n,a),this._matchers.aggregate=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_23__.Po)(l,(e=>(0,_engine_webgl_mesh_factories_matcherUtils_js__WEBPACK_IMPORTED_MODULE_19__.f)(e,n,a))),new _engine_webgl_mesh_factories_WGLMeshFactory_js__WEBPACK_IMPORTED_MODULE_21__.j(t,r,n)}async _onTileData(e,t,r,s){const{type:o,addOrUpdate:a,remove:n}=t,c=t.end;if(!a){const t={type:o,addOrUpdate:null,remove:n,clear:!1,end:c};return this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:t},s)}const d=this._processFeatures(e,a,r,s);try{const r=await d;if((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_23__.Wi)(r)){const t={type:o,addOrUpdate:null,remove:n,clear:!1,end:c};return this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:t},s)}for(const t of r)e.key.id!==t.message.tileKey&&this._addBufferData(e.key.id,t);await(0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_9__.$6)(r.map((r=>{const i=e.key.id===r.message.tileKey,a=i?t.remove:[],n=i&&t.end;return this._updateTileMesh(o,e,r,a,n,t.clear,s.signal)})))}catch(m){this._handleError(e,m,s)}}async _updateTileMesh(e,t,r,i,a,n,l){const d=e,m=r.message.tileKey;m!==t.key.id&&(a=!1);const p=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_23__.Po)(r,(e=>e.message)),h=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_23__.Po)(r,(e=>e.transferList))||[],f={type:d,addOrUpdate:p,remove:i,clear:!1,end:a},u={transferList:(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_23__.Wg)(h)||[],signal:l};return(0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_9__.k_)(u),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:m,data:f},u)}async _processFeatures(e,t,r,s){if((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_23__.Wi)(t)||!t.hasFeatures)return null;const o={transform:e.transform,hasZ:!1,hasM:!1},a=this._factory,n={viewingMode:"",scale:e.scale},l=await this._matchers.feature,d=await this._matchers.aggregate;(0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_9__.k_)(s);const m=this._getLabelInfos(e,t);return await a.analyze(t.getCursor(),l,d,o,n),(0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_9__.k_)(s),this._writeFeatureSet(e,t,o,m,a,r)}_writeFeatureSet(e,t,s,i,o,a){const n=t.getApproximateSize(),c="simple"===this._schema.mesh.matcher.type&&this._schema.mesh.matcher.isDotDensity,l=new _engine_webgl_mesh_MeshData_js__WEBPACK_IMPORTED_MODULE_18__._(e.key.id,{features:n,records:n,metrics:0},c,a,!0),d={viewingMode:"",scale:e.scale},m=t.getCursor();for(;m.next();)try{const t=m.getDisplayId(),a=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_23__.pC)(i)?i.get(t):null;o.writeCursor(l,m,s,d,e.level,a)}catch(h){}const p=e.tileInfoView.tileInfo.isWrappable;return l.serialize(p)}_handleError(e,t,r){if(!(0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_9__.D_)(t)){const s={tileKey:e.id,error:t.message};return this.remoteClient.invoke("tileRenderer.onTileError",s,{signal:r.signal})}}_getLabelInfos(e,t){const r=this._schema.mesh.labels,o=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_23__.Po)(r,(t=>t.filter((t=>function k(e,t){return(!e.minScale||e.minScale>=t)&&(!e.maxScale||e.maxScale<=t)}(t,e.scale)))));if((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_23__.Wi)(o)||0===o.length)return null;const a=new Map,n=(new _engine_webgl_collisions_CollisionGrid_js__WEBPACK_IMPORTED_MODULE_14__.Ao(_engine_webgl_definitions_js__WEBPACK_IMPORTED_MODULE_12__.wz),t.getCursor());for(;n.next();){const e=n.getDisplayId(),t=[],r=(0,_support_AttributeStore_js__WEBPACK_IMPORTED_MODULE_17__.nE)(e),s=r&&1!==n.readAttribute("cluster_count")?"aggregate":"feature";for(const i of o){if(i.target!==s)continue;const o=n.getStorage(),a=r&&"feature"===s?o.getComputedStringAtIndex(n.readAttribute("referenceId"),i.fieldIndex):o.getComputedStringAtIndex(e,i.fieldIndex);if(!a)continue;const c=(0,_engine_webgl_util_BidiText_js__WEBPACK_IMPORTED_MODULE_13__.E)(a.toString()),l=c[0],d=c[1];this._store.getMosaicItem(i.symbol,(0,_textUtils_js__WEBPACK_IMPORTED_MODULE_24__._)(l)).then((e=>{t[i.index]={glyphs:e.glyphMosaicItems,rtl:d,index:i.index}}))}a.set(e,t)}return a}_shouldDiscard(e,t){switch(this.service.geometryType){case"esriGeometryPoint":{const r=t.readLegacyPointGeometry();return!r||e.checkOverlap(r.x,r.y)}case"esriGeometryPolygon":{const r=t.readLegacyCentroid();return!r||e.checkOverlap(r.x,r.y)}default:return!1}}_markUsed(e,t){switch(this.service.geometryType){case"esriGeometryPoint":{const{x:r,y:s}=t.readLegacyPointGeometry();return e.markUsed(r,s)}case"esriGeometryPolygon":{const{x:r,y:s}=t.readLegacyCentroid();return e.markUsed(r,s)}}}};C=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_25__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_4__.j)("esri.views.2d.layers.features.processors.SymbolProcessor")],C);const __WEBPACK_DEFAULT_EXPORT__=C}}]);
//# sourceMappingURL=4645.75cc4d6f.iframe.bundle.js.map