(self.webpackChunkreact_arcgis_wmws=self.webpackChunkreact_arcgis_wmws||[]).push([[4692],{53585:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{OE:()=>h,Gc:()=>d,Qg:()=>m,Rq:()=>i,gX:()=>x,z2:()=>s,ET:()=>u,Vx:()=>g});var maybe=__webpack_require__(59472),Point=__webpack_require__(61106);__webpack_require__(36348);const EphemeralBlockCache=class t{constructor(t=15e3,e=5e3){this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=t,this._interval=Math.min(t,e)}decreaseRefCount(t,e){const s=t+"/"+e,r=this._cachedBlocks;if(r.has(s)){const t=r.get(s);return t.refCount--,t.refCount<=0&&(r.delete(s),t.controller&&t.controller.abort()),t.refCount}return 0}getBlock(t,e){const s=t+"/"+e,r=this._cachedBlocks;if(r.has(s)){const t=r.get(s);return t.ts=Date.now(),t.refCount++,r.delete(s),r.set(s,t),t.block}return null}putBlock(t,e,s,r=null){const i=this._cachedBlocks,c=t+"/"+e;if(i.has(c)){const t=i.get(c);t.ts=Date.now(),t.refCount++}else i.set(c,{block:s,ts:Date.now(),refCount:1,controller:r});this.trim(),this.updateTimer()}deleteBlock(t,e){const s=this._cachedBlocks,r=t+"/"+e;s.has(r)&&s.delete(r)}updateMaxSize(t){this._size=t,this.trim()}empty(){this._cachedBlocks.clear(),this.clearTimer()}getCurrentSize(){return this._cachedBlocks.size}updateTimer(){if(null!=this._timer)return;const t=this._cachedBlocks;this._timer=setInterval((()=>{const e=Array.from(t),s=Date.now();for(let r=0;r<e.length&&e[r][1].ts<=s-this._duration;r++)t.delete(e[r][0]);0===t.size&&this.clearTimer()}),this._interval)}trim(){const t=this._cachedBlocks;if(-1===this._size||this._size>=t.size)return;const e=Array.from(t);for(let s=0;s<e.length-this._size;s++)t.delete(e[s][0])}clearTimer(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}};var rasterProjectionHelper=__webpack_require__(52606);const c=new Map,a=new EphemeralBlockCache;function i(e,t){return null==t?e:`${e}?sliceId=${t}`}function s(e,t){const n={extent:null,rasterInfo:t,cache:new Map};if(c.has(e)){const t=c.get(e);return t.push(n),t.length-1}return c.set(e,[n]),0}function u(e,t){if(c.has(e)){const n=c.get(e);n[t]=null,n.some((e=>null!=e))||c.delete(e)}}function h(e,t,n){if(!c.has(e))return null==t?a.decreaseRefCount(e,n):0;const o=c.get(e);if(null==o[t])return a.decreaseRefCount(e,n);const r=o[t].cache;if(r.has(n)){const e=r.get(n);if(e.refCount--,0===e.refCount){r.delete(n);for(let e=0;e<o.length;e++)o[e]&&o[e].cache.has(n)&&o[e].cache.delete(n);e.controller&&e.controller.abort()}return e.refCount}return 0}function m(e,t,n){if(!c.has(e))return null==t?a.getBlock(e,n):null;const o=c.get(e);if(null==o[t]){for(let e=0;e<o.length;e++)if(o[e]&&o[e].cache.has(n)){const t=o[e].cache.get(n);return t.refCount++,t.block}return a.getBlock(e,n)}const r=o[t].cache;if(r.has(n)){const e=r.get(n);return e.refCount++,e.block}for(let l=0;l<o.length;l++)if(l!==t&&o[l]&&o[l]&&o[l].cache.has(n)){const e=o[l].cache.get(n);return e.refCount++,r.set(n,e),e.block}return null}function x(e,t,n,o,r=null){if(!c.has(e))return void(null==t&&a.putBlock(e,n,o,r));const l=c.get(e);if(null==l[t])return void a.putBlock(e,n,o,r);const i={refCount:1,block:o,isResolved:!1,isRejected:!1,controller:r};o.then((()=>i.isResolved=!0)).catch((()=>i.isRejected=!0)),l[t].cache.set(n,i)}function d(e,t,n){if(!c.has(e))return void(null==t&&a.deleteBlock(e,n));const o=c.get(e);null!=o[t]?o[t].cache.delete(n):a.deleteBlock(e,n)}function y(e,t){if(!c.has(e))return null;const n=c.get(e);return null==n[t]?null:n[t]}function g(n,c,a,i,s,u,f=null){const h=y(n,c),m=h.extent,{cache:x,rasterInfo:d}=h;if(m&&m.xmin===a.xmin&&m.xmax===a.xmax&&m.ymin===a.ymin&&m.ymax===a.ymax)return;const g=a.clone().normalize(),{spatialReference:p,transform:k}=d,M=new Set;for(let y=0;y<g.length;y++){const n=g[y];if(n.xmax-n.xmin<=i||n.ymax-n.ymin<=i)continue;let c=(0,rasterProjectionHelper.tB)(n,p,f);(0,maybe.pC)(k)&&(c=k.inverseTransform(c));const a=new Point.Z({x:i,y:i,spatialReference:n.spatialReference});if(null==s&&!(s=(0,rasterProjectionHelper.VO)(a,p,n,f)))return;const{pyramidLevel:h,pyramidResolution:m,excessiveReading:x}=(0,rasterProjectionHelper.kr)(s,d,u||"closest");if(x)return;const{storageInfo:R}=d,{origin:C}=R,j={x:Math.max(0,Math.floor((c.xmin-C.x)/m.x)),y:Math.max(0,Math.floor((C.y-c.ymax)/m.y))},v=Math.ceil((c.xmax-c.xmin)/m.x-.1),B=Math.ceil((c.ymax-c.ymin)/m.y-.1),b=h>0?R.pyramidBlockWidth:R.blockWidth,w=h>0?R.pyramidBlockHeight:R.blockHeight,$=1,I=Math.max(0,Math.floor(j.x/b)-$),H=Math.max(0,Math.floor(j.y/w)-$),E=Math.floor((j.x+v-1)/b)+$,P=Math.floor((j.y+B-1)/w)+$;for(let e=H;e<=P;e++)for(let t=I;t<=E;t++)M.add(`${h}/${e}/${t}`)}x.forEach(((e,t)=>{if(!M.has(t)){const e=x.get(t);(null==e||e.isResolved||e.isRejected)&&x.delete(t)}})),h.extent={xmin:a.xmin,ymin:a.ymin,xmax:a.xmax,ymax:a.ymax}}},52606:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{vF:()=>b,_D:()=>y,Qp:()=>R,zD:()=>h,tB:()=>g,nF:()=>d,VO:()=>M,kr:()=>j});var _core_Error_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(32656),_geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(27780),_geometry_support_webMercatorUtils_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(41241),_geometry_Point_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(61106),_geometry_Extent_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(52937),_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_6__=(__webpack_require__(36348),__webpack_require__(93533)),_geometry_projection_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(28449);const u=5e-4,m=function(e,n){const t=(e.isWGS84||e.isWebMercator)&&(n.isWGS84||n.isWebMercator);return!(e.equals(n)||t)};async function h(){if((0,_geometry_projection_js__WEBPACK_IMPORTED_MODULE_7__.kR)()||!(0,_geometry_projection_js__WEBPACK_IMPORTED_MODULE_7__.Gb)())return null;await(0,_geometry_projection_js__WEBPACK_IMPORTED_MODULE_7__.zD)()}function y(n,t,o){if(!m(n.spatialReference,t))return null;if(!(0,_geometry_projection_js__WEBPACK_IMPORTED_MODULE_7__.kR)())throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.Z("rasterprojectionhelper-projectResolution","projection engine is not loaded");return o?(0,_geometry_projection_js__WEBPACK_IMPORTED_MODULE_7__.rS)(t,n.spatialReference,n):(0,_geometry_projection_js__WEBPACK_IMPORTED_MODULE_7__.rS)(n.spatialReference,t,n)}function M(n,o,r,s=null){if(n.spatialReference.equals(o))return n;const l=m(n.spatialReference,o);if(l&&!(0,_geometry_projection_js__WEBPACK_IMPORTED_MODULE_7__.kR)())throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.Z("rasterprojectionhelper-projectResolution","projection engine is not loaded");const c=r.center,u=new _geometry_Extent_js__WEBPACK_IMPORTED_MODULE_4__.Z({xmin:c.x-n.x/2,xmax:c.x+n.x/2,ymin:c.y-n.y/2,ymax:c.y+n.y/2,spatialReference:n.spatialReference}),p=l?(0,_geometry_projection_js__WEBPACK_IMPORTED_MODULE_7__.iV)(u,o,s):(0,_geometry_support_webMercatorUtils_js__WEBPACK_IMPORTED_MODULE_2__.iV)(u,o);return null==p?null:{x:p.xmax-p.xmin,y:p.ymax-p.ymin}}function w(e,n=.01){return(0,_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_6__.c9)(e)?n/(0,_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_6__.c9)(e):0}function d(o,i,r=null,s=!0){const l=o.spatialReference;if(l.equals(i))return o;const c=m(l,i);if(c&&!(0,_geometry_projection_js__WEBPACK_IMPORTED_MODULE_7__.kR)())throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.Z("rasterprojectionhelper-projectResolution","projection engine is not loaded");const p=c?(0,_geometry_projection_js__WEBPACK_IMPORTED_MODULE_7__.iV)(o,i,r):(0,_geometry_support_webMercatorUtils_js__WEBPACK_IMPORTED_MODULE_2__.iV)(o,i);if(p&&s&&i.isGeographic){var f,h;const[e,t]=l.isWebMercator?(0,_geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_1__.C5)(l).origin:null!=(f=null==(h=(0,_geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_1__.C5)(l))?void 0:h.valid)?f:[],i=w(l);i&&null!=e&&null!=t&&(Math.abs(o.x-e)<i&&Math.abs(180-p.x)<u?p.x-=360:Math.abs(o.x-t)<i&&Math.abs(180+p.x)<u&&(p.x+=360))}return p}function g(i,r,s=null,l=!0){var c,p,f,h;const y=i.spatialReference;if(y.equals(r))return i;const M=m(y,r);if(M&&!(0,_geometry_projection_js__WEBPACK_IMPORTED_MODULE_7__.kR)())throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.Z("rasterprojectionhelper-projectExtent","projection engine is not loaded");const g=M?(0,_geometry_projection_js__WEBPACK_IMPORTED_MODULE_7__.iV)(i,r,s):(0,_geometry_support_webMercatorUtils_js__WEBPACK_IMPORTED_MODULE_2__.iV)(i,r);let[R,j]=null!=(c=null==(p=(0,_geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_1__.C5)(y))?void 0:p.origin)?c:[];if(g&&l&&y.isWebMercator&&r.isGeographic&&null!=R&&null!=j){const e=.001,n=1e3;if(Math.abs(i.xmin-R)<e&&Math.abs(j-i.xmax)>n&&Math.abs(180-g.xmax)<u){g.xmin=-180;const e=[];e.push(new _geometry_Point_js__WEBPACK_IMPORTED_MODULE_3__.Z(i.xmax,i.ymin,y)),e.push(new _geometry_Point_js__WEBPACK_IMPORTED_MODULE_3__.Z(i.xmax,(i.ymin+i.ymax)/2,y)),e.push(new _geometry_Point_js__WEBPACK_IMPORTED_MODULE_3__.Z(i.xmax,i.ymax,y));const n=e.map((e=>d(e,r,s))).filter((e=>!isNaN(null==e?void 0:e.x))).map((e=>e.x));g.xmax=Math.max.apply(null,n)}if(Math.abs(i.xmax-j)<e&&Math.abs(R-i.xmin)>n&&Math.abs(180+g.xmin)<u){g.xmax=180;const e=[];e.push(new _geometry_Point_js__WEBPACK_IMPORTED_MODULE_3__.Z(i.xmin,i.ymin,y)),e.push(new _geometry_Point_js__WEBPACK_IMPORTED_MODULE_3__.Z(i.xmin,(i.ymin+i.ymax)/2,y)),e.push(new _geometry_Point_js__WEBPACK_IMPORTED_MODULE_3__.Z(i.xmin,i.ymax,y));const n=e.map((e=>d(e,r,s))).filter((e=>!isNaN(null==e?void 0:e.x))).map((e=>e.x));g.xmin=Math.min.apply(null,n)}}[R,j]=r.isWebMercator?(0,_geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_1__.C5)(r).origin:null!=(f=null==(h=(0,_geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_1__.C5)(r))?void 0:h.valid)?f:[];const b=w(r);return b&&null!=R&&null!=j&&(Math.abs(g.xmin-R)<b&&(g.xmin=R),Math.abs(g.xmax-j)<b&&(g.xmax=j)),g}function R(t,i,r,s=null,l=null,c=!1,x=[32,32]){var u,h;if(m(t.spatialReference,i.spatialReference)&&!(0,_geometry_projection_js__WEBPACK_IMPORTED_MODULE_7__.kR)())throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.Z("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(t&&i&&r))return null;const{xmin:y,ymin:M,xmax:w,ymax:g}=t,R=t.spatialReference,j=i.spatialReference,[b,v]=null!=(u=null==(h=(0,_geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_1__.C5)(R))?void 0:h.valid)?u:[],N={x:x[0]*r.x,y:x[1]*r.y},S={cols:Math.ceil((w-y)/N.x-.1)+1,rows:Math.ceil((g-M)/N.y-.1)+1},z=N.x,W=N.y,G=[];let P,L=!1;for(let e=0;e<S.cols;e++){const n=[];for(let t=0;t<S.rows;t++){let r=d(new _geometry_Point_js__WEBPACK_IMPORTED_MODULE_3__.Z({x:y+z*e,y:g-W*t,spatialReference:R}),j,s);l&&(r=l.inverseTransform(r)),n.push(r),e>0&&c&&r&&P[t]&&null!=b&&r.x<P[t].x&&(r.x+=v-b),r?(G.push((r.x-i.xmin)/(i.xmax-i.xmin)),G.push((i.ymax-r.y)/(i.ymax-i.ymin))):(G.push(NaN),G.push(NaN),L=!0)}P=n}const q=function(e,n){const t=(e[0]+e[4]+e[4*n.cols]+e[4*n.cols+4])/4,o=(e[1]+e[5]+e[4*n.rows+1]+e[4*n.rows+5])/4;return[Math.abs(t-e[2*n.rows+2]),Math.abs(o-e[2*n.rows+3])]}(G,S),A=new Float32Array((S.cols-1)*(S.rows-1)*2*6),E=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),F=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let e=0;e<S.cols-1;e++){for(let n=0;n<S.rows-1;n++){let t=e*S.rows*2+2*n;const o=G[t],i=G[t+1],r=G[t+2],a=G[t+3];t+=2*S.rows;const s=G[t],l=G[t+1],c=G[t+2],x=G[t+3];let u=0,m=12*(n*(S.cols-1)+e);for(let e=0;e<3;e++)A[m++]=E[u++]*o+E[u++]*r+E[u++]*c;u=0;for(let e=0;e<3;e++)A[m++]=E[u++]*i+E[u++]*a+E[u++]*x;u=0;for(let e=0;e<3;e++)A[m++]=F[u++]*o+F[u++]*s+F[u++]*c;u=0;for(let e=0;e<3;e++)A[m++]=F[u++]*i+F[u++]*l+F[u++]*x}if(L)for(let e=0;e<A.length;e++)isNaN(A[e])&&(A[e]=-1)}return{offsets:G,error:q,coefficients:A,spacing:x,size:[S.cols-1,S.rows-1]}}function j(e,n,t){const i=Math.log(e.x/n.pixelSize.x)/Math.LN2,r=Math.log(e.y/n.pixelSize.y)/Math.LN2,a=n.storageInfo.maximumPyramidLevel||0;let s="down"===t?Math.floor(Math.min(i,r)):"up"===t?Math.ceil(Math.max(i,r)):Math.round((i+r)/2),l=!1;s<0?s=0:s>a&&(l=s>a+3,s=a);const c=2**s;return{pyramidLevel:s,pyramidResolution:new _geometry_Point_js__WEBPACK_IMPORTED_MODULE_3__.Z({x:c*n.nativePixelSize.x,y:c*n.nativePixelSize.y,spatialReference:n.spatialReference}),excessiveReading:l}}function b(e,n,t=512,i=!0){const{extent:a,spatialReference:s,pixelSize:l}=e,c=M(new _geometry_Point_js__WEBPACK_IMPORTED_MODULE_3__.Z({x:l.x,y:l.y,spatialReference:s}),n,a);if(null==c)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const x=(c.x+c.y)/2,u=(0,_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_6__.c9)(n),m=x*u*96*39.37,p=n.isGeographic?512/t*295828763.7958547:512/t*591657527.591555;let f=!1;const h=g(a,n);i&&(n.isGeographic||n.isWebMercator)&&(f=h.xmin*h.xmax<0);let y,w=m;const d=1.001;if(f){w=p;const e=.29858214164761665,n=e*(96*u*39.37);y=M(new _geometry_Point_js__WEBPACK_IMPORTED_MODULE_3__.Z({x:e,y:e,spatialReference:{wkid:3857}}),s,h),y.x*=w/n,y.y*=w/n}else{y={x:l.x,y:l.y};const n=Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2);let t=0;for(;w<p*(d/2)&&t<n;)t++,w*=2,y.x*=2,y.y*=2;Math.max(w,p)/Math.min(w,p)<=d&&(w=p)}const R=[w],j=[{x:y.x,y:y.y}],v=Math.min(70.5310735,m)/d;for(;w>=v;)w/=2,y.x/=2,y.y/=2,R.push(w),j.push({x:y.x,y:y.y});return{projectedPixelSize:c,scales:R,srcResolutions:j,isCustomTilingScheme:!f}}},55649:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _enums_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(31514),_brushes_WGLBrushInfo_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(69822),_brushes_WGLBrushStencil_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(87772),_WGLContainer_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(23956);const n=(e,r)=>e.key.level-r.key.level!=0?e.key.level-r.key.level:e.key.row-r.key.row!=0?e.key.row-r.key.row:e.key.col-r.key.col;class i extends _WGLContainer_js__WEBPACK_IMPORTED_MODULE_3__.Z{constructor(e){super(),this._tileInfoView=e}get requiresDedicatedFBO(){return!1}renderChildren(e){this.sortChildren(n),this.setStencilReference(),super.renderChildren(e)}createRenderParams(e){const{state:r}=e;return{...super.createRenderParams(e),requiredLevel:this._tileInfoView.getClosestInfoForScale(r.scale).level,displayLevel:this._tileInfoView.tileInfo.scaleToZoom(r.scale)}}prepareRenderPasses(t){const n=t.registerRenderPass({name:"stencil",brushes:[_brushes_WGLBrushStencil_js__WEBPACK_IMPORTED_MODULE_2__.Z],drawPhase:_enums_js__WEBPACK_IMPORTED_MODULE_0__.jx.DEBUG|_enums_js__WEBPACK_IMPORTED_MODULE_0__.jx.MAP|_enums_js__WEBPACK_IMPORTED_MODULE_0__.jx.HIGHLIGHT,target:()=>this.getStencilTarget()}),i=t.registerRenderPass({name:"tileInfo",brushes:[_brushes_WGLBrushInfo_js__WEBPACK_IMPORTED_MODULE_1__.Z],drawPhase:_enums_js__WEBPACK_IMPORTED_MODULE_0__.jx.DEBUG,target:()=>this.children,has:"esri-tiles-debug"});return[...super.prepareRenderPasses(t),n,i]}getStencilTarget(){return this.children}updateTransforms(e){for(const r of this.children){const s=this._tileInfoView.getTileResolution(r.key);r.setTransform(e,s)}}setStencilReference(){let e=1;for(const r of this.children)r.stencilRef=e++}}const __WEBPACK_DEFAULT_EXPORT__=i},23956:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>WGLContainer});__webpack_require__(95830);var maybe=__webpack_require__(59472),enums=__webpack_require__(31514),Container=__webpack_require__(17149),brushes=__webpack_require__(32825),Logger=__webpack_require__(36544),Error=__webpack_require__(32656),VertexArrayObject=__webpack_require__(74038),DisplayObject=__webpack_require__(56291),OptimizedGeometry=__webpack_require__(73127),featureConversionUtils=__webpack_require__(31036),vec2f64=__webpack_require__(55735),earcut=__webpack_require__(27202),vec2=__webpack_require__(14286),BufferObject=__webpack_require__(69595),number=__webpack_require__(53986);const m=Logger.Z.getLogger("esri.views.2d.engine.webgl.Mesh2D"),y=(e,t,r,o)=>{let n=0;for(let s=1;s<r;s++){const r=e[2*(t+s-1)],o=e[2*(t+s-1)+1];n+=(e[2*(t+s)]-r)*(e[2*(t+s)+1]+o)}return o?n>0:n<0},x=({coords:e,lengths:t},r)=>{const o=[];for(let n=0,s=0;n<t.length;s+=t[n],n+=1){const c=s,a=[];for(;n<t.length-1&&y(e,s+t[n],t[n+1],r);n+=1,s+=t[n])a.push(s+t[n]-c);const f=e.slice(2*c,2*(s+t[n])),h=(0,earcut.O)(f,a,2);for(const e of h)o.push(e+c)}return o};class g{constructor(e,t,r,o=!1){this._cache={},this.vertices=e,this.indices=t,this.primitiveType=r,this.isMapSpace=o}static fromRect({x:e,y:t,width:r,height:o}){const n=e,s=t,c=n+r,i=s+o;return g.fromScreenExtent({xmin:n,ymin:s,xmax:c,ymax:i})}static fromPath(e){const t=(0,featureConversionUtils.ks)(new OptimizedGeometry.Z,e.path,!1,!1),r=t.coords,s=new Uint32Array(x(t,!0)),c=new Uint32Array(r.length/2);for(let o=0;o<c.length;o++)c[o]=(0,number.UJ)(Math.floor(r[2*o]),Math.floor(r[2*o+1]));return new g({geometry:c},s,4)}static fromGeometry(e,t){const o=t.geometry.type;switch(o){case"polygon":return g.fromPolygon(e,t.geometry);case"extent":return g.fromMapExtent(e,t.geometry);default:return m.error(new Error.Z("mapview-bad-type",`Unable to create a mesh from type ${o}`,t)),g.fromRect({x:0,y:0,width:1,height:1})}}static fromPolygon(e,t){const r=(0,featureConversionUtils.Uy)(new OptimizedGeometry.Z,t,!1,!1),n=r.coords,i=new Uint32Array(x(r,!1)),f=new Uint32Array(n.length/2),m=(0,vec2f64.a)(),u=(0,vec2f64.a)();for(let o=0;o<f.length;o++)(0,vec2.s)(m,n[2*o],n[2*o+1]),e.toScreen(u,m),f[o]=(0,number.UJ)(Math.floor(u[0]),Math.floor(u[1]));return new g({geometry:f},i,4,!0)}static fromScreenExtent({xmin:e,xmax:t,ymin:r,ymax:o}){const n={geometry:new Uint32Array([(0,number.UJ)(e,r),(0,number.UJ)(t,r),(0,number.UJ)(e,o),(0,number.UJ)(e,o),(0,number.UJ)(t,r),(0,number.UJ)(t,o)])},s=new Uint32Array([0,1,2,3,4,5]);return new g(n,s,4)}static fromMapExtent(e,t){const[r,o]=e.toScreen([0,0],[t.xmin,t.ymin]),[n,s]=e.toScreen([0,0],[t.xmax,t.ymax]),c={geometry:new Uint32Array([(0,number.UJ)(r,o),(0,number.UJ)(n,o),(0,number.UJ)(r,s),(0,number.UJ)(r,s),(0,number.UJ)(n,o),(0,number.UJ)(n,s)])},i=new Uint32Array([0,1,2,3,4,5]);return new g(c,i,4)}destroy(){(0,maybe.pC)(this._cache.indexBuffer)&&this._cache.indexBuffer.dispose();for(const t in this._cache.vertexBuffers)(0,maybe.pC)(this._cache.vertexBuffers[t])&&this._cache.vertexBuffers[t].dispose()}get elementType(){return(e=>{switch(e.BYTES_PER_ELEMENT){case 1:return 5121;case 2:return 5123;case 4:return 5125;default:throw new Error.Z("Cannot get DataType of array")}})(this.indices)}getIndexBuffer(e,t=35044){return this._cache.indexBuffer||(this._cache.indexBuffer=BufferObject.Z.createIndex(e,t,this.indices)),this._cache.indexBuffer}getVertexBuffers(e,t=35044){return this._cache.vertexBuffers||(this._cache.vertexBuffers=Object.keys(this.vertices).reduce(((r,o)=>({...r,[o]:BufferObject.Z.createVertex(e,t,this.vertices[o])})),{})),this._cache.vertexBuffers}}const Mesh2D=g,a=Logger.Z.getLogger("esri.views.2d.engine.webgl.ClippingInfo"),c=t=>parseFloat(t)/100;class n extends DisplayObject.s{constructor(t,e){super(),this._clip=e,this._cache={},this.stage=t,this._handle=e.watch("version",(()=>this._invalidate())),this.ready()}static fromClipArea(t,e){return new n(t,e)}_destroyGL(){(0,maybe.pC)(this._cache.mesh)&&(this._cache.mesh.destroy(),this._cache.mesh=null),(0,maybe.pC)(this._cache.vao)&&(this._cache.vao.dispose(),this._cache.vao=null)}destroy(){this._destroyGL(),this._handle.remove()}getVAO(t,r,s,h){const[o,a]=r.size;if("geometry"!==this._clip.type&&this._lastWidth===o&&this._lastHeight===a||(this._lastWidth=o,this._lastHeight=a,this._destroyGL()),(0,maybe.Wi)(this._cache.vao)){const e=this._createMesh(r,this._clip),o=e.getIndexBuffer(t),a=e.getVertexBuffers(t);this._cache.mesh=e,this._cache.vao=new VertexArrayObject.Z(t,s,h,a,o)}return this._cache.vao}_invalidate(){this._destroyGL(),this.requestRender()}_createScreenRect(t,e){const[r,s]=t.size,i="string"==typeof e.left?c(e.left)*r:e.left,h="string"==typeof e.right?c(e.right)*r:e.right,o="string"==typeof e.top?c(e.top)*s:e.top,a="string"==typeof e.bottom?c(e.bottom)*s:e.bottom,n=i,p=o;return{x:n,y:p,width:Math.max(r-h-n,0),height:Math.max(s-a-p,0)}}_createMesh(t,e){switch(e.type){case"rect":return Mesh2D.fromRect(this._createScreenRect(t,e));case"path":return Mesh2D.fromPath(e);case"geometry":return Mesh2D.fromGeometry(t,e);default:return a.error(new Error.Z("mapview-bad-type","Unable to create ClippingInfo mesh from clip of type: ${clip.type}")),Mesh2D.fromRect({x:0,y:0,width:1,height:1})}}}const ClippingInfo=n;class o extends Container.W{constructor(){super(...arguments),this.name=this.constructor.name}set clips(e){this._clips=e,this.children.forEach((r=>r.clips=e)),this._updateClippingInfo()}doRender(e){const r=this.createRenderParams(e),{painter:t,globalOpacity:i,profiler:n,drawPhase:o}=r,a=o===enums.jx.LABEL?1:i*this.computedOpacity;n.recordContainerStart(this.name),t.beforeRenderLayer(r,this._clippingInfos?255:0,a),this.updateTransforms(e.state),this.renderChildren(r),t.compositeLayer(r,a),n.recordContainerEnd()}renderChildren(r){(0,maybe.Wi)(this._renderPasses)&&(this._renderPasses=this.prepareRenderPasses(r.painter));for(const e of this.children)e.beforeRender(r);for(const e of this._renderPasses)try{e.render(r)}catch(s){}for(const e of this.children)e.afterRender(r)}createRenderParams(e){return{...e,requireFBO:this.requiresDedicatedFBO}}prepareRenderPasses(e){return[e.registerRenderPass({name:"clip",brushes:[brushes.U.clip],target:()=>this._clippingInfos,drawPhase:enums.jx.MAP|enums.jx.LABEL|enums.jx.LABEL_ALPHA|enums.jx.DEBUG|enums.jx.HIGHLIGHT})]}updateTransforms(e){for(const r of this.children)r.setTransform(e)}onAttach(){super.onAttach(),this._updateClippingInfo()}onDetach(){super.onDetach(),this._updateClippingInfo()}_updateClippingInfo(){if((0,maybe.pC)(this._clippingInfos)&&(this._clippingInfos.forEach((e=>e.destroy())),this._clippingInfos=null),!this.stage)return;const e=this._clips;(0,maybe.pC)(e)&&e.length&&(this._clippingInfos=e.items.map((e=>ClippingInfo.fromClipArea(this.stage,e)))),this.requestRender()}}const WGLContainer=o},44692:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>ImageryTileLayerView2D});var tslib_es6=__webpack_require__(56140),maybe=(__webpack_require__(95830),__webpack_require__(59472)),Logger=__webpack_require__(36544),property=(__webpack_require__(68055),__webpack_require__(79881)),subclass=__webpack_require__(87566),promiseUtils=(__webpack_require__(10923),__webpack_require__(57002),__webpack_require__(86035),__webpack_require__(39105)),Point=__webpack_require__(61106),Extent=__webpack_require__(52937),screenUtils=(__webpack_require__(36348),__webpack_require__(96071)),Graphic=__webpack_require__(15988),watchUtils=__webpack_require__(80621),PixelBlock=__webpack_require__(42766),TileInfo=__webpack_require__(40920),pixelUtils=__webpack_require__(44464),rasterProjectionHelper=__webpack_require__(52606),RawBlockCache=__webpack_require__(53585),capabilities=__webpack_require__(43129),RefreshableLayerView=__webpack_require__(12421),TileInfoView=__webpack_require__(46666),TileQueue=__webpack_require__(13596),TileStrategy=__webpack_require__(1768),LayerView=__webpack_require__(48164),drapedUtils=__webpack_require__(37694),ImageryTileLayerView=__webpack_require__(43835),aaBoundingRect=__webpack_require__(50897),viewpointUtils=__webpack_require__(15187),enums=__webpack_require__(31514),brushes=__webpack_require__(32825),TileContainer=__webpack_require__(55649),TiledDisplayObject=__webpack_require__(9793),mat3=__webpack_require__(98501),mat3f32=__webpack_require__(55955),vec2f32=__webpack_require__(27851),DisplayObject=__webpack_require__(56291),rasterUtils=__webpack_require__(32415);const _={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,type:"stretch"};class x extends DisplayObject.s{constructor(t=null,e=null,s=null){super(),this._textureInvalidated=!0,this._memoryUsed=null,this._supportsBilinear=!0,this.stencilRef=0,this.coordScale=[1,1],this._symbolizerParameters=null,this.height=null,this.isRendereredSource=!1,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this.rawPixelData=null,this._suspended=!1,this._bandIds=null,this._interpolation=null,this._transformGrid=null,this.width=null,this.x=0,this.y=0,this.transforms={dvs:(0,mat3f32.c)()},this.source=t,this.transformGrid=e,this.interpolation=s}destroy(){const t=this.getTextures();null==t||t.textures.forEach((t=>t.dispose())),this._rasterTexture=null,this._transformGridTexture=null,this._colormapTexture=null}get symbolizerParameters(){return this._symbolizerParameters||_}set symbolizerParameters(t){this._symbolizerParameters=t}get source(){return this._source}set source(t){this._source=t,this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null,this._rasterTextureBandIds=null,this._memoryUsed=null)}get suspended(){return this._suspended}set suspended(t){this._suspended&&!t&&this.stage&&(this.ready(),this.requestRender()),this._suspended=t}get bandIds(){return this._bandIds}set bandIds(t){this._bandIds=t,this.invalidateTexture()}get interpolation(){return this._interpolation}set interpolation(t){this._interpolation=t,this._rasterTexture&&this._rasterTexture.setSamplingMode(!this._supportsBilinear||"bilinear"!==t&&"cubic"!==t?9728:9729)}get transformGrid(){return this._transformGrid}set transformGrid(t){this._transformGrid=t,this._transformGridTexture&&(this._transformGridTexture.dispose(),this._transformGridTexture=null,this._memoryUsed=null)}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRender())}setTransform(t){const o=(0,mat3.i)(this.transforms.dvs),[u,l]=t.toScreenNoRotation([0,0],this.x,this.y),h=this.resolution/this.pixelRatio/t.resolution,d=h*this.width,m=h*this.height,_=Math.PI*this.rotation/180;(0,mat3.a)(o,o,(0,vec2f32.f)(u,l)),(0,mat3.a)(o,o,(0,vec2f32.f)(d/2,m/2)),(0,mat3.r)(o,o,-_),(0,mat3.a)(o,o,(0,vec2f32.f)(-d/2,-m/2)),(0,mat3.j)(o,o,(0,vec2f32.f)(d,m)),(0,mat3.m)(this.transforms.dvs,t.displayViewMat3,o)}getTextures(){if(!this._rasterTexture)return null;const t=[],e=[];return this._transformGridTexture&&(e.push(this._transformGridTexture),t.push("u_transformGrid")),this._rasterTexture&&(e.push(this._rasterTexture),t.push("u_image")),this._colormapTexture&&(e.push(this._colormapTexture),t.push("u_colormap")),{names:t,textures:e}}getMemoryUsage(){if((0,maybe.Wi)(this._memoryUsed)){const t=this.getTextures();if(null==t)return 0;this._memoryUsed=t.textures.map((t=>t.descriptor.width*t.descriptor.height*4)).reduce(((t,e)=>t+e))}return this._memoryUsed}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}updateTexture({context:t}){var e,s,r;if(!this.stage)return null==(e=this._rasterTexture)||e.dispose(),null==(s=this._transformGridTexture)||s.dispose(),null==(r=this._colormapTexture)||r.dispose(),this._rasterTexture=null,this._rasterTextureBandIds=null,this._transformGridTexture=null,void(this._colormapTexture=null);if(!this._textureInvalidated)return;this._textureInvalidated=!1;const i=this.source,a=i&&i.pixels&&i.pixels.length>0;this._createOrDestroyRasterTexture(t),this._rasterTexture&&(a?(this._updateColormapTexture(t),this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=(0,rasterUtils.Br)(t,this.transformGrid))):this._rasterTexture.setData(null)),this.suspended||(this.ready(),this.requestRender())}_createOrDestroyRasterTexture(t){var e,s;const r=this.source?(0,pixelUtils.qF)(this.source,this.bandIds):null;if(!(r&&r.pixels&&r.pixels.length>0))return void(this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTextureBandIds=null,this._rasterTexture=null));const i=null==this._rasterTextureBandIds&&null==this.bandIds||this._rasterTextureBandIds&&this.bandIds&&this._rasterTextureBandIds.join("")===this.bandIds.join("");if(this._rasterTexture){if(i)return;this._rasterTexture.dispose(),this._rasterTextureBandIds=null,this._rasterTexture=null}const a=this.interpolation||"nearest",u=this.isRendereredSource||!(null!=(e=t.capabilities.textureFloat)&&e.textureFloat);this._rasterTexture=(0,rasterUtils.s9)(t,r,a,u),this._supportsBilinear=null==(s=t.capabilities.textureFloat)?void 0:s.textureFloatLinear,this._rasterTextureBandIds=this.bandIds}_updateColormapTexture(t){const e=this._colormap,s=this.symbolizerParameters.colormap;return s?e?s.length!==e.length||s.some(((t,s)=>t!==e[s]))?(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=(0,rasterUtils.iC)(t,s),void(this._colormap=s)):void 0:(this._colormapTexture=(0,rasterUtils.iC)(t,s),void(this._colormap=s)):(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),void(this._colormap=null))}}class RasterTile_e extends TiledDisplayObject.I{constructor(t,e,i,a=null){super(t,e,i),this.bitmap=new x(a,null,null),this.bitmap.coordScale=i,this.bitmap.once("isReady",(()=>this.ready()))}destroy(){super.destroy(),this.bitmap.destroy(),this.bitmap=null,this.stage=null}set stencilRef(t){this.bitmap.stencilRef=t}get stencilRef(){return this.bitmap.stencilRef}getMemoryUsage(){return this.bitmap.getMemoryUsage()}setTransform(t,s){super.setTransform(t,s),this.bitmap.transforms.dvs=this.transforms.dvs}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap.stage=null}}class n extends TileContainer.Z{constructor(){super(...arguments),this.isCustomTilingScheme=!1}createTile(e){const s=this._getTileBounds(e);return new RasterTile_e(e,s,this._tileInfoView.tileInfo.size)}destroyTile(){}prepareRenderPasses(e){const s=e.registerRenderPass({name:"bitmap (tile)",brushes:[brushes.U.raster],target:()=>this.children.map((e=>e.bitmap)),drawPhase:enums.jx.MAP});return[...super.prepareRenderPasses(e),s]}doRender(e){this.visible&&e.drawPhase===enums.jx.MAP&&super.doRender(e)}_getTileBounds(t){const i=this._tileInfoView.getTileBounds((0,aaBoundingRect.Ue)(),t);if(this.isCustomTilingScheme&&t.world){const{tileInfo:e}=this._tileInfoView,r=(0,viewpointUtils.ut)(e.spatialReference);if(r){const{resolution:s}=e.lodAt(t.level),o=r/s%e.size[0],n=o?(e.size[0]-o)*s:0;i[0]-=n*t.world,i[2]-=n*t.world}}return i}}var LayerView2D=__webpack_require__(81558);const V=Logger.Z.getLogger("esri.views.2d.layers.ImageryTileLayerView2D"),L=[0,0];let q=class extends((0,ImageryTileLayerView.R)((0,RefreshableLayerView.yc)((0,LayerView2D.y)(LayerView.Z)))){constructor(){super(...arguments),this._tileStrategy=null,this._tileInfoView=null,this._fetchQueue=null,this._blockCacheRegistryUrl=null,this._blockCacheRegistryId=null,this._bitmapView=null,this._emptyTilePixelBlock=null,this._srcResolutions=null,this._previousLOD=null,this._needBlockCacheUpdate=!1,this._globalSymbolizerParams=null,this._symbolizerParams=null,this._abortController=null,this._globalUpdateRequested=!1,this._isCustomTilingScheme=!1,this.useWebGLForProcessing=!0,this._redrawDebounced=(0,promiseUtils.Ds)((e=>this._redrawImage(e)),2e3)}initialize(){const e=this.updateFullExtent();this.addResolvingPromise(e)}get useProgressiveUpdate(){return null==this._get("useProgressiveUpdate")||this._get("useProgressiveUpdate")}set useProgressiveUpdate(e){if(this._tileStrategy&&this.useProgressiveUpdate!==e){this._tileStrategy.destroy(),this._bitmapView.removeAllChildren();const t=this._getCacheSize(e);this._tileStrategy=new TileStrategy.Z({cachePolicy:"purge",resampling:!1,acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),cacheSize:t,tileInfoView:this._tileInfoView}),this._set("useProgressiveUpdate",e),this.requestUpdate()}}hitTest(e,t){if(this.suspended)return Promise.resolve(null);const i=this.view.toMap((0,screenUtils.vW)(e,t));return Promise.resolve(new Graphic.Z({attributes:{},geometry:i}))}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume();const{extent:t,resolution:i,scale:s}=e.state,r=this._tileInfoView.getClosestInfoForScale(s);if(this.layer.raster){var a;if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){const e=this._srcResolutions[r.level],s=t.toJSON?t:Extent.Z.fromJSON(t);(0,RawBlockCache.Vx)(this._blockCacheRegistryUrl,this._blockCacheRegistryId,s,i,e,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1,(null==(a=this._previousLOD)?void 0:a.level)!==r.level&&(this._previousLOD=r,null!=this._symbolizerParams&&this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}this.notifyChange("updating")}attach(){this.layer.increaseRasterJobHandlerUsage(),(0,capabilities.Z)().supportsTextureFloat||(this.useWebGLForProcessing=!1),this.layer.raster&&(this.layer.raster.ioConfig.allowPartialFill=!0),this._initializeTileInfo(),this._tileInfoView=new TileInfoView.Z(this.tileInfo,this.fullExtent),this._fetchQueue=new TileQueue.Z({tileInfoView:this._tileInfoView,concurrency:10,process:(e,t)=>this.fetchTile(e,t)});const e=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new TileStrategy.Z({cachePolicy:"purge",resampling:!1,acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),cacheSize:e,tileInfoView:this._tileInfoView}),this._bitmapView=new n(this._tileInfoView),this._bitmapView.isCustomTilingScheme=this._isCustomTilingScheme,this.container.addChild(this._bitmapView),this.handles.add([(0,watchUtils.YP)(this,["layer.bandIds","layer.renderer"],(()=>this._redrawDebounced().catch((e=>{(0,promiseUtils.D_)(e)||V.error(e)})))),(0,watchUtils.YP)(this,["layer.interpolation"],((e,t)=>{"majority"!==e&&"majority"!==t||!this._canUseMajorityInterpolationOnDataSource()?this._redrawDebounced().catch((e=>{(0,promiseUtils.D_)(e)||V.error(e)})):this.refreshDebounced()})),(0,watchUtils.YP)(this,["layer.multidimensionalDefinition"],this.refreshDebounced)],"attach"),this._updateBlockCacheRegistry()}detach(){this.handles.remove("attach"),this.layer.decreaseRasterJobHandlerUsage(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null,(0,RawBlockCache.ET)(this._blockCacheRegistryUrl,this._blockCacheRegistryId)}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){!this.hasTilingEffects&&this.useProgressiveUpdate||(this._abortController&&this._abortController.abort(),this._abortController=(0,promiseUtils.yi)(),0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then((()=>{this._globalUpdateRequested=!1,this.requestUpdate()})));const e=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(e),this.requestUpdate()}createFetchPopupFeaturesQueryGeometry(e,t){return(0,drapedUtils.K)(e,t,this.view)}async doRefresh(){this.updateRequested||this.suspended||(this.layer.updateRenderer(),this._updateSymbolizerParams(),this._updateBlockCacheRegistry(!0),this._fetchQueue.reset(),this._tileStrategy.tiles.forEach((e=>this._enqueueTileFetch(e))),this.notifyChange("updating"))}isUpdating(){return this._fetchQueue.length>0||this._globalUpdateRequested}acquireTile(e){const t=this._bitmapView.createTile(e),i=t.bitmap;return[i.x,i.y]=this._tileInfoView.getTileCoords(L,t.key),i.resolution=this._tileInfoView.getTileResolution(t.key),[i.width,i.height]=this._tileInfoView.tileInfo.size,this._enqueueTileFetch(t),this.requestUpdate(),this._needBlockCacheUpdate=!0,this._globalUpdateRequested=this.hasTilingEffects||!this.useProgressiveUpdate,t}releaseTile(e){this._fetchQueue.abort(e.key.id),this._bitmapView.removeChild(e),e.once("detach",(()=>{e.destroy(),this.requestUpdate()})),this.requestUpdate()}fetchTile(e,s){const r=!(0,maybe.Wi)(s)&&s.signal,a=this._canUseWebGLForProcessing(),l={tileInfo:this.tileInfo,signal:(0,maybe.Wg)(r),registryId:this._blockCacheRegistryId,requestRawData:a,srcResolution:this._srcResolutions[e.level],datumTransformation:this.datumTransformation,interpolation:a?"nearest":this.layer.interpolation};return this.layer.fetchTile(e.level,e.row,e.col,l)}_canUseWebGLForProcessing(){return this.useWebGLForProcessing&&this.layer.symbolizer.canRenderInWebGL&&!("majority"===this.layer.interpolation&&this._canUseMajorityInterpolationOnDataSource())}_getCacheSize(e){return e?40:0}_initializeTileInfo(){const e=this.view.spatialReference,t=new Point.Z({x:this.fullExtent.xmin,y:this.fullExtent.ymax,spatialReference:e}),{scales:i,srcResolutions:s,isCustomTilingScheme:r}=(0,rasterProjectionHelper.vF)(this.layer.rasterInfo,e),a=TileInfo.Z.create({spatialReference:e,size:512,scales:i});(0===a.origin.x||a.origin.x>t.x)&&(a.origin=t),this._isCustomTilingScheme=r,this._set("tileInfo",a),this._srcResolutions=null!=s?s:[]}async _enqueueTileFetch(e,t){if(!this._fetchQueue.has(e.key.id)){try{const t=await this._fetchQueue.push(e.key),{bandIds:s}=this.layer;let r=!this.useProgressiveUpdate||this.hasTilingEffects&&!this._globalSymbolizerParams;if(this._globalUpdateRequested&&!this.moving&&0===this._fetchQueue.length){r=!1;try{await this._redrawImage(this._abortController&&this._abortController.signal)}catch(i){(0,promiseUtils.D_)(i)&&V.error(i)}this._globalUpdateRequested=!1}const a=this._canUseWebGLForProcessing();if(a&&!this.hasTilingEffects&&null==this._symbolizerParams&&this._updateSymbolizerParams(),t&&t.pixelBlock){const i={extent:t.extent,pixelBlock:t.pixelBlock};if(e.bitmap.rawPixelData=i,a)e.bitmap.source=t.pixelBlock,e.bitmap.isRendereredSource=!1;else{const t=await this.layer.applyRenderer(i,this.hasTilingEffects&&this._globalSymbolizerParams&&"stretch"===this._globalSymbolizerParams.type?this._globalSymbolizerParams:null);e.bitmap.source=t,e.bitmap.isRendereredSource=!0}e.bitmap.symbolizerParameters=a?this._globalSymbolizerParams||this._symbolizerParams:null,a?e.bitmap.transformGrid||(e.bitmap.transformGrid=t.transformGrid):e.bitmap.transformGrid=null}else{const t=this._createEmptyTilePixelBlock();e.bitmap.source=t,e.bitmap.symbolizerParameters=a?this._symbolizerParams:null,e.bitmap.transformGrid=null}e.bitmap.bandIds=s,e.bitmap.width=this._tileInfoView.tileInfo.size[0],e.bitmap.height=this._tileInfoView.tileInfo.size[1],e.bitmap.interpolation=this._getLayerInterpolation(),e.bitmap.suspended=r,e.bitmap.invalidateTexture(),e.once("attach",(()=>this.requestUpdate())),this._bitmapView.addChild(e)}catch(i){(0,promiseUtils.D_)(i)||V.error(i)}this.requestUpdate()}}async _redrawImage(e){this.layer.updateRenderer(),this.hasTilingEffects?await this._updateGlobalSymbolizerParams(e):(this._updateSymbolizerParams(),this._globalSymbolizerParams=null);const{bandIds:t}=this.layer,i=this._bitmapView.children.map((async e=>{const i=this._canUseWebGLForProcessing();!i&&e.bitmap.rawPixelData?(e.bitmap.source=await this.layer.applyRenderer(e.bitmap.rawPixelData,this.hasTilingEffects&&this._globalSymbolizerParams&&"stretch"===this._globalSymbolizerParams.type?this._globalSymbolizerParams:null),e.bitmap.isRendereredSource=!0):(e.bitmap.isRendereredSource&&e.bitmap.rawPixelData&&(e.bitmap.source=e.bitmap.rawPixelData.pixelBlock),e.bitmap.isRendereredSource=!1),e.bitmap.symbolizerParameters=i?this._globalSymbolizerParams||this._symbolizerParams:null,e.bitmap.bandIds=t,e.bitmap.interpolation=this._getLayerInterpolation(),e.bitmap.suspended=!1}));await(0,promiseUtils.as)(i),this.container.requestRender()}_createEmptyTilePixelBlock(){if(!this._emptyTilePixelBlock){const e=this._tileInfoView.tileInfo.size[0],t=this._tileInfoView.tileInfo.size[1];this._emptyTilePixelBlock=new PixelBlock.Z({width:e,height:t,pixels:[new Uint8Array(e*t)],mask:new Uint8Array(e*t),pixelType:"u8"})}return this._emptyTilePixelBlock}async _updateGlobalSymbolizerParams(e){const t={srcResolution:this._srcResolutions[this._previousLOD.level],registryId:this._blockCacheRegistryId,signal:e},i=await this.layer.fetchPixels(this.view.extent,this.view.width,this.view.height,t);if(!i||!i.pixelBlock)return;const s=this.layer.symbolizer.generateWebGLParameters({pixelBlock:(0,pixelUtils.qF)(i.pixelBlock,this.layer.bandIds),isGCS:this.view.spatialReference.isGeographic,resolution:{x:this._previousLOD.resolution,y:this._previousLOD.resolution},bandIds:this.layer.bandIds});!this._canUseWebGLForProcessing()&&s&&"stretch"===s.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(s.factor=s.factor.map((e=>255*e)),s.outMin=Math.round(255*s.outMin),s.outMax=Math.round(255*s.outMax)),this._globalSymbolizerParams=s}_updateSymbolizerParams(){this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.view.spatialReference.isGeographic,resolution:{x:this._previousLOD.resolution,y:this._previousLOD.resolution},bandIds:this.layer.bandIds})}_updateBlockCacheRegistry(e=!1){const{url:t,rasterInfo:i,multidimensionalDefinition:s,raster:r}=this.layer,a=null!=i&&i.multidimensionalInfo?r.getSliceIndex(s):null,l=(0,RawBlockCache.Rq)(t,a);if(l!==this._blockCacheRegistryUrl){if(null!=this._blockCacheRegistryUrl&&(0,RawBlockCache.ET)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=(0,RawBlockCache.z2)(l,this.layer.raster.rasterInfo),e){const e=this._tileInfoView.getClosestInfoForScale(this.view.scale),t=this._srcResolutions[e.level];(0,RawBlockCache.Vx)(l,this._blockCacheRegistryId,this.view.extent,this.view.resolution,t,this.layer.raster.ioConfig.sampling)}this._blockCacheRegistryUrl=l}}_canUseMajorityInterpolationOnDataSource(){const{bandCount:e,attributeTable:t,colormap:i,pixelType:s}=this.layer.rasterInfo;return 1===e&&(null!=t||null!=i||"u8"===s||"s8"===s)}_getLayerInterpolation(){const e=this.layer.renderer.type;return"raster-colormap"===e||"unique-value"===e||"class-breaks"===e?"nearest":this.layer.interpolation}};(0,tslib_es6._)([(0,property.Cb)()],q.prototype,"useProgressiveUpdate",null),q=(0,tslib_es6._)([(0,subclass.j)("esri.views.2d.layers.ImageryTileLayerView2D")],q);const ImageryTileLayerView2D=q},81558:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{y:()=>LayerView2D_l});var tslib_es6=__webpack_require__(56140),property=(__webpack_require__(95830),__webpack_require__(36544),__webpack_require__(68055),__webpack_require__(79881)),subclass=__webpack_require__(87566),Collection=(__webpack_require__(10923),__webpack_require__(57002),__webpack_require__(86035),__webpack_require__(28293)),collectionUtils=__webpack_require__(32105),watchUtils=__webpack_require__(80621),JSONSupport=__webpack_require__(58385);let e=class extends JSONSupport.wq{};e=(0,tslib_es6._)([(0,subclass.j)("esri.views.layers.support.ClipArea")],e);const ClipArea=e;var s;let i=s=class extends ClipArea{constructor(){super(...arguments),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new s({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}get version(){return(this._get("version")||0)+1}};(0,tslib_es6._)([(0,property.Cb)({type:[Number,String],json:{write:!0}})],i.prototype,"left",void 0),(0,tslib_es6._)([(0,property.Cb)({type:[Number,String],json:{write:!0}})],i.prototype,"right",void 0),(0,tslib_es6._)([(0,property.Cb)({type:[Number,String],json:{write:!0}})],i.prototype,"top",void 0),(0,tslib_es6._)([(0,property.Cb)({type:[Number,String],json:{write:!0}})],i.prototype,"bottom",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],i.prototype,"version",null),i=s=(0,tslib_es6._)([(0,subclass.j)("esri.views.layers.support.ClipRect")],i);const ClipRect=i;var y,Container=__webpack_require__(17149),Geometry=__webpack_require__(39718),Extent=__webpack_require__(52937),Polygon=__webpack_require__(53817),jsonUtils=__webpack_require__(56885);__webpack_require__(36348);const c={base:Geometry.Z,key:"type",typeMap:{extent:Extent.Z,polygon:Polygon.Z}};let n=y=class extends ClipArea{constructor(){super(...arguments),this.type="geometry",this.geometry=null}get version(){return(this._get("version")||0)+1}clone(){return new y({geometry:this.geometry.clone()})}};(0,tslib_es6._)([(0,property.Cb)({types:c,json:{read:jsonUtils.im,write:!0}})],n.prototype,"geometry",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],n.prototype,"version",null),n=y=(0,tslib_es6._)([(0,subclass.j)("esri.views.layers.support.Geometry")],n);const support_Geometry=n;let Path_e=class extends ClipArea{constructor(){super(...arguments),this.type="path",this.path=[]}get version(){return(this._get("version")||0)+1}};(0,tslib_es6._)([(0,property.Cb)({type:[[[Number]]],json:{write:!0}})],Path_e.prototype,"path",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],Path_e.prototype,"version",null),Path_e=(0,tslib_es6._)([(0,subclass.j)("esri.views.layers.support.Path")],Path_e);const Path=Path_e,LayerView2D_c=Collection.Z.ofType({key:"type",base:ClipArea,typeMap:{rect:ClipRect,path:Path,geometry:support_Geometry}}),LayerView2D_l=i=>{let a=class extends i{constructor(){super(...arguments),this.clips=new LayerView2D_c,this.moving=!1,this.attached=!1,this.lastUpdateId=-1,this.updateRequested=!1}initialize(){var t;this.container||(this.container=new Container.W),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([(0,watchUtils.S1)(this,"suspended",(t=>{this.container&&(this.container.visible=!t),this.view&&!t&&this.updateRequested&&this.view.requestUpdate()}),!0),(0,watchUtils.S1)(this,["layer.opacity","container"],(()=>{var t,e;this.container&&(this.container.opacity=null!=(t=null==(e=this.layer)?void 0:e.opacity)?t:1)}),!0),(0,watchUtils.S1)(this,["layer.blendMode"],(t=>{this.container&&(this.container.blendMode=t)}),!0),(0,watchUtils.S1)(this,["layer.effect"],(t=>{this.container&&(this.container.effect=t)}),!0),this.clips.on("change",(()=>{this.container.clips=this.clips,this.notifyChange("clips")}))]),null!=(t=this.view)&&t.whenLayerView?this.view.whenLayerView(this.layer).then((t=>{t!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)}),(()=>{})):this.when().then((()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)}),(()=>{}))}destroy(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}get updating(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}isVisibleAtScale(t){let e=!0;const s=this.layer,i=s.minScale,r=s.maxScale;if(null!=i&&null!=r){let s=!i,o=!r;!s&&t<=i&&(s=!0),!o&&t>=r&&(o=!0),e=s&&o}return e}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(t){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",t),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(t))):this.updateRequested=!1}isUpdating(){return!1}isRendering(){return!1}canResume(){return!!super.canResume()&&this.isVisibleAtScale(this.view.scale)}};return(0,tslib_es6._)([(0,property.Cb)({type:LayerView2D_c,set(t){const e=(0,collectionUtils.Z)(t,this._get("clips"),LayerView2D_c);this._set("clips",e)}})],a.prototype,"clips",void 0),(0,tslib_es6._)([(0,property.Cb)()],a.prototype,"moving",void 0),(0,tslib_es6._)([(0,property.Cb)()],a.prototype,"attached",void 0),(0,tslib_es6._)([(0,property.Cb)()],a.prototype,"container",void 0),(0,tslib_es6._)([(0,property.Cb)()],a.prototype,"suspended",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],a.prototype,"updateParameters",void 0),(0,tslib_es6._)([(0,property.Cb)()],a.prototype,"updateRequested",void 0),(0,tslib_es6._)([(0,property.Cb)()],a.prototype,"updating",null),(0,tslib_es6._)([(0,property.Cb)()],a.prototype,"view",void 0),a=(0,tslib_es6._)([(0,subclass.j)("esri.views.2d.layers.LayerView2D")],a),a}},43835:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{R:()=>p});var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(56140),_core_maybe_js__WEBPACK_IMPORTED_MODULE_12__=(__webpack_require__(95830),__webpack_require__(59472)),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__=(__webpack_require__(36544),__webpack_require__(68055),__webpack_require__(79881)),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(87566),_core_Error_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(32656),_Graphic_js__WEBPACK_IMPORTED_MODULE_9__=(__webpack_require__(10923),__webpack_require__(57002),__webpack_require__(86035),__webpack_require__(15988)),_layers_support_rasterFunctions_rasterProjectionHelper_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(52606),_support_popupUtils_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(21707);const p=p=>{let u=class extends p{constructor(){super(...arguments),this._rasterFieldPrefix="Raster.",this.layer=null,this.view=null,this.fullExtent=null,this.tileInfo=null,this.datumTransformation=null}get hasTilingEffects(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}async fetchPopupFeatures(e,r){const{layer:i}=this;if(!e)return Promise.reject(new _core_Error_js__WEBPACK_IMPORTED_MODULE_5__.Z("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:i}));const{popupEnabled:a}=i,n=(0,_support_popupUtils_js__WEBPACK_IMPORTED_MODULE_11__.V)(i,r);if(!a||!(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_12__.pC)(n))throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_5__.Z("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:a,popupTemplate:n});const p=[],{value:u}=await i.identify(e);if(u){var f,m;const e=u.join(", "),t={ObjectId:0},r="Raster.ServicePixelValue";t[r]=this._formatAttributeValue(e,r);const o=null==(f=i.rasterInfo)||null==(m=f.attributeTable)?void 0:m.features;if(o&&o.length>0){const r=o.filter((t=>{const r=t.attributes.value||t.attributes.Value||t.attributes.VALUE;return String(r)===e}));if(r.length>0){const e=r[0];if(e)for(const r in e.attributes)if(e.attributes.hasOwnProperty(r)){const i=this._rasterFieldPrefix+r;t[i]=this._formatAttributeValue(e.attributes[r],i)}}}const a=new _Graphic_js__WEBPACK_IMPORTED_MODULE_9__.Z(this.fullExtent.clone(),null,t);a.layer=i,a.sourceLayer=a.layer,p.push(a)}return p}updateFullExtent(){const e=this.layer.tileInfo;let t;e&&e.spatialReference||(t=new _core_Error_js__WEBPACK_IMPORTED_MODULE_5__.Z("layerview:tiling-information-missing","The layer doesn't provide tiling information",{layer:this.layer}));const r=(0,_layers_support_rasterFunctions_rasterProjectionHelper_js__WEBPACK_IMPORTED_MODULE_10__._D)(this.layer.fullExtent,this.view.spatialReference,!1),i=(0,_layers_support_rasterFunctions_rasterProjectionHelper_js__WEBPACK_IMPORTED_MODULE_10__.tB)(this.layer.fullExtent,this.view.spatialReference,r);return null==i&&(t=new _core_Error_js__WEBPACK_IMPORTED_MODULE_5__.Z("layerview:projection-not-supported","The layer extent cannot be projected to the view's spatial reference",{layer:this.layer})),this._set("fullExtent",i),this.datumTransformation||(this.datumTransformation=(0,_layers_support_rasterFunctions_rasterProjectionHelper_js__WEBPACK_IMPORTED_MODULE_10__._D)(this.layer.fullExtent,this.view.spatialReference,!0)),t?Promise.reject(t):Promise.resolve()}_formatAttributeValue(e,t){if("string"==typeof e){const r=this.layer.popupTemplate&&this.layer.popupTemplate.fieldInfos,i=this._getFieldInfo(r,t),o=i&&i.format;if(o){let t,r;return e.trim().indexOf(",")>-1?(t=",",r=t+" ",this._formatDelimitedString(e,t,r,o)):e.trim().indexOf(" ")>-1?(t=r=" ",this._formatDelimitedString(e,t,r,o)):this._formatNumberFromString(e,o)}}return e}_getFieldInfo(e,t){if(!e||!e.length||!t)return;const r=t.toLowerCase();let i;return e.some((e=>!(!e.fieldName||e.fieldName.toLowerCase()!==r&&e.fieldName.toLowerCase()!==r.replace(/ /g,"_")||(i=e,0)))),i}_formatDelimitedString(e,t,r,i){return e&&t&&r&&i?e.trim().split(t).map((e=>this._formatNumberFromString(e,i))).join(r):e}_formatNumberFromString(e,t){if(!e||!t)return e;const r=Number(e);return isNaN(r)?e:t.format(r)}};return(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_13__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)()],u.prototype,"layer",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_13__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)()],u.prototype,"view",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_13__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)()],u.prototype,"fullExtent",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_13__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)()],u.prototype,"tileInfo",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_13__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)({readOnly:!0})],u.prototype,"hasTilingEffects",null),u=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_13__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_4__.j)("esri.views.layers.ImageryTileLayerView")],u),u}},21707:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{V:()=>d,e:()=>i});var _core_maybe_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(59472),_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(4665);async function i(i,d=i.popupTemplate){if(!(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_1__.pC)(d))return[];const o=await d.getRequiredFields(i.fields),{lastEditInfoEnabled:s}=d,{objectIdField:u,typeIdField:a,globalIdField:n,relationships:f}=i;if(o.includes("*"))return["*"];const r=s?await(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.CH)(i):[],m=(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.Q0)(i.fields,[...o,...r]);return a&&m.push(a),m&&u&&(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.cT)(i.fields,u)&&-1===m.indexOf(u)&&m.push(u),m&&n&&(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.cT)(i.fields,n)&&-1===m.indexOf(n)&&m.push(n),f&&f.forEach((e=>{const{keyField:p}=e;m&&p&&(0,_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.cT)(i.fields,p)&&-1===m.indexOf(p)&&m.push(p)})),m}function d(p,l){return p.popupTemplate?p.popupTemplate:(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_1__.pC)(l)&&l.defaultPopupTemplateEnabled&&(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_1__.pC)(p.defaultPopupTemplate)?p.defaultPopupTemplate:null}},37694:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{K:()=>a});var _core_maybe_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(59472),_geometry_Extent_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(52937),_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_2__=(__webpack_require__(36348),__webpack_require__(93533));function a(t,i,a,o=new _geometry_Extent_js__WEBPACK_IMPORTED_MODULE_0__.Z){let s;if("2d"===a.type)s=i*a.resolution;else if("3d"===a.type){const r=a.overlayPixelSizeInMapUnits(t),o=a.basemapSpatialReference;s=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_3__.pC)(o)&&!o.equals(a.spatialReference)?(0,_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_2__.c9)(o)/(0,_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_2__.c9)(a.spatialReference):i*r}const m=t.x-s,p=t.y-s,c=t.x+s,l=t.y+s,{spatialReference:f}=a;return o.xmin=Math.min(m,c),o.ymin=Math.min(p,l),o.xmax=Math.max(m,c),o.ymax=Math.max(p,l),o.spatialReference=f,o}new _geometry_Extent_js__WEBPACK_IMPORTED_MODULE_0__.Z}}]);
//# sourceMappingURL=4692.c8b6c3f9.iframe.bundle.js.map