(self.webpackChunkreact_arcgis_wmws=self.webpackChunkreact_arcgis_wmws||[]).push([[9698],{25654:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{M:()=>r,b:()=>o});var _views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(33834),_views_3d_webgl_engine_core_shaderModules_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(51219);function o(){const o=new _views_3d_webgl_engine_core_shaderModules_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_1__.kG;o.vertex.uniforms.add("proj","mat4").add("view","mat4").add("width","float"),o.attributes.add("position","vec3"),o.attributes.add("normal","vec3"),o.attributes.add("uv0","vec2"),o.attributes.add("auxpos1","float"),o.varyings.add("vtc","vec2"),o.varyings.add("vlength","float"),o.varyings.add("vradius","float"),o.vertex.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_0__.H`
    void main(void) {
      vec3 bitangent = normal;

      vtc = uv0;
      vlength = auxpos1;
      vradius = 0.5 * width;

      vec4 pos = view * vec4(position + vradius * bitangent * uv0.y, 1.0);
      gl_Position = proj * pos;
    }
  `),o.fragment.uniforms.add("outlineSize","float").add("outlineColor","vec4").add("stripeLength","float").add("stripeEvenColor","vec4").add("stripeOddColor","vec4");const r=1/Math.sqrt(2);return o.fragment.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_0__.H`
    const float INV_SQRT2 = ${_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_0__.H.float(r)};

    vec4 arrowColor(vec2 tc, float len) {
      float d = INV_SQRT2 * (tc.x - abs(tc.y));
      d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));
      d = min(d, 1.0 - abs(tc.y));

      if (d < 0.0) {
        return vec4(0.0);
      } else if (d < outlineSize) {
        return outlineColor;
      } else {
        return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;
      }
    }

    void main(void) {
      vec2 ntc = vec2(vtc.x / vradius, vtc.y);
      vec4 color = arrowColor(ntc, vlength / vradius);
      if (color.a == 0.0) {
        discard;
      }
      gl_FragColor = color;
    }
  `),o}var r=Object.freeze({__proto__:null,build:o})},9698:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{DirectLineMeasurement3DView:()=>DirectLineMeasurement3DView_U});var tslib_es6=__webpack_require__(56140),maybe=(__webpack_require__(95830),__webpack_require__(59472)),property=(__webpack_require__(36544),__webpack_require__(68055),__webpack_require__(79881)),subclass=__webpack_require__(87566),Accessor=(__webpack_require__(10923),__webpack_require__(57002),__webpack_require__(86035),__webpack_require__(82677)),locale=__webpack_require__(3766),mathUtils=__webpack_require__(33655),screenUtils=__webpack_require__(96071),messages=__webpack_require__(14071),vec3f64=(__webpack_require__(89771),__webpack_require__(77625)),vec3=__webpack_require__(17387),Handles=__webpack_require__(59691),watchUtils=__webpack_require__(80621),projectionEllipsoid=__webpack_require__(89333),unitUtils=__webpack_require__(93533),unitFormatUtils=__webpack_require__(56888);function quantityFormatUtils_l(t,a,n,e=2,i="abbr"){return(0,unitFormatUtils.VG)(t,a.toUnit(n).value,n,e,i)}function quantityFormatUtils_f(r,a,n=2,e="abbr"){if("length"!==a.measure)throw new Error("quantity is not a length");return(0,unitFormatUtils.Rd)(r,a.value,a.unit,n,e)}function quantityFormatUtils_h(r,t,a=2,n="abbr"){if("length"!==t.measure)throw new Error("quantity is not a length");return(0,unitFormatUtils.Ud)(r,t.value,t.unit,a,n)}var vec2=__webpack_require__(14286),vec4f32=__webpack_require__(77615),lineStippleUtils=__webpack_require__(48430),mat4=__webpack_require__(67128),mat4f64=__webpack_require__(12811),vec4=__webpack_require__(34353),stack=__webpack_require__(8344),Geometry=__webpack_require__(27354),GeometryUtil=__webpack_require__(39746),RibbonLineMaterial=__webpack_require__(94899),ColorMaterial=__webpack_require__(94589),Object3D=__webpack_require__(5355),WebGLLayer=__webpack_require__(42722);class VisualElement_t{constructor(t){this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=t,this.view.watch("ready",(t=>{this._resourcesCreated&&(t?this._createResources():this._destroyResources())}))}applyProps(t){let e=!1;for(const s in t)s in this?"attached"===s?e=t[s]:this[s]=t[s]:console.error("Cannot set unknown property",s);this.attached=e}destroy(){this.attached=!1}get attached(){return this._attached}set attached(t){t!==this._attached&&this.view._stage&&(this._attached=t,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources())}get visible(){return this._visible}set visible(t){t!==this._visible&&(this._visible=t,this.attached&&this.updateVisibility(t))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.visible||this.updateVisibility(!1)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}class Object3DVisualElement_a extends VisualElement_t{constructor(e){super(e.view),this._resources=null,this._transform=(0,mat4f64.a)()}get object(){return(0,maybe.pC)(this._resources)?this._resources.object:null}get transform(){return this._transform}set transform(s){(0,mat4.c)(this._transform,s),(0,maybe.pC)(this._resources)&&(this._resources.object.transformation=this._transform,this._resources.layer.commit())}recreate(){this.attached&&this.createResources()}recreateGeometry(){if((0,maybe.Wi)(this._resources))return;const e=this._resources.object,r=this.view._stage;r.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),this.visible||e.setVisible(this.visible),r.addMany(e.geometries),this._resources.layer.commit()}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const s=new WebGLLayer.F({isPickable:!1});e.add(s);const r=new Object3D.T({castShadow:!1});r.transformation=this._transform,this.createExternalResources(),this.createGeometries(r),e.addMany(r.geometries),this.forEachExternalMaterial((s=>e.add(s))),e.add(r),s.add(r),s.commit(),this.visible||(r.setVisible(!1),s.commit()),this._resources={layer:s,object:r}}destroyResources(){const e=this.view._stage;!(0,maybe.Wi)(this._resources)&&e&&(e.remove(this._resources.object),e.remove(this._resources.layer),this.forEachExternalMaterial((s=>{e.remove(s),s.dispose()})),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){(0,maybe.Wi)(this._resources)||(this._resources.object.setVisible(e),this._resources.layer.commit())}}class y extends Object3DVisualElement_a{constructor(e){super(e),this._handles=new Handles.Z,this._quadMaterial=null,this._outlineMaterial=null,this._maxSize=0,this._position=(0,vec3f64.c)(),this._up=(0,vec3f64.c)(),this._right=(0,vec3f64.c)(),this._renderOccluded=4,this._color=(0,vec4f32.f)(1,0,0,1),this._outlineColor=(0,vec4f32.f)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=16,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,vec4.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,vec4.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:o}){this._maxSize=Math.min((0,vec3.k)(t,e),(0,vec3.k)(t,o))/3,(0,vec3.n)(this._up,(0,vec3.f)(this._up,e,t)),(0,vec3.n)(this._right,(0,vec3.f)(this._right,o,t)),(0,vec3.g)(this._position,t),this.recreateGeometry()}createExternalResources(){this._quadMaterial=new ColorMaterial.E(this.quadMaterialParameters),this._outlineMaterial=new RibbonLineMaterial.U(this.outlineMaterialParameters),this._handles.add(this.view.state.watch("camera",(()=>this._updateTransform())))}destroyExternalResources(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}forEachExternalMaterial(e){e(this._quadMaterial),e(this._outlineMaterial)}createGeometries(e){this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e)}_createQuadGeometry(e){const t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}_createOutlineGeometry(e){if(0===this._outlineSize)return;const t=(0,vec3.b)(stack.WM.get(),this._up,this._right),i=GeometryUtil.Z.createPolylineGeometry([this._up,t,this._right]);e.addGeometry(i,this._outlineMaterial)}_updateTransform(t=this.object){const i=this.view.state.camera,r=this._size*i.computeScreenPixelSizeAt(this._position),s=Math.min(this._maxSize,r);(0,mat4.i)(z),(0,mat4.t)(z,z,this._position),(0,mat4.s)(z,z,[s,s,s]),(0,maybe.pC)(t)&&(t.transformation=z)}_quadGeometryData(e,t){const i=(0,vec3.b)(stack.WM.get(),e,t);return new Geometry.Z([["position",{size:3,data:[0,0,0,...t,...e,...i],exclusive:!0}]],[["position",new Uint16Array([0,1,2,1,2,3])]])}get quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){this._quadMaterial&&this._quadMaterial.setParameterValues(this.quadMaterialParameters)}get outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){this._outlineMaterial&&this._outlineMaterial.setParameterValues(this.outlineMaterialParameters)}}const z=(0,mat4f64.a)();__webpack_require__(82550);(0,vec3f64.c)();function k(e,r,n,o){o.projectToRenderScreen(e,viewUtils_b),o.projectToRenderScreen(r,H),(0,vec2.d)(n,U,x),(0,vec2.e)(n,n)}(0,vec3f64.c)(),(0,screenUtils.J$)();const viewUtils_b=(0,screenUtils.J$)(),x=viewUtils_b,H=(0,screenUtils.J$)(),U=H;(0,screenUtils.s1)(),(0,screenUtils.s1)(),(0,screenUtils.s1)();__webpack_require__(38836);let h_e=e=>({vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}),r=(t,o,n)=>{for(let l=0,i=o.length;l<i;l++){let i=o[l];Array.isArray(i)?r(t,i,n):null!=i&&!1!==i&&("string"==typeof i&&(i=h_e(i)),n.push(i))}};function h_t(e,t,o){if(Array.isArray(t))o=t,t=void 0;else if(t&&("string"==typeof t||t.hasOwnProperty("vnodeSelector"))||o&&("string"==typeof o||o.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let n,l;return o&&1===o.length&&"string"==typeof o[0]?n=o[0]:o&&(l=[],r(e,o,l),0===l.length&&(l=void 0)),{vnodeSelector:e,properties:t,children:l,text:""===n?void 0:n,domNode:null}}__webpack_require__(79618);let LineOverlayItem_r=class extends Accessor.Z{constructor(t){super(t),this.startX=0,this.startY=0,this.endX=0,this.endY=0,this.width=1,this.color=[0,0,0,.5],this.visible=!0}get startPosition(){return[this.startX,this.startY]}set startPosition(t){this._set("startX",t[0]),this._set("startY",t[1])}get endPosition(){return[this.endX,this.endY]}set endPosition(t){this._set("endX",t[0]),this._set("endY",t[1])}get strokeStyle(){const t=this.color;return`rgba(${t[0]}, ${t[1]}, ${t[2]}, ${t[3]})`}get lineCap(){return"round"}render(){const{height:t,left:e,top:s,width:i,x1:r,x2:n,y1:p,y2:a}=this.calculateCoordinates(LineOverlayItem_h),l=`stroke: ${this.strokeStyle}; stroke-width: ${this.width}; stroke-linecap: ${this.lineCap};`;return h_t("div",{classes:{"esri-line-overlay-item":!0},styles:{left:e+"px",top:s+"px",width:i+"px",height:t+"px",visibility:this.visible?"visible":"hidden"}},[h_t("svg",{width:i,height:t},[h_t("line",{x1:r,y1:p,x2:n,y2:a,style:l})])])}renderCanvas(t){if(!this.visible)return;t.strokeStyle=this.strokeStyle,t.lineWidth=this.width,t.lineCap=this.lineCap;const e=this.calculateCoordinates(LineOverlayItem_h);t.beginPath(),t.moveTo(e.left+e.x1,e.top+e.y1),t.lineTo(e.left+e.x2,e.top+e.y2),t.stroke()}calculateCoordinates(t){const e=Math.min(this.startX,this.endX),s=Math.max(this.startX,this.endX),i=Math.min(this.startY,this.endY),o=Math.max(this.startY,this.endY),r=this.width;return t.left=e-r,t.top=i-r,t.width=s-e+2*r,t.height=Math.max(20,o-i+2*r),t.x1=this.startX-e+r,t.y1=this.startY-i+r,t.x2=this.endX-e+r,t.y2=this.endY-i+r,t}};(0,tslib_es6._)([(0,property.Cb)()],LineOverlayItem_r.prototype,"startX",void 0),(0,tslib_es6._)([(0,property.Cb)()],LineOverlayItem_r.prototype,"startY",void 0),(0,tslib_es6._)([(0,property.Cb)()],LineOverlayItem_r.prototype,"endX",void 0),(0,tslib_es6._)([(0,property.Cb)()],LineOverlayItem_r.prototype,"endY",void 0),(0,tslib_es6._)([(0,property.Cb)()],LineOverlayItem_r.prototype,"startPosition",null),(0,tslib_es6._)([(0,property.Cb)()],LineOverlayItem_r.prototype,"endPosition",null),(0,tslib_es6._)([(0,property.Cb)()],LineOverlayItem_r.prototype,"width",void 0),(0,tslib_es6._)([(0,property.Cb)()],LineOverlayItem_r.prototype,"color",void 0),(0,tslib_es6._)([(0,property.Cb)()],LineOverlayItem_r.prototype,"visible",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],LineOverlayItem_r.prototype,"strokeStyle",null),LineOverlayItem_r=(0,tslib_es6._)([(0,subclass.j)("esri.views.overlay.LineOverlayItem")],LineOverlayItem_r);const LineOverlayItem_h={left:0,top:0,width:0,height:0,x1:0,y1:0,x2:0,y2:0};const LineOverlayItem=LineOverlayItem_r,TextOverlayItem_s={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};let TextOverlayItem_l=class extends Accessor.Z{constructor(t){super(t),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this.backgroundColor="rgba(0, 0, 0, 0.6)",this.textColor="white",this.textShadowColor=[0,0,0],this.textShadowSize=1}get position(){return[this.x,this.y]}set position(t){this._set("x",t[0]),this._set("y",t[1])}get padding(){return.5*this.fontSize}render(){return h_t("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",backgroundColor:this.backgroundColor,color:this.textColor,padding:this.padding+"px",borderRadius:this.padding+"px",textShadow:`0 0 ${this.textShadowSize}px rgb(${this.textShadowColor[0]}, ${this.textShadowColor[1]}, ${this.textShadowColor[2]})`}},[this.text])}renderCanvas(t){if(!this.visible)return;const e=t.font.replace(/^(.*?)px/,"");t.font=`${this.fontSize}px ${e}`;const o=this.padding,i=this.padding,r=t.measureText(this.text).width,s=this.fontSize,l=TextOverlayItem_n[this.anchor];t.textAlign="center",t.textBaseline="middle";const h=r+2*o,a=s+2*o,x=this.x+l.x*h,p=this.y+l.y*a;this.roundedRect(t,x,p,h,a,i),t.fillStyle=this.backgroundColor,t.fill();const c=this.x+(l.x+.5)*h,d=this.y+(l.y+.5)*a;this._renderTextShadow(t,this.text,c,d),t.fillStyle=this.textColor,t.fillText(this.text,c,d)}_renderTextShadow(t,e,o,i){t.lineJoin="miter",t.fillStyle=`rgba(${this.textShadowColor[0]}, ${this.textShadowColor[1]}, ${this.textShadowColor[2]}, ${1/TextOverlayItem_h.length})`;const r=this.textShadowSize;for(const[s,l]of TextOverlayItem_h)t.fillText(e,o+r*s,i+r*l)}roundedRect(t,e,o,i,r,s){t.beginPath(),t.moveTo(e,o+s),t.arcTo(e,o,e+s,o,s),t.lineTo(e+i-s,o),t.arcTo(e+i,o,e+i,o+s,s),t.lineTo(e+i,o+r-s),t.arcTo(e+i,o+r,e+i-s,o+r,s),t.lineTo(e+s,o+r),t.arcTo(e,o+r,e,o+r-s,s),t.closePath()}_cssClasses(){const t={"esri-text-overlay-item":!0};for(const e in TextOverlayItem_s)t[TextOverlayItem_s[e]]=this.anchor===e;return t}};(0,tslib_es6._)([(0,property.Cb)()],TextOverlayItem_l.prototype,"x",void 0),(0,tslib_es6._)([(0,property.Cb)()],TextOverlayItem_l.prototype,"y",void 0),(0,tslib_es6._)([(0,property.Cb)()],TextOverlayItem_l.prototype,"position",null),(0,tslib_es6._)([(0,property.Cb)()],TextOverlayItem_l.prototype,"text",void 0),(0,tslib_es6._)([(0,property.Cb)()],TextOverlayItem_l.prototype,"fontSize",void 0),(0,tslib_es6._)([(0,property.Cb)()],TextOverlayItem_l.prototype,"anchor",void 0),(0,tslib_es6._)([(0,property.Cb)()],TextOverlayItem_l.prototype,"visible",void 0),(0,tslib_es6._)([(0,property.Cb)()],TextOverlayItem_l.prototype,"padding",null),TextOverlayItem_l=(0,tslib_es6._)([(0,subclass.j)("esri.views.overlay.TextOverlayItem")],TextOverlayItem_l);const TextOverlayItem_n={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},TextOverlayItem_h=[];{const t=16;for(let e=0;e<360;e+=360/t)TextOverlayItem_h.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)])}const TextOverlayItem=TextOverlayItem_l;class LabelVisualElement_f extends VisualElement_t{constructor(t){super(t.view),this._handles=new Handles.Z,this._textItem=null,this._calloutItem=null,this._showCallout=!0,this._showText=!0,this._geometry=null,this._text=null,this._fontSize=14,this._distance=25,this._anchor="right",this.applyProps(t)}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this._updateLabelPosition()}get textItem(){return this._textItem}get text(){return this._text}set text(t){this._text=t,this.attached&&(this._textItem.text=this._text)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=t,this.attached&&(this._textItem.fontSize=this._fontSize)}get distance(){return this._distance}set distance(t){this._distance!==t&&(this._distance=t,this._updateLabelPosition())}get anchor(){return this._anchor}set anchor(t){this._anchor!==t&&(this._anchor=t,this._updateLabelPosition())}overlaps(t){return this.textItem.visible&&t.textItem.visible&&this.view.overlay.overlaps(this._textItem,t.textItem)}_updateLabelPosition(){if(this.attached){if(this._showText=!1,this._showCallout=!1,(0,maybe.pC)(this.geometry)&&this.view._stage)switch(this.geometry.type){case"point":this._computeLabelPositionFromPoint(this.geometry,LabelVisualElement_k)&&(this._textItem.position=[LabelVisualElement_k[0],LabelVisualElement_k[1]],this._textItem.anchor="center",this._showText=!0);break;case"corner":this._computeLabelPositionFromCorner(this.geometry,this._distance,LabelVisualElement_k,LabelVisualElement_z)&&(this._showCallout=this._updatePosition(LabelVisualElement_k,LabelVisualElement_z),this._showText=!0);break;case"segment":this._computeLabelPositionFromSegment(this.geometry,this._distance,this._anchor,LabelVisualElement_k,LabelVisualElement_z)&&(this._showText=!0,this._showCallout=this._updatePosition(LabelVisualElement_k,LabelVisualElement_z))}this.updateVisibility(this.visible)}}_computeLabelPositionFromPoint(t,e){this.view.renderCoordsHelper.toRenderCoords(t,L);const s=this.view._stage.camera;return s.projectToRenderScreen(L,LabelVisualElement_R),!(LabelVisualElement_R[2]<0||LabelVisualElement_R[2]>1||(s.renderToScreen(LabelVisualElement_R,e),0))}_computeLabelPositionFromCorner(t,e,s,i){if(!t)return!1;const o=this.view._stage.camera;return LabelVisualElement_w(t.left,1,o,P),(0,vec2.n)(P,P),LabelVisualElement_w(t.right,0,o,LabelVisualElement_T),(0,vec2.h)(LabelVisualElement_j,P,LabelVisualElement_T),(0,vec2.n)(LabelVisualElement_j,LabelVisualElement_j),(0,vec2.e)(LabelVisualElement_j,LabelVisualElement_j),o.projectToRenderScreen(t.left.endRenderSpace,LabelVisualElement_R),!(LabelVisualElement_R[2]<0||LabelVisualElement_R[2]>1||(o.renderToScreen(LabelVisualElement_R,s),(0,vec2.a)(LabelVisualElement_j,LabelVisualElement_j,e*o.pixelRatio),(0,vec2.h)(LabelVisualElement_j,LabelVisualElement_j,LabelVisualElement_R),o.renderToScreen(LabelVisualElement_j,i),0))}_computeLabelPositionFromSegment(t,e,s,i,o){if(!t)return!1;const r=t.segment,a=this.view._stage.camera;k(r.startRenderSpace,r.endRenderSpace,P,a),(0,vec2.s)(LabelVisualElement_j,-P[1],P[0]);let n=!1;switch(s){case"top":n=LabelVisualElement_j[1]<0;break;case"bottom":n=LabelVisualElement_j[1]>0;break;case"left":n=LabelVisualElement_j[0]>0;break;case"right":n=LabelVisualElement_j[0]<0}if(n&&(0,vec2.n)(LabelVisualElement_j,LabelVisualElement_j),0===(0,vec2.l)(LabelVisualElement_j))switch(s){case"top":LabelVisualElement_j[1]=1;break;case"bottom":LabelVisualElement_j[1]=-1;break;case"left":LabelVisualElement_j[0]=-1;break;case"right":LabelVisualElement_j[0]=1}return r.eval(LabelVisualElement_H[t.sampleLocation],L),a.projectToRenderScreen(L,LabelVisualElement_R),!(LabelVisualElement_R[2]<0||LabelVisualElement_R[2]>1||(a.renderToScreen(LabelVisualElement_R,i),(0,vec2.a)(LabelVisualElement_j,LabelVisualElement_j,e*a.pixelRatio),(0,vec2.h)(LabelVisualElement_j,LabelVisualElement_j,LabelVisualElement_R),a.renderToScreen(LabelVisualElement_j,o),0))}_updatePosition(t,e){if(e){const s=e[0]-t[0],i=e[1]-t[1];return this._textItem.position=[e[0],e[1]],this._textItem.anchor=Math.abs(s)>Math.abs(i)?s>0?"left":"right":i>0?"top":"bottom",this._calloutItem.startPosition=[t[0],t[1]],this._calloutItem.endPosition=[e[0],e[1]],!0}return this._textItem.position=[t[0],t[1]],this._textItem.anchor="center",!1}createResources(){this._textItem=new TextOverlayItem({visible:!0}),this._textItem.text=(0,maybe.Wg)(this._text),this._textItem.fontSize=this._fontSize,this._calloutItem=new LineOverlayItem({visible:!0,width:2}),this._updateLabelPosition(),this.view.overlay.items.addMany([this._textItem,this._calloutItem]),this._handles.add(this.view.state.watch("camera",(()=>{this._updateLabelPosition()})))}destroyResources(){this.view.overlay&&!this.view.overlay.destroyed&&this.view.overlay.items.removeMany([this._textItem,this._calloutItem]),this._handles.removeAll()}updateVisibility(t){this._textItem.visible=this._showText&&t,this._calloutItem.visible=this._showCallout&&t}}function LabelVisualElement_w(t,e,s,i){t.eval(e,I,LabelVisualElement_S),(0,vec3.b)(LabelVisualElement_y,I,LabelVisualElement_S),s.projectToRenderScreen(I,LabelVisualElement_C),s.projectToRenderScreen(LabelVisualElement_y,M),(0,vec2.d)(i,V,F),(0,vec2.e)(i,i)}function LabelVisualElement_g(t){switch(t){case"top":return"bottom";case"right":return"left";case"bottom":return"top";case"left":return"right"}}const I=(0,vec3f64.c)(),LabelVisualElement_y=(0,vec3f64.c)(),LabelVisualElement_S=(0,vec3f64.c)(),P=(0,screenUtils.gX)(),LabelVisualElement_T=(0,screenUtils.gX)(),LabelVisualElement_j=(0,screenUtils.gX)(),L=(0,vec3f64.c)(),LabelVisualElement_R=(0,screenUtils.J$)(),LabelVisualElement_k=(0,screenUtils.s1)(),LabelVisualElement_z=(0,screenUtils.s1)(),LabelVisualElement_C=(0,screenUtils.J$)(),F=LabelVisualElement_C,M=(0,screenUtils.J$)(),V=M,LabelVisualElement_H={start:0,center:.5,end:1};var lineUtils=__webpack_require__(78641);class LineVisualElement_u extends Object3DVisualElement_a{constructor(e){super(e),this._renderOccluded=4,this._width=1,this._color=(0,vec4f32.f)(1,0,1,1),this._innerWidth=1,this._innerColor=null,this._stipplePattern=null,this._stippleOffColor=null,this._stippleIntegerRepeats=!1,this._writeDepthEnabled=!0,this._falloff=0,this._polygonOffset=!1,this.applyProps(e)}setGeometryFromExtent(e){const t=this.view.spatialReference,r=(0,vec3f64.c)(),o=(0,vec3f64.c)(),n=100,l=[];(0,vec3.s)(r,e[0],e[1],n),this.view.renderCoordsHelper.toRenderCoords(r,t,o),l.push([o[0],o[1],o[2]]),(0,vec3.s)(r,e[2],e[1],n),this.view.renderCoordsHelper.toRenderCoords(r,t,o),l.push([o[0],o[1],o[2]]),(0,vec3.s)(r,e[2],e[3],n),this.view.renderCoordsHelper.toRenderCoords(r,t,o),l.push([o[0],o[1],o[2]]),(0,vec3.s)(r,e[0],e[3],n),this.view.renderCoordsHelper.toRenderCoords(r,t,o),l.push([o[0],o[1],o[2]]),(0,vec3.s)(r,e[0],e[1],n),this.view.renderCoordsHelper.toRenderCoords(r,t,o),l.push([o[0],o[1],o[2]]),(0,vec3.s)(r,e[0],e[1],n),this.view.renderCoordsHelper.toRenderCoords(r,t,o),l.push([o[0],o[1],o[2]]),this.geometry=[l]}setGeometryFromFrustum(e){const t=[];e.lines.forEach((e=>{t.push([e.origin[0],e.origin[1],e.origin[2]]),t.push([e.endpoint[0],e.endpoint[1],e.endpoint[2]])})),this.geometry=[t]}setGeometryFromSegment(e){const t=e.endRenderSpace;(0,mat4.i)(LineVisualElement_g),(0,mat4.t)(LineVisualElement_g,LineVisualElement_g,t),this.transform=LineVisualElement_g;const{points:r}=e.createRenderGeometry(t,this.view.renderCoordsHelper);this.geometry=[r]}setGeometryFromSegments(e,t=vec3f64.Z){(0,mat4.i)(LineVisualElement_g),(0,mat4.t)(LineVisualElement_g,LineVisualElement_g,t),this.transform=LineVisualElement_g,this.geometry=e.map((e=>e.createRenderGeometry(t,this.view.renderCoordsHelper).points))}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,vec4.g)(e,this._color)||((0,vec4.c)(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(r){(0,maybe.pC)(r)?!(0,maybe.Wi)(this._innerColor)&&(0,vec4.g)(r,this._innerColor)||(this._innerColor=(0,vec4.c)((0,vec4f32.c)(),r),this._updateMaterial()):(0,maybe.pC)(this._innerColor)&&(this._innerColor=null,this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(t){const r=(0,maybe.pC)(t)!==(0,maybe.pC)(this._stipplePattern);this._stipplePattern=t,r?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(r){((0,maybe.Wi)(r)||(0,maybe.Wi)(this._stippleOffColor)||!(0,vec4.g)(r,this._stippleOffColor))&&(this._stippleOffColor=(0,maybe.pC)(r)?(0,vec4f32.a)(r):null,this._updateMaterial())}get stippleIntegerRepeats(){return this._stippleIntegerRepeats}set stippleIntegerRepeats(e){this._stippleIntegerRepeats!==e&&(this._stippleIntegerRepeats=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}createExternalResources(){this._material=new RibbonLineMaterial.U(this.materialParameters)}destroyExternalResources(){this._material=null}createGeometries(e){const t=this._createLineGeometries();if(0!==t.length)for(let r=0;r<t.length;++r){const s=(0,lineUtils.YU)(t[r]);e.addGeometry(s,this._material)}}forEachExternalMaterial(e){e(this._material)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:!1,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,stippleIntegerRepeats:this._stippleIntegerRepeats,polygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}_updateMaterial(){this.attached&&this._material.setParameterValues(this.materialParameters)}_createLineGeometries(){const e=this.geometry;if((0,maybe.Wi)(e)||0===e.length)return[];const r=[];return e.forEach((e=>{const t=e.length,s=new Float64Array(3*t);e.forEach(((e,t)=>{s[3*t+0]=e[0],s[3*t+1]=e[1],s[3*t+2]=e[2]}));const i={attributeData:{position:s},removeDuplicateStartEnd:0};r.push(i)})),r}}const LineVisualElement_g=(0,mat4f64.a)();var support_mathUtils=__webpack_require__(17154),geometry_projection=__webpack_require__(28449);class _{constructor(t=(0,vec3f64.c)(),s=(0,vec3f64.c)()){this.startRenderSpace=t,this.endRenderSpace=s,this.type="euclidean"}eval(e,i,n){return(0,vec3.e)(i,this.startRenderSpace,this.endRenderSpace,e),n&&((0,vec3.f)(n,this.endRenderSpace,this.startRenderSpace),(0,vec3.n)(n,n)),i}createRenderGeometry(e,t){const r=[],i=[],n=(t,n)=>{const c=Segment_u;(0,vec3.f)(c,t,e),r.push([c[0],c[1],c[2]]),i.push([n[0],n[1],n[2]])},c=t.worldUpAtPosition(this.eval(.5,Segment_m),stack.WM.get());return n(this.startRenderSpace,c),n(this.endRenderSpace,c),{points:r,normals:i}}}class Segment_f{constructor(t,s,r){this.startRenderSpace=t,this.endRenderSpace=s,this.renderSpatialReference=r,this.type="geodesic",this._start=(0,vec3f64.c)(),this._end=(0,vec3f64.c)(),this._pcpf=(0,projectionEllipsoid.rS)(r),this._project=(0,geometry_projection.Up)(r,this._pcpf),this._projectIn(t,this._start),this._projectIn(s,this._end)}_projectIn(e,t){this._project?(0,geometry_projection.SH)(e,this.renderSpatialReference,t,this._pcpf):(0,vec3.g)(t,e)}eval(e,i,o){if(this._project)if(o){const t=Segment_u;(0,support_mathUtils.ek)(this._start,this._end,e,i,t),(0,vec3.b)(Segment_R,i,t),(0,geometry_projection.SH)(i,this._pcpf,i,this.renderSpatialReference),(0,geometry_projection.SH)(Segment_R,this._pcpf,Segment_R,this.renderSpatialReference),(0,vec3.f)(o,Segment_R,i),(0,vec3.n)(o,o)}else(0,support_mathUtils.ZA)(this._start,this._end,e,i),(0,geometry_projection.SH)(i,this._pcpf,i,this.renderSpatialReference);else(0,vec3.e)(i,this._start,this._end,e),o&&((0,vec3.f)(o,this._end,this._start),(0,vec3.n)(o,o));return i}createRenderGeometry(e,t){const r=[],i=[],n=(t,n)=>{const c=Segment_R;(0,vec3.f)(c,t,e),r.push([c[0],c[1],c[2]]),i.push([n[0],n[1],n[2]])};for(let s=0;s<128;++s){const e=s/127,r=Segment_m,i=Segment_u;this.eval(e,r),t.worldUpAtPosition(r,i),n(r,i)}return{points:r,normals:i}}}const Segment_m=(0,vec3f64.c)(),Segment_u=(0,vec3f64.c)(),Segment_R=(0,vec3f64.c)();var InterleavedLayout=__webpack_require__(80905),GLMaterial=__webpack_require__(26701),Material=__webpack_require__(10762),ReloadableShaderModule=__webpack_require__(23240),ShaderTechnique=__webpack_require__(97853),ShaderTechniqueConfiguration=__webpack_require__(44801),DefaultVertexAttributeLocations=__webpack_require__(11379),Program=__webpack_require__(51007),renderState=__webpack_require__(36904),View_glsl=__webpack_require__(89553),MeasurementArrow_glsl=__webpack_require__(25654);class MeasurementArrowTechnique_h extends ShaderTechnique.A{constructor(r,e){super(r,e)}initializeProgram(r){const e=MeasurementArrowTechnique_h.shader.get().build();return new Program.Z(r.rctx,e.generateSource("vertex"),e.generateSource("fragment"),DefaultVertexAttributeLocations.i)}bindPass(r,e,t){View_glsl.G.bindProjectionMatrix(this.program,t.camera.projectionMatrix),this.program.setUniform1f("width",e.width),this.program.setUniform1f("outlineSize",e.outlineSize),this.program.setUniform4fv("outlineColor",e.outlineColor),this.program.setUniform1f("stripeLength",e.stripeLength),this.program.setUniform4fv("stripeEvenColor",e.stripeEvenColor),this.program.setUniform4fv("stripeOddColor",e.stripeOddColor)}bindDraw(r){View_glsl.G.bindView(this.program,r)}initializePipeline(){return(0,renderState.sm)({polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:513},depthWrite:renderState.LZ,colorWrite:renderState.BK})}get primitiveType(){return 5}}MeasurementArrowTechnique_h.shader=new ReloadableShaderModule.J(MeasurementArrow_glsl.M,(()=>__webpack_require__.e(7577).then(__webpack_require__.bind(__webpack_require__,77039))));class MeasurementArrowTechnique_d extends ShaderTechniqueConfiguration.m{constructor(){super(...arguments),this.polygonOffsetEnabled=!1}}(0,tslib_es6._)([(0,ShaderTechniqueConfiguration.o)()],MeasurementArrowTechnique_d.prototype,"polygonOffsetEnabled",void 0);class MeasurementArrowMaterial_h extends Material.F5{constructor(e){super(e,MeasurementArrowMaterial_g),this.techniqueConfig=new MeasurementArrowTechnique_d}getTechniqueConfig(){return this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset,this.techniqueConfig}dispose(){}getPassParameters(){return this.params}intersect(){}createBufferWriter(){return new MeasurementArrowMaterial_w}getGLMaterial(e){return 0===e.output?new MeasurementArrowMaterial_m(e):void 0}}class MeasurementArrowMaterial_m extends GLMaterial.Z{constructor(e){super(e),this.updateParameters()}updateParameters(){this.technique=this.techniqueRep.acquireAndReleaseExisting(MeasurementArrowTechnique_h,this.material.getTechniqueConfig(),this.technique)}beginSlot(e){return 3===e}bind(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)}}const MeasurementArrowMaterial_g={width:32,outlineSize:.2,outlineColor:[1,.5,0,1],stripeLength:1,stripeEvenColor:[1,1,1,1],stripeOddColor:[1,.5,0,1],polygonOffset:!1,...Material.zh},MeasurementArrowMaterial_d=(0,InterleavedLayout.U$)().vec3f("position").vec3f("normal").vec2f("uv0").f32("auxpos1"),MeasurementArrowMaterial_v=(0,vec3f64.c)(),MeasurementArrowMaterial_q=(0,vec3f64.c)(),MeasurementArrowMaterial_b=(0,vec3f64.c)(),MeasurementArrowMaterial_x=(0,vec3f64.c)(),MeasurementArrowMaterial_C=(0,vec3f64.c)();class MeasurementArrowMaterial_w{constructor(){this.vertexBufferLayout=MeasurementArrowMaterial_d}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 2*(e.indices.get("position").length/2+1)}write(e,a,c,u){const f=a.vertexAttributes.get("position").data,l=a.vertexAttributes.get("normal").data,p=f.length/3,h=a&&a.indices&&a.indices.get("position");h&&h.length!==2*(p-1)&&console.warn("MeasurementArrowMaterial does not support indices");const m=MeasurementArrowMaterial_v,g=MeasurementArrowMaterial_q,d=MeasurementArrowMaterial_b,w=MeasurementArrowMaterial_x,P=MeasurementArrowMaterial_C,j=e.transformation,y=e.invTranspTransformation,L=c.position,M=c.normal,A=c.uv0;let T=0;for(let v=0;v<p;++v){const e=3*v;if((0,vec3.s)(m,f[e],f[e+1],f[e+2]),v<p-1){const e=3*(v+1);(0,vec3.s)(g,f[e],f[e+1],f[e+2]),(0,vec3.s)(P,l[e],l[e+1],l[e+2]),(0,vec3.n)(P,P),(0,vec3.f)(d,g,m),(0,vec3.n)(d,d),(0,vec3.c)(w,P,d),(0,vec3.n)(w,w)}const a=(0,vec3.k)(m,g);j&&y&&((0,vec3.i)(m,m,j),(0,vec3.i)(g,g,j),(0,vec3.i)(w,w,y));const c=u+2*v,h=c+1;L.setVec(c,m),L.setVec(h,m),M.setVec(c,w),M.setVec(h,w),A.set(c,0,T),A.set(c,1,-1),A.set(h,0,T),A.set(h,1,1),v<p-1&&(T+=a)}const B=c.auxpos1;for(let t=0;t<2*p;++t)B.set(u+t,T)}}class MeasurementArrowVisualElement_d extends Object3DVisualElement_a{constructor(e){super(e),this._parameters=MeasurementArrowVisualElement_c,this._handles=null,this._origin=(0,vec3f64.c)(),this._originTransform=(0,mat4f64.a)(),this._arrowCenter=(0,vec3f64.c)(),this._renderOccluded=4,this._geometry=null,this._stripeLength=1,this._stripesEnabled=!0,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._arrowMaterial&&this._arrowMaterial.setParameterValues({renderOccluded:e}))}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.geometryChanged()}get stripeLength(){return this._stripeLength}set stripeLength(e){this._stripeLength=e,this.attached&&this._arrowMaterial.setParameterValues({stripeLength:this._stripeLength})}get stripesEnabled(){return this._stripesEnabled}set stripesEnabled(e){if(this._stripesEnabled=e,this.attached){const e=this._stripesEnabled?this._parameters.arrowStripeEvenColor:this._parameters.arrowStripeOddColor;this._arrowMaterial.setParameterValues({stripeEvenColor:e})}}createExternalResources(){const e=this._stripesEnabled?this._parameters.arrowStripeEvenColor:this._parameters.arrowStripeOddColor;this._arrowMaterial=new MeasurementArrowMaterial_h({outlineColor:this._parameters.arrowOutlineColor,stripeEvenColor:e,stripeOddColor:this._parameters.arrowStripeOddColor,renderOccluded:this.renderOccluded,polygonOffset:!0}),this._handles=new Handles.Z,this._handles.add(this.view.state.watch("camera",(()=>{this.viewChanged()})))}destroyExternalResources(){this._arrowMaterial=null,this._handles.destroy(),this._handles=null}forEachExternalMaterial(e){e(this._arrowMaterial)}createGeometries(r){if((0,maybe.Wi)(this._geometry)||(0,maybe.Wi)(this._geometry.startRenderSpace)||(0,maybe.Wi)(this._geometry.endRenderSpace))return;const t=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);r.addGeometry(t,this._arrowMaterial,this._originTransform),this.viewChanged()}_createArrowGeometry(e,r,t,i){const a=this.view.renderCoordsHelper,h=[],l=[],d=(e,r)=>{const i=stack.WM.get();(0,vec3.f)(i,e,t),h.push(i),l.push(r)};if("euclidean"===i.type){i.eval(.5,this._arrowCenter);const t=stack.WM.get();a.worldUpAtPosition(this._arrowCenter,t),d(e,t),d(r,t)}else{i.eval(.5,this._arrowCenter);const e=this._parameters.arrowSubdivisions+1&-2;for(let r=0;r<e;++r){const t=r/(e-1),s=stack.WM.get(),n=stack.WM.get();i.eval(t,s),a.worldUpAtPosition(s,n),d(s,n)}}return GeometryUtil.Z.createPolylineGeometry(h,l)}geometryChanged(){this.recreateGeometry()}viewChanged(){if(this.view.ready&&this.attached&&(0,maybe.pC)(this._geometry)){const e=this.view._stage.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameterValues({width:this._parameters.arrowWidth*e})}}}const MeasurementArrowVisualElement_c={arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128};let DirectLineMeasurement3DView_U=class extends Accessor.Z{constructor(e){super(e),this._params={...B},this._handles=new Handles.Z,this._segmentVisualElement=null,this._triangleVisualElement=null,this._rightAngleQuad=null,this._projectedGeodesicLine=null,this._geodesicStartHint=null,this._geodesicEndHint=null,this._segmentLabel=null,this._verticalLabel=null,this._horizontalLabel=null,this._segmentLabelDisplayedMeasurement="euclidean",this._startPosition=(0,vec3f64.c)(),this._endPosition=(0,vec3f64.c)(),this._cornerPosition=(0,vec3f64.c)(),this._startPositionAtSeaLevel=(0,vec3f64.c)(),this._endPositionAtSeaLevel=(0,vec3f64.c)(),this._viewMode="none",this._geometryDirty=!0,this.state="pending",this.messages=null,this._visualizedMeasurement="auto",this._actualVisualizedMeasurement="euclidean",this._visualElementOrientation="auto",this._triangleOrientationOverride=null,this._triangleCollapseRatioThreshold=.03,this._geodesicDistanceThreshold=1e5}initialize(){this._handles.add((0,watchUtils.N1)(this.view,"ready",(()=>this._initialize()),!0))}_initialize(){switch(this.state){case"ready":throw new Error("invalid state");case"destroyed":return}this._segmentVisualElement=new MeasurementArrowVisualElement_d({attached:!0,view:this.view,geometry:null,renderOccluded:4}),this._triangleVisualElement=new LineVisualElement_u({attached:!0,view:this.view,width:this._params.triangleLineWidth,color:this._params.triangleColor,renderOccluded:4}),this._rightAngleQuad=new y({attached:!0,view:this.view,color:DirectLineMeasurement3DView_I,renderOccluded:4}),this._projectedGeodesicLine=new LineVisualElement_u({attached:!0,view:this.view,width:this._params.geodesicProjectionLineWidth,color:this._params.geodesicProjectionLineColor,polygonOffset:!0,stipplePattern:(0,lineStippleUtils.z5)(this._params.guideStippleLengthPixels),stippleIntegerRepeats:!1,renderOccluded:4}),this._geodesicStartHint=new LineVisualElement_u({attached:!0,view:this.view,width:this._params.guideLineWidth,color:this._params.geodesicProjectionLineColor,polygonOffset:!0,stipplePattern:(0,lineStippleUtils.z5)(this._params.guideStippleLengthPixels),stippleIntegerRepeats:!1,renderOccluded:4}),this._geodesicEndHint=new LineVisualElement_u({attached:!0,view:this.view,width:this._params.guideLineWidth,color:this._params.geodesicProjectionLineColor,polygonOffset:!0,stipplePattern:(0,lineStippleUtils.z5)(this._params.guideStippleLengthPixels),stippleIntegerRepeats:!1,renderOccluded:4}),this._segmentLabel=new LabelVisualElement_f({attached:!0,view:this.view,fontSize:this._params.direcLabelFontSize}),this._verticalLabel=new LabelVisualElement_f({attached:!0,view:this.view,fontSize:this._params.verticalLabelFontSize}),this._horizontalLabel=new LabelVisualElement_f({attached:!0,view:this.view,fontSize:this._params.horizontalLabelFontSize}),this._handles.add([this.dataObject.watch("visible",(()=>this._update(!1)),!0),this.dataObject.watch("startPoint",(()=>this._update()),!0),this.dataObject.watch("endPoint",(()=>this._update()),!0),this.dataObject.watch("measurement",(()=>this._update()),!0),this.dataObject.watch("settings.unit",(()=>{this._updateLabels(),this._updateSegmentStripeLength()}),!0),this.view.state.watch("camera",(()=>this._update()),!0),(0,locale.qe)((async()=>this._updateMessageBundle()))]),this._set("state","ready"),this._updateMessageBundle(),this._update()}async whenReady(){return(0,watchUtils.N1)(this,"ready").then((()=>{}))}get ready(){return"ready"===this.state}get viewMode(){return this._viewMode}get visualizedMeasurement(){return this._visualizedMeasurement}set visualizedMeasurement(e){e!==this._visualizedMeasurement&&(this._visualizedMeasurement=e,this._update())}get actualVisualizedMeasurement(){return this._actualVisualizedMeasurement}get visualElementsOrientation(){return this._visualElementOrientation}set visualElementsOrientation(e){e!==this._visualElementOrientation&&(this._visualElementOrientation=e,this._update())}get allowVisualElementsOrientationChange(){return(0,maybe.Wi)(this._triangleOrientationOverride)}set allowVisualElementsOrientationChange(e){(0,maybe.Wi)(this._triangleOrientationOverride)!==e&&((0,maybe.Wi)(this._triangleOrientationOverride)?this._triangleOrientationOverride=this._getActualVisualElementsOrientation():(this._triangleOrientationOverride=null,this._update()))}get triangleCollapseRatioThreshold(){return this._triangleCollapseRatioThreshold}set triangleCollapseRatioThreshold(e){this._triangleCollapseRatioThreshold=e,this._update()}get geodesicDistanceThreshold(){return this._geodesicDistanceThreshold}set geodesicDistanceThreshold(e){this._geodesicDistanceThreshold=e,this._update()}get segmentLabel(){return this._segmentLabel}get horizontalLabel(){return this._horizontalLabel}get verticalLabel(){return this._verticalLabel}get testData(){let e=null;const t="geodesic"===this.actualVisualizedMeasurement;return e={direct:t?this.horizontalLabel:this.segmentLabel,horizontal:t?this.segmentLabel:this.horizontalLabel,vertical:this.verticalLabel},{labels:e,stripeLength:this._segmentVisualElement.stripeLength}}_update(e=!0){switch(this.state){case"destroyed":case"pending":return}const t=this.dataObject.visible;switch(this._geometryDirty=e,this._geometryDirty&&t&&(this._updateGeometryAndViewMode(),this._geometryDirty=!1),this._viewMode){case"none":this._segmentVisualElement.visible=!1,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1;break;case"segment":this._segmentVisualElement.visible=t,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1;break;case"segment-and-triangle":this._segmentVisualElement.visible=t,this._triangleVisualElement.visible=t,this._rightAngleQuad.visible=t,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1;break;case"segment-and-projection":this._segmentVisualElement.visible=t,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}this._updateLabels()}destroy(){switch(this.state){case"destroyed":case"pending":return}this._handles.destroy(),this._segmentVisualElement.destroy(),this._segmentVisualElement=null,this._triangleVisualElement.destroy(),this._triangleVisualElement=null,this._rightAngleQuad.destroy(),this._rightAngleQuad=null,this._projectedGeodesicLine.destroy(),this._projectedGeodesicLine=null,this._geodesicStartHint.destroy(),this._geodesicStartHint=null,this._geodesicEndHint.destroy(),this._geodesicEndHint=null,this._segmentLabel.destroy(),this._segmentLabel=null,this._verticalLabel.destroy(),this._verticalLabel=null,this._horizontalLabel.destroy(),this._horizontalLabel=null,this.set("view",null),this._set("state","destroyed")}_updateGeometryAndViewMode(){const e=this.view,i=e.renderCoordsHelper;if((0,maybe.Wi)(this.dataObject.startPoint)||(0,maybe.Wi)(this.dataObject.endPoint)||this.dataObject.startPoint.equals(this.dataObject.endPoint))return this._viewMode="none",void(this._actualVisualizedMeasurement="auto"===this._visualizedMeasurement?"euclidean":this._visualizedMeasurement);i.toRenderCoords(this.dataObject.startPoint,this._startPosition),i.toRenderCoords(this.dataObject.endPoint,this._endPosition);const s=this._getActualVisualElementsOrientation(),a=this._updateActualVisualizedMeasurement();this._viewMode=this._computeViewMode(a);let n=this._startPosition,r=this._endPosition;const o="above-segment"===s?1:-1,l=o*(i.getAltitude(r)-i.getAltitude(n));l<0&&(n=this._endPosition,r=this._startPosition);const h="geodesic"===a?new Segment_f(this._startPosition,this._endPosition,i.spatialReference):new _(this._startPosition,this._endPosition);switch(this._segmentVisualElement.geometry=h,this._updateSegmentStripeLength(),this._segmentLabelDisplayedMeasurement=a,this._viewMode){case"segment":this._segmentLabel.anchor="above-segment"===s?"top":"bottom",this._segmentLabel.geometry={type:"segment",segment:h,sampleLocation:"center"};break;case"segment-and-triangle":{const t=this._cornerPosition;i.worldUpAtPosition(n,t),(0,vec3.a)(t,t,o*Math.abs(l)),(0,vec3.b)(t,t,n),this._triangleVisualElement.geometry=[[[n[0],n[1],n[2]],[t[0],t[1],t[2]],[r[0],r[1],r[2]]]],this._rightAngleQuad.geometry={previous:n,center:t,next:r};const a=new _(n,t),c=new _(t,r),d=function W(e,t,i,s,a){const n=J,r=K;a.projectToRenderScreen(i,n),a.projectToRenderScreen(t,r);const l={segment:"bottom",horizontal:"top",vertical:n[0]<r[0]?"left":"right"};{const s=N,n=X;if(k(e,i,s,a),k(e,t,n,a),(0,vec2.g)(s,n)>=DirectLineMeasurement3DView_q)l.segment=(0,mathUtils.Xx)(s[1])===(0,mathUtils.Xx)(n[1])?LabelVisualElement_g(l.vertical):l.vertical;else{const e=Y;k(i,t,e,a),(0,vec2.g)(e,n)>=DirectLineMeasurement3DView_q&&(l.segment=(0,mathUtils.Xx)(e[0])===(0,mathUtils.Xx)(n[0])?LabelVisualElement_g(l.horizontal):l.horizontal)}}if("below-segment"===s){const e=e=>"top"===e?"bottom":"top";l.segment=e(l.segment),l.horizontal=e(l.horizontal),l.vertical=e(l.vertical)}return l}(n,r,t,s,e.state.camera);this._segmentLabel.geometry={type:"segment",segment:h,sampleLocation:"center"},this._segmentLabel.anchor=d.segment,this._verticalLabel.geometry={type:"segment",segment:a,sampleLocation:"center"},this._verticalLabel.anchor=d.vertical,this._horizontalLabel.geometry={type:"segment",segment:c,sampleLocation:"center"},this._horizontalLabel.anchor=d.horizontal;break}case"segment-and-projection":{(0,vec3.g)(this._startPositionAtSeaLevel,this._startPosition),(0,vec3.g)(this._endPositionAtSeaLevel,this._endPosition),i.setAltitude(0,this._startPositionAtSeaLevel),i.setAltitude(0,this._endPositionAtSeaLevel);const e=new Segment_f(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,i.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(e),this._geodesicStartHint.setGeometryFromSegment(new _(this._startPositionAtSeaLevel,this._startPosition)),this._geodesicEndHint.setGeometryFromSegment(new _(this._endPositionAtSeaLevel,this._endPosition)),this._segmentLabel.geometry={type:"segment",segment:e,sampleLocation:"center"},this._segmentLabel.anchor="above-segment"===s?"top":"bottom";break}}}_updateLabels(){switch(this.state){case"pending":case"destroyed":return}const e=this.messages,i=this.dataObject.measurement;if((0,maybe.Wi)(i)||!e)return this._segmentLabel.visible=!1,this._horizontalLabel.visible=!1,void(this._verticalLabel.visible=!1);const s={verticalDistance:"",horizontalDistance:"",euclideanDistance:"",geodesicDistance:""},a=i.directDistance,n=i.horizontalDistance,r=i.verticalDistance,o=i.geodesicDistance,l=i.geodesicAngle;switch(this.dataObject.settings.unit){case"metric":s.euclideanDistance=a&&quantityFormatUtils_f(e,a),s.horizontalDistance=n&&quantityFormatUtils_f(e,n),s.verticalDistance=r&&function quantityFormatUtils_s(r,t,n=2,e="abbr"){if("length"!==t.measure)throw new Error("quantity is not a length");return(0,unitFormatUtils.Wv)(r,t.value,t.unit,n,e)}(e,r),s.geodesicDistance=o&&quantityFormatUtils_f(e,o);break;case"imperial":s.euclideanDistance=a&&quantityFormatUtils_h(e,a),s.horizontalDistance=n&&quantityFormatUtils_h(e,n),s.verticalDistance=r&&function b(r,t,a=2,n="abbr"){if("length"!==t.measure)throw new Error("quantity is not a length");return(0,unitFormatUtils.Zv)(r,t.value,t.unit,a,n)}(e,r),s.geodesicDistance=o&&quantityFormatUtils_h(e,o);break;case"degrees":{const t=l&&quantityFormatUtils_l(e,l,"degrees");s.euclideanDistance=t,s.horizontalDistance=t,s.geodesicDistance=t;break}case"degrees-minutes-seconds":s.horizontalDistance=l&&function g(r){if("angle"!==r.measure)throw new Error("quantity is not an angle");return(0,unitFormatUtils.Bs)(r.value,r.unit)}(l);break;default:{const t=this.dataObject.settings.unit;s.euclideanDistance=a&&quantityFormatUtils_l(e,a,t),s.horizontalDistance=n&&quantityFormatUtils_l(e,n,t),s.verticalDistance=r&&quantityFormatUtils_l(e,r,t),s.geodesicDistance=o&&quantityFormatUtils_l(e,o,t);break}}this._segmentLabel.text="euclidean"===this._segmentLabelDisplayedMeasurement?s.euclideanDistance:s.geodesicDistance,this._horizontalLabel.text=s.horizontalDistance,this._verticalLabel.text=s.verticalDistance;const h=this.dataObject.visible;switch(this._viewMode){case"none":this._segmentLabel.visible=!1,this._horizontalLabel.visible=!1,this._verticalLabel.visible=!1;break;case"segment":this._segmentLabel.visible=h,this._horizontalLabel.visible=!1,this._verticalLabel.visible=!1;break;case"segment-and-triangle":this._segmentLabel.visible=h,this._horizontalLabel.visible=h,this._verticalLabel.visible=h;break;case"segment-and-projection":this._segmentLabel.visible=h,this._horizontalLabel.visible=!1,this._verticalLabel.visible=!1}this.notifyChange("segmentLabel"),this.notifyChange("horizontalLabel"),this.notifyChange("verticalLabel")}_updateSegmentStripeLength(){const e=function Q(e,t){let s=null;if((0,maybe.pC)(t.measurement)){const e=t.measurement.directDistance;switch(t.settings.unit){case"metric":s=e&&e.toUnit("meters");break;case"imperial":s=e&&e.toUnit((0,unitUtils.FN)(e.value,e.unit));break;case"degrees":case"degrees-minutes-seconds":{const e=t.measurement.geodesicAngle;s=e&&e.toUnit("degrees");break}default:s=e&&e.toUnit(t.settings.unit)}}if(s){let t=1;return t=(0,mathUtils.sk)(s.value/30),t*="degrees"===s.unit?(0,projectionEllipsoid.Iu)(e.spatialReference).metersPerDegree:(0,unitUtils.En)(1,s.unit,"meters"),t}return null}(this.view,this.dataObject);(0,maybe.pC)(e)?(this._segmentVisualElement.stripeLength=e,this._segmentVisualElement.stripesEnabled=!0):this._segmentVisualElement.stripesEnabled=!1}_computeViewMode(e){const i=this.dataObject,s=i.measurement;if("geodesic"===e){if(!DirectLineMeasurement3DView_x(i,this.geodesicDistanceThreshold))return"segment";if(DirectLineMeasurement3DView_F(this.view,this._startPosition)||DirectLineMeasurement3DView_F(this.view,this._endPosition))return"segment-and-projection"}return(0,maybe.Wi)(s)||Math.min(s.verticalDistance.value/s.horizontalDistance.value,s.horizontalDistance.value/s.verticalDistance.value)<this.triangleCollapseRatioThreshold?"segment":"segment-and-triangle"}_getActualVisualElementsOrientation(){return(0,maybe.pC)(this._triangleOrientationOverride)?this._triangleOrientationOverride:"auto"===this.visualElementsOrientation?this.view.state.camera.aboveGround?"above-segment":"below-segment":this.visualElementsOrientation}_updateActualVisualizedMeasurement(){if("auto"===this._visualizedMeasurement){this._actualVisualizedMeasurement="euclidean";const e=this.dataObject.settings.unit;"degrees"!==e&&"degrees-minutes-seconds"!==e||(this._actualVisualizedMeasurement="geodesic"),DirectLineMeasurement3DView_x(this.dataObject,this.geodesicDistanceThreshold)&&(this._actualVisualizedMeasurement="geodesic")}else this._actualVisualizedMeasurement=this._visualizedMeasurement;return this._actualVisualizedMeasurement}_updateMessageBundle(){(0,messages.ME)("esri/core/t9n/Units").then((e=>{this.messages=e,this.view&&this._updateLabels()}))}};function DirectLineMeasurement3DView_x(e,t){return(0,maybe.pC)(e.measurement)&&e.measurement.horizontalDistance&&e.measurement.horizontalDistance.value>t}function DirectLineMeasurement3DView_F(e,t){if(!e.state)return!1;const i=e.state.camera,s=e.renderCoordsHelper,a=i.computeScreenPixelSizeAt(t);return s.getAltitude(t)/a>=10}(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],DirectLineMeasurement3DView_U.prototype,"state",void 0),(0,tslib_es6._)([(0,property.Cb)()],DirectLineMeasurement3DView_U.prototype,"ready",null),(0,tslib_es6._)([(0,property.Cb)()],DirectLineMeasurement3DView_U.prototype,"messages",void 0),(0,tslib_es6._)([(0,property.Cb)()],DirectLineMeasurement3DView_U.prototype,"view",void 0),(0,tslib_es6._)([(0,property.Cb)()],DirectLineMeasurement3DView_U.prototype,"dataObject",void 0),(0,tslib_es6._)([(0,property.Cb)()],DirectLineMeasurement3DView_U.prototype,"viewMode",null),(0,tslib_es6._)([(0,property.Cb)()],DirectLineMeasurement3DView_U.prototype,"segmentLabel",null),(0,tslib_es6._)([(0,property.Cb)()],DirectLineMeasurement3DView_U.prototype,"horizontalLabel",null),(0,tslib_es6._)([(0,property.Cb)()],DirectLineMeasurement3DView_U.prototype,"verticalLabel",null),DirectLineMeasurement3DView_U=(0,tslib_es6._)([(0,subclass.j)("esri.views.3d.interactive.graphics.DirectLineMeasurement3D.DirectLineMeasurement3DView")],DirectLineMeasurement3DView_U);const DirectLineMeasurement3DView_I=(0,vec4f32.f)(1,.5,0,.75),B={laserLineGlowColor:[1,.5,0],laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:[1,1,1],laserLineInnerWidth:.75,laserLineGlobalAlpha:.75,laserLineEnabled:!0,handleColor:[1,.5,0],handleOpacity:.5,handleRadius:5,triangleColor:DirectLineMeasurement3DView_I,triangleLineWidth:3,triangleCornerSize:32,triangleSubdivisions:128,arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128,geodesicProjectionLineWidth:2,geodesicProjectionLineColor:DirectLineMeasurement3DView_I,guideLineWidth:2,guideLineColor:DirectLineMeasurement3DView_I,guideStippleLengthPixels:6,labelDistance:25,direcLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12},DirectLineMeasurement3DView_q=Math.cos((0,mathUtils.Vl)(12)),J=(0,screenUtils.J$)(),K=(0,screenUtils.J$)(),N=(0,screenUtils.gX)(),X=(0,screenUtils.gX)(),Y=(0,screenUtils.gX)()}}]);
//# sourceMappingURL=9698.11f24cd3.iframe.bundle.js.map