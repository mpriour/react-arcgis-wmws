"use strict";(self.webpackChunkreact_arcgis_wmws=self.webpackChunkreact_arcgis_wmws||[]).push([[2052],{91103:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{lm:()=>j,CS:()=>g,Yu:()=>b,Cw:()=>d,j5:()=>S});var _core_lang_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(67134),_config_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(51366),_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(3466),_geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(14685),_geometry_support_boundsUtils_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(79880),_PopupTemplate_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(80020),_kernel_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(88256),_request_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(40457),_renderers_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(72506),_tasks_support_FeatureSet_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(41017),_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(37116);const c={esriGeometryPoint:"points",esriGeometryPolyline:"polylines",esriGeometryPolygon:"polygons"};function d(o){const t=o.folders||[],r=t.slice(),s=new Map,n=new Map,i=new Map,a=new Map,f=new Map,l={esriGeometryPoint:n,esriGeometryPolyline:i,esriGeometryPolygon:a};(o.featureCollection&&o.featureCollection.layers||[]).forEach((o=>{const t=(0,_core_lang_js__WEBPACK_IMPORTED_MODULE_0__.d9)(o);t.featureSet.features=[];const r=o.featureSet.geometryType;s.set(r,t);const f=o.layerDefinition.objectIdField;"esriGeometryPoint"===r?G(n,f,o.featureSet.features):"esriGeometryPolyline"===r?G(i,f,o.featureSet.features):"esriGeometryPolygon"===r&&G(a,f,o.featureSet.features)})),o.groundOverlays&&o.groundOverlays.forEach((e=>{f.set(e.id,e)})),t.forEach((e=>{e.networkLinkIds.forEach((t=>{const s=function P(e,o,t){const r=function h(e,o){let t;return o.some((o=>o.id===e&&(t=o,!0))),t}(e,t);return r&&(r.parentFolderId=o,r.networkLink=r),r}(t,e.id,o.networkLinks);s&&r.push(s)}))})),r.forEach((o=>{o.featureInfos&&(o.points=(0,_core_lang_js__WEBPACK_IMPORTED_MODULE_0__.d9)(s.get("esriGeometryPoint")),o.polylines=(0,_core_lang_js__WEBPACK_IMPORTED_MODULE_0__.d9)(s.get("esriGeometryPolyline")),o.polygons=(0,_core_lang_js__WEBPACK_IMPORTED_MODULE_0__.d9)(s.get("esriGeometryPolygon")),o.mapImages=[],o.featureInfos.map((e=>{switch(e.type){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryPolygon":{const t=l[e.type].get(e.id);t&&o[c[e.type]].featureSet.features.push(t);break}case"GroundOverlay":{const t=f.get(e.id);t&&o.mapImages.push(t);break}}})),o.fullExtent=j([o]))}));const u=j(r);return{folders:t,sublayers:r,extent:u}}function g(e,r,s,n){const f=_kernel_js__WEBPACK_IMPORTED_MODULE_6__.id&&_kernel_js__WEBPACK_IMPORTED_MODULE_6__.id.findCredential(e);e=(0,_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_2__.fl)(e,{token:f&&f.token});const l=_config_js__WEBPACK_IMPORTED_MODULE_1__.Z.kmlServiceUrl;return(0,_request_js__WEBPACK_IMPORTED_MODULE_7__.default)(l,{query:{url:e,model:"simple",folders:"",refresh:0!==s||void 0,outSR:JSON.stringify(r)},responseType:"json",signal:n})}function S(e,o,t=null,r=[]){const s=[],n={},i=o.sublayers,a=o.folders.map((e=>e.id));return i.forEach((o=>{const i=new e;if(t?i.read(o,t):i.read(o),r.length&&a.indexOf(i.id)>-1&&(i.visible=-1!==r.indexOf(i.id)),n[o.id]=i,null!=o.parentFolderId&&-1!==o.parentFolderId){const e=n[o.parentFolderId];e.sublayers||(e.sublayers=[]),e.sublayers.unshift(i)}else s.unshift(i)})),s}function G(e,o,t){t.forEach((t=>{e.set(t.attributes[o],t)}))}async function b(e){const o=_tasks_support_FeatureSet_js__WEBPACK_IMPORTED_MODULE_9__.default.fromJSON(e.featureSet).features,t=e.layerDefinition,r=(0,_renderers_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_8__.im)(t.drawingInfo.renderer),s=_PopupTemplate_js__WEBPACK_IMPORTED_MODULE_5__.Z.fromJSON(e.popupInfo),i=[];for(const n of o){const e=await r.getSymbolAsync(n);n.symbol=e,n.popupTemplate=s,n.visible=!0,i.push(n)}return i}function j(e){const o=(0,_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_10__.Ue)(),t=(0,_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_10__.Ue)(_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_10__.Gv);for(const r of e){if(r.polygons&&r.polygons.featureSet&&r.polygons.featureSet.features)for(const e of r.polygons.featureSet.features)(0,_geometry_support_boundsUtils_js__WEBPACK_IMPORTED_MODULE_4__.Yg)(o,e.geometry),(0,_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_10__.TC)(t,o);if(r.polylines&&r.polylines.featureSet&&r.polylines.featureSet.features)for(const e of r.polylines.featureSet.features)(0,_geometry_support_boundsUtils_js__WEBPACK_IMPORTED_MODULE_4__.Yg)(o,e.geometry),(0,_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_10__.TC)(t,o);if(r.points&&r.points.featureSet&&r.points.featureSet.features)for(const e of r.points.featureSet.features)(0,_geometry_support_boundsUtils_js__WEBPACK_IMPORTED_MODULE_4__.Yg)(o,e.geometry),(0,_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_10__.TC)(t,o);if(r.mapImages)for(const e of r.mapImages)(0,_geometry_support_boundsUtils_js__WEBPACK_IMPORTED_MODULE_4__.Yg)(o,e.extent),(0,_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_10__.TC)(t,o)}return(0,_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_10__.fS)(t,_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_10__.Gv)?null:{xmin:t[0],ymin:t[1],zmin:t[2],xmax:t[3],ymax:t[4],zmax:t[5],spatialReference:_geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_3__.Z.WGS84}}},86602:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{e:()=>_});__webpack_require__(39994);var _chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1662),_chunks_mat3f32_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(19710),_chunks_vec2f32_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(55542),_webgl_Texture_js__WEBPACK_IMPORTED_MODULE_6__=(__webpack_require__(88338),__webpack_require__(6174),__webpack_require__(43487)),_DisplayObject_js__WEBPACK_IMPORTED_MODULE_8__=(__webpack_require__(18567),__webpack_require__(51118)),_ImageryBitmapSource_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(7349);function x(t,e,i){const s={target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071};return e&&i&&(s.width=e,s.height=i),new _webgl_Texture_js__WEBPACK_IMPORTED_MODULE_6__.Z(t,s)}class _ extends _DisplayObject_js__WEBPACK_IMPORTED_MODULE_8__.s{constructor(t=null,e,i=!0){super(),this.requestRenderOnSourceChangedEnabled=i,this._textureInvalidated=!0,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.transforms={dvs:(0,_chunks_mat3f32_js__WEBPACK_IMPORTED_MODULE_2__.c)()},this.blendFunction=e,this.source=t,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null)}get isSourceScaled(){return this.width!==this.sourceWidth||this.height!==this.sourceHeight}get height(){return void 0!==this._height?this._height:this.sourceHeight}set height(t){this._height=t}get source(){return this._source}set source(t){this._source=t,this.invalidateTexture()}get sourceHeight(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height}get sourceWidth(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width}get width(){return void 0!==this._width?this._width:this.sourceWidth}set width(t){this._width=t}beforeRender(t){super.beforeRender(t),this.updateTexture(t)}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRenderOnSourceChangedEnabled&&this.requestRender())}setTransform(h){const o=(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.i)(this.transforms.dvs),[u,a]=h.toScreenNoRotation([0,0],this.x,this.y),d=this.resolution/this.pixelRatio/h.resolution,c=d*this.width,l=d*this.height,x=Math.PI*this.rotation/180;(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.a)(o,o,(0,_chunks_vec2f32_js__WEBPACK_IMPORTED_MODULE_3__.f)(u,a)),(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.a)(o,o,(0,_chunks_vec2f32_js__WEBPACK_IMPORTED_MODULE_3__.f)(c/2,l/2)),(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.r)(o,o,-x),(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.a)(o,o,(0,_chunks_vec2f32_js__WEBPACK_IMPORTED_MODULE_3__.f)(-c/2,-l/2)),(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.j)(o,o,(0,_chunks_vec2f32_js__WEBPACK_IMPORTED_MODULE_3__.f)(c,l)),(0,_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.m)(this.transforms.dvs,h.displayViewMat3,o)}setSamplingProfile(t){this._texture&&(t.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(t.samplingMode))}bind({context:t},e){this._texture&&t.bindTexture(this._texture,e)}updateTexture({context:t}){var e;if(!this.stage)return null==(e=this._texture)||e.dispose(),void(this._texture=null);if(!this._textureInvalidated)return;this._textureInvalidated=!1,this._texture||(this.source?this._texture=x(t,this.sourceWidth,this.sourceHeight):this._texture=x(t));const i=this.source;if(i){if(this._texture.resize(this.sourceWidth,this.sourceHeight),function d(t){return t&&"render"in t}(i))if(i instanceof _ImageryBitmapSource_js__WEBPACK_IMPORTED_MODULE_9__.Z){const t=i.getRenderedRasterPixels();this._texture.setData(t.renderedRasterPixels)}else this._texture.setData(function l(t){const e=document.createElement("canvas");return e.width=t.width,e.height=t.height,t.render(e.getContext("2d")),e}(i));else(function c(t){return t&&!("render"in t)})(i)&&this._texture.setData(i);this.ready()}else this._texture.setData(null)}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}}},12688:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{c:()=>t});var _webgl_enums_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(38716),_brushes_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(96467),_webgl_WGLContainer_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(10994);class t extends _webgl_WGLContainer_js__WEBPACK_IMPORTED_MODULE_2__.Z{get requiresDedicatedFBO(){return this.children.some((e=>"additive"===e.blendFunction))}prepareRenderPasses(s){const t=s.registerRenderPass({name:"bitmap",brushes:[_brushes_js__WEBPACK_IMPORTED_MODULE_1__.U.bitmap],target:()=>this.children,drawPhase:_webgl_enums_js__WEBPACK_IMPORTED_MODULE_0__.jx.MAP});return[...super.prepareRenderPasses(s),t]}}},7349:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});const __WEBPACK_DEFAULT_EXPORT__=class e{constructor(e,t,i){this.pixelBlock=e,this.extent=t,this.originalPixelBlock=i}get width(){return this.pixelBlock?this.pixelBlock.width:0}get height(){return this.pixelBlock?this.pixelBlock.height:0}render(e){const t=this.pixelBlock;if(!t)return;const i=this.filter({pixelBlock:t}),l=i.pixelBlock.getAsRGBA(),h=e.createImageData(i.pixelBlock.width,i.pixelBlock.height);h.data.set(l),e.putImageData(h,0,0)}getRenderedRasterPixels(){const e=this.filter({pixelBlock:this.pixelBlock});return{width:e.pixelBlock.width,height:e.pixelBlock.height,renderedRasterPixels:new Uint8Array(e.pixelBlock.getAsRGBA().buffer)}}}},22052:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__(36663),_core_maybe_js__WEBPACK_IMPORTED_MODULE_25__=(__webpack_require__(39994),__webpack_require__(61681)),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__=(__webpack_require__(13802),__webpack_require__(7283),__webpack_require__(81977)),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(12571),_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(3466),_geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_8__=(__webpack_require__(12173),__webpack_require__(51876),__webpack_require__(14685)),_geometry_support_webMercatorUtils_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(39536),_geometry_Extent_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(91772),_core_Collection_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(66591),_kernel_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(88256),_request_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(40457),_core_Handles_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(44584),_geometry_projection_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(83614),_rest_utils_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(84238),_support_GraphicsCollection_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(94449),_layers_support_kmlUtils_js__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(91103),_layers_LayerView_js__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(26216),_graphics_GraphicsView2D_js__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(33500),_graphics_GraphicContainer_js__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(68114),_engine_Bitmap_js__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(86602),_engine_BitmapContainer_js__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(12688),_LayerView2D_js__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(80347);class j{constructor(){this.allSublayers=new Map,this.allPoints=[],this.allPolylines=[],this.allPolygons=[],this.allMapImages=[]}}let C=class extends((0,_LayerView2D_js__WEBPACK_IMPORTED_MODULE_24__.y)(_layers_LayerView_js__WEBPACK_IMPORTED_MODULE_19__.Z)){constructor(){super(...arguments),this._handles=new _core_Handles_js__WEBPACK_IMPORTED_MODULE_14__.Z,this._bitmapIndex=new Map,this._mapImageContainer=new _engine_BitmapContainer_js__WEBPACK_IMPORTED_MODULE_23__.c,this._kmlVisualData=new j,this.allVisiblePoints=new _support_GraphicsCollection_js__WEBPACK_IMPORTED_MODULE_17__.JN,this.allVisiblePolylines=new _support_GraphicsCollection_js__WEBPACK_IMPORTED_MODULE_17__.JN,this.allVisiblePolygons=new _support_GraphicsCollection_js__WEBPACK_IMPORTED_MODULE_17__.JN,this.allVisibleMapImages=new _core_Collection_js__WEBPACK_IMPORTED_MODULE_11__.Z}hitTest(e,i){if(this.suspended||!this._pointsView&&!this._polylinesView&&!this._polygonsView)return Promise.resolve(null);const t=[this._pointsView.hitTest(e,i),this._polylinesView.hitTest(e,i),this._polygonsView.hitTest(e,i)];return Promise.all(t).then((e=>e.filter((e=>(e&&(e.layer=this.layer,e.sourceLayer=this.layer),!!e)))[0]||null))}update(e){this._polygonsView&&this._polygonsView.processUpdate(e),this._polylinesView&&this._polylinesView.processUpdate(e),this._pointsView&&this._pointsView.processUpdate(e)}attach(){this._handles.add([this.allVisibleMapImages.on("change",(e=>{e.added.forEach((e=>this._addMapImage(e))),e.removed.forEach((e=>this._removeMapImage(e)))}))]),this.container.addChild(this._mapImageContainer),this._polygonsView=new _graphics_GraphicsView2D_js__WEBPACK_IMPORTED_MODULE_20__.Z({view:this.view,graphics:this.allVisiblePolygons,requestUpdateCallback:()=>this.requestUpdate(),container:new _graphics_GraphicContainer_js__WEBPACK_IMPORTED_MODULE_21__.Z(this.view.featuresTilingScheme)}),this.container.addChild(this._polygonsView.container),this._polylinesView=new _graphics_GraphicsView2D_js__WEBPACK_IMPORTED_MODULE_20__.Z({view:this.view,graphics:this.allVisiblePolylines,requestUpdateCallback:()=>this.requestUpdate(),container:new _graphics_GraphicContainer_js__WEBPACK_IMPORTED_MODULE_21__.Z(this.view.featuresTilingScheme)}),this.container.addChild(this._polylinesView.container),this._pointsView=new _graphics_GraphicsView2D_js__WEBPACK_IMPORTED_MODULE_20__.Z({view:this.view,graphics:this.allVisiblePoints,requestUpdateCallback:()=>this.requestUpdate(),container:new _graphics_GraphicContainer_js__WEBPACK_IMPORTED_MODULE_21__.Z(this.view.featuresTilingScheme)}),this.container.addChild(this._pointsView.container),this.watch("layer.visibleSublayers",(e=>{for(const[i,t]of this._kmlVisualData.allSublayers)t.visibility=0;for(const i of e){const e=this._kmlVisualData.allSublayers.get(i.id);e&&(e.visibility=1)}this._refreshCollections()})),this._fetchingPromise=this._fetchService().then((()=>{this._fetchingPromise=null,this.notifyChange("updating")}))}detach(){this._handles.removeAll(),this._mapImageContainer.removeAllChildren(),this.container.removeAllChildren(),this._bitmapIndex.clear(),this._polygonsView&&(this._polygonsView.destroy(),this._polygonsView=null),this._polylinesView&&(this._polylinesView.destroy(),this._polylinesView=null),this._pointsView&&(this._pointsView.destroy(),this._pointsView=null)}moveStart(){}viewChange(){this._polygonsView.viewChange(),this._polylinesView.viewChange(),this._pointsView.viewChange()}moveEnd(){}isUpdating(){return null!=this._fetchingPromise||this._pointsView.updating||this._polygonsView.updating||this._polylinesView.updating}_addMapImage(e){(this.view.spatialReference.isWGS84||this.view.spatialReference.isWebMercator)&&(0,_request_js__WEBPACK_IMPORTED_MODULE_13__.default)(e.href,{responseType:"image"}).then((({data:i})=>{let t=_geometry_Extent_js__WEBPACK_IMPORTED_MODULE_10__.Z.fromJSON(e.extent);(0,_geometry_support_webMercatorUtils_js__WEBPACK_IMPORTED_MODULE_9__.Q8)(t,this.view.spatialReference)&&(t=(0,_geometry_support_webMercatorUtils_js__WEBPACK_IMPORTED_MODULE_9__.iV)(t,this.view.spatialReference));const s=new _engine_Bitmap_js__WEBPACK_IMPORTED_MODULE_22__.e(i,"standard");s.x=t.xmin,s.y=t.ymax,s.resolution=t.width/i.naturalWidth,s.rotation=e.rotation,this._mapImageContainer.addChild(s),this._bitmapIndex.set(e,s)}))}async _getViewDependentUrl(e,s){const{viewFormat:a,viewBoundScale:n,httpQuery:h}=e;if((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_25__.pC)(a)){if((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_25__.Wi)(s))throw new Error("Loading this network link requires a view state.");let m;if(await(0,_geometry_projection_js__WEBPACK_IMPORTED_MODULE_15__.zD)(),(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_25__.pC)(n)&&1!==n){const e=new _geometry_Extent_js__WEBPACK_IMPORTED_MODULE_10__.Z(s.extent);e.expand(n),m=e}else m=s.extent;m=(0,_geometry_projection_js__WEBPACK_IMPORTED_MODULE_15__.iV)(m,_geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_8__.Z.WGS84);const d=(0,_geometry_projection_js__WEBPACK_IMPORTED_MODULE_15__.iV)(m,_geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_8__.Z.WebMercator),y=m.xmin,_=m.xmax,V=m.ymin,b=m.ymax,f=s.size[0]*s.pixelRatio,v=s.size[1]*s.pixelRatio,S=Math.max(d.width,d.height),I={"[bboxWest]":y.toString(),"[bboxEast]":_.toString(),"[bboxSouth]":V.toString(),"[bboxNorth]":b.toString(),"[lookatLon]":m.center.x.toString(),"[lookatLat]":m.center.y.toString(),"[lookatRange]":S.toString(),"[lookatTilt]":"0","[lookatHeading]":s.rotation.toString(),"[lookatTerrainLon]":m.center.x.toString(),"[lookatTerrainLat]":m.center.y.toString(),"[lookatTerrainAlt]":"0","[cameraLon]":m.center.x.toString(),"[cameraLat]":m.center.y.toString(),"[cameraAlt]":S.toString(),"[horizFov]":"60","[vertFov]":"60","[horizPixels]":f.toString(),"[vertPixels]":v.toString(),"[terrainEnabled]":"0","[clientVersion]":_kernel_js__WEBPACK_IMPORTED_MODULE_12__.i8,"[kmlVersion]":"2.2","[clientName]":"ArcGIS API for JavaScript","[language]":"en-US"},x=e=>{for(const i in e)for(const t in I)e[i]=e[i].replace(t,I[t])},P=(0,_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_5__.u0)(a);x(P);let k={};(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_25__.pC)(h)&&(k=(0,_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_5__.u0)(h),x(k));const j=(0,_rest_utils_js__WEBPACK_IMPORTED_MODULE_16__.en)(e.href);return j.query={...j.query,...P,...k},`${j.path}?${(0,_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_5__.B7)(P)}`}return e.href}async _fetchService(){const e=new j;await this._loadVisualData(this.layer.url,e),this._kmlVisualData=e,this._refreshCollections()}_refreshCollections(){this.allVisiblePoints.removeAll(),this.allVisiblePolylines.removeAll(),this.allVisiblePolygons.removeAll(),this.allVisibleMapImages.removeAll(),this.allVisiblePoints.addMany(this._kmlVisualData.allPoints.filter((e=>this._isSublayerVisible(e.sublayerId))).map((({item:e})=>e))),this.allVisiblePolylines.addMany(this._kmlVisualData.allPolylines.filter((e=>this._isSublayerVisible(e.sublayerId))).map((({item:e})=>e))),this.allVisiblePolygons.addMany(this._kmlVisualData.allPolygons.filter((e=>this._isSublayerVisible(e.sublayerId))).map((({item:e})=>e))),this.allVisibleMapImages.addMany(this._kmlVisualData.allMapImages.filter((e=>this._isSublayerVisible(e.sublayerId))).map((({item:e})=>e)))}_isSublayerVisible(e){const i=this._kmlVisualData.allSublayers.get(e);return!!i.visibility&&(-1===i.parentFolderId||this._isSublayerVisible(i.parentFolderId))}_loadVisualData(e,i){return this._fetchParsedKML(e).then((async e=>{for(const t of e.sublayers){i.allSublayers.set(t.id,t);const e=t.points?await(0,_layers_support_kmlUtils_js__WEBPACK_IMPORTED_MODULE_18__.Yu)(t.points):[],s=t.polylines?await(0,_layers_support_kmlUtils_js__WEBPACK_IMPORTED_MODULE_18__.Yu)(t.polylines):[],a=t.polygons?await(0,_layers_support_kmlUtils_js__WEBPACK_IMPORTED_MODULE_18__.Yu)(t.polygons):[],o=t.mapImages||[];if(i.allPoints.push(...e.map((e=>({item:e,sublayerId:t.id})))),i.allPolylines.push(...s.map((e=>({item:e,sublayerId:t.id})))),i.allPolygons.push(...a.map((e=>({item:e,sublayerId:t.id})))),i.allMapImages.push(...o.map((e=>({item:e,sublayerId:t.id})))),t.networkLink){const e=await this._getViewDependentUrl(t.networkLink,this.view.state);await this._loadVisualData(e,i)}}}))}_fetchParsedKML(e){return(0,_layers_support_kmlUtils_js__WEBPACK_IMPORTED_MODULE_18__.CS)(e,this.view.spatialReference,this.layer.refreshInterval).then((e=>(0,_layers_support_kmlUtils_js__WEBPACK_IMPORTED_MODULE_18__.Cw)(e.data)))}_removeMapImage(e){const i=this._bitmapIndex.get(e);i&&(this._mapImageContainer.removeChild(i),this._bitmapIndex.delete(e))}};(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_26__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)()],C.prototype,"_pointsView",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_26__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)()],C.prototype,"_polylinesView",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_26__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)()],C.prototype,"_polygonsView",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_26__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)()],C.prototype,"_fetchingPromise",void 0),(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_26__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.Cb)()],C.prototype,"updating",void 0),C=(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_26__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_4__.j)("esri.views.2d.layers.KMLLayerView2D")],C);const __WEBPACK_DEFAULT_EXPORT__=C},80347:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{y:()=>LayerView2D_l});var tslib_es6=__webpack_require__(36663),property=(__webpack_require__(39994),__webpack_require__(13802),__webpack_require__(7283),__webpack_require__(81977)),subclass=__webpack_require__(12571),Collection=(__webpack_require__(3466),__webpack_require__(12173),__webpack_require__(51876),__webpack_require__(66591)),collectionUtils=__webpack_require__(58811),watchUtils=__webpack_require__(15071),JSONSupport=__webpack_require__(49004);let e=class extends JSONSupport.wq{};e=(0,tslib_es6._)([(0,subclass.j)("esri.views.layers.support.ClipArea")],e);const ClipArea=e;var s;let i=s=class extends ClipArea{constructor(){super(...arguments),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new s({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}get version(){return(this._get("version")||0)+1}};(0,tslib_es6._)([(0,property.Cb)({type:[Number,String],json:{write:!0}})],i.prototype,"left",void 0),(0,tslib_es6._)([(0,property.Cb)({type:[Number,String],json:{write:!0}})],i.prototype,"right",void 0),(0,tslib_es6._)([(0,property.Cb)({type:[Number,String],json:{write:!0}})],i.prototype,"top",void 0),(0,tslib_es6._)([(0,property.Cb)({type:[Number,String],json:{write:!0}})],i.prototype,"bottom",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],i.prototype,"version",null),i=s=(0,tslib_es6._)([(0,subclass.j)("esri.views.layers.support.ClipRect")],i);const ClipRect=i;var y,Container=__webpack_require__(10530),Geometry=__webpack_require__(20031),Extent=__webpack_require__(91772),Polygon=__webpack_require__(89542),jsonUtils=__webpack_require__(53736);__webpack_require__(91957);const c={base:Geometry.Z,key:"type",typeMap:{extent:Extent.Z,polygon:Polygon.Z}};let n=y=class extends ClipArea{constructor(){super(...arguments),this.type="geometry",this.geometry=null}get version(){return(this._get("version")||0)+1}clone(){return new y({geometry:this.geometry.clone()})}};(0,tslib_es6._)([(0,property.Cb)({types:c,json:{read:jsonUtils.im,write:!0}})],n.prototype,"geometry",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],n.prototype,"version",null),n=y=(0,tslib_es6._)([(0,subclass.j)("esri.views.layers.support.Geometry")],n);const support_Geometry=n;let Path_e=class extends ClipArea{constructor(){super(...arguments),this.type="path",this.path=[]}get version(){return(this._get("version")||0)+1}};(0,tslib_es6._)([(0,property.Cb)({type:[[[Number]]],json:{write:!0}})],Path_e.prototype,"path",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],Path_e.prototype,"version",null),Path_e=(0,tslib_es6._)([(0,subclass.j)("esri.views.layers.support.Path")],Path_e);const Path=Path_e,LayerView2D_c=Collection.Z.ofType({key:"type",base:ClipArea,typeMap:{rect:ClipRect,path:Path,geometry:support_Geometry}}),LayerView2D_l=i=>{let a=class extends i{constructor(){super(...arguments),this.clips=new LayerView2D_c,this.moving=!1,this.attached=!1,this.lastUpdateId=-1,this.updateRequested=!1}initialize(){var t;this.container||(this.container=new Container.W),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([(0,watchUtils.S1)(this,"suspended",(t=>{this.container&&(this.container.visible=!t),this.view&&!t&&this.updateRequested&&this.view.requestUpdate()}),!0),(0,watchUtils.S1)(this,["layer.opacity","container"],(()=>{var t,e;this.container&&(this.container.opacity=null!=(t=null==(e=this.layer)?void 0:e.opacity)?t:1)}),!0),(0,watchUtils.S1)(this,["layer.blendMode"],(t=>{this.container&&(this.container.blendMode=t)}),!0),(0,watchUtils.S1)(this,["layer.effect"],(t=>{this.container&&(this.container.effect=t)}),!0),this.clips.on("change",(()=>{this.container.clips=this.clips,this.notifyChange("clips")}))]),null!=(t=this.view)&&t.whenLayerView?this.view.whenLayerView(this.layer).then((t=>{t!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)}),(()=>{})):this.when().then((()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)}),(()=>{}))}destroy(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}get updating(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}isVisibleAtScale(t){let e=!0;const s=this.layer,i=s.minScale,r=s.maxScale;if(null!=i&&null!=r){let s=!i,o=!r;!s&&t<=i&&(s=!0),!o&&t>=r&&(o=!0),e=s&&o}return e}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(t){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",t),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(t))):this.updateRequested=!1}isUpdating(){return!1}isRendering(){return!1}canResume(){return!!super.canResume()&&this.isVisibleAtScale(this.view.scale)}};return(0,tslib_es6._)([(0,property.Cb)({type:LayerView2D_c,set(t){const e=(0,collectionUtils.Z)(t,this._get("clips"),LayerView2D_c);this._set("clips",e)}})],a.prototype,"clips",void 0),(0,tslib_es6._)([(0,property.Cb)()],a.prototype,"moving",void 0),(0,tslib_es6._)([(0,property.Cb)()],a.prototype,"attached",void 0),(0,tslib_es6._)([(0,property.Cb)()],a.prototype,"container",void 0),(0,tslib_es6._)([(0,property.Cb)()],a.prototype,"suspended",void 0),(0,tslib_es6._)([(0,property.Cb)({readOnly:!0})],a.prototype,"updateParameters",void 0),(0,tslib_es6._)([(0,property.Cb)()],a.prototype,"updateRequested",void 0),(0,tslib_es6._)([(0,property.Cb)()],a.prototype,"updating",null),(0,tslib_es6._)([(0,property.Cb)()],a.prototype,"view",void 0),a=(0,tslib_es6._)([(0,subclass.j)("esri.views.2d.layers.LayerView2D")],a),a}},68114:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _engine_webgl_enums_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(38716),_BaseGraphicContainer_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(28715);class i extends _BaseGraphicContainer_js__WEBPACK_IMPORTED_MODULE_1__.Z{renderChildren(r){this.attributeView.bindTextures(r.context),this.children.some((e=>e.hasData))&&(super.renderChildren(r),r.drawPhase===_engine_webgl_enums_js__WEBPACK_IMPORTED_MODULE_0__.jx.MAP&&this._renderChildren(r),r.drawPhase===_engine_webgl_enums_js__WEBPACK_IMPORTED_MODULE_0__.jx.HIGHLIGHT&&this._renderHighlight(r))}_renderHighlight(e){const{painter:r}=e,i=r.effects.highlight;i.bind(e),this._renderChildren(e,i.defines),i.draw(e),i.unbind()}}const __WEBPACK_DEFAULT_EXPORT__=i}}]);