"use strict";(self.webpackChunkreact_arcgis_wmws=self.webpackChunkreact_arcgis_wmws||[]).push([[2413],{43502:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{T:()=>o});var promiseUtils=__webpack_require__(78668),Queue=__webpack_require__(58713),has=__webpack_require__(39994),maybe=__webpack_require__(61681),Logger=__webpack_require__(13802),Error=__webpack_require__(70375),definitions=__webpack_require__(14266),Texture=(__webpack_require__(88338),__webpack_require__(6174),__webpack_require__(43487)),FramebufferObject=__webpack_require__(18567),Utils=__webpack_require__(15875),debug=__webpack_require__(37727);const z=Logger.Z.getLogger("esri.views.2d.engine.webgl.AttributeStoreView"),U=(0,debug.g)(debug.J,z),S=t=>2147483647&t;class k{constructor(t,e,i){this._texture=null,this._lastTexture=null,this._fbos={},this.texelSize=4;const{buffer:s,pixelType:r,textureOnly:h}=t,o=(0,Utils.UK)(r);this.shared=i,this.pixelType=r,this.size=e,this.textureOnly=h,h||(this.data=new o((0,maybe.Wg)(s))),this._resetRange()}destroy(){(0,maybe.Po)(this._texture,(t=>t.dispose()));for(const t in this._fbos)(0,maybe.Po)(this._fbos[t],(e=>{"0"===t&&e.detachColorTexture(),e.dispose()})),this._fbos[t]=null;this._texture=null}get _textureDesc(){return{target:3553,wrapMode:33071,pixelFormat:6408,dataType:this.pixelType,samplingMode:9728,width:this.size,height:this.size}}setData(t,e,i){const s=S(t),r=(0,maybe.Wg)(this.data),h=s*this.texelSize+e;!r||h>=r.length||(r[h]=i,this.dirtyStart=Math.min(this.dirtyStart,s),this.dirtyEnd=Math.max(this.dirtyEnd,s))}getData(t,i){if((0,maybe.Wi)(this.data))return null;const s=S(t)*this.texelSize+i;return!this.data||s>=this.data.length?null:this.data[s]}getTexture(t){return(0,maybe.Pt)(this._texture,(()=>this._initTexture(t)))}getFBO(t,i=0){if((0,maybe.Wi)(this._fbos[i])){const e={colorTarget:0,depthStencilTarget:0},s=0===i?this.getTexture(t):this._textureDesc;this._fbos[i]=new FramebufferObject.Z(t,e,s)}return this._fbos[i]}get locked(){return!(5121!==this.pixelType||!this.shared||this.textureOnly||!(0,has.Z)("esri-atomics")||!this.data)&&1===Atomics.load(this.data,0)}updateTexture(t){if(!this.locked)try{const i=this.dirtyStart,s=this.dirtyEnd;if(i>s)return;this._resetRange();const r=(0,maybe.Wg)(this.data).buffer,h=this.getTexture(t),o=4,d=(i-i%this.size)/this.size,n=(s-s%this.size)/this.size,l=d,p=this.size,c=n,x=d*this.size*o,_=(p+c*this.size)*o-x,f=(0,Utils.UK)(this.pixelType),g=f.BYTES_PER_ELEMENT;try{new f(r,x*g,_)}catch(e){}const b=new f(r,x*g,_),m=this.size,y=c-l+1;if(y>this.size)return void z.error(new Error.Z("mapview-webgl","Out-of-bounds index when updating AttributeData"));h.updateData(0,0,l,m,y,b)}catch(e){}}update(t){const{data:e,start:i,end:r}=t;if((0,maybe.pC)(e)){const s=this.data,r=i*this.texelSize;for(let i=0;i<e.length;i++){const a=1<<i%this.texelSize;t.layout&a&&(s[r+i]=e[i])}}this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,r)}resize(t,e){const i=this.size;if(this.size=e,this.textureOnly)return void(i!==this.size&&(this._lastTexture=this._texture,this._texture=null));const s=(0,Utils.UK)(this.pixelType);this.destroy(),this.data=new s((0,maybe.Wg)(t.buffer))}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}_initTexture(t){const e=new Texture.Z(t,this._textureDesc,(0,maybe.Pt)(this.data,void 0));if((0,maybe.pC)(this._lastTexture)&&this._fbos[0]){const i=this._lastTexture.descriptor.width,s=this._lastTexture.descriptor.height,r=this._lastTexture.descriptor.dataType,a=this._lastTexture.descriptor.pixelFormat,h=this.getFBO(t),o=(0,Utils.Yw)(r),d=new((0,Utils.UK)(r))(new ArrayBuffer(i*s*o*this.texelSize)),n=t.getBoundFramebufferObject(),{x:u,y:l,width:p,height:c}=t.getViewport();t.bindFramebuffer(h),h.readPixels(0,0,i,s,a,r,d),e.updateData(0,0,0,2*i,s/2,d),t.setViewport(u,l,p,c),t.bindFramebuffer(n)}return this.destroy(),this._texture=e,this._texture}}class j{constructor(t){this._onUpdate=t,this._initialized=!1,this._forceNextUpload=!1,this._locked=!1}initialize(t){const{blocks:r,shared:a,size:h}=t;if(this.shared=a,this.size=h,U("Initializing AttributeStoreView",t),(0,maybe.Wi)(this._data))this._data=(0,maybe.Fd)(r,(t=>new k(t,h,a)));else for(let i=0;i<this._data.length;i++){const t=this._data[i],o=r[i];(0,maybe.pC)(o)&&((0,maybe.Wi)(t)?this._data[i]=new k(o,h,a):t.resize(o,h))}this._initialized=!0}destroy(){(0,maybe.Po)(this._data,(t=>(0,maybe.Fd)(t,(t=>t.destroy())))),(0,maybe.Po)(this._defaultTexture,(t=>t.dispose()))}getBlock(t){return(0,maybe.Wi)(this._data)?null:this._data[t]}setLabelMinZoom(t,e){this.setData(t,0,1,e)}getLabelMinZoom(t){return this.getData(t,0,1,255)}getFilterFlags(t){return this.getData(t,0,0,0)}getVVSize(t){return this.getData(t,definitions.aK,0,0)}getData(t,i,r,h){if(!this._data)return 0;const o=(0,maybe.Wg)(this._data)[i];if((0,maybe.Wi)(o))return 0;const d=o.getData(t,r);return(0,maybe.pC)(d)?d:h}setData(t,e,i,s){const r=(0,maybe.Wg)(this._data)[e];(0,maybe.Wg)(r).setData(t,i,s)}lockTextureUpload(){this._locked=!0}unlockTextureUpload(){this._locked=!1}forceTextureUpload(){this._forceNextUpload=!0}async requestUpdate(t){if(this._pendingAttributeUpdate)return void z.error(new Error.Z("mapview-webgl","Tried to update attribute data with a pending update"));const e=(0,promiseUtils.hh)();return U("AttributeStoreView Update Requested",t),this._pendingAttributeUpdate={data:t,resolver:e},e.promise}update(){if(this._initialized&&(this._onUpdate(),(0,maybe.pC)(this._pendingAttributeUpdate))){const{data:t,resolver:e}=this._pendingAttributeUpdate,i=(0,maybe.Wg)(this._data);for(let s=0;s<t.blocks.length;s++){const e=t.blocks[s],a=i[s];(0,maybe.Po)(a,(t=>(0,maybe.Po)(e,(e=>{U(`Updating block ${s}`,e),t.update(e)}))))}this._pendingAttributeUpdate=null,e()}}bindTextures(t){this.update();const e=this._getDefaultTexture(t);if(!this._initialized)return t.bindTexture(e,definitions.iJ),t.bindTexture(e,definitions.nM),t.bindTexture(e,definitions.Ij),void t.bindTexture(e,definitions.f2);const i=(0,maybe.Wg)(this._data);this._locked&&!this._forceNextUpload||((0,maybe.JR)(i,(e=>e.updateTexture(t))),this._forceNextUpload=!1),t.bindTexture((0,maybe.R2)(i[0],e,(e=>e.getTexture(t))),definitions.iJ),t.bindTexture((0,maybe.R2)(i[1],e,(e=>e.getTexture(t))),definitions.nM),t.bindTexture((0,maybe.R2)(i[2],e,(e=>e.getTexture(t))),definitions.Ij),t.bindTexture((0,maybe.R2)(i[3],e,(e=>e.getTexture(t))),definitions.f2)}_getDefaultTexture(t){if((0,maybe.Wi)(this._defaultTexture)){const e={wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1};this._defaultTexture=new Texture.Z(t,e,new Uint8Array(4))}return this._defaultTexture}}var TileContainer=__webpack_require__(70179),Color=__webpack_require__(30936),screenUtils=__webpack_require__(95550),unitUtils=__webpack_require__(17321),lengthUtils=__webpack_require__(6923),capabilities=__webpack_require__(35119);function c(e,t){const i=t.length;if(e<t[0].value||1===i)return t[0].size;for(let s=1;s<i;s++)if(e<t[s].value){const i=(e-t[s-1].value)/(t[s].value-t[s-1].value);return t[s-1].size+i*(t[s].size-t[s-1].size)}return t[i-1].size}function h(e,t,i=0){if((0,maybe.Wi)(t))return e[i+0]=0,e[i+1]=0,e[i+2]=0,void(e[i+3]=0);const{r:a,g:o,b:l,a:r}=t;e[i+0]=a*r/255,e[i+1]=o*r/255,e[i+2]=l*r/255,e[i+3]=r}class p{constructor(){this.symbolLevels=[],this.vvColorValues=new Float32Array(8),this.vvColors=new Float32Array(32),this.vvOpacityValues=new Float32Array(8),this.vvOpacities=new Float32Array(8),this.vvSizeMinMaxValue=new Float32Array(4),this.ddColors=new Float32Array(32),this.ddBackgroundColor=new Float32Array(4),this.ddActiveDots=new Float32Array(8),this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1}}getSizeVVFieldStops(i){const s=this._vvSizeFieldStops;switch(s.type){case"static":return s;case"level-dependent":return(0,maybe.Pt)(s.levels[i],(()=>{let e=1/0,a=0;for(const t in s.levels){const s=parseFloat(t),o=Math.abs(i-s);o<e&&(e=o,a=s)}if(e===1/0)return{sizes:new Float32Array([0,0,0,0,0,0]),values:new Float32Array([0,0,0,0,0,0])};const o=2**((i-a)/2),l=(0,maybe.Wg)(s.levels[a]),r=new Float32Array(l.values);return r[2]*=o,r[3]*=o,{sizes:(0,maybe.Wg)(l.sizes),values:r}}))}}get vvMaterialParameters(){return this._vvMaterialParameters}update(e){(0,maybe.pC)(this._vvInfo)&&this._updateVisualVariables(this._vvInfo.vvRanges,e)}setInfo(e,t,s){if("dot-density"===((0,maybe.pC)(s)&&s.forEach((e=>this._updateEffects(e))),this._vvInfo=t,e.type))this._updateDotDensityInfo(e)}getVariation(){return{ddDotBlending:this.ddDotBlending,outsideLabelsVisible:this.outsideLabelsVisible,oesTextureFloat:(0,capabilities.Z)().supportsTextureFloat}}getVariationHash(){return(this.ddDotBlending?1:0)|(this.outsideLabelsVisible?1:0)<<1}_updateEffects(e){(0,maybe.pC)(e)&&e.filter&&e.filter.enabled&&(this.outsideLabelsVisible=e.excludedLabelsVisible)}_updateVisualVariables(e,t){const i=this._vvMaterialParameters;if(i.vvOpacityEnabled=!1,i.vvSizeEnabled=!1,i.vvColorEnabled=!1,i.vvRotationEnabled=!1,!e)return;const s=e.size;if(s){if(i.vvSizeEnabled=!0,s.minMaxValue){const e=s.minMaxValue;let i,a;if((0,Utils.$K)(e.minSize)&&(0,Utils.$K)(e.maxSize))if((0,Utils.hj)(e.minSize)&&(0,Utils.hj)(e.maxSize))i=(0,screenUtils.F2)(e.minSize),a=(0,screenUtils.F2)(e.maxSize);else{const s=t.scale;i=(0,screenUtils.F2)(c(s,e.minSize.stops)),a=(0,screenUtils.F2)(c(s,e.maxSize.stops))}this.vvSizeMinMaxValue.set([e.minDataValue,e.maxDataValue,i,a])}if(s.scaleStops&&(this.vvSizeScaleStopsValue=(0,screenUtils.F2)(c(t.scale,s.scaleStops.stops))),s.unitValue){const e=(0,unitUtils.c9)(t.spatialReference)/lengthUtils.a[s.unitValue.unit];this.vvSizeUnitValueToPixelsRatio=e/t.resolution}s.fieldStops&&(this._vvSizeFieldStops=s.fieldStops)}const a=e.color;a&&(i.vvColorEnabled=!0,this.vvColorValues.set(a.values),this.vvColors.set(a.colors));const n=e.opacity;n&&(i.vvOpacityEnabled=!0,this.vvOpacityValues.set(n.values),this.vvOpacities.set(n.opacities));const v=e.rotation;v&&(i.vvRotationEnabled=!0,i.vvRotationType=v.type)}_updateDotDensityInfo(e){const t=e.attributes;this.ddDotValue=e.dotValue,this.ddDotScale=e.referenceScale,this.ddDotSize=e.dotSize,this.ddDotBlending=e.dotBlendingEnabled,this.ddSeed=e.seed;for(let i=0;i<definitions.$0;i++){const e=i>=t.length?new Color.Z([0,0,0,0]):t[i].color;h(this.ddColors,e,4*i)}for(let i=0;i<8;i++)this.ddActiveDots[i]=i<e.attributes.length?1:0;h(this.ddBackgroundColor,e.backgroundColor)}}class o extends TileContainer.Z{constructor(e){super(e),this._rendererInfo=new p,this._materialItemsRequestQueue=new Queue.Z,this.attributeView=new j((()=>this.onAttributeStoreUpdate()))}destroy(){this.removeAllChildren(),this.children.forEach((e=>e.destroy())),this.attributeView.destroy(),this._materialItemsRequestQueue.clear()}setRendererInfo(e,t,r){this._rendererInfo.setInfo(e,t,r),this.requestRender()}async getMaterialItems(t,r){if(!t||0===t.length)return null;const s=(0,promiseUtils.hh)();return this._materialItemsRequestQueue.push({items:t,abortOptions:r,resolver:s}),this.requestRender(),s.promise}doRender(e){if(e.context.capabilities.enable("textureFloat"),e.context.capabilities.enable("vao"),this._materialItemsRequestQueue.length>0){let t=this._materialItemsRequestQueue.pop();for(;t;)this._processMaterialItemRequest(e,t),t=this._materialItemsRequestQueue.pop()}super.doRender(e)}renderChildren(e){for(const t of this.children)t.commit(e);this._rendererInfo.update(e.state),super.renderChildren(e)}createRenderParams(e){return{...super.createRenderParams(e),rendererInfo:this._rendererInfo,attributeView:this.attributeView}}onAttributeStoreUpdate(){}_processMaterialItemRequest(e,{items:t,abortOptions:r,resolver:s}){const{painter:i,pixelRatio:o}=e,n=t.map((e=>i.textureManager.rasterizeItem(e.symbol,o,e.glyphIds,r)));Promise.all(n).then((e=>{if(!this.stage)return void s.reject();const r=e.map(((e,r)=>({id:t[r].id,mosaicItem:e})));s.resolve(r)}),s.reject)}}},70179:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _enums_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(38716),_brushes_WGLBrushInfo_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(38448),_brushes_WGLBrushStencil_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(22598),_WGLContainer_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(10994);const n=(e,r)=>e.key.level-r.key.level!=0?e.key.level-r.key.level:e.key.row-r.key.row!=0?e.key.row-r.key.row:e.key.col-r.key.col;class i extends _WGLContainer_js__WEBPACK_IMPORTED_MODULE_3__.Z{constructor(e){super(),this._tileInfoView=e}get requiresDedicatedFBO(){return!1}renderChildren(e){this.sortChildren(n),this.setStencilReference(),super.renderChildren(e)}createRenderParams(e){const{state:r}=e;return{...super.createRenderParams(e),requiredLevel:this._tileInfoView.getClosestInfoForScale(r.scale).level,displayLevel:this._tileInfoView.tileInfo.scaleToZoom(r.scale)}}prepareRenderPasses(t){const n=t.registerRenderPass({name:"stencil",brushes:[_brushes_WGLBrushStencil_js__WEBPACK_IMPORTED_MODULE_2__.Z],drawPhase:_enums_js__WEBPACK_IMPORTED_MODULE_0__.jx.DEBUG|_enums_js__WEBPACK_IMPORTED_MODULE_0__.jx.MAP|_enums_js__WEBPACK_IMPORTED_MODULE_0__.jx.HIGHLIGHT,target:()=>this.getStencilTarget()}),i=t.registerRenderPass({name:"tileInfo",brushes:[_brushes_WGLBrushInfo_js__WEBPACK_IMPORTED_MODULE_1__.Z],drawPhase:_enums_js__WEBPACK_IMPORTED_MODULE_0__.jx.DEBUG,target:()=>this.children,has:"esri-tiles-debug"});return[...super.prepareRenderPasses(t),n,i]}getStencilTarget(){return this.children}updateTransforms(e){for(const r of this.children){const s=this._tileInfoView.getTileResolution(r.key);r.setTransform(e,s)}}setStencilReference(){let e=1;for(const r of this.children)r.stencilRef=e++}}const __WEBPACK_DEFAULT_EXPORT__=i},10994:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>WGLContainer});__webpack_require__(39994);var maybe=__webpack_require__(61681),enums=__webpack_require__(38716),Container=__webpack_require__(10530),brushes=__webpack_require__(96467),Logger=__webpack_require__(13802),Error=__webpack_require__(70375),VertexArrayObject=__webpack_require__(29620),DisplayObject=__webpack_require__(51118),OptimizedGeometry=__webpack_require__(15540),featureConversionUtils=__webpack_require__(12065),vec2f64=__webpack_require__(69666),earcut=__webpack_require__(57144),vec2=__webpack_require__(55709),BufferObject=__webpack_require__(78951),number=__webpack_require__(8530);const m=Logger.Z.getLogger("esri.views.2d.engine.webgl.Mesh2D"),y=(e,t,r,o)=>{let n=0;for(let s=1;s<r;s++){const r=e[2*(t+s-1)],o=e[2*(t+s-1)+1];n+=(e[2*(t+s)]-r)*(e[2*(t+s)+1]+o)}return o?n>0:n<0},x=({coords:e,lengths:t},r)=>{const o=[];for(let n=0,s=0;n<t.length;s+=t[n],n+=1){const c=s,a=[];for(;n<t.length-1&&y(e,s+t[n],t[n+1],r);n+=1,s+=t[n])a.push(s+t[n]-c);const f=e.slice(2*c,2*(s+t[n])),h=(0,earcut.O)(f,a,2);for(const e of h)o.push(e+c)}return o};class g{constructor(e,t,r,o=!1){this._cache={},this.vertices=e,this.indices=t,this.primitiveType=r,this.isMapSpace=o}static fromRect({x:e,y:t,width:r,height:o}){const n=e,s=t,c=n+r,i=s+o;return g.fromScreenExtent({xmin:n,ymin:s,xmax:c,ymax:i})}static fromPath(e){const t=(0,featureConversionUtils.ks)(new OptimizedGeometry.Z,e.path,!1,!1),r=t.coords,s=new Uint32Array(x(t,!0)),c=new Uint32Array(r.length/2);for(let o=0;o<c.length;o++)c[o]=(0,number.UJ)(Math.floor(r[2*o]),Math.floor(r[2*o+1]));return new g({geometry:c},s,4)}static fromGeometry(e,t){const o=t.geometry.type;switch(o){case"polygon":return g.fromPolygon(e,t.geometry);case"extent":return g.fromMapExtent(e,t.geometry);default:return m.error(new Error.Z("mapview-bad-type",`Unable to create a mesh from type ${o}`,t)),g.fromRect({x:0,y:0,width:1,height:1})}}static fromPolygon(e,t){const r=(0,featureConversionUtils.Uy)(new OptimizedGeometry.Z,t,!1,!1),n=r.coords,i=new Uint32Array(x(r,!1)),f=new Uint32Array(n.length/2),m=(0,vec2f64.a)(),u=(0,vec2f64.a)();for(let o=0;o<f.length;o++)(0,vec2.s)(m,n[2*o],n[2*o+1]),e.toScreen(u,m),f[o]=(0,number.UJ)(Math.floor(u[0]),Math.floor(u[1]));return new g({geometry:f},i,4,!0)}static fromScreenExtent({xmin:e,xmax:t,ymin:r,ymax:o}){const n={geometry:new Uint32Array([(0,number.UJ)(e,r),(0,number.UJ)(t,r),(0,number.UJ)(e,o),(0,number.UJ)(e,o),(0,number.UJ)(t,r),(0,number.UJ)(t,o)])},s=new Uint32Array([0,1,2,3,4,5]);return new g(n,s,4)}static fromMapExtent(e,t){const[r,o]=e.toScreen([0,0],[t.xmin,t.ymin]),[n,s]=e.toScreen([0,0],[t.xmax,t.ymax]),c={geometry:new Uint32Array([(0,number.UJ)(r,o),(0,number.UJ)(n,o),(0,number.UJ)(r,s),(0,number.UJ)(r,s),(0,number.UJ)(n,o),(0,number.UJ)(n,s)])},i=new Uint32Array([0,1,2,3,4,5]);return new g(c,i,4)}destroy(){(0,maybe.pC)(this._cache.indexBuffer)&&this._cache.indexBuffer.dispose();for(const t in this._cache.vertexBuffers)(0,maybe.pC)(this._cache.vertexBuffers[t])&&this._cache.vertexBuffers[t].dispose()}get elementType(){return(e=>{switch(e.BYTES_PER_ELEMENT){case 1:return 5121;case 2:return 5123;case 4:return 5125;default:throw new Error.Z("Cannot get DataType of array")}})(this.indices)}getIndexBuffer(e,t=35044){return this._cache.indexBuffer||(this._cache.indexBuffer=BufferObject.Z.createIndex(e,t,this.indices)),this._cache.indexBuffer}getVertexBuffers(e,t=35044){return this._cache.vertexBuffers||(this._cache.vertexBuffers=Object.keys(this.vertices).reduce(((r,o)=>({...r,[o]:BufferObject.Z.createVertex(e,t,this.vertices[o])})),{})),this._cache.vertexBuffers}}const Mesh2D=g,a=Logger.Z.getLogger("esri.views.2d.engine.webgl.ClippingInfo"),c=t=>parseFloat(t)/100;class n extends DisplayObject.s{constructor(t,e){super(),this._clip=e,this._cache={},this.stage=t,this._handle=e.watch("version",(()=>this._invalidate())),this.ready()}static fromClipArea(t,e){return new n(t,e)}_destroyGL(){(0,maybe.pC)(this._cache.mesh)&&(this._cache.mesh.destroy(),this._cache.mesh=null),(0,maybe.pC)(this._cache.vao)&&(this._cache.vao.dispose(),this._cache.vao=null)}destroy(){this._destroyGL(),this._handle.remove()}getVAO(t,r,s,h){const[o,a]=r.size;if("geometry"!==this._clip.type&&this._lastWidth===o&&this._lastHeight===a||(this._lastWidth=o,this._lastHeight=a,this._destroyGL()),(0,maybe.Wi)(this._cache.vao)){const e=this._createMesh(r,this._clip),o=e.getIndexBuffer(t),a=e.getVertexBuffers(t);this._cache.mesh=e,this._cache.vao=new VertexArrayObject.Z(t,s,h,a,o)}return this._cache.vao}_invalidate(){this._destroyGL(),this.requestRender()}_createScreenRect(t,e){const[r,s]=t.size,i="string"==typeof e.left?c(e.left)*r:e.left,h="string"==typeof e.right?c(e.right)*r:e.right,o="string"==typeof e.top?c(e.top)*s:e.top,a="string"==typeof e.bottom?c(e.bottom)*s:e.bottom,n=i,p=o;return{x:n,y:p,width:Math.max(r-h-n,0),height:Math.max(s-a-p,0)}}_createMesh(t,e){switch(e.type){case"rect":return Mesh2D.fromRect(this._createScreenRect(t,e));case"path":return Mesh2D.fromPath(e);case"geometry":return Mesh2D.fromGeometry(t,e);default:return a.error(new Error.Z("mapview-bad-type","Unable to create ClippingInfo mesh from clip of type: ${clip.type}")),Mesh2D.fromRect({x:0,y:0,width:1,height:1})}}}const ClippingInfo=n;class o extends Container.W{constructor(){super(...arguments),this.name=this.constructor.name}set clips(e){this._clips=e,this.children.forEach((r=>r.clips=e)),this._updateClippingInfo()}doRender(e){const r=this.createRenderParams(e),{painter:t,globalOpacity:i,profiler:n,drawPhase:o}=r,a=o===enums.jx.LABEL?1:i*this.computedOpacity;n.recordContainerStart(this.name),t.beforeRenderLayer(r,this._clippingInfos?255:0,a),this.updateTransforms(e.state),this.renderChildren(r),t.compositeLayer(r,a),n.recordContainerEnd()}renderChildren(r){(0,maybe.Wi)(this._renderPasses)&&(this._renderPasses=this.prepareRenderPasses(r.painter));for(const e of this.children)e.beforeRender(r);for(const e of this._renderPasses)try{e.render(r)}catch(s){}for(const e of this.children)e.afterRender(r)}createRenderParams(e){return{...e,requireFBO:this.requiresDedicatedFBO}}prepareRenderPasses(e){return[e.registerRenderPass({name:"clip",brushes:[brushes.U.clip],target:()=>this._clippingInfos,drawPhase:enums.jx.MAP|enums.jx.LABEL|enums.jx.LABEL_ALPHA|enums.jx.DEBUG|enums.jx.HIGHLIGHT})]}updateTransforms(e){for(const r of this.children)r.setTransform(e)}onAttach(){super.onAttach(),this._updateClippingInfo()}onDetach(){super.onDetach(),this._updateClippingInfo()}_updateClippingInfo(){if((0,maybe.pC)(this._clippingInfos)&&(this._clippingInfos.forEach((e=>e.destroy())),this._clippingInfos=null),!this.stage)return;const e=this._clips;(0,maybe.pC)(e)&&e.length&&(this._clippingInfos=e.items.map((e=>ClippingInfo.fromClipArea(this.stage,e)))),this.requestRender()}}const WGLContainer=o},780:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{o:()=>r});var _definitions_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(14266),_TiledDisplayObject_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(27954);class r extends _TiledDisplayObject_js__WEBPACK_IMPORTED_MODULE_1__.I{constructor(o,r){super(o,r,[_definitions_js__WEBPACK_IMPORTED_MODULE_0__.I_,_definitions_js__WEBPACK_IMPORTED_MODULE_0__.I_])}}}}]);