"use strict";(self.webpackChunkreact_arcgis_wmws=self.webpackChunkreact_arcgis_wmws||[]).push([[9368],{29368:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{CIMSymbolRasterizer:()=>C,GeometryStyle:()=>p});var string=__webpack_require__(21130),promiseUtils=__webpack_require__(78668),jsonUtils=__webpack_require__(53736),screenUtils=__webpack_require__(95550),Symbol3DAnchorPosition2D=__webpack_require__(37939),request=__webpack_require__(40457),utils=__webpack_require__(60789),cimSymbolUtils=__webpack_require__(97500),cimAnalyzer=__webpack_require__(75312),Rasterizer=__webpack_require__(556);class r{constructor(){}rasterizeText(t,r){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const o=this._textRasterizationCanvas,n=o.getContext("2d");this.setFontProperties(n,r),this.parameters=r,this.textLines=t.split(/\r?\n/),this.lineHeight=this.computeLineHeight();const a=this.computeTextWidth(n,r),h=this.lineHeight*this.textLines.length;o.width=a,o.height=h,this.renderedLineHeight=Math.round(this.lineHeight*r.pixelRatio),this.renderedHaloSize=r.halo.size*r.pixelRatio,this.renderedWidth=a*r.pixelRatio,this.renderedHeight=h*r.pixelRatio,this.fillStyle=function i(t){return`rgba(${t.slice(0,3).toString()},${t[3]})`}(r.color),this.haloStyle=function e(t){return`rgb(${t.slice(0,3).toString()})`}(r.halo.color);const l=this.renderedLineHeight,d=this.renderedHaloSize;this.setFontProperties(n,r);const c=function s(t,e){return"center"===t?.5*e:"right"===t?e:0}(n.textAlign,this.renderedWidth)+d,g=d;let f=0,p=0;d>0&&this.renderHalo(n,c,g,f,p,r),p+=g,f+=c;for(const e of this.textLines)n.globalCompositeOperation="destination-out",n.fillStyle="rgb(0, 0, 0)",n.fillText(e,f,p),n.globalCompositeOperation="source-over",n.fillStyle=this.fillStyle,n.fillText(e,f,p),p+=l;const u=n.getImageData(0,0,this.renderedWidth,this.renderedHeight),x=new Uint8Array(u.data);if(r.premultiplyColors){let t;for(let e=0;e<x.length;e+=4)t=x[e+3]/255,x[e]=x[e]*t,x[e+1]=x[e+1]*t,x[e+2]=x[e+2]*t}return{size:[this.renderedWidth,this.renderedHeight],image:new Uint32Array(x.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}renderHalo(t,e,i,r,s,o){const n=this.renderedWidth,a=this.renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas")),this._haloRasterizationCanvas.width=n,this._haloRasterizationCanvas.height=a;const h=this._haloRasterizationCanvas,l=h.getContext("2d");l.clearRect(0,0,n,a),this.setFontProperties(l,o),l.fillStyle=this.haloStyle,l.strokeStyle=this.haloStyle;const d=this.renderedHaloSize<3;l.lineJoin=d?"miter":"round",d?this.renderHaloEmulated(l,e,i):this.renderHaloNative(l,e,i),t.globalAlpha=this.parameters.halo.color[3],t.drawImage(h,0,0,n,a,r,s,n,a),t.globalAlpha=1}renderHaloEmulated(t,e,i){const r=this.renderedLineHeight,s=this.renderedHaloSize;for(const n of this.textLines){for(const[r,a]of o)t.fillText(n,e+s*r,i+s*a);i+=r}}renderHaloNative(t,e,i){const r=this.renderedLineHeight,s=this.renderedHaloSize;for(const o of this.textLines){const n=2*s,a=5,h=.1;for(let r=0;r<a;r++){const s=1-(a-1)*h+r*h;t.lineWidth=s*n,t.strokeText(o,e,i)}i+=r}}setFontProperties(e,i){const r=i.font,s=`${r.style} ${r.weight} ${(0,screenUtils.F2)(i.size*i.pixelRatio)}px ${r.family}, sans-serif`;let o;switch(e.font=s,e.textBaseline="top",i.horizontalAlignment){default:o="left";break;case"right":o="right";break;case"center":o="center"}e.textAlign=o}computeTextWidth(t,e){let i=0;for(const s of this.textLines)i=Math.max(i,t.measureText(s).width);const r=e.font;return("italic"===r.style||"oblique"===r.style||"string"==typeof r.weight&&("bold"===r.weight||"bolder"===r.weight)||"number"==typeof r.weight&&r.weight>600)&&(i+=.3*t.measureText("A").width),i+=2*this.parameters.halo.size,Math.round(i)}computeLineHeight(){const t=1.275*this.parameters.size;return Math.round(t+2*this.parameters.halo.size)}}const o=[];{const t=16;for(let e=0;e<360;e+=360/t)o.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)])}var p;!function(e){e.Legend="legend",e.Preview="preview"}(p||(p={}));const d=(e,t,r)=>{if(e&&e.targetSize){let a;if(r){const t=Math.max(r.frame.xmax-r.frame.xmin,r.frame.ymax-r.frame.ymin);a=e.targetSize/(0,screenUtils.F2)(t)}else a=e.targetSize/t.referenceSize;return a}return e&&e.scaleFactor?e.scaleFactor:1},M={fill:{legend:{frame:{xmax:15,xmin:0,ymax:15,ymin:0},geometry:{rings:[[[0,15],[15,7.5],[15,0],[0,0],[0,15]]]},canvasPaths:{rings:[[[0,15],[0,0],[15,7.5],[15,15],[0,15]]]}},preview:{frame:{xmax:100,xmin:0,ymax:100,ymin:0},geometry:{rings:[[[0,100],[100,100],[100,0],[0,0],[0,100]]]},canvasPaths:{rings:[[[0,100],[0,0],[100,0],[100,100],[0,100]]]}}},stroke:{legend:{frame:{xmax:24,xmin:0,ymax:-2,ymin:2},geometry:{paths:[[[0,0],[12,0],[24,0]]]},canvasPaths:{paths:[[[0,2],[12,2],[24,2]]]}},preview:{frame:{xmax:100,xmin:0,ymax:-2,ymin:2},geometry:{paths:[[[0,0],[50,0],[100,0]]]},canvasPaths:{paths:[[[0,2],[50,2],[100,2]]]}}}};class C{constructor(e,t){this._spatialReference=e,this._avoidSDF=t,this._resourceCache=new Map,this._rasterizer=new Rasterizer.Z,this._textRasterizer=new r,this._pictureMarkerCache=new Map}async rasterizeCIMSymbolAsync(e,t,a,i,s,o,n,c){i=i||(t?null!=t.centroid?"esriGeometryPolygon":(0,jsonUtils.Ji)(t.geometry):null)||function z(e){if(!(e&&e.data&&e.data.symbol))return null;switch(e.data.symbol.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}(e);const l=await this.analyzeCIMSymbol(e,t?function I(e){return(e?Object.keys(e):[]).map((t=>({name:t,alias:t,type:"string"==typeof e[t]?"esriFieldTypeString":"esriFieldTypeDouble"})))}(t.attributes):null,a,i,c);return this.rasterizeCIMSymbol(l,t,i,s,o,n)}async analyzeCIMSymbol(e,r,a,i,s){const o=[],n=r?{geometryType:i,spatialReference:this._spatialReference,fields:r}:null;let l;await(0,cimAnalyzer.c)(e.data,n,o,this._avoidSDF),(0,promiseUtils.k_)(s);for(const t of o)"CIMPictureMarker"!==t.cim.type&&"CIMPictureFill"!==t.cim.type&&"CIMPictureStroke"!==t.cim.type||(l||(l=[]),l.push(this.fetchPictureMarkerResource(t,s))),a&&"text"===t.type&&"string"==typeof t.text&&t.text.indexOf("[")>-1&&(t.text=(0,utils.Qs)(a,t.text,t.cim.textCase));return l&&await Promise.all(l),o}async fetchPictureMarkerResource(e,t){const r=e.materialHash;if(!this._pictureMarkerCache.get(r)){const a=(await(0,request.default)(e.cim.url,{responseType:"image",signal:t&&t.signal})).data;this._pictureMarkerCache.set(r,a)}}rasterizeCIMSymbol(e,t,r,a,i,s){const o=[];for(const n of e){a&&"function"==typeof a.scaleFactor&&(a.scaleFactor=a.scaleFactor(t,i,s));const e=this._getRasterizedResource(n,t,r,a,i,s);if(!e)continue;let c=0,m=e.anchorX||0,h=e.anchorY||0,f=!1,g=0,y=0;if("esriGeometryPoint"===r){const e=d(a,n,null);if(g=(0,utils.hf)(n.offsetX,t,i,s)*e||0,y=(0,utils.hf)(n.offsetY,t,i,s)*e||0,"marker"===n.type)c=(0,utils.hf)(n.rotation,t,i,s)||0,f=!!n.rotateClockwise&&n.rotateClockwise;else if("text"===n.type){if(c=(0,utils.hf)(n.angle,t,i,s)||0,void 0!==n.horizontalAlignment)switch(n.horizontalAlignment){case"left":m=-.5;break;case"right":m=.5;break;default:m=0}if(void 0!==n.verticalAlignment)switch(n.verticalAlignment){case"top":h=.5;break;case"bottom":h=-.5;break;case"baseline":h=-.25;break;default:h=0}}}null!=e&&o.push({angle:c,rotateClockWise:f,anchorX:m,anchorY:h,offsetX:g,offsetY:y,rasterizedResource:e})}return this.getSymbolImage(o)}getSymbolImage(e){const t=document.createElement("canvas"),r=t.getContext("2d");let a=0,i=0,n=0,c=0;const l=[];for(let o=0;o<e.length;o++){const t=e[o],m=t.rasterizedResource;if(!m)continue;const h=m.size,f=t.offsetX,g=t.offsetY,y=t.anchorX,u=t.anchorY,p=t.rotateClockWise||!1;let d=t.angle,M=(0,screenUtils.F2)(f)-h[0]*(.5+y),C=(0,screenUtils.F2)(g)-h[1]*(.5+u),I=M+h[0],z=C+h[1];if(d){p&&(d=-d);const e=Math.sin(d*Math.PI/180),t=Math.cos(d*Math.PI/180),r=M*t-C*e,a=M*e+C*t,i=M*t-z*e,s=M*e+z*t,o=I*t-z*e,n=I*e+z*t,c=I*t-C*e,l=I*e+C*t;M=Math.min(r,i,o,c),C=Math.min(a,s,n,l),I=Math.max(r,i,o,c),z=Math.max(a,s,n,l)}a=M<a?M:a,i=C<i?C:i,n=I>n?I:n,c=z>c?z:c;const P=r.createImageData(m.size[0],m.size[1]);P.data.set(new Uint8ClampedArray(m.image.buffer));const x={offsetX:f,offsetY:g,rotateClockwise:p,angle:d,rasterizedImage:P,anchorX:y,anchorY:u};l.push(x)}t.width=n-a,t.height=c-i;const m=-a,h=c;for(let o=0;o<l.length;o++){const e=l[o],t=this._imageDataToCanvas(e.rasterizedImage),a=e.rasterizedImage.width,i=e.rasterizedImage.height,n=m-a*(.5+e.anchorX),c=h-i*(.5-e.anchorY);if(e.angle){const a=(360-e.angle)*Math.PI/180;r.save(),r.translate((0,screenUtils.F2)(e.offsetX),-(0,screenUtils.F2)(e.offsetY)),r.translate(m,h),r.rotate(a),r.translate(-m,-h),r.drawImage(t,n,c),r.restore()}else r.drawImage(t,n+(0,screenUtils.F2)(e.offsetX),c-(0,screenUtils.F2)(e.offsetY))}const f=new Symbol3DAnchorPosition2D.Z({x:m/t.width-.5,y:h/t.height-.5});return{imageData:0!==t.width&&0!==t.height?r.getImageData(0,0,t.width,t.height):r.createImageData(1,1),anchorPosition:f}}_imageDataToCanvas(e){this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas"));const t=this._imageDataCanvas,r=t.getContext("2d");return t.width=e.width,t.height=e.height,r.putImageData(e,0,0),t}_imageTo32Array(e,t,r){this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas"));const a=this._imageDataCanvas,i=a.getContext("2d");return a.width=t,a.height=r,i.drawImage(e,0,0,t,r),new Uint32Array(i.getImageData(0,0,t,r).data.buffer)}_getRasterizedResource(t,r,a,i,s,o){let n,c,m,f;if("esriGeometryPolyline"===a||"esriGeometryPolygon"===a){const h=i&&i.style?i.style:p.Legend,f="esriGeometryPolyline"===a?M.stroke[h]:M.fill[h];if("line"===t.type){if("CIMSolidStroke"!==t.cim.type){if("CIMPictureStroke"===t.cim.type){const e=(0,utils.hf)(t.width,r,s,o),{image:a,width:i,height:n}=this._getPictureResource(t,e);return this._rasterizePictureResource(t,a,i,n,f,e)}return null}({analyzedCIM:n,hash:m}=P(t,r,s,o)),c=this._embedCIMLayerInVectorMarker(n,f)}else if("marker"===t.type){if("CIMPictureMarker"===t.cim.type)return null;if("CIMVectorMarker"!==t.cim.type)return null;t.cim.offsetX=(0,utils.hf)(t.offsetX,r,s,o),t.cim.offsetY=(0,utils.hf)(t.offsetY,r,s,o),t.cim.rotation=(0,utils.hf)(t.rotation,r,s,o),t.cim.markerPlacement=t.markerPlacement,({analyzedCIM:n}=P(t,r,s,o)),m=(0,string.hP)(JSON.stringify(n)).toString(),c=this._embedCIMLayerInVectorMarker(n,f)}else{if("text"===t.type)return null;if("fill"===t.type){if("CIMHatchFill"===t.cim.type||"CIMVectorMarker"===t.cim.type||"CIMPictureMarker"===t.cim.type||"CIMPictureFill"===t.cim.type){const e=t.cim.size||t.cim.height;let a,i,c;if("CIMPictureMarker"===t.cim.type||"CIMPictureFill"===t.cim.type)({image:a,width:i,height:c}=this._getPictureResource(t,e));else{({analyzedCIM:n,hash:m}=P(t,r,s,o));const e=this._rasterizer.rasterizeJSONResource(n,1,this._avoidSDF);a=e.image,i=e.size[0],c=e.size[1]}return this._rasterizePictureResource(t,a,i,c,f,null)}if("CIMSolidFill"!==t.cim.type)return null;({analyzedCIM:n,hash:m}=P(t,r,s,o)),c=this._embedCIMLayerInVectorMarker(n,f)}}}else{if("text"===t.type)return f=this._rasterizeTextResource(t,r,i,s,o),f;({analyzedCIM:n,hash:m}=P(t,r,s,o));const e=d(i,t,null);if("CIMPictureMarker"===t.cim.type){const a=(0,utils.hf)(t.size,r,s,o)*e,{image:i,width:n,height:c}=this._getPictureResource(t,a);return f={image:i,size:[n,c],sdf:!1,simplePattern:!1,anchorX:t.anchorPoint?t.anchorPoint.x:0,anchorY:t.anchorPoint?t.anchorPoint.y:0},f}(0,cimSymbolUtils.FW)(n,e,{preserveOutlineWidth:!1}),c=n}m+=a,i&&(m+=JSON.stringify(i));const g=this._resourceCache;return g.has(m)?g.get(m):(f=this._rasterizer.rasterizeJSONResource(c,window.devicePixelRatio||1,this._avoidSDF),g.set(m,f),f)}_rasterizeTextResource(e,t,r,a,i){const s=d(r,e,null),o=(0,utils.hf)(e.text,t,a,i);if(!o||0===o.length)return null;const n=(0,utils.hf)(e.fontName,t,a,i),c=(0,utils.hf)(e.style,t,a,i),h=(0,utils.hf)(e.weight,t,a,i),f=(0,utils.hf)(e.decoration,t,a,i),g=(0,utils.hf)(e.size,t,a,i)*s,y=(0,utils.hf)(e.horizontalAlignment,t,a,i),u=(0,utils.hf)(e.verticalAlignment,t,a,i),p=(0,utils.nn)((0,utils.hf)(e.color,t,a,i)),M=(0,utils.nn)((0,utils.hf)(e.outlineColor,t,a,i)),C={color:p,size:g,horizontalAlignment:y,verticalAlignment:u,font:{family:n,style:c,weight:h,decoration:f},halo:{size:(0,utils.hf)(e.outlineSize,t,a,i)||0,color:M,style:c},pixelRatio:1,premultiplyColors:!this._avoidSDF};return this._textRasterizer.rasterizeText(o,C)}_rasterizePictureResource(e,t,r,o,n,c){const l=document.createElement("canvas"),m=l.getContext("2d");l.height=(0,screenUtils.F2)(Math.max(Math.abs(n.frame.ymax-n.frame.ymin),c)),l.width=(0,screenUtils.F2)(Math.abs(n.frame.xmax-n.frame.xmin));const h=m.createImageData(r,o);h.data.set(new Uint8ClampedArray(t.buffer));const f=this._imageDataToCanvas(h),g=m.createPattern(f,"repeat"),y=Math.cos((-e.cim.rotation||0)*Math.PI/180),u=Math.sin((-e.cim.rotation||0)*Math.PI/180);g.setTransform({m11:y,m12:u,m21:-u,m22:y,m41:(0,screenUtils.F2)(e.cim.offsetX)||0,m42:(0,screenUtils.F2)(e.cim.offsetY)||0});const p=n.canvasPaths;let d,M,C;(0,jsonUtils.oU)(p)?(d=p.rings,m.fillStyle=g,M=m.fill,C=["evenodd"]):(0,jsonUtils.l9)(p)&&(d=p.paths,m.strokeStyle=g,m.lineWidth=c,M=m.stroke,d[0][0][1]=l.height/2,d[0][1][1]=l.height/2),m.beginPath();for(const a of d){const e=a?a.length:0;if(e>1){let t=a[0];m.moveTo((0,screenUtils.F2)(t[0]),(0,screenUtils.F2)(t[1]));for(let r=1;r<e;++r)t=a[r],m.lineTo((0,screenUtils.F2)(t[0]),(0,screenUtils.F2)(t[1]));m.closePath()}}M.apply(m,C);const I=m.getImageData(0,0,l.width,l.height),z=new Uint8Array(I.data);return{size:[l.width,l.height],image:new Uint32Array(z.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}_getPictureResource(e,t){const r=this._pictureMarkerCache.get(e.materialHash);if(!r)return null;const a=r.height/r.width,i=t?a>1?(0,screenUtils.F2)(t):(0,screenUtils.F2)(t)/a:r.width,o=t?a>1?(0,screenUtils.F2)(t)*a:(0,screenUtils.F2)(t):r.height;return{image:this._imageTo32Array(r,i,o),width:i,height:o}}_embedCIMLayerInVectorMarker(e,t){const r=(0,jsonUtils.oU)(t.geometry)?"CIMPolygonSymbol":"CIMLineSymbol";return{type:"CIMVectorMarker",frame:t.frame,markerGraphics:[{type:"CIMMarkerGraphic",geometry:t.geometry,symbol:{type:r,symbolLayers:[e]}}]}}}function P(e,t,r,a){let i,s;return"function"==typeof e.materialHash?(i=(0,e.materialHash)(t,r,a),s=(0,cimAnalyzer.S)(e.cim,e.materialOverrides)):(i=e.materialHash,s=e.cim),{analyzedCIM:s,hash:i}}},556:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _utils_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(60789),_Rect_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(10927),_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(31775),_SDFHelper_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(89626);const __WEBPACK_DEFAULT_EXPORT__=class o{dispose(){this._rasterizationCanvas=null}rasterizeJSONResource(e,s,o){if(this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),"simple-fill"===e.type||"esriSFS"===e.type){const[r,a,n]=_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_0__.fN.rasterizeSimpleFill(this._rasterizationCanvas,e.style,s);return{size:[a,n],image:new Uint32Array(r.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0}}if("simple-line"===e.type||"esriSLS"===e.type){const[r,a,n]=_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_0__.fN.rasterizeSimpleLine(e.style,e.cap);return{size:[a,n],image:new Uint32Array(r.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}let m,l,f;if("simple-marker"===e.type||"esriSMS"===e.type||"line-marker"===e.type?(m=_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_0__.B$.fromSimpleMarker(e),f=(0,_SDFHelper_js__WEBPACK_IMPORTED_MODULE_1__.Fp)(m)):"CIMHatchFill"===e.type?(m=_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_0__.B$.fromCIMHatchFill(e),l=new _Rect_js__WEBPACK_IMPORTED_MODULE_2__.Z(m.frame.xmin,-m.frame.ymax,m.frame.xmax-m.frame.xmin,m.frame.ymax-m.frame.ymin)):e.markerPlacement&&"CIMMarkerPlacementInsidePolygon"===e.markerPlacement.type?(m=_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_0__.B$.fromCIMInsidePolygon(e),l=new _Rect_js__WEBPACK_IMPORTED_MODULE_2__.Z(m.frame.xmin,-m.frame.ymax,m.frame.xmax-m.frame.xmin,m.frame.ymax-m.frame.ymin)):(m=e,f=(0,_SDFHelper_js__WEBPACK_IMPORTED_MODULE_1__.Fp)(m)),f&&!o){const[e,r,t]=(0,_SDFHelper_js__WEBPACK_IMPORTED_MODULE_1__.RL)(f);return e?{size:[r,t],image:new Uint32Array(e.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}:null}const[c,h,p,y,u]=_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_0__.B$.rasterize(this._rasterizationCanvas,m,l,!o);return c?{size:[h,p],image:new Uint32Array(c.buffer),sdf:!1,simplePattern:!1,anchorX:y,anchorY:u}:null}rasterizeImageResource(r,t,a,n){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),this._rasterizationCanvas.width=r,this._rasterizationCanvas.height=t;const i=this._rasterizationCanvas.getContext("2d");a instanceof ImageData?i.putImageData(a,0,0):(a.setAttribute("width",`${r}px`),a.setAttribute("height",`${t}px`),i.drawImage(a,0,0,r,t));const o=i.getImageData(0,0,r,t),m=new Uint8Array(o.data);if(n)for(const e of n)if(e&&e.oldColor&&4===e.oldColor.length&&e.newColor&&4===e.newColor.length){const[r,t,a,n]=e.oldColor,[i,s,o,l]=e.newColor;if(r===i&&t===s&&a===o&&n===l)continue;for(let e=0;e<m.length;e+=4)r===m[e]&&t===m[e+1]&&a===m[e+2]&&n===m[e+3]&&(m[e]=i,m[e+1]=s,m[e+2]=o,m[e+3]=l)}let l;for(let e=0;e<m.length;e+=4)l=m[e+3]/255,m[e]=m[e]*l,m[e+1]=m[e+1]*l,m[e+2]=m[e+2]*l;let f=m,c=r,h=t;const p=512;if(c>=p||h>=p){const a=c/h;a>1?(c=p,h=Math.round(p/a)):(h=p,c=Math.round(p*a)),f=new Uint8Array(4*c*h);const n=new Uint8ClampedArray(f.buffer);(0,_utils_js__WEBPACK_IMPORTED_MODULE_3__.TT)(m,r,t,n,c,h,!1)}return{size:[r,t],image:new Uint32Array(f.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}},89626:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{RL:()=>a,bk:()=>f,Fp:()=>r,UV:()=>m});var _geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(53736),_Rect_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(10927),_packingUtils_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(20);function r(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":{const n=t.symbolLayers;return n&&1===n.length?r(n[0]):null}case"CIMVectorMarker":{const n=t.markerGraphics;if(!n||1!==n.length)return null;const o=n[0];if(!o)return null;const r=o.geometry;if(!r)return null;const l=o.symbol;return!l||"CIMPolygonSymbol"!==l.type&&"CIMLineSymbol"!==l.type?null:{geom:r,asFill:"CIMPolygonSymbol"===l.type}}case"sdf":return{geom:t.geom,asFill:t.asFill}}return null}function s(t){let n=1/0,o=-1/0,r=1/0,l=-1/0;for(const e of t)for(const t of e)t[0]<n&&(n=t[0]),t[0]>o&&(o=t[0]),t[1]<r&&(r=t[1]),t[1]>l&&(l=t[1]);return[n,r,o,l]}function f(n){return n?n.rings?s(n.rings):n.paths?s(n.paths):(0,_geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_0__.YX)(n)?[n.xmin,n.ymin,n.xmax,n.ymax]:null:null}function m(t,n,o,r,l){const[e,i,s,f]=t;if(s<e||f<i)return[0,0,0];const m=s-e,a=f-i,y=Math.floor(31.5),h=(128-2*(y+1))/Math.max(m,a),x=Math.round(m*h)+2*y,M=Math.round(a*h)+2*y;let g=1;n&&(g=M/h/(n.ymax-n.ymin));let p=0,d=0;if(r)if(l){if(n&&o&&n.ymax-n.ymin>0){const t=(n.xmax-n.xmin)/(n.ymax-n.ymin);p=r.x/(o*t),d=r.y/o}}else p=r.x,d=r.y;return p=.5*(n.xmax+n.xmin)+p*(n.xmax-n.xmin),d=.5*(n.ymax+n.ymin)+d*(n.ymax-n.ymin),p-=e,d-=i,p*=h,d*=h,p+=y,d+=y,[g,p/x-.5,-(d/M-.5)]}function a(t){const n=function e(t){return t?t.rings?t.rings:t.paths?t.paths:void 0!==t.xmin&&void 0!==t.ymin&&void 0!==t.xmax&&void 0!==t.ymax?[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]:null:null}(t.geom),o=function i(t){let o=1/0,r=-1/0,l=1/0,e=-1/0;for(const n of t)for(const t of n)t[0]<o&&(o=t[0]),t[0]>r&&(r=t[0]),t[1]<l&&(l=t[1]),t[1]>e&&(e=t[1]);return new _Rect_js__WEBPACK_IMPORTED_MODULE_2__.Z(o,l,r-o,e-l)}(n),s=Math.floor(31.5),f=(128-2*(s+1))/Math.max(o.width,o.height),m=Math.round(o.width*f)+2*s,a=Math.round(o.height*f)+2*s,h=[];for(const e of n)if(e&&e.length>1){const n=[];for(const t of e){let[r,l]=t;r-=o.x,l-=o.y,r*=f,l*=f,r+=s-.5,l+=s-.5,n.push([r,l])}if(t.asFill){const t=n.length-1;n[0][0]===n[t][0]&&n[0][1]===n[t][1]||n.push(n[0])}h.push(n)}const x=function c(t,n,o,r){const l=n*o,e=new Array(l),i=r*r+1;for(let s=0;s<l;++s)e[s]=i;for(const s of t){const t=s.length;for(let l=1;l<t;++l){const t=s[l-1],i=s[l];let f,m,a,c;t[0]<i[0]?(f=t[0],m=i[0]):(f=i[0],m=t[0]),t[1]<i[1]?(a=t[1],c=i[1]):(a=i[1],c=t[1]);let u=Math.floor(f)-r,y=Math.floor(m)+r,h=Math.floor(a)-r,x=Math.floor(c)+r;u<0&&(u=0),y>n&&(y=n),h<0&&(h=0),x>o&&(x=o);const M=i[0]-t[0],g=i[1]-t[1],p=M*M+g*g;for(let r=u;r<y;r++)for(let l=h;l<x;l++){let s,f,m=(r-t[0])*M+(l-t[1])*g;m<0?(s=t[0],f=t[1]):m>p?(s=i[0],f=i[1]):(m/=p,s=t[0]+m*M,f=t[1]+m*g);const a=(r-s)*(r-s)+(l-f)*(l-f),c=(o-l-1)*n+r;a<e[c]&&(e[c]=a)}}}for(let s=0;s<l;++s)e[s]=Math.sqrt(e[s]);return e}(h,m,a,s);return t.asFill&&function u(t,n,o,r,l){for(const e of t){const t=e.length;for(let i=1;i<t;++i){const t=e[i-1],s=e[i];let f,m,a,c;t[0]<s[0]?(f=t[0],m=s[0]):(f=s[0],m=t[0]),t[1]<s[1]?(a=t[1],c=s[1]):(a=s[1],c=t[1]);let u=Math.floor(f),y=Math.floor(m)+1,h=Math.floor(a),x=Math.floor(c)+1;u<r&&(u=r),y>n-r&&(y=n-r),h<r&&(h=r),x>o-r&&(x=o-r);for(let e=h;e<x;++e){if(t[1]>e==s[1]>e)continue;const i=(o-e-1)*n;for(let n=u;n<y;++n)n<(s[0]-t[0])*(e-t[1])/(s[1]-t[1])+t[0]&&(l[i+n]=-l[i+n]);for(let t=r;t<u;++t)l[i+t]=-l[i+t]}}}}(h,m,a,s,x),[y(x,s),m,a]}function y(t,n){const r=2*n,l=t.length,e=new Uint8Array(4*l);for(let i=0;i<l;++i){const n=.5-t[i]/r;(0,_packingUtils_js__WEBPACK_IMPORTED_MODULE_1__.I)(n,e,4*i)}return e}},75312:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{S:()=>T,c:()=>k});var _core_string_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(21130),_core_Logger_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(13802),_support_arcadeOnDemand_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(30879),_Color_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(30936),_core_screenUtils_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(95550),_utils_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(60789),_views_2d_arcade_callExpressionWithFeature_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(28432),_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(31775),_SDFHelper_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(89626);const u=_core_Logger_js__WEBPACK_IMPORTED_MODULE_1__.Z.getLogger("esri.symbols.cim.cimAnalyzer");function y(e){switch(e){case"Butt":return 0;case"Square":return 2;default:return 1}}function h(e){switch(e){case"Bevel":return 0;case"Miter":return 2;default:return 1}}function g(e){switch(e){default:return"left";case"Right":return"right";case"Center":return"center";case"Justify":return"justify"}}function d(e){switch(e){default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function b(e,t,i,o){let r;e[t]?r=e[t]:(r={},e[t]=r),r[i]=o}function N(e){const t=e.markerPlacement;return t&&t.angleToLine?1:0}async function k(e,t,o,r){const n=o||[];if(!e)return n;let a,l;const s={};if("CIMSymbolReference"!==e.type)return u.error("Expect cim type to be 'CIMSymbolReference'"),n;if(a=e.symbol,l=e.primitiveOverrides,l){const e=[];for(const o of l){const r=o.valueExpressionInfo;if(r&&t){const n=r.expression,a=(0,_support_arcadeOnDemand_js__WEBPACK_IMPORTED_MODULE_2__.Yi)(n,t.spatialReference,t.fields).then((e=>{e&&b(s,o.primitiveName,o.propertyName,e)}));e.push(a)}else null!=o.value&&b(s,o.primitiveName,o.propertyName,o.value)}await Promise.all(e)}switch(a.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":!function O(e,t,i,o,r,n){if(!e)return;const a=e.symbolLayers;if(!a)return;let l;const s=_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_5__.B$.getSize(e);"CIMPointSymbol"===e.type&&"Map"===e.angleAlignment&&(l=1);let m=a.length;for(;m--;){const c=a[m];if(!c||!1===c.enable)continue;const p=[];switch(_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_5__.E0.findApplicableOverrides(c,t,p),c.type){case"CIMSolidFill":C(c,i,p,o,r);break;case"CIMPictureFill":P(c,i,p,o,r);break;case"CIMHatchFill":L(c,i,p,o,r);break;case"CIMGradientFill":M(c,i,p,o,r);break;case"CIMSolidStroke":X(c,i,p,o,r,"CIMPolygonSymbol"===e.type,s);break;case"CIMPictureStroke":I(c,i,p,o,r,"CIMPolygonSymbol"===e.type,s);break;case"CIMGradientStroke":x(c,i,p,o,r,"CIMPolygonSymbol"===e.type,s);break;case"CIMCharacterMarker":if(w(c,i,p,o,r))break;break;case"CIMPictureMarker":if(w(c,i,p,o,r))break;"CIMLineSymbol"===e.type&&(l=N(c)),z(c,i,p,o,r,l,s);break;case"CIMVectorMarker":if(w(c,i,p,o,r))break;"CIMLineSymbol"===e.type&&(l=N(c)),J(c,i,p,o,r,l,s,n);break;default:u.error("Cannot analyze CIM layer",c.type)}}}(a,l,s,t,n,r)}return n}function C(t,i,o,r,n){const l=t.primitiveName,s=(0,_utils_js__WEBPACK_IMPORTED_MODULE_7__.NO)(t.color),c=(0,_core_string_js__WEBPACK_IMPORTED_MODULE_0__.hP)(JSON.stringify(t)).toString();n.push({type:"fill",templateHash:c,materialHash:0===o.length?c:()=>c,cim:t,materialOverrides:null,colorLocked:t.colorLocked,color:F(l,i,"Color",r,s,j),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:t.effects})}function P(t,i,o,r,n){const l=t.primitiveName,s=t.tintColor?(0,_utils_js__WEBPACK_IMPORTED_MODULE_7__.NO)(t.tintColor):{r:255,g:255,b:255,a:1},c=(0,_core_string_js__WEBPACK_IMPORTED_MODULE_0__.hP)(JSON.stringify(t)).toString(),f=(0,_core_string_js__WEBPACK_IMPORTED_MODULE_0__.hP)(`${t.url}${JSON.stringify(t.colorSubstitutions)}`).toString();n.push({type:"fill",templateHash:c,materialHash:0===o.length?f:()=>f,cim:t,materialOverrides:null,colorLocked:t.colorLocked,effects:t.effects,color:F(l,i,"TintColor",r,s,j),height:F(l,i,"Height",r,t.height),scaleX:F(l,i,"ScaleX",r,t.scaleX),angle:F(l,i,"Rotation",r,t.rotation),offsetX:F(l,i,"OffsetX",r,t.offsetX),offsetY:F(l,i,"OffsetY",r,t.offsetY)})}function L(t,i,o,r,n){const a=["Rotation","OffsetX","OffsetY"],l=o.filter((e=>e.primitiveName!==t.primitiveName&&-1===a.indexOf(e.propertyName))),s=t.primitiveName,c=(0,_core_string_js__WEBPACK_IMPORTED_MODULE_0__.hP)(JSON.stringify(t)).toString(),f=(0,_core_string_js__WEBPACK_IMPORTED_MODULE_0__.hP)(`${t.separation}${JSON.stringify(t.lineSymbol)}`).toString();n.push({type:"fill",templateHash:c,materialHash:0===o.length?f:W(f,i,l,r),cim:t,materialOverrides:l,colorLocked:t.colorLocked,effects:t.effects,color:{r:255,g:255,b:255,a:1},height:F(s,i,"Separation",r,t.separation),scaleX:1,angle:F(s,i,"Rotation",r,t.rotation),offsetX:F(s,i,"OffsetX",r,t.offsetX),offsetY:F(s,i,"OffsetY",r,t.offsetY)})}function M(t,i,o,r,n){const a=(0,_core_string_js__WEBPACK_IMPORTED_MODULE_0__.hP)(JSON.stringify(t)).toString();n.push({type:"fill",templateHash:a,materialHash:0===o.length?a:W(a,i,o,r),cim:t,materialOverrides:null,colorLocked:t.colorLocked,effects:t.effects,color:{r:128,g:128,b:128,a:1},height:0,angle:0,offsetX:0,offsetY:0,scaleX:1})}function X(t,i,o,r,n,l,s){const c=(0,_core_string_js__WEBPACK_IMPORTED_MODULE_0__.hP)(JSON.stringify(t)).toString(),f=t.primitiveName,m=(0,_utils_js__WEBPACK_IMPORTED_MODULE_7__.NO)(t.color),p=void 0!==t.width?t.width:4,u=y(t.capStyle),g=h(t.joinStyle),d=t.miterLimit;n.push({type:"line",templateHash:c,materialHash:0===o.length?c:()=>c,cim:t,materialOverrides:null,isOutline:l,colorLocked:t.colorLocked,effects:t.effects,color:F(f,i,"Color",r,m,j),width:F(f,i,"Width",r,p),cap:F(f,i,"CapStyle",r,u),join:F(f,i,"JoinStyle",r,g),miterLimit:F(f,i,"MiterLimit",r,d),referenceWidth:s,zOrder:A(t.name),isDashed:!1})}function I(t,i,o,r,n,l,s){const c=(0,_core_string_js__WEBPACK_IMPORTED_MODULE_0__.hP)(`${t.url}${JSON.stringify(t.colorSubstitutions)}`).toString(),f=t.primitiveName,m=(0,_utils_js__WEBPACK_IMPORTED_MODULE_7__.NO)(t.tintColor),p=void 0!==t.width?t.width:4,u=y(t.capStyle),g=h(t.joinStyle),d=t.miterLimit,S=(0,_core_string_js__WEBPACK_IMPORTED_MODULE_0__.hP)(JSON.stringify(t)).toString();n.push({type:"line",templateHash:S,materialHash:0===o.length?c:()=>c,cim:t,materialOverrides:null,isOutline:l,colorLocked:t.colorLocked,effects:t.effects,color:F(f,i,"TintColor",r,m,j),width:F(f,i,"Width",r,p),cap:F(f,i,"CapStyle",r,u),join:F(f,i,"JoinStyle",r,g),miterLimit:F(f,i,"MiterLimit",r,d),referenceWidth:s,zOrder:A(t.name),isDashed:!1})}function x(t,i,o,r,n,a,l){const s=t.primitiveName,c=void 0!==t.width?t.width:4,f=y(t.capStyle),m=h(t.joinStyle),p=t.miterLimit,u=(0,_core_string_js__WEBPACK_IMPORTED_MODULE_0__.hP)(JSON.stringify(t)).toString();n.push({type:"line",templateHash:u,materialHash:0===o.length?u:W(u,i,o,r),cim:t,materialOverrides:null,isOutline:a,colorLocked:t.colorLocked,effects:t.effects,color:{r:128,g:128,b:128,a:1},width:F(s,i,"Width",r,c),cap:F(s,i,"CapStyle",r,f),join:F(s,i,"JoinStyle",r,m),miterLimit:F(s,i,"MiterLimit",r,p),referenceWidth:l,zOrder:A(t.name),isDashed:!1})}function w(t,i,o,r,n){const a=t.markerPlacement;if(!a||"CIMMarkerPlacementInsidePolygon"!==a.type)return!1;const l=a,s=["Rotation","OffsetX","OffsetY"],c=o.filter((e=>e.primitiveName!==t.primitiveName&&-1===s.indexOf(e.propertyName))),f=(0,_core_string_js__WEBPACK_IMPORTED_MODULE_0__.hP)(JSON.stringify(t)).toString();return n.push({type:"fill",templateHash:f,materialHash:0===o.length?f:W(f,i,c,r),cim:t,materialOverrides:c,colorLocked:t.colorLocked,effects:t.effects,color:{r:255,g:255,b:255,a:1},height:F(l.primitiveName,i,"StepY",r,l.stepY),scaleX:1,angle:F(l.primitiveName,i,"GridAngle",r,l.gridAngle),offsetX:F(l.primitiveName,i,"OffsetX",r,l.offsetX),offsetY:F(l.primitiveName,i,"OffsetY",r,l.offsetY)}),!0}function z(t,i,o,r,n,l,s){const c=t.primitiveName,f=t.size,m=t.scaleX,p=t.rotation,u=t.offsetX,y=t.offsetY,h=(0,_utils_js__WEBPACK_IMPORTED_MODULE_7__.NO)(t.tintColor),g=(0,_core_string_js__WEBPACK_IMPORTED_MODULE_0__.hP)(`${t.url}${JSON.stringify(t.colorSubstitutions)}`).toString();let d=!1,S="";for(const e of o)e.primitiveName===c&&(void 0!==e.value?S+=`-${e.primitiveName}-${e.propertyName}-${JSON.stringify(e.value)}`:e.valueExpressionInfo&&(d=!0));n.push({type:"marker",templateHash:(0,_core_string_js__WEBPACK_IMPORTED_MODULE_0__.hP)(JSON.stringify(t)+S).toString(),materialHash:d?()=>g:g,cim:t,materialOverrides:null,colorLocked:t.colorLocked,effects:t.effects,scaleSymbolsProportionally:!1,alignment:l,size:F(c,i,"Size",r,f),scaleX:F(c,i,"ScaleX",r,m),rotation:F(c,i,"Rotation",r,p),offsetX:F(c,i,"OffsetX",r,u),offsetY:F(c,i,"OffsetY",r,y),color:F(c,i,"TintColor",r,h,j),anchorPoint:t.anchorPoint,isAbsoluteAnchorPoint:"Relative"!==t.anchorPointUnits,outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,frameHeight:0,rotateClockwise:t.rotateClockwise,referenceSize:s,sizeRatio:1,markerPlacement:t.markerPlacement})}function J(e,t,i,o,r,n,a,l){const s=e.markerGraphics;if(!s)return;let c=0;if(e.scaleSymbolsProportionally){const t=e.frame;t&&(c=t.ymax-t.ymin)}for(const f of s)if(f){const s=f.symbol;if(!s)continue;switch(s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":Y(e,f,i,t,o,r,n,a,c,l);break;case"CIMTextSymbol":H(e,f,t,i,o,r,n,a,c)}}}function H(t,i,o,r,n,s,m,p,u){_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_5__.E0.findApplicableOverrides(i,r,[]);const h=i.geometry;if(!("x"in h)||!("y"in h))return;const b=i.symbol,N=function v(e){return e.underline?"underline":e.strikethrough?"line-through":"none"}(b),k=function S(e){let t="normal",i="normal";if(e){const o=e.toLowerCase();-1!==o.indexOf("italic")?t="italic":-1!==o.indexOf("oblique")&&(t="oblique"),-1!==o.indexOf("bold")?i="bold":-1!==o.indexOf("light")&&(i="lighter")}return{style:t,weight:i}}(b.fontStyleName);b.font={family:b.fontFamilyName,decoration:N,...k};const O=t.frame,C=h.x-.5*(O.xmin+O.xmax),P=h.y-.5*(O.ymin+O.ymax),L=t.size/u,M=t.primitiveName,X=(b.height||0)*L,I=b.angle||0,x=((b.offsetX||0)+C)*L,w=((b.offsetY||0)+P)*L,z=(0,_utils_js__WEBPACK_IMPORTED_MODULE_7__.NO)(_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_5__.B$.getFillColor(b));let J=(0,_utils_js__WEBPACK_IMPORTED_MODULE_7__.NO)(_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_5__.B$.getStrokeColor(b)),H=_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_5__.B$.getStrokeWidth(b);H||(J=(0,_utils_js__WEBPACK_IMPORTED_MODULE_7__.NO)(_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_5__.B$.getFillColor(b.haloSymbol)),H=b.haloSize*L);let Y="";for(const e of r)e.primitiveName===M&&void 0!==e.value&&(Y+=`-${e.primitiveName}-${e.propertyName}-${JSON.stringify(e.value)}`);const R=JSON.stringify(t.effects)+Number(t.colorLocked)+JSON.stringify(t.anchorPoint)+t.anchorPointUnits+JSON.stringify(t.markerPlacement),$=(0,_core_string_js__WEBPACK_IMPORTED_MODULE_0__.hP)(JSON.stringify(i)+R+Y).toString();s.push({type:"text",templateHash:$,materialHash:()=>(0,_core_string_js__WEBPACK_IMPORTED_MODULE_0__.hP)(JSON.stringify(b.font)).toString(),cim:b,materialOverrides:null,colorLocked:t.colorLocked,effects:t.effects,alignment:m,anchorPoint:{x:t.anchorPoint?t.anchorPoint.x:0,y:t.anchorPoint?t.anchorPoint.y:0},isAbsoluteAnchorPoint:"Relative"!==t.anchorPointUnits,fontName:b.fontFamilyName,decoration:"none",weight:"normal",style:"normal",size:F(M,o,"Size",n,X),angle:F(M,o,"Rotation",n,I),offsetX:F(M,o,"OffsetX",n,x),offsetY:F(M,o,"OffsetY",n,w),horizontalAlignment:g(b.horizontalAlignment),verticalAlignment:d(b.verticalAlignment),text:F(i.primitiveName,o,"TextString",n,i.textString,_utils_js__WEBPACK_IMPORTED_MODULE_7__.X3,b.textCase),color:z,outlineColor:J,outlineSize:H,referenceSize:p,sizeRatio:1,markerPlacement:t.markerPlacement})}function Y(t,i,o,r,n,l,s,f,u,y){const h=i.symbol,g=i.geometry;if(!g)return;const d=h.symbolLayers;if(!d)return;if(y)return void R(t,i,r,o,n,l,s,f,u);let S=d.length;for(;S--;){const y=d[S];if(y&&!1!==y.enable)switch(y.type){case"CIMSolidFill":case"CIMSolidStroke":{const h=(0,_SDFHelper_js__WEBPACK_IMPORTED_MODULE_6__.bk)(g);if(!h)continue;const[d,S,v]=(0,_SDFHelper_js__WEBPACK_IMPORTED_MODULE_6__.UV)(h,t.frame,t.size,t.anchorPoint,"Relative"!==t.anchorPointUnits),b="CIMSolidFill"===y.type,N={type:"sdf",geom:g,asFill:b},k=t.primitiveName,O=t.size,C=t.rotation||0,P=t.offsetX,L=t.offsetY,M=y.primitiveName,X=(0,_utils_js__WEBPACK_IMPORTED_MODULE_7__.NO)(b?_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_5__.B$.getFillColor(y):_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_5__.B$.getStrokeColor(y)),I=b?{r:0,g:0,b:0,a:0}:(0,_utils_js__WEBPACK_IMPORTED_MODULE_7__.NO)(_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_5__.B$.getStrokeColor(y)),x=_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_5__.B$.getStrokeWidth(y);if(!b&&!x)break;let w=!1,z="";for(const e of o)e.primitiveName!==M&&e.primitiveName!==k||(void 0!==e.value?z+=`-${e.primitiveName}-${e.propertyName}-${JSON.stringify(e.value)}`:e.valueExpressionInfo&&(w=!0));const J=JSON.stringify({...t,markerGraphics:null}),H=(0,_core_string_js__WEBPACK_IMPORTED_MODULE_0__.hP)(JSON.stringify(N)).toString(),Y={type:"marker",templateHash:(0,_core_string_js__WEBPACK_IMPORTED_MODULE_0__.hP)(JSON.stringify(i)+JSON.stringify(y)+J+z).toString(),materialHash:w?()=>H:H,cim:N,materialOverrides:null,colorLocked:t.colorLocked,effects:t.effects,scaleSymbolsProportionally:t.scaleSymbolsProportionally,alignment:s,anchorPoint:{x:S,y:v},isAbsoluteAnchorPoint:!1,size:F(t.primitiveName,r,"Size",n,O),rotation:F(t.primitiveName,r,"Rotation",n,C),offsetX:F(t.primitiveName,r,"OffsetX",n,P),offsetY:F(t.primitiveName,r,"OffsetY",n,L),scaleX:1,frameHeight:u,rotateClockwise:t.rotateClockwise,referenceSize:f,sizeRatio:d,color:F(M,r,"Color",n,X,j),outlineColor:F(M,r,"Color",n,I,j),outlineWidth:F(M,r,"Width",n,x),markerPlacement:t.markerPlacement};l.push(Y);break}default:R(t,i,r,o,n,l,s,f,u)}}}function R(t,i,o,r,a,l,s,f,m){const p=function $(e,t){return{type:e.type,enable:!0,name:e.name,colorLocked:e.colorLocked,primitiveName:e.primitiveName,anchorPoint:e.anchorPoint,anchorPointUnits:e.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:e.rotateClockwise,rotation:0,size:e.size,billboardMode3D:e.billboardMode3D,depth3D:e.depth3D,frame:e.frame,markerGraphics:[t],scaleSymbolsProportionally:e.scaleSymbolsProportionally,respectFrame:e.respectFrame,clippingPath:e.clippingPath,effects:e.effects}}(t,i);let u=[];const y=["Rotation","OffsetX","OffsetY"];u=r.filter((e=>e.primitiveName!==t.primitiveName||-1===y.indexOf(e.propertyName)));let h="";for(const e of r)void 0!==e.value&&(h+=`-${e.primitiveName}-${e.propertyName}-${JSON.stringify(e.value)}`);const[g,d,S]=_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_5__.B$.getTextureAnchor(p),v=t.primitiveName,b=t.rotation||0,N=t.offsetX||0,k=t.offsetY||0,O=(0,_core_string_js__WEBPACK_IMPORTED_MODULE_0__.hP)(JSON.stringify(p)+h).toString(),C={type:"marker",templateHash:O,materialHash:0===u.length?O:W(O,o,u,a),cim:p,materialOverrides:u,colorLocked:t.colorLocked,effects:t.effects,scaleSymbolsProportionally:t.scaleSymbolsProportionally,alignment:s,anchorPoint:{x:g,y:d},isAbsoluteAnchorPoint:!1,size:t.size,rotation:F(v,o,"Rotation",a,b),offsetX:F(v,o,"OffsetX",a,N),offsetY:F(v,o,"OffsetY",a,k),color:{r:0,g:0,b:0,a:0},outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,scaleX:1,frameHeight:m,rotateClockwise:t.rotateClockwise,referenceSize:f,sizeRatio:S/(0,_core_screenUtils_js__WEBPACK_IMPORTED_MODULE_8__.F2)(t.size),markerPlacement:t.markerPlacement};l.push(C)}function A(e){if(e&&0===e.indexOf("Level_")){const t=parseInt(e.substr(6),10);if(NaN!==t)return t}return 0}function j(e){if(!e||0===e.length)return null;const t=new _Color_js__WEBPACK_IMPORTED_MODULE_3__.Z(e).toRgba();return{r:t[0],g:t[1],b:t[2],a:t[3]}}function F(e,t,i,r,n,a,l){const c=t[e];if(c){const e=c[i];if("string"==typeof e||"number"==typeof e||e instanceof Array)return a?a.call(null,e,l):e;if(null!=e&&e instanceof _support_arcadeOnDemand_js__WEBPACK_IMPORTED_MODULE_2__.mz)return(t,i,o)=>{let c=(0,_views_2d_arcade_callExpressionWithFeature_js__WEBPACK_IMPORTED_MODULE_4__.Z)(e,t,{$view:o},r.geometryType,i);return null!==c&&a&&(c=a.call(null,c,l)),null!==c?c:n}}return n}function W(t,i,r,n){for(const e of r)if(e.valueExpressionInfo){const t=i[e.primitiveName]&&i[e.primitiveName][e.propertyName];t instanceof _support_arcadeOnDemand_js__WEBPACK_IMPORTED_MODULE_2__.mz&&(e.fn=(e,i,o)=>(0,_views_2d_arcade_callExpressionWithFeature_js__WEBPACK_IMPORTED_MODULE_4__.Z)(t,e,{$view:o},n.geometryType,i))}return(i,o,n)=>{for(const e of r)e.fn&&(e.value=e.fn(i,o,n));return(0,_core_string_js__WEBPACK_IMPORTED_MODULE_0__.hP)(t+_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_5__.E0.buildOverrideKey(r)).toString()}}function T(e,t){if(!t||0===t.length)return e;const i=JSON.parse(JSON.stringify(e));return _CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_5__.E0.applyOverrides(i,t),i}}}]);