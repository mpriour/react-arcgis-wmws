{"version":3,"file":"ImageryLayerView3D.f379e560.js","sources":["../../node_modules/@arcgis/core/views/3d/layers/ImageryLayerView3D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import{isNone as t}from\"../../../core/maybe.js\";import{debounce as a}from\"../../../core/promiseUtils.js\";import{whenOnce as i}from\"../../../core/watchUtils.js\";import\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as r}from\"../../../core/accessorSupport/decorators/subclass.js\";import s from\"./DynamicLayerView3D.js\";import{ImageryLayerView as o}from\"../../layers/ImageryLayerView.js\";let m=class extends(o(s)){constructor(){super(...arguments),this.type=\"imagery-3d\",this.redrawDebounced=a((async e=>{this.redraw(((e,t)=>this._redrawImage(e,t)),e)}),2e3)}initialize(){this.handles.add([i(this.view.basemapTerrain,\"ready\",(()=>this.initializeMaximumDataResolution())),this.layer.on(\"redraw\",(()=>this.redrawDebounced()))]),this.updatingHandles.add(this.layer,\"exportImageServiceParameters.version\",(()=>{this.updatingHandles.addPromise(this.refreshDebounced())})),this.updatingHandles.add(this,\"timeExtent\",(()=>this.updatingHandles.addPromise(this.refreshDebounced())))}initializeMaximumDataResolution(){const e=this.view.basemapTerrain.spatialReference,t=this.layer.fullExtent;t&&e.equals(t.spatialReference)&&(this.maximumDataResolution={x:this.layer.pixelSizeX,y:this.layer.pixelSizeY})}getFetchOptions(){return{timeExtent:this.timeExtent}}async processResult(e,t,a){t.imageElement?e.image=t.imageElement:(e.image=document.createElement(\"canvas\"),e.pixelData=t.pixelData,await this._redrawImage(e,a))}async _redrawImage(e,a){if(!(e.image instanceof HTMLCanvasElement)||t(e.pixelData))return Promise.reject();const i=e.image,r=i.getContext(\"2d\"),s=await this.layer.applyRenderer(e.pixelData,{signal:a}),o=this.layer.applyFilter(s).pixelBlock;if(t(o))return Promise.reject();i.width=o.width,i.height=o.height;const m=r.createImageData(o.width,o.height);m.data.set(o.getAsRGBA()),r.putImageData(m,0,0)}};m=e([r(\"esri.views.3d.layers.ImageryLayerView3D\")],m);var n=m;export{n as default};\n"],"names":["m","o","s","constructor","arguments","this","type","redrawDebounced","a","async","e2","redraw","e3","t2","_redrawImage","initialize","handles","add","i","view","basemapTerrain","initializeMaximumDataResolution","layer","on","updatingHandles","addPromise","refreshDebounced","spatialReference","fullExtent","equals","maximumDataResolution","x","pixelSizeX","y","pixelSizeY","getFetchOptions","timeExtent","a2","imageElement","image","document","createElement","pixelData","HTMLCanvasElement","t","Promise","reject","r","getContext","applyRenderer","signal","applyFilter","pixelBlock","width","height","m2","createImageData","data","set","getAsRGBA","putImageData","e","n"],"mappings":"gVAI0jB,IAAIA,EAAE,cAAcC,EAAEC,IAAIC,uBAAuBC,WAAWC,KAAKC,KAAK,aAAaD,KAAKE,gBAAgBC,GAAGC,MAAMC,SAASC,QAAQ,CAACC,EAAEC,IAAIR,KAAKS,aAAaF,EAAEC,IAAIH,KAAK,KAAKK,kBAAkBC,QAAQC,IAAI,CAACC,EAAEb,KAAKc,KAAKC,eAAe,SAAS,IAAIf,KAAKgB,oCAAoChB,KAAKiB,MAAMC,GAAG,UAAU,IAAIlB,KAAKE,sBAAsBF,KAAKmB,gBAAgBP,IAAIZ,KAAKiB,MAAM,wCAAwC,UAAUE,gBAAgBC,WAAWpB,KAAKqB,uBAAuBrB,KAAKmB,gBAAgBP,IAAIZ,KAAK,cAAc,IAAIA,KAAKmB,gBAAgBC,WAAWpB,KAAKqB,sBAAsBL,wCAAwCX,EAAEL,KAAKc,KAAKC,eAAeO,iBAAiBd,EAAER,KAAKiB,MAAMM,cAAclB,EAAEmB,OAAOhB,EAAEc,yBAAyBG,sBAAsB,CAACC,EAAE1B,KAAKiB,MAAMU,WAAWC,EAAE5B,KAAKiB,MAAMY,aAAaC,wBAAwB,CAACC,WAAW/B,KAAK+B,gCAAgC1B,EAAEG,EAAEwB,KAAKC,aAAa5B,EAAE6B,MAAM1B,EAAEyB,gBAAgBC,MAAMC,SAASC,cAAc,UAAU/B,EAAEgC,UAAU7B,EAAE6B,gBAAgBrC,KAAKS,aAAaJ,EAAE2B,uBAAuB3B,EAAE2B,UAAUE,iBAAiBI,oBAAoBC,EAAElC,EAAEgC,kBAAkBG,QAAQC,eAAe5B,EAAER,EAAE6B,MAAMQ,EAAE7B,EAAE8B,WAAW,MAAM9C,QAAQG,KAAKiB,MAAM2B,cAAcvC,EAAEgC,UAAU,CAACQ,OAAOb,IAAIpC,EAAEI,KAAKiB,MAAM6B,YAAYjD,GAAGkD,cAAcR,EAAE3C,UAAU4C,QAAQC,WAAWO,MAAMpD,EAAEoD,MAAMnC,EAAEoC,OAAOrD,EAAEqD,aAAaC,EAAER,EAAES,gBAAgBvD,EAAEoD,MAAMpD,EAAEqD,UAAUG,KAAKC,IAAIzD,EAAE0D,aAAaZ,EAAEa,aAAaL,EAAE,EAAE,KAAKvD,EAAE6D,EAAE,CAACd,EAAE,4CAA4C/C,GAAM,IAAC8D,EAAE9D"}