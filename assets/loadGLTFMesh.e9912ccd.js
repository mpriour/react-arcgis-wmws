import{qC as t,N as e,B as n,qD as o,qE as r,qz as s,a1 as a,jM as i,qF as c,oJ as l,qA as u,gG as f,gV as p,qG as m,qH as g,qI as d,ew as x,m9 as q,qJ as h,cs as v,oK as w,gL as y,gT as b,g_ as C,gU as M,qK as A,qL as T,qM as B,qN as $,qO as F,qP as S,qQ as E,qR as L,qS as N,qT as O,qU as R,gO as j,qV as I,qW as V,qX as z,qY as G,qZ as K,M as U,q_ as D}from"./vendor.7103ff48.js";import{b as J}from"./georeference.6f09914a.js";async function P(h,w,y){const b=new t(function(t){return null!=t&&t.resolveFile?{busy:!1,request:async(o,r,s)=>{const a=t.resolveFile(o),i="image"===r?"image":"binary"===r?"array-buffer":"json";return(await e(a,{responseType:i,signal:n(s)?s.signal:null})).data}}:null}(y)),C=(await o(b,w,y,!0)).model,M=C.lods.shift(),A=new Map,T=new Map;C.textures.forEach(((t,e)=>A.set(e,function(t){return new r({data:t.data,wrap:W(t.parameters.wrap)})}(t)))),C.materials.forEach(((t,e)=>T.set(e,function(t,e){const n=new x(function(t,e){return q(Y(t[0]),Y(t[1]),Y(t[2]),e)}(t.color,t.opacity)),o=t.emissiveFactor?new x((r=t.emissiveFactor,v(Y(r[0]),Y(r[1]),Y(r[2])))):null;var r;return new s({color:n,colorTexture:a(i(t.textureColor,(t=>e.get(t)))),normalTexture:a(i(t.textureNormal,(t=>e.get(t)))),emissiveColor:o,emissiveTexture:a(i(t.textureEmissive,(t=>e.get(t)))),occlusionTexture:a(i(t.textureOcclusion,(t=>e.get(t)))),alphaMode:H(t.alphaMode),alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,metallic:t.metallicFactor,roughness:t.roughnessFactor,metallicRoughnessTexture:a(i(t.textureMetallicRoughness,(t=>e.get(t))))})}(t,A))));const B=function(t){let e=0;const n={color:!1,tangent:!1,normal:!1,texCoord0:!1},o=new Map,r=new Map,s=[];for(const a of t.parts){const{attributes:{position:t,normal:i,color:c,tangent:l,texCoord0:f}}=a,p=`\n      ${Q(t,o)}/\n      ${Q(i,o)}/\n      ${Q(c,o)}/\n      ${Q(l,o)}/\n      ${Q(f,o)}/\n      ${_(a.transform)}\n    `;let m=!1;const g=u(r,p,(()=>(m=!0,{start:e,length:t.count})));m&&(e+=t.count),i&&(n.normal=!0),c&&(n.color=!0),l&&(n.tangent=!0),f&&(n.texCoord0=!0),s.push({gltf:a,writeVertices:m,region:g})}return{vertexAttributes:{position:c(f,e),normal:n.normal?c(p,e):null,tangent:n.tangent?c(m,e):null,color:n.color?c(g,e):null,texCoord0:n.texCoord0?c(d,e):null},parts:s,components:[]}}(M);for(const t of B.parts)k(B,t,T);const{position:$,normal:F,tangent:S,color:E,texCoord0:L}=B.vertexAttributes,N={position:$.typedBuffer,normal:n(F)?F.typedBuffer:null,tangent:n(S)?S.typedBuffer:null,uv:n(L)?L.typedBuffer:null,color:n(E)?E.typedBuffer:null},O=J(N,h,y);return{transform:O.transform,components:B.components,spatialReference:h.spatialReference,vertexAttributes:new l({position:O.vertexAttributes.position,normal:O.vertexAttributes.normal,tangent:O.vertexAttributes.tangent,color:N.color,uv:N.uv})}}function Q(t,e){if(U(t))return"-";const n=t.typedBuffer;return`${u(e,n.buffer,(()=>e.size))}/${n.byteOffset}/${n.byteLength}`}function _(t){return n(t)?t.toString():"-"}function k(t,e,o){e.writeVertices&&function(t,e){const{position:o,normal:r,tangent:s,color:a,texCoord0:i}=t.vertexAttributes,c=e.region.start,{attributes:l,transform:u}=e.gltf,f=l.position.count;if(y(o.slice(c,f),l.position,u),n(l.normal)&&n(r)){const t=b(C(),u);M(r.slice(c,f),l.normal,t)}else n(r)&&A(r,0,0,1,{dstIndex:c,count:f});if(n(l.tangent)&&n(s)){const t=b(C(),u);T(s.slice(c,f),l.tangent,t)}else n(s)&&B(s,0,0,1,1,{dstIndex:c,count:f});if(n(l.texCoord0)&&n(i)?$(i.slice(c,f),l.texCoord0):n(i)&&F(i,0,0,{dstIndex:c,count:f}),n(l.color)&&n(a)){const t=l.color,e=a.slice(c,f);if(4===t.elementCount)t instanceof m?S(e,t,255):t instanceof g?E(e,t):t instanceof L&&N(e,t,8);else{B(e,255,255,255,255);const n=O.fromTypedArray(e.typedBuffer,e.typedBufferStride);t instanceof p?R(n,t,255):t instanceof O?j(n,t):t instanceof I&&V(n,t,8)}}else n(a)&&B(a.slice(c,f),255,255,255,255)}(t,e);const r=e.gltf,s=function(t,e){switch(e){case 4:return K(t,D);case 5:return G(t);case 6:return z(t)}}(r.indices||r.attributes.position.count,r.primitiveType),a=e.region.start;if(a)for(let n=0;n<s.length;n++)s[n]+=a;t.components.push(new w({faces:s,material:o.get(r.material),trustSourceNormals:!0}))}function H(t){switch(t){case"OPAQUE":return"opaque";case"MASK":return"mask";case"BLEND":return"blend"}}function W(t){return{horizontal:X(t.s),vertical:X(t.t)}}function X(t){switch(t){case 33071:return"clamp";case 33648:return"mirror";case 10497:return"repeat"}}function Y(t){return t**(1/h)*255}export{P as loadGLTFMesh};
//# sourceMappingURL=loadGLTFMesh.e9912ccd.js.map
