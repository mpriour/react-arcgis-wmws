{"version":3,"file":"SliceLayerView3D.d6bfea66.js","sources":["../../node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/ScreenSizeScaling.glsl.js","../../node_modules/@arcgis/core/chunks/ShadedColorMaterial.glsl.js","../../node_modules/@arcgis/core/views/3d/interactive/Manipulator3D.js","../../node_modules/@arcgis/core/views/3d/webgl-engine/shaders/ShadedColorMaterialTechnique.js","../../node_modules/@arcgis/core/views/3d/webgl-engine/materials/ShadedColorMaterial.js","../../node_modules/@arcgis/core/views/3d/interactive/analysisTools/slice/sliceToolConfig.js","../../node_modules/@arcgis/core/chunks/SlicePlaneMaterial.glsl.js","../../node_modules/@arcgis/core/views/3d/webgl-engine/shaders/SlicePlaneMaterialTechnique.js","../../node_modules/@arcgis/core/views/3d/webgl-engine/materials/SlicePlaneMaterial.js","../../node_modules/@arcgis/core/views/3d/interactive/visualElements/SlicePlaneVisualElement.js","../../node_modules/@arcgis/core/widgets/Slice/SlicePlane.js","../../node_modules/@arcgis/core/views/3d/interactive/analysisTools/slice/sliceToolUtils.js","../../node_modules/@arcgis/core/views/3d/interactive/manipulatorUtils.js","../../node_modules/@arcgis/core/views/3d/interactive/graphics/Slice/SliceController.js","../../node_modules/@arcgis/core/views/3d/interactive/graphics/Slice/SliceView.js","../../node_modules/@arcgis/core/views/3d/layers/analysis/Slice/SliceLayerViewData.js","../../node_modules/@arcgis/core/views/3d/layers/SliceLayerView3D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{glsl as e}from\"../shaderModules/interfaces.js\";function i(i){i.vertex.uniforms.add(\"camPos\",\"vec3\").add(\"perScreenPixelRatio\",\"float\").add(\"screenSize\",\"float\"),i.vertex.code.add(e`float computeRenderPixelSizeAt( vec3 pWorld ){\nvec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);\nfloat viewDirectionDistance = abs(dot(viewForward, pWorld - camPos));\nreturn viewDirectionDistance*perScreenPixelRatio;\n}\nvec3 screenSizeScaling(vec3 position, vec3 anchor){\nreturn position * screenSize * computeRenderPixelSizeAt(anchor) + anchor;\n}`)}function r(e,i,r){e.setUniform1f(\"perScreenPixelRatio\",r.camera.perScreenPixelRatio),e.setUniform1f(\"screenSize\",i.screenSize)}export{i as ScreenSizeScaling,r as bindScreenSizeScalingUniforms};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{ScreenSizeScaling as e}from\"../views/3d/webgl-engine/core/shaderLibrary/ScreenSizeScaling.glsl.js\";import{Slice as r}from\"../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl.js\";import{Transform as o}from\"../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl.js\";import{ReadLinearDepth as i}from\"../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl.js\";import{multipassTerrainTest as a}from\"../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl.js\";import{symbolAlphaCutoff as d}from\"../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl.js\";import{ColorConversion as l}from\"../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl.js\";import{glsl as n}from\"../views/3d/webgl-engine/core/shaderModules/interfaces.js\";import{ShaderBuilder as s}from\"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder.js\";function t(t){const c=new s;return c.include(o,{linearDepth:!1}),c.include(e,{}),c.include(r,t),c.fragment.include(l),c.vertex.uniforms.add(\"proj\",\"mat4\").add(\"view\",\"mat4\"),c.fragment.uniforms.add(\"color\",\"vec4\"),c.attributes.add(\"position\",\"vec3\"),c.varyings.add(\"vWorldPosition\",\"vec3\"),t.multipassTerrainEnabled&&c.varyings.add(\"depth\",\"float\"),t.screenSizeEnabled&&c.attributes.add(\"offset\",\"vec3\"),t.shadingEnabled&&(c.vertex.uniforms.add(\"viewNormal\",\"mat4\"),c.fragment.uniforms.add(\"shadedColor\",\"vec4\").add(\"shadingDirection\",\"vec3\"),c.attributes.add(\"normal\",\"vec3\"),c.varyings.add(\"vViewNormal\",\"vec3\")),c.vertex.code.add(n`\n    void main(void) {\n      vWorldPosition = ${t.screenSizeEnabled?\"screenSizeScaling(offset, position)\":\"position\"};\n  `),t.shadingEnabled&&c.vertex.code.add(n`vec3 worldNormal = normal;\nvViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;`),c.vertex.code.add(n`\n    ${t.multipassTerrainEnabled?\"depth = (view * vec4(vWorldPosition, 1.0)).z;\":\"\"}\n    gl_Position = transformPosition(proj, view, vWorldPosition);\n  }\n  `),t.multipassTerrainEnabled&&(c.fragment.include(i),c.include(a,t)),c.fragment.code.add(n`\n    void main() {\n      discardBySlice(vWorldPosition);\n      ${t.multipassTerrainEnabled?\"terrainDepthTest(gl_FragCoord, depth);\":\"\"}\n    `),t.shadingEnabled?c.fragment.code.add(n`vec3 viewNormalNorm = normalize(vViewNormal);\nfloat shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);\nvec4 finalColor = mix(color, shadedColor, shadingFactor);`):c.fragment.code.add(n`vec4 finalColor = color;`),c.fragment.code.add(n`\n      if (finalColor.a < ${n.float(d)}) {\n        discard;\n      }\n      ${7===t.output?n`gl_FragColor = vec4(finalColor.a);`:\"\"}\n\n      ${0===t.output?n`gl_FragColor = highlightSlice(finalColor, vWorldPosition); ${t.OITEnabled?\"gl_FragColor = premultiplyAlpha(gl_FragColor);\":\"\"}`:\"\"}\n    }\n    `),c}var c=Object.freeze({__proto__:null,build:t});export{c as S,t as b};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport\"../../../geometry.js\";import{neverReached as e}from\"../../../core/compilerUtils.js\";import t from\"../../../core/Evented.js\";import{deg2rad as i}from\"../../../core/mathUtils.js\";import{isSome as s,isNone as o,unwrapOr as r,unwrap as n}from\"../../../core/maybe.js\";import{createScreenPointArray as a,createRenderScreenPointArray3 as c,screenPointObjectToArray as l,castRenderScreenPointArray as h}from\"../../../core/screenUtils.js\";import{once as d}from\"../../../core/accessorSupport/utils.js\";import{f as u}from\"../../../chunks/mat3.js\";import{c as _}from\"../../../chunks/mat3f64.js\";import{e as g,s as m,m as f,i as p}from\"../../../chunks/mat4.js\";import{c as v}from\"../../../chunks/mat4f64.js\";import{j as b}from\"../../../chunks/vec2.js\";import{b as y,t as j,m as L,a as S,g as R,h as w,s as O,f as T}from\"../../../chunks/vec3.js\";import{c as E,Z as A}from\"../../../chunks/vec3f64.js\";import{canProjectWithoutEngine as D,projectPoint as F,sphericalPCPFtoLonLatElevation as z,computeENUToSphericalPCPFLocalRotation as k}from\"../../../geometry/projection.js\";import{getReferenceEllipsoid as P}from\"../../../geometry/projectionEllipsoid.js\";import{containsPointObject as I}from\"../../../geometry/support/aaBoundingRect.js\";import{create as M,distance2 as C,fromPoints as x,closestRayDistance2 as B}from\"../../../geometry/support/lineSegment.js\";import{create as W,fromPositionAndNormal as V,intersectRay as H}from\"../../../geometry/support/plane.js\";import{create as U}from\"../../../geometry/support/ray.js\";import{sv3d as G}from\"../../../geometry/support/vectorStacks.js\";import{clonePoint as Z}from\"../../../layers/graphics/hydratedFeatures.js\";import{getElevationAtPoint as q}from\"../support/ElevationProvider.js\";import{fromScreen as J}from\"../support/geometryUtils/ray.js\";import K from\"../webgl-engine/lib/Camera.js\";import{Object3D as N}from\"../webgl-engine/lib/Object3D.js\";import{WebGLLayer as Q}from\"../webgl-engine/lib/WebGLLayer.js\";import X from\"../../../geometry/Point.js\";class Y{constructor(e){this.idHint=0,this.camera=new K,this._elevation={offset:0,override:null},this.collisionType={type:\"point\"},this.collisionPriority=0,this._renderObjects=[],this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=v(),this._worldFrame=null,this._renderLocation=E(),this._renderLocationDirty=!0,this._location=new X({x:0,y:0,z:0}),this._elevationAlignedLocation=new X,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=0,this._focused=!1,this.events=new t.EventEmitter,this._screenLocation={screenPointArray:a(),renderScreenPointArray:c(),pixelSize:0},this._screenLocationDirty=!0,this._applyObjectTransform=null,this._engineResourcesAddedToStage=!1,this._engineResources=null,this._attached=!1,this._engineLayer=null,this._materialIdReferences=null,this._location.spatialReference=e.view.spatialReference;for(const t in e)this[t]=e[t];this.view.state&&this.view.state.camera&&this.camera.copyFrom(this.view.state.camera)}destroy(){this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this.camera=null}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),{remove:d((()=>{this._noDisplayCount--,0===this._noDisplayCount&&this._updateEngineObject()}))}}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){$(e)&&(this._screenLocationDirty=!0),g(this._modelTransform,e),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=v()),ee(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(e){Z(e,this._location),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit(\"location-update\",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){Z(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit(\"location-update\",{location:this._location})}_updateElevationAlignedLocation(){this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y;const e=s(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=this.location.spatialReference,this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit(\"select-changed\",{action:e?\"select\":\"deselect\"}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject())}updateStateEnabled(e,t){t?this.state|=e:this.state&=~e}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit(\"focus-changed\",{action:!0===e?\"focus\":\"unfocus\"}))}get focused(){return this._focused}get screenLocation(){return this.ensureScreenLocation(),this._screenLocation}ensureScreenLocation(){if(!this._screenLocationDirty)return;this._screenLocation.pixelSize=this.camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1;let e;if($(this._modelTransform)){const t=this._calculateModelTransformOffset(_e);e=y(t,t,this.renderLocation)}else e=this.renderLocation;this.camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this.camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}intersectionDistance(t,i){if(!this.available)return null;const s=l(t,te),r=this._getCollisionRadius(i),n=-1*this.collisionPriority;switch(this.collisionType.type){case\"point\":if(b(this.screenLocation.screenPointArray,s)<r*r)return this.screenLocation.renderScreenPointArray[2]+n;break;case\"line\":{const e=this.collisionType.paths,t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,ne),a=r*this.screenLocation.pixelSize,c=J(this.camera,s,se);if(o(c))return null;for(const s of e){if(0===s.length)continue;const e=L(ce,s[0],i);for(let t=1;t<s.length;t++){const o=L(le,s[t],i),r=B(x(e,o,ie),c);if(null!=r&&r<a*a){const t=y(G.get(),e,o);S(t,t,.5);const i=h(G.get());return this.camera.projectToRenderScreen(t,i),i[2]+n}R(e,o)}}break}case\"disc\":{var a;const e=this.collisionType.direction,t=null!=(a=this.collisionType.offset)?a:A,i=this._getWorldToScreenObjectScale(),c=this._calculateObjectTransform(i,ne),l=r*this.screenLocation.pixelSize,h=J(this.camera,s,se);if(o(h))return null;const d=u(oe,c),_=j(de,e,d),g=L(ue,t,c);V(g,_,ae);const m=he;if(H(ae,h,m)&&w(m,g)<l*l)return this.screenLocation.renderScreenPointArray[2]+n;break}case\"ribbon\":{const{paths:e,direction:t}=this.collisionType,i=this._getWorldToScreenObjectScale(),a=this._calculateObjectTransform(i,ne),c=r*this.camera.computeScreenPixelSizeAt(this.renderLocation),l=J(this.camera,s,se);if(o(l))return null;const d=u(oe,a),_=j(de,t,d),g=this._calculateModelTransformPosition(ue);V(g,_,ae);const m=he;if(!H(ae,l,m))break;for(const s of e){if(0===s.length)continue;const e=L(ce,s[0],a);for(let t=1;t<s.length;t++){const i=L(le,s[t],a),o=C(x(e,i,ie),m);if(null!=o&&o<c*c){const t=y(G.get(),e,i);S(t,t,.5);const s=h(G.get());return this.camera.projectToRenderScreen(t,s),s[2]+n}R(e,i)}}break}default:e(this.collisionType)}return null}attach(e={manipulator3D:{}}){var t;if(!this.view._stage)return;const i=e.manipulator3D;if(o(i.engineLayerId)){const e=new Q({isPickable:!1,updatePolicy:1});this.view._stage.add(e),i.engineLayerId=e.id,this._engineLayer=e}else null!=(t=this.view._stage)&&t.getObject&&(this._engineLayer=this.view._stage.getObject(i.engineLayerId));i.engineLayerReferences=(i.engineLayerReferences||0)+1,this._materialIdReferences=i.materialIdReferences,o(this._materialIdReferences)&&(this._materialIdReferences=new Map,i.materialIdReferences=this._materialIdReferences),this.camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),D(this._location.spatialReference,this.view.spatialReference)||(this.location=new X({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(e={manipulator3D:{}}){const t=e.manipulator3D;t.engineLayerReferences--;const i=0===t.engineLayerReferences;i&&(t.engineLayerId=null),this._removeResourcesFromStage(i),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this.camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(e){F(this.location,ge,e.spatialReference),I(e.extent,ge)&&(this.location=this._location)}_evaluateElevationAlignment(e=this.location){if(o(this.elevationInfo))return!1;let t=null,i=0;const s=r(this.elevationInfo.offset,0);switch(this.elevationInfo.mode){case\"on-the-ground\":t=r(q(this.view.elevationProvider,e,\"ground\"),0);break;case\"relative-to-ground\":i=r(q(this.view.elevationProvider,e,\"ground\"),0)+s;break;case\"relative-to-scene\":i=r(q(this.view.elevationProvider,e,\"scene\"),0)+s;break;case\"absolute-height\":i=s}return(i!==this._elevation.offset||t!==this._elevation.override)&&(this._elevation.offset=i,this._elevation.override=t,!0)}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const e=this._getWorldToScreenObjectScale(),t=ne;if(!0===this.autoScaleRenderObjects){const i=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(i,t)}else this._calculateObjectTransform(e,t);const{objectsByState:i}=this._ensureEngineResources(),s=(this.focused?2:1)|(this.selected?8:4),o=this._noDisplayCount>0;for(const{stateMask:r,objects:n}of i){if(o){for(const e of n)e.setVisible(!1);continue}const e=!(0!=(15&r))||(s&r)==(15&r),i=!(0!=(65520&r))||(this.state&r)==(65520&r);if(e&&i)for(const s of n)s.setVisible(!0),s.transformation=t;else for(const t of n)t.setVisible(!1)}}_ensureEngineResources(){if(o(this._engineResources)){const e=n(this._engineLayer),t=[],i=new Set;this.renderObjects.forEach((({material:e})=>{i.has(e)||(t.push(e),i.add(e))}));const s=(e,t)=>{const{geometry:i,material:s,transform:o}=t;Array.isArray(i)?i.forEach((t=>e.addGeometry(t,s,o))):e.addGeometry(i,s,o)},o=new Map;this._renderObjects.forEach((e=>{const t=new N({castShadow:!1});s(t,e);const i=e.stateMask||0,r=o.get(i)||[];r.push(t),o.set(i,r)}));const r=[];o.forEach(((e,t)=>r.push({stateMask:t,objects:e}))),this._engineResources={objectsByState:r,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){if(this._engineResourcesAddedToStage||o(this._engineResources))return;const{objectsByState:e,layer:t,materials:i}=this._engineResources;i.forEach((e=>{const t=n(this._materialIdReferences),i=t.get(e.id)||0;0===i&&this.view._stage.add(e),t.set(e.id,i+1)})),e.forEach((({objects:e})=>{t.addMany(e),this.view._stage.addMany(e)})),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(e=!1){if(!this._engineResourcesAddedToStage||o(this._engineResources))return;const{objectsByState:t,layer:i,materials:s}=this._engineResources;t.forEach((({objects:e})=>{i.removeMany(e),this.view._stage.removeMany(e)})),s.forEach((e=>{const t=n(this._materialIdReferences),i=t.get(e.id);1===i?(this.view._stage.remove(e),t.delete(e.id)):t.set(e.id,i-1)})),e&&this.view._stage.remove(i),this._engineResourcesAddedToStage=!1}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*(\"touch\"===e?this.touchMultiplier:1)}_getFocusedSize(e,t){return e*(t?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){const t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,re);return O(e,i[12],i[13],i[14])}_calculateModelTransformOffset(e){const t=this._calculateModelTransformPosition(e);return T(e,t,this.renderLocation)}_calculateObjectTransform(e,t){return m(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&f(t,t,this._worldFrame),f(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,s(this._applyObjectTransform)&&this._applyObjectTransform(t),t}get test(){let e=!1;if(s(this._engineResources))for(const t in this._engineResources.objectsByState){const i=this._engineResources.objectsByState[t];for(const t of i.objects)if(t.isVisible){e=!0;break}if(e)break}return{areAnyResourcesVisible:e}}}function $(e){return 0!==e[12]||0!==e[13]||0!==e[14]}function ee(e,t,s){switch(e.viewingMode){case\"local\":return p(s),!0;case\"global\":{const o=P(e.renderCoordsHelper.spatialReference);return z(t,0,ce,0,o.radius),k(i(ce[0]),i(ce[1]),s),!0}}}const te=a(),ie=M(),se=U(),oe=_(),re=v(),ne=v(),ae=W(),ce=E(),le=E(),he=E(),de=E(),ue=E(),_e=E(),ge=new X({x:0,y:0,z:0,spatialReference:null});export{Y as Manipulator3D};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import{c as r}from\"../../../../chunks/vec4f64.js\";import{bindScreenSizeScalingUniforms as i}from\"../core/shaderLibrary/ScreenSizeScaling.glsl.js\";import{bindSliceUniformsWithOrigin as t}from\"../core/shaderLibrary/Slice.glsl.js\";import{bindMultipassTerrainTexture as o}from\"../core/shaderLibrary/shading/MultipassTerrainTest.glsl.js\";import{bindProjectionMatrix as s,bindView as a,bindCameraPosition as n}from\"../core/shaderLibrary/util/View.glsl.js\";import{ReloadableShaderModule as l}from\"../core/shaderTechnique/ReloadableShaderModule.js\";import{ShaderTechnique as p}from\"../core/shaderTechnique/ShaderTechnique.js\";import{parameter as d,ShaderTechniqueConfiguration as c}from\"../core/shaderTechnique/ShaderTechniqueConfiguration.js\";import{blendingDefault as h,OITBlending as m,OITDepthWrite as u,OITPolygonOffset as g}from\"../lib/OrderIndependentTransparency.js\";import{Program as b}from\"../lib/Program.js\";import{S as f}from\"../../../../chunks/ShadedColorMaterial.glsl.js\";import{makePipelineState as v,cullingParams as y,defaultDepthWriteParams as T,defaultColorWriteParams as E}from\"../../../webgl/renderState.js\";class S extends p{initializeProgram(e){const r=S.shader.get(),i=this.configuration,t=r.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,screenSizeEnabled:i.screenSizeEnabled,shadingEnabled:i.shadingEnabled,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new b(e.rctx,t,P)}bindPass(e,r){const{screenSizeEnabled:t,shadingEnabled:a}=this.configuration,{color:n,shadingTint:l,shadingDirection:p}=e;s(this.program,r.camera.projectionMatrix),this.program.setUniform4fv(\"color\",n),r.multipassTerrainEnabled&&(this.program.setUniform2fv(\"cameraNearFar\",r.camera.nearFar),this.program.setUniform2fv(\"inverseViewport\",r.inverseViewport),o(this.program,r)),a&&(this.program.setUniform4fv(\"shadedColor\",this.blendColor(w,l,n)),this.program.setUniform3fv(\"shadingDirection\",p),this.program.setUniformMatrix4fv(\"viewNormal\",r.camera.viewInverseTransposeMatrix)),t&&i(this.program,e,r)}bindDraw(e){a(this.program,e),n(this.program,e.origin,e.camera.viewInverseTransposeMatrix),t(this.program,this.configuration,e),this.program.rebindTextures()}blendColor(e,r,i){const t=1-r[3],o=r[3]+i[3]*t;return 0===o?(e[3]=o,e):(e[0]=(r[0]*r[3]+i[0]*i[3]*t)/o,e[1]=(r[1]*r[3]+i[1]*i[3]*t)/o,e[2]=(r[2]*r[3]+i[2]*i[3]*t)/o,e[3]=i[3],e)}setPipelineState(e){const r=this.configuration,i=3===e,t=2===e;return v({blending:0!==r.output&&7!==r.output||!r.transparent?null:i?h:m(e),culling:y(r.cullFace),depthTest:{func:t?513:r.shadingEnabled?515:513},depthWrite:i?r.writeDepth&&T:u(e),colorWrite:E,polygonOffset:i||t?null:g})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}S.shader=new l(f,(()=>import(\"./ShadedColorMaterial.glsl.js\")));class j extends c{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}e([d({count:8})],j.prototype,\"output\",void 0),e([d({count:3})],j.prototype,\"cullFace\",void 0),e([d()],j.prototype,\"slicePlaneEnabled\",void 0),e([d()],j.prototype,\"transparent\",void 0),e([d()],j.prototype,\"writeDepth\",void 0),e([d()],j.prototype,\"screenSizeEnabled\",void 0),e([d()],j.prototype,\"shadingEnabled\",void 0),e([d({count:4})],j.prototype,\"transparencyPassType\",void 0),e([d()],j.prototype,\"multipassTerrainEnabled\",void 0),e([d()],j.prototype,\"cullAboveGround\",void 0);const P=new Map([[\"position\",0],[\"normal\",1],[\"offset\",2]]),w=r();export{S as ShadedColorMaterialTechnique,j as ShadedColorMaterialTechniqueConfiguration,P as ShadedColorMaterialVertexAttrLocations};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{n as e,s as t,a as r,b as i}from\"../../../../chunks/vec3.js\";import{c as s}from\"../../../../chunks/vec3f64.js\";import{center as a,scale as n}from\"../../../../geometry/support/aaBoundingBox.js\";import{BufferViewVec3f as o}from\"../../../../geometry/support/buffer/BufferView.js\";import{newLayout as u}from\"../../support/buffer/InterleavedLayout.js\";import c from\"../lib/GLMaterial.js\";import{materialParametersDefaults as h,Material as f}from\"../lib/Material.js\";import{assert as l}from\"../lib/Util.js\";import{writeDefaultAttributes as p,writePosition as m}from\"./internal/bufferWriterUtils.js\";import{intersectTriangleGeometry as d}from\"./internal/MaterialUtil.js\";import{ShadedColorMaterialTechniqueConfiguration as b,ShadedColorMaterialVertexAttrLocations as g,ShadedColorMaterialTechnique as q}from\"../shaders/ShadedColorMaterialTechnique.js\";class v extends f{constructor(e){super(e,C),this.supportsEdges=!0,this.techniqueConfig=new b,this._vertexAttributeLocations=g}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.screenSizeEnabled=this.params.screenSizeEnabled,this.techniqueConfig.shadingEnabled=this.params.shadingEnabled,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.params}intersect(e,s,o,u,c,h,f){if(this.params.screenSizeEnabled){const o=e.vertexAttributes.get(\"offset\"),l={applyToVertex:(e,s,a,n)=>{const c=t(P,o.data[3*n+0],o.data[3*n+1],o.data[3*n+2]),h=t(x,e,s,a);return r(c,c,this.params.screenSize*u.camera.computeRenderPixelSizeAt(c)),i(h,h,c),[h[0],h[1],h[2]]},applyToAabb:e=>{const t=a(e,P);return n(e,this.params.screenSize*u.camera.computeRenderPixelSizeAt(t))}};d(e,s,u,c,h,l,f)}else d(e,s,u,c,h,void 0,f)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output?new E(e):void 0}createBufferWriter(){return new S(this.params.screenSizeEnabled)}}class E extends c{constructor(e){super(e),this.updateParameters()}updateParameters(e){this._technique=this._techniqueRep.releaseAndAcquire(q,this._material.getTechniqueConfig(this._output,e),this._technique)}beginSlot(e){if(4===this._output)return 3===e;let t=3;return this._technique.configuration.transparent&&(t=this._technique.configuration.writeDepth?5:8),e===t||23===e}ensureParameters(e){this.updateParameters(e)}bind(e){this._technique.bindPass(this._material.getPassParameters(),e)}}const C={color:[1,1,1,1],shadingTint:[0,0,0,.25],shadingDirection:e(s(),[.5,-.5,-.5]),transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,screenSizeEnabled:!1,screenSize:14,shadingEnabled:!0,...h};class S{constructor(e){this.screenSizeEnabled=e;const t=u().vec3f(\"position\").vec3f(\"normal\");this.screenSizeEnabled&&t.vec3f(\"offset\"),this.vertexBufferLayout=t}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(\"position\").length}write(e,t,r,i){if(p(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,r,i),this.screenSizeEnabled){if(!t.vertexAttributes.has(\"offset\"))throw new Error(\"offset vertex attribute required for screenSizeEnabled ShadedColorMaterial\");{const s=t.vertexAttributes.get(\"offset\"),a=t.indices.get(\"offset\");l(3===s.size);const n=r.getField(\"offset\",o);if(!n)throw new Error(\"unable to acquire view for offset\");m(a,s.data,e.invTranspTransformation,n,i)}}}}const P=s(),x=s();export{v as ShadedColorMaterial};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport o from\"../../../../../core/has.js\";import{deg2rad as t}from\"../../../../../core/mathUtils.js\";const r=o(\"mac\")?\"Meta\":\"Control\",s=\"Shift\",a=2,c=1.15,m=1.15,h=1.1,e=2500,i=.02,f=Math.cos(t(45)),p=Math.cos(t(5)),M=.95,j=.3,l=.7,n=[1,.5,0],x=2,C=1,S=[...n,l],U=[0,0,0,.04],b=[...n,.5],d=[...n,1],g=[1,1,1,1],k=[1,.8,.6,1],q=[1,.93,.86,1],u=[...n,1],v=[...n,1],w=3,y=11,z=22.5,A=40,B=48,D=2.25,E=4,F=1,G=.3,H=6,I=4,J=12,K=40,L=27,N=1600,O=.4;export{a as DISPLAY_FOCUS_MULTIPLIER,b as GRID_COLOR,n as HANDLE_COLOR,l as HANDLE_OPACITY,i as INITIAL_DEPTH_OFFSET_FRAC,O as INITIAL_PLANE_HALF_SIZE_VIEW_PROPORTION,U as PLANE_BACKGROUND_COLOR,N as PLANE_MIN_BASIS_SCREEN_LEN2,S as PLANE_OUTLINE_COLOR,C as PLANE_OUTLINE_WIDTH,x as PLANE_PREVIEW_OUTLINE_WIDTH,e as POINTER_MOVE_TIMER_MS,M as PREVIEW_FADE_DOT_THRESHOLD,j as PREVIEW_FADE_DURATION_SECONDS,H as RESIZE_HANDLE_CORNER_INPUT_RADIUS,E as RESIZE_HANDLE_CORNER_WIDTH,I as RESIZE_HANDLE_EDGE_INPUT_RADIUS,G as RESIZE_HANDLE_EDGE_PADDING_FRAC,F as RESIZE_HANDLE_EDGE_WIDTH,d as ROTATE_HEADING_CALLOUT_COLOR,L as ROTATE_HEADING_DISC_RADIUS,h as ROTATE_HEADING_DISC_RADIUS_FOCUS_MULTIPLIER,K as ROTATE_HEADING_OFFSET_DISTANCE,J as ROTATE_HEADING_TIP_LENGTH,k as SHIFT_RESTART_ARROW_CAP_COLOR,B as SHIFT_RESTART_ARROW_LENGTH,D as SHIFT_RESTART_ARROW_OUTLINE_WIDTH,g as SHIFT_RESTART_ARROW_TIP_COLOR,u as SHIFT_RESTART_CALLOUT_COLOR,A as SHIFT_RESTART_OFFSET_DISTANCE,v as SHIFT_RESTART_OUTLINE_COLOR,m as SHIFT_RESTART_TIP_FOCUS_MULTIPLIER,z as SHIFT_RESTART_TIP_LENGTH,y as SHIFT_RESTART_TIP_RADIUS,q as SHIFT_RESTART_TUBE_COLOR,c as SHIFT_RESTART_TUBE_FOCUS_MULTIPLIER,w as SHIFT_RESTART_TUBE_RADIUS,p as SMALL_ANGLE_DOT_THRESHOLD,f as VERTICAL_DOT_THRESHOLD,r as forceHorizontalModifier,s as forceVerticalModifier};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{glsl as d}from\"../views/3d/webgl-engine/core/shaderModules/interfaces.js\";import{ShaderBuilder as e}from\"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder.js\";function r(){const r=new e;return r.extensions.add(\"GL_OES_standard_derivatives\"),r.vertex.uniforms.add(\"proj\",\"mat4\").add(\"view\",\"mat4\"),r.attributes.add(\"position\",\"vec3\"),r.attributes.add(\"uv0\",\"vec2\"),r.varyings.add(\"vUV\",\"vec2\"),r.vertex.code.add(d`void main(void) {\nvUV = uv0;\ngl_Position = proj * view * vec4(position, 1.0);\n}`),r.fragment.uniforms.add(\"backgroundColor\",\"vec4\").add(\"gridColor\",\"vec4\").add(\"ratio\",\"float\").add(\"gridWidth\",\"float\"),r.fragment.code.add(d`void main() {\nconst float LINE_WIDTH = 1.0;\nvec2 uvScaled = vUV * gridWidth;\nvec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));\nvec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);\ngrid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);\ngrid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);\nfloat gridFade = max(grid.x, grid.y);\nfloat gridAlpha = gridColor.a * gridFade;\ngl_FragColor =\nvec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +\nvec4(gridColor.rgb, 1.0) * gridAlpha;\n}`),r}var a=Object.freeze({__proto__:null,build:r});export{a as S,r as b};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{bindProjectionMatrix as r,bindView as e}from\"../core/shaderLibrary/util/View.glsl.js\";import{ReloadableShaderModule as i}from\"../core/shaderTechnique/ReloadableShaderModule.js\";import{ShaderTechnique as o}from\"../core/shaderTechnique/ShaderTechnique.js\";import{Default3D as t}from\"../lib/DefaultVertexAttributeLocations.js\";import{Program as a}from\"../lib/Program.js\";import{S as s}from\"../../../../chunks/SlicePlaneMaterial.glsl.js\";import{makePipelineState as l,separateBlendingParams as n,defaultColorWriteParams as m}from\"../../../webgl/renderState.js\";class d extends o{initializeProgram(r){const e=d.shader.get().build();return new a(r.rctx,e,t)}bindPass(e,i){r(this.program,i.camera.projectionMatrix),this.program.setUniform4fv(\"backgroundColor\",e.backgroundColor),this.program.setUniform4fv(\"gridColor\",e.gridColor),this.program.setUniform1f(\"gridWidth\",e.gridWidth)}bindDraw(r){e(this.program,r),this.program.rebindTextures()}initializePipeline(){return l({blending:n(1,1,771,771),depthTest:{func:513},colorWrite:m})}}d.shader=new i(s,(()=>import(\"./SlicePlaneMaterial.glsl.js\")));export{d as SlicePlaneMaterialTechnique};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../chunks/tslib.es6.js\";import{autoDispose as r}from\"../lib/AutoDisposable.js\";import e from\"../lib/GLMaterial.js\";import{Material as i,materialParametersDefaults as s}from\"../lib/Material.js\";import{DefaultBufferWriter as o,PositionUVLayout as a}from\"./internal/DefaultBufferWriter.js\";import{intersectTriangleGeometry as n}from\"./internal/MaterialUtil.js\";import{SlicePlaneMaterialTechnique as u}from\"../shaders/SlicePlaneMaterialTechnique.js\";class l extends i{constructor(t){super(t,m)}intersect(t,r,e,i,s,o,a){return n(t,r,i,s,o,void 0,a)}createBufferWriter(){return new o(a)}getGLMaterial(t){return 0===t.output?new c(t):void 0}}class c extends e{constructor(t){super(t),this._technique=new u(this._techniqueRep.constructionContext,null),this.updateParameters()}updateParameters(){}beginSlot(t){return 8===t}bind(t){this._technique.bindPass(this._material.params,t)}}t([r()],c.prototype,\"_technique\",void 0);const m={backgroundColor:[1,0,0,.5],gridColor:[0,1,0,.5],gridWidth:4,...s};export{l as SlicePlaneMaterial};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{isSome as r}from\"../../../../core/maybe.js\";import{c as e}from\"../../../../chunks/vec4.js\";import{f as t}from\"../../../../chunks/vec4f32.js\";import{Object3DVisualElement as i}from\"./Object3DVisualElement.js\";import a from\"../../webgl-engine/lib/GeometryUtil.js\";import{SlicePlaneMaterial as s}from\"../../webgl-engine/materials/SlicePlaneMaterial.js\";class d extends i{constructor(r){super(r),this._material=null,this._renderOccluded=4,this._gridWidth=1,this._gridColor=t(1,0,0,1),this._backgroundColor=t(1,0,0,1),this.applyProps(r)}get renderOccluded(){return this._renderOccluded}set renderOccluded(r){r!==this._renderOccluded&&(this._renderOccluded=r,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(r){this._gridWidth!==r&&(this._gridWidth=r,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(r){e(this._gridColor,r),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(r){e(this._backgroundColor,r),this._updateMaterial()}createExternalResources(){this._material=new s(this.materialParameters)}destroyExternalResources(){this._material=null}forEachExternalMaterial(e){r(this._material)&&e(this._material)}createGeometries(e){if(r(this._material)){const r=a.createSquareGeometry();e.addGeometry(r,this._material)}}get materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded}}_updateMaterial(){r(this._material)&&this._material.setParameterValues(this.materialParameters)}}export{d as SlicePlaneVisualElement};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../chunks/tslib.es6.js\";import\"../../geometry.js\";import{JSONSupport as o}from\"../../core/JSONSupport.js\";import{clone as e}from\"../../core/lang.js\";import{isSome as i}from\"../../core/maybe.js\";import{property as r}from\"../../core/accessorSupport/decorators/property.js\";import{cast as s}from\"../../core/accessorSupport/decorators/cast.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import{subclass as p}from\"../../core/accessorSupport/decorators/subclass.js\";import{ensureNumber as a}from\"../../core/accessorSupport/ensureType.js\";import{persistable as h}from\"../../core/accessorSupport/decorators/persistable.js\";import{cyclicalDeg as n}from\"../../views/3d/support/mathUtils.js\";import m from\"../../geometry/Point.js\";var l;let c=l=class extends o{constructor(t){super(t),this.type=\"plane\",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}clone(){return new l({position:e(this.position),heading:this.heading,tilt:this.tilt,width:this.width,height:this.height})}equals(t){return this.heading===t.heading&&this.tilt===t.tilt&&i(this.position)&&i(t.position)&&this.position.equals(t.position)&&this.width===t.width&&this.height===t.height}};t([r({readOnly:!0,json:{read:!1,write:!0}})],c.prototype,\"type\",void 0),t([r({type:m}),h()],c.prototype,\"position\",void 0),t([r({type:Number,nonNullable:!0,range:{min:0,max:360}}),h(),s((t=>n.normalize(a(t),0,!0)))],c.prototype,\"heading\",void 0),t([r({type:Number,nonNullable:!0,range:{min:0,max:360}}),h(),s((t=>n.normalize(a(t),0,!0)))],c.prototype,\"tilt\",void 0),t([r({type:Number,nonNullable:!0}),h()],c.prototype,\"width\",void 0),t([r({type:Number,nonNullable:!0}),h()],c.prototype,\"height\",void 0),c=l=t([p(\"esri.widgets.Slice.SlicePlane\")],c);var d=c;export{d as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport\"../../../../../geometry.js\";import{neverReached as e}from\"../../../../../core/compilerUtils.js\";import t from\"../../../../../core/Logger.js\";import{rad2deg as i,deg2rad as s}from\"../../../../../core/mathUtils.js\";import{isNone as r,isSome as o,unwrapOr as n}from\"../../../../../core/maybe.js\";import{castRenderScreenPointArray3 as a}from\"../../../../../core/screenUtils.js\";import{r as c,i as l,f as m,m as d,c as g,t as u,x as p}from\"../../../../../chunks/mat4.js\";import{c as f}from\"../../../../../chunks/mat4f64.js\";import{r as b}from\"../../../../../chunks/quat.js\";import{a as h,g as w,d as y,c as j,n as M,b as k,l as v,f as P,p as O,s as T}from\"../../../../../chunks/vec3.js\";import{a as U,c as R,f as S}from\"../../../../../chunks/vec3f64.js\";import{r as L,f as A,i as E,a as C,n as F,u as G}from\"../../../../../chunks/boundedPlane.js\";import{fromPositionAndNormal as x,fromVectorsAndPoint as I}from\"../../../../../geometry/support/plane.js\";import{create as z}from\"../../../../../geometry/support/ray.js\";import{angleAroundAxis as D}from\"../../../../../geometry/support/vector.js\";import{sv3d as B,sm4d as H,sq4d as V}from\"../../../../../geometry/support/vectorStacks.js\";import{Manipulator3D as q}from\"../../Manipulator3D.js\";import{calculateTranslateRotateFromBases as N}from\"../../manipulatorUtils.js\";import{SHIFT_RESTART_TIP_RADIUS as W,RESIZE_HANDLE_EDGE_PADDING_FRAC as Z,SMALL_ANGLE_DOT_THRESHOLD as $,PLANE_MIN_BASIS_SCREEN_LEN2 as J,INITIAL_PLANE_HALF_SIZE_VIEW_PROPORTION as K,SHIFT_RESTART_OFFSET_DISTANCE as Q,SHIFT_RESTART_ARROW_OUTLINE_WIDTH as X,SHIFT_RESTART_ARROW_TIP_COLOR as Y,SHIFT_RESTART_ARROW_CAP_COLOR as _,SHIFT_RESTART_TUBE_COLOR as ee,SHIFT_RESTART_OUTLINE_COLOR as te,SHIFT_RESTART_CALLOUT_COLOR as ie,ROTATE_HEADING_OFFSET_DISTANCE as se,ROTATE_HEADING_DISC_RADIUS as re,ROTATE_HEADING_CALLOUT_COLOR as oe,PLANE_OUTLINE_COLOR as ne,PLANE_OUTLINE_WIDTH as ae,PLANE_BACKGROUND_COLOR as ce,GRID_COLOR as le,HANDLE_COLOR as me,RESIZE_HANDLE_CORNER_INPUT_RADIUS as de,RESIZE_HANDLE_EDGE_INPUT_RADIUS as ge,ROTATE_HEADING_TIP_LENGTH as ue,VERTICAL_DOT_THRESHOLD as pe,ROTATE_HEADING_DISC_RADIUS_FOCUS_MULTIPLIER as fe,DISPLAY_FOCUS_MULTIPLIER as be,RESIZE_HANDLE_EDGE_WIDTH as he,SHIFT_RESTART_ARROW_LENGTH as we,SHIFT_RESTART_TUBE_RADIUS as ye,SHIFT_RESTART_TIP_LENGTH as je,SHIFT_RESTART_TUBE_FOCUS_MULTIPLIER as Me,SHIFT_RESTART_TIP_FOCUS_MULTIPLIER as ke,RESIZE_HANDLE_CORNER_WIDTH as ve}from\"./sliceToolConfig.js\";import{LineVisualElement as Pe}from\"../../visualElements/LineVisualElement.js\";import{SlicePlaneVisualElement as Oe}from\"../../visualElements/SlicePlaneVisualElement.js\";import{getElevationAtPoint as Te}from\"../../../support/ElevationProvider.js\";import{fromRender as Ue}from\"../../../support/geometryUtils/ray.js\";import{Geometry as Re}from\"../../../webgl-engine/lib/Geometry.js\";import Se from\"../../../webgl-engine/lib/GeometryUtil.js\";import{ColorMaterial as Le}from\"../../../webgl-engine/materials/ColorMaterial.js\";import{ImageMaterial as Ae}from\"../../../webgl-engine/materials/ImageMaterial.js\";import{NativeLineMaterial as Ee}from\"../../../webgl-engine/materials/NativeLineMaterial.js\";import{RibbonLineMaterial as Ce}from\"../../../webgl-engine/materials/RibbonLineMaterial.js\";import Fe from\"../../../../../widgets/Slice/SlicePlane.js\";import Ge from\"../../../../../geometry/Point.js\";const xe=t.getLogger(\"esri.views.3d.interactive.analysisTools.slice.sliceToolUtils\");function Ie(e,t,i,s,r,o,n,a){return ze(t,n.worldUpAtPosition(e,B.get()),r,o,a.basis1,a.basis2),h(a.basis1,a.basis1,i),h(a.basis2,a.basis2,s),w(a.origin,e),I(a.basis2,a.basis1,a.origin,a.plane),a}function ze(e,t,i,s,r,o){const n=y(e,t),a=B.get(),c=B.get();switch(0===s?Math.abs(n)>pe?1:2:s){case 2:{const s=Math.abs(n)<=$?e:i.viewUp;j(a,s,t),w(c,t);break}case 1:j(a,i.viewUp,t),j(c,t,a);break;case 3:{const s=Math.abs(n)<=$?t:i.viewUp;j(a,s,e),j(c,e,a);break}}const l=j(B.get(),a,c);y(l,i.viewForward)>0&&h(c,c,-1),M(r,a),M(o,c)}function De(e,t,i){const s=t.worldUpAtPosition(e.origin,B.get()),r=e.basis1,o=mt(e,s),n=Math.round(o/yt)*yt;return L(e,n-o,r,i)}function Be(e,t,i,s,r,o){const n=w(B.get(),r.origin);k(n,n,h(B.get(),r.basis1,e.direction[0]<0?1:-1)),k(n,n,h(B.get(),r.basis2,e.direction[1]<0?1:-1));const a=v(r.basis1),c=v(r.basis2),l=P(B.get(),i,n),m=P(B.get(),t,n);let d=0,g=0;if(et(e)){const t=_e(r),i=_e(o);d=a-.5*e.direction[0]*y(r.basis1,m)/a,g=c-.5*e.direction[1]*y(r.basis2,m)/c;const s=i/t;d*=s,g*=s}const u=d+.5*e.direction[0]*y(r.basis1,l)/a,p=g+.5*e.direction[1]*y(r.basis2,l)/c,f=h(B.get(),r.basis1,u/a),b=h(B.get(),r.basis2,p/c);(u<=0||Xe(o.origin,f,s)<=J)&&w(f,o.basis1),(p<=0||Xe(o.origin,b,s)<=J)&&w(b,o.basis2);const j=w(B.get(),n);return k(j,j,h(B.get(),f,e.direction[0]<0?-1:1)),k(j,j,h(B.get(),b,e.direction[1]<0?-1:1)),A(j,f,b,o)}function He(e,t){return K*Math.min(t.width,t.height)*t.computeRenderPixelSizeAt(e)}function Ve(e,t,i,s){const r=j(B.get(),t,i);return j(r,r,t),x(e,r,s)}function qe(e,t){return N(e.basis1,e.basis2,e.origin,t)}function Ne(e,t,i,s){const r=t.worldUpAtPosition(e.origin,B.get()),o=B.get();switch(i){case 1:w(o,r);break;case 2:w(o,e.basis1)}return x(e.origin,o,s)}function We(e,t,i,s){const r=Qe(i,2),o=H.get();c(o,t,r.edge*Math.PI/2);const n=M(B.get(),r.basis);let l=h(B.get(),n,r.direction*s.computeScreenPixelSizeAt(r.position)*Q);k(l,l,r.position);const m=s.projectToRenderScreen(l,a(B.get())),d=Ze(s,m);Ue(s,m,wt),M(wt.direction,wt.direction);const g=B.get();!d&&E(i,wt,g)&&(l=g),o[12]=0,o[13]=0,o[14]=0,e.modelTransform=o,e.renderLocation=U(l),d?e.state|=ht:e.state&=~ht}function Ze(e,t){const[i,s,r,o]=e.viewport,n=Math.min(r,o)/16;let a=!0;return t[0]<i+n?(t[0]=i+n,a=!1):t[0]>i+r-n&&(t[0]=i+r-n,a=!1),t[1]<s+n?(t[1]=s+n,a=!1):t[1]>s+o-n&&(t[1]=s+o-n,a=!1),a}function $e(e,t,i,s){const r=v(s.basis1),o=v(s.basis2),n=Ye(s),a=_e(s),g=T(B.get(),0,0,0);k(g,h(B.get(),s.basis1,t.direction[0]),h(B.get(),s.basis2,t.direction[1])),k(g,s.origin,g);let u=0,p=1;if(et(t))1===t.direction[0]&&-1===t.direction[1]?u=yt:1===t.direction[0]&&1===t.direction[1]?u=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(u=3*Math.PI/2),p=a;else{const e=0!==t.direction[0]?1:2;u=1===e?yt:0,p=(1===e?o:r)-n}const f=l(H.get());c(f,f,u),m(f,f,T(B.get(),p,p,p)),d(f,i,f),f[12]=0,f[13]=0,f[14]=0,e.modelTransform=f,e.renderLocation=g}function Je(e,t,i,s){const r=s.worldUpAtPosition(i.origin,B.get()),o=Qe(i,0),n=l(H.get());c(n,n,o.edge*Math.PI/2),g(n,n,-mt(i,r)),d(n,t,n),n[12]=0,n[13]=0,n[14]=0,e.modelTransform=n,e.renderLocation=o.position}function Ke(e,t,i){const s=Qe(i,1),r=l(H.get());c(r,r,s.edge*Math.PI/2),g(r,r,yt),d(r,t,r),r[12]=0,r[13]=0,r[14]=0,e.modelTransform=r,e.renderLocation=s.position}function Qe(e,t){switch(t){case 0:return{basis:e.basis1,direction:1,position:k(B.get(),e.origin,e.basis1),edge:t};case 1:return{basis:e.basis2,direction:1,position:k(B.get(),e.origin,e.basis2),edge:t};case 2:return{basis:e.basis1,direction:-1,position:P(B.get(),e.origin,e.basis1),edge:t};case 3:return{basis:e.basis2,direction:-1,position:P(B.get(),e.origin,e.basis2),edge:t}}}function Xe(e,t,i){const s=i.projectToRenderScreen(k(B.get(),e,t),a(B.get())),r=i.projectToRenderScreen(P(B.get(),e,t),a(B.get()));return O(P(s,s,r))}function Ye(e){const t=v(e.basis1),i=v(e.basis2);return Z*Math.min(t,i)}function _e(e){return Ye(e)}function et(e){return 0!==e.direction[0]&&0!==e.direction[1]}function tt(e,t=1){const i=0===t?Q:0,s=[S(i,0,-we/2),S(i,0,we/2)],r=ct(s,!0),o=(e,t)=>nt(s,s,{tubeRadius:ye,tipRadius:W,tipLength:je,tubeFocusMultiplier:Me,tipFocusMultiplier:ke,padding:e,bothEnds:!0,flat:null,focusTipLength:!0,addCap:t}),n=o(0,!1),a=o(X,!0),c=new Le({color:Y,cullFace:2,renderOccluded:16}),l=new Le({color:_,cullFace:2,renderOccluded:16}),m=new Le({color:ee,cullFace:2,renderOccluded:16}),d=new Le({color:te,transparent:!0,writeDepth:!1,cullFace:1,renderOccluded:2}),g=Se.createPolylineGeometry([[i,0,0],[i-Q,0,0]]),u=Se.createPolylineGeometry([[i,0,0],[i-Q,0,0]]),p=new Ee({color:ie,renderOccluded:4});return new q({view:e,renderObjects:[...n.normal.map((({part:e,geometry:t,transform:i})=>({geometry:t,material:\"tip\"===e?c:\"cap\"===e?l:m,transform:i,stateMask:1|bt}))),...a.normal.map((({geometry:e,transform:t})=>({geometry:e,material:d,transform:t,stateMask:1|bt}))),{geometry:g,material:p,stateMask:1|bt|ht},...n.focused.map((({part:e,geometry:t,transform:i})=>({geometry:t,material:\"tip\"===e?c:\"cap\"===e?l:m,transform:i,stateMask:2|bt}))),...a.focused.map((({geometry:e,transform:t})=>({geometry:e,material:d,transform:t,stateMask:2|bt}))),{geometry:u,material:p,stateMask:2|bt|ht}],autoScaleRenderObjects:!1,collisionType:{type:\"line\",paths:[r]},collisionPriority:1,radius:W,state:bt})}function it(e,t){const i=new Ae({transparent:!0,writeDepth:!1,textureId:t.id,renderOccluded:16}),s=se,r=re,o=r*fe,n=e=>{const t=new Uint32Array([0,1,2,2,3,0]);return new Re([[\"position\",{size:3,data:[s-e,-e,0,s+e,-e,0,s+e,e,0,s-e,e,0],exclusive:!0}],[\"uv0\",{size:2,data:[0,0,1,0,1,1,0,1]}]],[[\"position\",t],[\"uv0\",t]])},a=Se.createPolylineGeometry([[0,0,0],[s-r,0,0]]),c=Se.createPolylineGeometry([[0,0,0],[s-o,0,0]]),l=new Ee({color:oe,renderOccluded:4}),m=[{geometry:n(r),material:i,stateMask:1|bt},{geometry:a,material:l,stateMask:1|bt},{geometry:n(o),material:i,stateMask:2|bt},{geometry:c,material:l,stateMask:2|bt}];return new q({view:e,renderObjects:m,autoScaleRenderObjects:!1,collisionType:{type:\"disc\",direction:[0,0,1],offset:[s,0,0]},collisionPriority:1,radius:r/2,state:bt})}function st(e){return new Pe({view:e,attached:!0,color:ne,width:ae,writeDepthEnabled:!1,renderOccluded:4,geometry:[[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]]]})}function rt(e){return new Oe({view:e,attached:!0,backgroundColor:[...ce],gridColor:le,gridWidth:4,renderOccluded:4})}function ot(e,t){const i=et(t),s=i?[S(1,0,0),S(0,0,0),S(0,1,0)]:[S(1,0,0),S(-1,0,0)],r=Se.createPolylineGeometry(s),o=[...me,1],n=e=>new Ce({color:o,width:e,renderOccluded:4}),a=()=>new Ee({color:o,renderOccluded:4}),c=i?ve:he,l=c*be,m=he,d=e=>e>1?n(e):a(),g=[{geometry:r,material:d(c),stateMask:1|jt},{geometry:r,material:d(l),stateMask:2|jt},{geometry:r,material:d(m),stateMask:Mt}],u=new q({view:e,renderObjects:g,collisionType:{type:\"line\",paths:[s]},autoScaleRenderObjects:!1,worldSized:!0,radius:i?de:ge,idHint:i?1:2});return u.state=jt,u}function nt(e,t,i){const s=s=>{const r=(s?t:e).slice(0),n=P(B.get(),r[0],r[1]);M(n,n);const a=P(B.get(),r[r.length-1],r[r.length-2]);if(M(a,a),i.padding>0){const e=h(R(),a,-i.padding);if(r[r.length-1]=k(e,e,r[r.length-1]),i.bothEnds){const e=h(R(),n,-i.padding);r[0]=k(e,e,r[0])}}const c=s?i.tipFocusMultiplier:1,g=i.tipLength*(i.focusTipLength?c:1),w=i.tipRadius*c,y=l(H.get());if(i.padding>0){const e=g/4,t=T(B.get(),0,e,0),s=1+i.padding/e;u(y,y,t),m(y,y,T(B.get(),s,s,s)),u(y,y,h(t,t,-1/s))}const j=l(f()),v=S(0,1,0),O=p(f(),b(V.get(),v,a));O[12]=r[r.length-1][0],O[13]=r[r.length-1][1],O[14]=r[r.length-1][2],d(O,O,y);const U=[{part:\"tube\",geometry:at(i.tubeRadius*(s?i.tubeFocusMultiplier:1)+i.padding,i.flat,r),transform:j}];let L,A;if(o(i.flat)?L=Se.createExtrudedTriangle(g,w,w,i.flat.thickness):(L=Se.createConeGeometry(g,w,24,!1,!1,!0),A=Se.createConeGeometry(g,w,24,!1,!0,!1)),U.push({part:\"tip\",geometry:L,transform:O}),A&&U.push({part:\"cap\",geometry:A,transform:O}),i.bothEnds){const e=p(f(),b(V.get(),v,n));e[12]=r[0][0],e[13]=r[0][1],e[14]=r[0][2],d(e,e,y),U.push({part:\"tip\",geometry:L,transform:e}),A&&U.push({part:\"cap\",geometry:A,transform:e})}return U};return{normal:s(!1),focused:s(!0)}}function at(e,t,i){const s=[];if(o(t))s.push([e,t.thickness/2],[-e,t.thickness/2],[-e,-t.thickness/2],[e,-t.thickness/2]);else{const t=12;for(let i=0;i<t;i++){const r=i/t*2*Math.PI;s.push([Math.cos(r)*e,Math.sin(r)*e])}}return Se.createPathExtrusionGeometry(s,i,[],[],!1)}function ct(e,t){const i=P(R(),e[e.length-1],e[e.length-2]);if(M(i,i),h(i,i,ue),k(i,i,e[e.length-1]),t){const t=P(R(),e[0],e[1]);return M(t,t),h(t,t,ue),k(t,t,e[0]),[t,...e,i]}return[...e,i]}function lt(e,t,s,n=new Fe){if(r(e))return null;const a=o(n.position)?n.position:new Ge;t.fromRenderCoords(e.origin,a,s),n.position=a;const c=t.worldUpAtPosition(e.origin,B.get()),l=t.worldBasisAtPosition(e.origin,1,B.get());return n.width=2*v(e.basis1),n.height=2*v(e.basis2),n.tilt=i(mt(e,c)),n.heading=i(dt(e,c,l)),n}function mt(e,t){return D(t,e.basis2,e.basis1)+yt}function dt(e,t,i){return D(e.basis1,i,t)-yt}function gt(e,t,i,r,o,n,a=C()){return n.toRenderCoords(e,a.origin)?(n.worldBasisAtPosition(a.origin,0,a.basis1),n.worldBasisAtPosition(a.origin,1,a.basis2),I(a.basis2,a.basis1,a.origin,a.plane),L(a,-s(t),F(a),a),L(a,s(i),a.basis1,a),h(a.basis1,a.basis1,r/2),h(a.basis2,a.basis2,o/2),G(a),a):(xe.error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}function ut(e,t,i=C()){return r(e)||r(e.position)?null:gt(e.position,e.heading,e.tilt,e.width,e.height,t,i)}function pt(e,t,i=C()){if(r(e)||r(e.position))return null;let s=e.position;return e.position.hasZ||(s=e.position.clone(),s.z=n(Te(t.elevationProvider,e.position),0)),gt(s,e.heading,e.tilt,e.width,e.height,t.renderCoordsHelper,i)}function ft(t){switch(t.type){case\"building-scene\":case\"csv\":case\"direct-line-measurement\":case\"area-measurement\":case\"feature\":case\"geo-rss\":case\"geojson\":case\"graphics\":case\"group\":case\"integrated-mesh\":case\"kml\":case\"line-of-sight\":case\"map-notes\":case\"ogc-feature\":case\"point-cloud\":case\"route\":case\"slice\":case\"scene\":case\"stream\":case\"voxel\":case\"subtype-group\":case\"unknown\":case\"unsupported\":case\"wfs\":case null:return!1;case\"base-dynamic\":case\"base-elevation\":case\"base-tile\":case\"bing-maps\":case\"elevation\":case\"imagery\":case\"imagery-tile\":case\"map-image\":case\"open-street-map\":case\"tile\":case\"vector-tile\":case\"wcs\":case\"web-tile\":case\"wms\":case\"wmts\":return!0;default:return e(t.type),!1}}const bt=16,ht=32,wt=z(),yt=Math.PI/2,jt=16,Mt=32;export{bt as DidPointerMoveRecentlyFlag,ht as IsShiftEdgeOnScreenFlag,ct as addArrowTips,qe as calculateBoundedPlaneTranslateRotate,_e as calculateDiagonalResizeHandleScale,He as calculatePlaneHalfSize,Ye as calculateResizeHandlePadding,Xe as calculateScreenSpaceBasisLength2,nt as createArrowGeometry,rt as createGridVisualElement,st as createOutlineVisualElement,Ie as createPlane,ot as createResizeManipulator,it as createRotateManipulator,Ne as createRotatePlane,tt as createShiftManipulator,Ve as createShiftPlane,De as forceHorizontalOrVertical,ft as isAlwaysDrapedLayer,et as isDiagonalResizeHandle,ze as normalToBases,lt as planeToShape,jt as resizeNormal,Mt as resizeOutlineOnly,Be as resizePlane,pt as shapeToElevationAlignedPlane,ut as shapeToPlane,$e as updateResizeHandle,Je as updateRotateHeadingHandle,Ke as updateRotateTiltHandle,We as updateShiftRestartHandle};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{isSome as e,isNone as t}from\"../../../core/maybe.js\";import{b as r}from\"../../../chunks/mat4.js\";import{f as n,c as o,m as c,n as a}from\"../../../chunks/vec3.js\";import{f as i}from\"../../../chunks/vec4f64.js\";import{sv3d as s,sm4d as l}from\"../../../geometry/support/vectorStacks.js\";import{hydrateGeometry as m}from\"../../../layers/graphics/hydratedFeatures.js\";import{Manipulator3D as u}from\"./Manipulator3D.js\";import{computeCentroid as p}from\"../layers/graphics/graphicUtils.js\";import g from\"../webgl-engine/lib/GeometryUtil.js\";import{ColorMaterial as f}from\"../webgl-engine/materials/ColorMaterial.js\";import{ShadedColorMaterial as h}from\"../webgl-engine/materials/ShadedColorMaterial.js\";function d(e,t=4,r=!0){const n=i(e[0],e[1],e[2],e.length>3?e[3]:1),o=e[3]<1;return r?new h({color:n,transparent:o,writeDepth:!0,cullFace:2,renderOccluded:t}):new f({color:n,transparent:o,writeDepth:!0,cullFace:2,renderOccluded:t})}function j(e,t=4){const r=i(e[0],e[1],e[2],4===e.length?e[3]:1);return new f({color:r,transparent:!0,writeDepth:!0,cullFace:1,renderOccluded:t})}function w(e,t,r){return new u({view:e,renderObjects:[{geometry:g.createSphereGeometry(1,32,32),material:d(i(t[0],t[1],t[2],null!=r?r:1))}]})}function y(e,t,a,i){const m=n(s.get(),e,a),u=b(m,o(s.get(),i,m),a,l.get());r(u,u);const p=c(s.get(),t,u);return Math.atan2(p[1],p[0])}function b(e,t,r,n){const c=a(s.get(),e),i=a(s.get(),t),l=o(s.get(),c,i);return n[0]=c[0],n[1]=c[1],n[2]=c[2],n[3]=0,n[4]=i[0],n[5]=i[1],n[6]=i[2],n[7]=0,n[8]=l[0],n[9]=l[1],n[10]=l[2],n[11]=0,n[12]=r[0],n[13]=r[1],n[14]=r[2],n[15]=1,n}function O(t,r){const n=t.getViewForGraphic(r);return e(n)&&\"computeAttachmentOrigin\"in n?n.computeAttachmentOrigin(r,t.spatialReference):null}function v(t,r,n){const o=O(t,n);e(o)?r.elevationAlignedLocation=o:F(r,n.geometry)}function F(e,r){if(t(r))return;const n=\"mesh\"===r.type?r.anchor:p(r);t(n)||(e.location=m(n))}export{y as calculateInputRotationTransform,b as calculateTranslateRotateFromBases,d as createManipulatorMaterial,j as createManipulatorOutlineMaterial,w as createSphereManipulator,O as getGraphicAttachmentOrigin,v as placeAtGraphic};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import i from\"../../../../../core/Accessor.js\";import t from\"../../../../../core/Handles.js\";import a from\"../../../../../core/Logger.js\";import{isNone as r,isSome as l}from\"../../../../../core/maybe.js\";import{whenOnce as s}from\"../../../../../core/watchUtils.js\";import{property as n}from\"../../../../../core/accessorSupport/decorators/property.js\";import\"../../../../../core/has.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import{subclass as o}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{a as c}from\"../../../../../chunks/boundedPlane.js\";import h from\"../../../../../layers/Layer.js\";import d from\"../../../../../layers/buildingSublayers/BuildingComponentSublayer.js\";import{isAlwaysDrapedLayer as y,shapeToElevationAlignedPlane as u,forceHorizontalOrVertical as p,planeToShape as w}from\"../../analysisTools/slice/sliceToolUtils.js\";import v from\"../../../../../widgets/Slice/SlicePlane.js\";const V=a.getLogger(\"esri.views.3d.interactive.graphics.Slice.SliceController\");let f=class extends i{constructor(e){super(e),this._handles=new t,this._internalChange=!1,this._currentSlicePlane=null,this.state=\"pending\"}get ready(){return\"ready\"===this.state}initialize(){this._handles.add(this.layerView.layerViewData.excludedLayers.on(\"before-add\",(e=>{const i=e.item;null!=i&&(i instanceof h||i instanceof d)?i instanceof h&&y(i)?(V.error(\"excludedLayers\",`Layer '${i.title}, id:${i.id}' of type '${i.type}' can not be individually excluded from slicing. Use 'excludeGroundSurface' instead.`),e.preventDefault()):this.layerView.layerViewData.excludedLayers.includes(i)&&e.preventDefault():(V.error(\"excludedLayers\",\"Invalid layer type, layer must derive from Layer or BuildingComponentSublayer\"),e.preventDefault())}))),this._handles.add(s(this.view,\"ready\",(()=>this._initialize()),!0))}_initialize(){switch(this.state){case\"pending\":break;case\"destroyed\":return;case\"ready\":throw new Error(\"state error\")}C(this.view,this),this._handles.add([this.layerView.layerViewData.watch(\"plane\",(()=>{this._internalChange||this._updateSlicePlaneFromBoundedPlane(),this._updateLayerViews()}),!0),this.layerView.layerViewData.watch(\"excludeGroundSurface\",(()=>this._updateLayerViews()),!0),this.layerView.layerViewData.excludedLayers.on(\"change\",(()=>this._updateLayerViews())),this.layerView.watch([\"active\",\"visible\"],(()=>{this._updateActiveController(),this._updateViewSlicePlane()}),!0),this.view.allLayerViews.on(\"change\",(()=>this._updateLayerViews()))]),this._handles.add([this.analysis.watch(\"plane\",(()=>{this._internalChange||(this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane())}),!0)],\"analysis\"),this._set(\"state\",\"ready\"),this._updateActiveController(),this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane()}destroy(){switch(this.state){case\"destroyed\":case\"pending\":return}this.layerView.active=!1,P(this.view,this),this._handles.destroy(),this.view.slicePlane=null,this.set(\"view\",null),this._set(\"state\",\"destroyed\")}async whenReady(){return await s(this,\"ready\"),this}_updateBoundedPlaneFromSlicePlane(){const e=this.analysis.plane,i=this._currentSlicePlane;if(r(i)&&r(e)||l(i)&&l(e)&&e.equals(i))return;let t=null,a=null;l(e)&&(t=u(e,this.view,c()),l(t)?a={heading:e.heading,tilt:e.tilt,position:e.position,width:e.width,height:e.height}:console.warn(\"Failed slice plane conversion.\")),this._currentSlicePlane=a,l(t)&&!this.analysis.tiltEnabled&&p(t,this.view.renderCoordsHelper,t),this._internalChange=!0,this.layerView.layerViewData.plane=t,this._internalChange=!1}_updateSlicePlaneFromBoundedPlane(){const e=this.layerView.layerViewData.plane,i=w(e,this.view.renderCoordsHelper,this.view.spatialReference,new v);let t=null;l(i)&&(t={heading:i.heading,tilt:i.tilt,position:i.position,width:i.width,height:i.height}),this._currentSlicePlane=t,l(e)&&(this.analysis.tiltEnabled||p(e,this.view.renderCoordsHelper,e)),this._internalChange=!0,this.analysis.plane=i,this._internalChange=!1,this._updateViewSlicePlane()}_updateActiveController(){if(_)return;const e=S(this.view);if(this.layerView.active)l(e.activeController)&&e.activeController!==this?(_=!0,e.activeController.layerView.active=!1,_=!1):l(e.activeController)&&e.activeController,this._updateLayerViews(),e.activeController=this;else{if(l(e.activeController)&&e.activeController!==this)return;l(e.activeController)&&e.activeController===this&&(e.activeController=null,this._updateLayerViews())}}_updateViewSlicePlane(){\"ready\"===this.state&&g(this.view)}_updateLayerViews(){const e=l(this.layerView.layerViewData.plane)&&this.layerView.visible&&this.layerView.active,i=[],t=e=>{\"layers\"in e?e.layers.forEach(t):i.push(e)};this.layerView.layerViewData.excludedLayers.forEach(t),this.view.allLayerViews.forEach((t=>{\"slicePlaneEnabled\"in t&&(t.slicePlaneEnabled=e&&i.indexOf(t.layer)<0),\"sublayerViews\"in t&&t.sublayerViews.forEach((t=>{t.slicePlaneEnabled=e&&i.indexOf(t.sublayer)<0}))})),null!=this.view.basemapTerrain&&(this.view.basemapTerrain.slicePlaneEnabled=e&&!this.layerView.layerViewData.excludeGroundSurface)}};e([n({readOnly:!0})],f.prototype,\"state\",void 0),e([n()],f.prototype,\"view\",void 0),e([n()],f.prototype,\"analysis\",void 0),e([n()],f.prototype,\"layerView\",void 0),e([n()],f.prototype,\"ready\",null),f=e([o(\"esri.views.3d.interactive.graphics.Slice.SliceController\")],f);const m=new Map;let _=!1;function g(e){const i=S(e).activeController;l(i)&&l(i.layerView.layerViewData.plane)&&i.layerView.visible?e.slicePlane=i.layerView.layerViewData.plane:e.slicePlane=null}function C(e,i){m.has(e)||m.set(e,{all:[],activeController:null}),m.get(e).all.push(i)}function S(e){return m.get(e)}function P(e,i){if(!m.has(e))throw new Error(\"view expected in global slice register\");const t=m.get(e),a=t.all.lastIndexOf(i);if(-1===a)throw new Error(\"controller expected in global slice register\");t.all.splice(a,1),0===t.all.length&&m.delete(e)}export{f as SliceController};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import t from\"../../../../../core/Accessor.js\";import i from\"../../../../../core/Handles.js\";import{applyOpacity as s}from\"../../../../../core/mathUtils.js\";import{isNone as a,destroyMaybe as r,isSome as l}from\"../../../../../core/maybe.js\";import{whenOnce as o}from\"../../../../../core/watchUtils.js\";import{property as n}from\"../../../../../core/accessorSupport/decorators/property.js\";import\"../../../../../core/has.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import\"../../../../../core/Logger.js\";import{subclass as h}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{reactionInit as c}from\"../../../../../core/accessorSupport/trackingUtils.js\";import{w as p,m as d}from\"../../../../../chunks/mat4.js\";import{s as u,l as m}from\"../../../../../chunks/vec3.js\";import{c as y}from\"../../../../../chunks/vec4f64.js\";import{sm4d as w,sv3d as _}from\"../../../../../geometry/support/vectorStacks.js\";import{PLANE_OUTLINE_WIDTH as V,PLANE_OUTLINE_COLOR as g,PLANE_PREVIEW_OUTLINE_WIDTH as f,PLANE_BACKGROUND_COLOR as v,GRID_COLOR as j}from\"../../analysisTools/slice/sliceToolConfig.js\";import{createGridVisualElement as E,createOutlineVisualElement as b,calculateBoundedPlaneTranslateRotate as k}from\"../../analysisTools/slice/sliceToolUtils.js\";import{createStipplePatternSimple as S}from\"../../../webgl-engine/materials/lineStippleUtils.js\";let M=class extends t{constructor(e){super(e),this._handles=new i,this._gridVisualElement=null,this._outlineVisualElement=null,this.state=\"pending\"}get ready(){return\"ready\"===this.state}set showGrid(e){this._set(\"showGrid\",e),this._updateMaterials()}set editable(e){this._set(\"editable\",e),this._updateMaterials()}initialize(){this._initialize()}async _initialize(){switch(this.state){case\"pending\":break;case\"destroyed\":return;case\"ready\":throw new Error(\"state error\")}if(await o(this.view,\"ready\",!0),a(this.layerView.layerViewData))throw new Error(\"expected internal object to be valid\");this._gridVisualElement=E(this.view),this._outlineVisualElement=b(this.view),this._handles.add(c((()=>this.layerView.fullOpacity),(()=>this._updateMaterials())),\"layer\"),this._handles.add([this.layerView.watch(\"visible\",(()=>this._updateMaterials()),!0),this.layerView.layerViewData.watch(\"plane\",(()=>this._updatePlane()),!0),this.layerView.watch(\"active\",(()=>this._updateMaterials()),!0)],\"internal\"),this._updatePlane(),this._set(\"state\",\"ready\")}destroy(){switch(this.state){case\"destroyed\":case\"pending\":return}this._handles.destroy(),this._gridVisualElement=r(this._gridVisualElement),this._outlineVisualElement=r(this._outlineVisualElement),this.set(\"view\",null),this._set(\"state\",\"destroyed\")}async whenReady(){return await o(this,\"ready\"),this}_update(){switch(this.state){case\"pending\":case\"destroyed\":return}}_updatePlane(){const e=this.layerView.layerViewData.plane,t=l(e)?k(e,w.get()):null;if(this._outlineVisualElement.width=V,l(e)){const i=u(_.get(),m(e.basis1),m(e.basis2),1),s=p(w.get(),i),a=d(s,t,s);this._outlineVisualElement.transform=a,this._gridVisualElement.transform=a}this._updateMaterials()}_updateMaterials(){const e=this.layerView.layerViewData.plane&&this.layerView.visible,t=this.layerView.active,i=this.layerView.fullOpacity,a=s(D,g,i);this._outlineVisualElement.color=a,this._outlineVisualElement.width=this.editable?V:f,this._outlineVisualElement.stipplePattern=t?null:S(5);const r=s(D,v,i),o=!!l(this.layerView.layerViewData)&&this.showGrid?j:[0,0,0,0];this._gridVisualElement.backgroundColor=r,this._gridVisualElement.gridColor=o,this._gridVisualElement.visible=e,this._outlineVisualElement.visible=e}};e([n({readOnly:!0})],M.prototype,\"state\",void 0),e([n()],M.prototype,\"view\",void 0),e([n()],M.prototype,\"layer\",void 0),e([n()],M.prototype,\"layerView\",void 0),e([n()],M.prototype,\"ready\",null),e([n({value:!1})],M.prototype,\"showGrid\",null),e([n({value:!0})],M.prototype,\"editable\",null),M=e([h(\"esri.views.3d.interactive.graphics.Slice.SliceView\")],M);const D=y();export{M as SliceView};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import r from\"../../../../../core/Accessor.js\";import o from\"../../../../../core/Collection.js\";import{castForReferenceSetter as s,referenceSetter as t}from\"../../../../../core/collectionUtils.js\";import{property as c}from\"../../../../../core/accessorSupport/decorators/property.js\";import\"../../../../../core/has.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import\"../../../../../core/Logger.js\";import{subclass as p}from\"../../../../../core/accessorSupport/decorators/subclass.js\";let i=class extends r{constructor(){super(...arguments),this.plane=null,this.excludeGroundSurface=!1}get excludedLayers(){return this._get(\"excludedLayers\")||new o}set excludedLayers(e){this._set(\"excludedLayers\",t(e,this._get(\"excludedLayers\")))}};e([c()],i.prototype,\"plane\",void 0),e([c()],i.prototype,\"excludeGroundSurface\",void 0),e([c({cast:s})],i.prototype,\"excludedLayers\",null),i=e([p(\"esri.views.3d.interactive.graphics.Slice.SliceInternal\")],i);export{i as SliceLayerViewData};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as i}from\"../../../chunks/tslib.es6.js\";import{createDeferred as e}from\"../../../core/promiseUtils.js\";import{property as s}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as t}from\"../../../core/accessorSupport/decorators/subclass.js\";import{SliceController as r}from\"../interactive/graphics/Slice/SliceController.js\";import{SliceView as a}from\"../interactive/graphics/Slice/SliceView.js\";import{LayerView3D as o}from\"./LayerView3D.js\";import{SliceLayerViewData as l}from\"./analysis/Slice/SliceLayerViewData.js\";import n from\"../../layers/LayerView.js\";let y=class extends(o(n)){constructor(){super(...arguments),this.type=\"slice-3d\",this.analysisView=null,this.analysisController=null,this._initialized=e(),this.layerViewData=new l,this.active=!0,this.showGrid=!1,this.editable=!1}initialize(){this.analysisView=new a({view:this.view,layer:this.layer,layerView:this}),this.analysisController=new r({view:this.view,analysis:this.layer,layerView:this}),this._initialized.resolve()}destroy(){this.analysisView.destroy(),this.analysisView=null,this.analysisController.destroy(),this.analysisController=null}async when(){return this.destroyed?null:(await this._initialized.promise,this.destroyed?null:(await this.analysisView.whenReady(),this.destroyed?null:(await this.analysisController.whenReady(),this)))}get testData(){return{view:this.analysisView,controller:this.analysisController}}};i([s()],y.prototype,\"type\",void 0),i([s()],y.prototype,\"layerViewData\",void 0),i([s()],y.prototype,\"layer\",void 0),i([s()],y.prototype,\"active\",void 0),i([s({aliasOf:\"analysisView.showGrid\"})],y.prototype,\"showGrid\",void 0),i([s({aliasOf:\"analysisView.editable\"})],y.prototype,\"editable\",void 0),y=i([t(\"esri.views.3d.layers.SliceLayerView3D\")],y);var p=y;export{y as SliceLayerView3D,p as default};\n"],"names":["i2","vertex","uniforms","add","code","e","t2","c2","s","include","o","linearDepth","r","fragment","l","attributes","varyings","multipassTerrainEnabled","screenSizeEnabled","shadingEnabled","n","i","a","float","d","output","OITEnabled","M","U","W","X","x","y","z","spatialReference","c","Object","freeze","__proto__","build","t","p","initializeProgram","e2","r2","S","shader","get","this","configuration","slicePlaneEnabled","sliceHighlightDisabled","sliceEnabledForVertexPrograms","transparencyPassType","cullAboveGround","b","rctx","P","bindPass","a2","color","n2","shadingTint","l2","shadingDirection","p2","program","camera","projectionMatrix","setUniform4fv","setUniform2fv","nearFar","inverseViewport","blendColor","w","setUniform3fv","setUniformMatrix4fv","viewInverseTransposeMatrix","setUniform1f","perScreenPixelRatio","screenSize","bindDraw","origin","rebindTextures","o2","setPipelineState","v","blending","transparent","h","m","culling","cullFace","depthTest","func","depthWrite","writeDepth","T","u","colorWrite","E","polygonOffset","g","initializePipeline","f","import","constructor","arguments","count","j","prototype","Map","__spreadValues","extensions","backgroundColor","gridColor","gridWidth","intersect","s2","createBufferWriter","getGLMaterial","_technique","_techniqueRep","constructionContext","updateParameters","beginSlot","bind","_material","params","_renderOccluded","_gridWidth","_gridColor","_backgroundColor","applyProps","_updateMaterial","createExternalResources","materialParameters","destroyExternalResources","forEachExternalMaterial","createGeometries","createSquareGeometry","addGeometry","renderOccluded","setParameterValues","type","position","heading","tilt","width","height","clone","equals","readOnly","json","read","write","Number","nonNullable","range","min","max","normalize","xe","getLogger","worldUpAtPosition","B","basis1","mt","Math","round","yt","L","N","basis2","Fe","Ge","fromRenderCoords","worldBasisAtPosition","D","dt","C","hasZ","Te","elevationProvider","toRenderCoords","I","plane","F","G","error","wkid","gt","renderCoordsHelper","PI","V","_handles","_internalChange","_currentSlicePlane","state","initialize","layerView","layerViewData","excludedLayers","on","item","title","id","preventDefault","includes","view","_initialize","Error","has","set","all","activeController","push","watch","_updateSlicePlaneFromBoundedPlane","_updateLayerViews","_updateActiveController","_updateViewSlicePlane","allLayerViews","analysis","_updateBoundedPlaneFromSlicePlane","_set","destroy","active","lastIndexOf","splice","length","delete","slicePlane","console","warn","tiltEnabled","_","visible","e3","layers","forEach","t3","indexOf","layer","sublayerViews","t4","sublayer","basemapTerrain","excludeGroundSurface","_gridVisualElement","_outlineVisualElement","_updateMaterials","Oe","attached","ce","le","Pe","ne","writeDepthEnabled","geometry","fullOpacity","_updatePlane","_update","k","transform","editable","stipplePattern","showGrid","value","_get","cast","analysisView","analysisController","_initialized","resolve","destroyed","promise","whenReady","controller","aliasOf"],"mappings":"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"}