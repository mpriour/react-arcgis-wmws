var e=Object.defineProperty,i=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,r=(i,t,a)=>t in i?e(i,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[t]=a,s=(e,s)=>{for(var n in s||(s={}))t.call(s,n)&&r(e,n,s[n]);if(i)for(var n of i(s))a.call(s,n)&&r(e,n,s[n]);return e};import{nl as n,mw as l,mc as o,aL as d,iC as c,iA as h,iB as u,iD as p,iH as g,iE as y,iF as w,nm as v,iI as m,F as b,iK as f,iL as _,iM as V,iO as C,iP as P,iQ as x,nn as E,iR as S,iS as D,lg as z,iT as O,iU as L,iW as T,iX as W,iY as M,no as j,j1 as F,jr as k,lj as N,cn as G,ir as U,lm as A,lk as R,K as I,iN as B,mo as q,np as $,li as H,ik as K,im as Q,io as X,ip as Y,e8 as Z,kf as J,B as ee,ii as ie,G as te,bp as ae,nq as re,nr as se,H as ne,aa as le,x as oe,bb as de,ns as ce,nt as he,M as ue,k4 as pe,gx as ge,nu as ye,b1 as we,la as ve,nv as me,nw as be,gv as fe,cq as _e,nx as Ve,hv as Ce,bq as Pe,br as xe,b as Ee,fC as Se,l9 as De,eO as ze,ny as Oe,fD as Le,nz as Te,gK as We,ll as Me,lq as je,mu as Fe,A as ke,mv as Ne,ig as Ge,ih as Ue,fz as Ae}from"./vendor.7103ff48.js";import{E as Re}from"./BuildingComponentSublayer.0363077d.js";import{c as Ie,m as Be}from"./LineVisualElement.a7c721d3.js";import"./ImageMaterialTechnique.920f1ced.js";import{g as qe}from"./persistable.2e27d0f9.js";function $e(e){e.vertex.uniforms.add("camPos","vec3").add("perScreenPixelRatio","float").add("screenSize","float"),e.vertex.code.add(c`float computeRenderPixelSizeAt( vec3 pWorld ){
vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
float viewDirectionDistance = abs(dot(viewForward, pWorld - camPos));
return viewDirectionDistance*perScreenPixelRatio;
}
vec3 screenSizeScaling(vec3 position, vec3 anchor){
return position * screenSize * computeRenderPixelSizeAt(anchor) + anchor;
}`)}function He(e){const i=new h;return i.include(u,{linearDepth:!1}),i.include($e,{}),i.include(p,e),i.fragment.include(g),i.vertex.uniforms.add("proj","mat4").add("view","mat4"),i.fragment.uniforms.add("color","vec4"),i.attributes.add("position","vec3"),i.varyings.add("vWorldPosition","vec3"),e.multipassTerrainEnabled&&i.varyings.add("depth","float"),e.screenSizeEnabled&&i.attributes.add("offset","vec3"),e.shadingEnabled&&(i.vertex.uniforms.add("viewNormal","mat4"),i.fragment.uniforms.add("shadedColor","vec4").add("shadingDirection","vec3"),i.attributes.add("normal","vec3"),i.varyings.add("vViewNormal","vec3")),i.vertex.code.add(c`
    void main(void) {
      vWorldPosition = ${e.screenSizeEnabled?"screenSizeScaling(offset, position)":"position"};
  `),e.shadingEnabled&&i.vertex.code.add(c`vec3 worldNormal = normal;
vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;`),i.vertex.code.add(c`
    ${e.multipassTerrainEnabled?"depth = (view * vec4(vWorldPosition, 1.0)).z;":""}
    gl_Position = transformPosition(proj, view, vWorldPosition);
  }
  `),e.multipassTerrainEnabled&&(i.fragment.include(y),i.include(w,e)),i.fragment.code.add(c`
    void main() {
      discardBySlice(vWorldPosition);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    `),e.shadingEnabled?i.fragment.code.add(c`vec3 viewNormalNorm = normalize(vViewNormal);
float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
vec4 finalColor = mix(color, shadedColor, shadingFactor);`):i.fragment.code.add(c`vec4 finalColor = color;`),i.fragment.code.add(c`
      if (finalColor.a < ${c.float(v)}) {
        discard;
      }
      ${7===e.output?c`gl_FragColor = vec4(finalColor.a);`:""}

      ${0===e.output?c`gl_FragColor = highlightSlice(finalColor, vWorldPosition); ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    }
    `),i}n(),l(),o(),new d({x:0,y:0,z:0,spatialReference:null});var Ke=Object.freeze({__proto__:null,build:He});class Qe extends _{initializeProgram(e){const i=Qe.shader.get(),t=this.configuration,a=i.build({output:t.output,slicePlaneEnabled:t.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,screenSizeEnabled:t.screenSizeEnabled,shadingEnabled:t.shadingEnabled,OITEnabled:0===t.transparencyPassType,multipassTerrainEnabled:t.multipassTerrainEnabled,cullAboveGround:t.cullAboveGround});return new V(e.rctx,a,Ye)}bindPass(e,i){const{screenSizeEnabled:t,shadingEnabled:a}=this.configuration,{color:r,shadingTint:s,shadingDirection:n}=e;C(this.program,i.camera.projectionMatrix),this.program.setUniform4fv("color",r),i.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",i.camera.nearFar),this.program.setUniform2fv("inverseViewport",i.inverseViewport),P(this.program,i)),a&&(this.program.setUniform4fv("shadedColor",this.blendColor(Ze,s,r)),this.program.setUniform3fv("shadingDirection",n),this.program.setUniformMatrix4fv("viewNormal",i.camera.viewInverseTransposeMatrix)),t&&function(e,i,t){e.setUniform1f("perScreenPixelRatio",t.camera.perScreenPixelRatio),e.setUniform1f("screenSize",i.screenSize)}(this.program,e,i)}bindDraw(e){x(this.program,e),E(this.program,e.origin,e.camera.viewInverseTransposeMatrix),S(this.program,this.configuration,e),this.program.rebindTextures()}blendColor(e,i,t){const a=1-i[3],r=i[3]+t[3]*a;return 0===r?(e[3]=r,e):(e[0]=(i[0]*i[3]+t[0]*t[3]*a)/r,e[1]=(i[1]*i[3]+t[1]*t[3]*a)/r,e[2]=(i[2]*i[3]+t[2]*t[3]*a)/r,e[3]=t[3],e)}setPipelineState(e){const i=this.configuration,t=3===e,a=2===e;return D({blending:0!==i.output&&7!==i.output||!i.transparent?null:t?z:O(e),culling:L(i.cullFace),depthTest:{func:a?513:i.shadingEnabled?515:513},depthWrite:t?i.writeDepth&&T:W(e),colorWrite:M,polygonOffset:t||a?null:j})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}Qe.shader=new m(Ke,(()=>import("./ShadedColorMaterial.glsl.ad7acf49.js")));class Xe extends F{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}b([f({count:8})],Xe.prototype,"output",void 0),b([f({count:3})],Xe.prototype,"cullFace",void 0),b([f()],Xe.prototype,"slicePlaneEnabled",void 0),b([f()],Xe.prototype,"transparent",void 0),b([f()],Xe.prototype,"writeDepth",void 0),b([f()],Xe.prototype,"screenSizeEnabled",void 0),b([f()],Xe.prototype,"shadingEnabled",void 0),b([f({count:4})],Xe.prototype,"transparencyPassType",void 0),b([f()],Xe.prototype,"multipassTerrainEnabled",void 0),b([f()],Xe.prototype,"cullAboveGround",void 0);const Ye=new Map([["position",0],["normal",1],["offset",2]]),Ze=k();s({color:[1,1,1,1],shadingTint:[0,0,0,.25],shadingDirection:N(G(),[.5,-.5,-.5]),transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,screenSizeEnabled:!1,screenSize:14,shadingEnabled:!0},U),I("mac");const Je=[1,.5,0],ei=[...Je,.7],ii=[0,0,0,.04],ti=[...Je,.5];function ai(){const e=new h;return e.extensions.add("GL_OES_standard_derivatives"),e.vertex.uniforms.add("proj","mat4").add("view","mat4"),e.attributes.add("position","vec3"),e.attributes.add("uv0","vec2"),e.varyings.add("vUV","vec2"),e.vertex.code.add(c`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),e.fragment.uniforms.add("backgroundColor","vec4").add("gridColor","vec4").add("ratio","float").add("gridWidth","float"),e.fragment.code.add(c`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
gl_FragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),e}var ri=Object.freeze({__proto__:null,build:ai});class si extends _{initializeProgram(e){const i=si.shader.get().build();return new V(e.rctx,i,B)}bindPass(e,i){C(this.program,i.camera.projectionMatrix),this.program.setUniform4fv("backgroundColor",e.backgroundColor),this.program.setUniform4fv("gridColor",e.gridColor),this.program.setUniform1f("gridWidth",e.gridWidth)}bindDraw(e){x(this.program,e),this.program.rebindTextures()}initializePipeline(){return D({blending:q(1,1,771,771),depthTest:{func:513},colorWrite:M})}}si.shader=new m(ri,(()=>import("./SlicePlaneMaterial.glsl.540e31b8.js")));class ni extends K{constructor(e){super(e,oi)}intersect(e,i,t,a,r,s,n){return Q(e,i,a,r,s,void 0,n)}createBufferWriter(){return new X(Y)}getGLMaterial(e){return 0===e.output?new li(e):void 0}}class li extends H{constructor(e){super(e),this._technique=new si(this._techniqueRep.constructionContext,null),this.updateParameters()}updateParameters(){}beginSlot(e){return 8===e}bind(e){this._technique.bindPass(this._material.params,e)}}b([$()],li.prototype,"_technique",void 0);const oi=s({backgroundColor:[1,0,0,.5],gridColor:[0,1,0,.5],gridWidth:4},U);class di extends Ie{constructor(e){super(e),this._material=null,this._renderOccluded=4,this._gridWidth=1,this._gridColor=Z(1,0,0,1),this._backgroundColor=Z(1,0,0,1),this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(e){this._gridWidth!==e&&(this._gridWidth=e,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(e){J(this._gridColor,e),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(e){J(this._backgroundColor,e),this._updateMaterial()}createExternalResources(){this._material=new ni(this.materialParameters)}destroyExternalResources(){this._material=null}forEachExternalMaterial(e){ee(this._material)&&e(this._material)}createGeometries(e){if(ee(this._material)){const i=ie.createSquareGeometry();e.addGeometry(i,this._material)}}get materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded}}_updateMaterial(){ee(this._material)&&this._material.setParameterValues(this.materialParameters)}}var ci;let hi=ci=class extends le{constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}clone(){return new ci({position:oe(this.position),heading:this.heading,tilt:this.tilt,width:this.width,height:this.height})}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&ee(this.position)&&ee(e.position)&&this.position.equals(e.position)&&this.width===e.width&&this.height===e.height}};b([te({readOnly:!0,json:{read:!1,write:!0}})],hi.prototype,"type",void 0),b([te({type:d}),qe()],hi.prototype,"position",void 0),b([te({type:Number,nonNullable:!0,range:{min:0,max:360}}),qe(),ae((e=>re.normalize(se(e),0,!0)))],hi.prototype,"heading",void 0),b([te({type:Number,nonNullable:!0,range:{min:0,max:360}}),qe(),ae((e=>re.normalize(se(e),0,!0)))],hi.prototype,"tilt",void 0),b([te({type:Number,nonNullable:!0}),qe()],hi.prototype,"width",void 0),b([te({type:Number,nonNullable:!0}),qe()],hi.prototype,"height",void 0),hi=ci=b([ne("esri.widgets.Slice.SlicePlane")],hi);var ui=hi;const pi=de.getLogger("esri.views.3d.interactive.analysisTools.slice.sliceToolUtils");function gi(e,i,t){const a=i.worldUpAtPosition(e.origin,A.get()),r=e.basis1,s=vi(e,a),n=Math.round(s/bi)*bi;return ce(e,n-s,r,t)}function yi(e,i){return function(e,i,t,a){const r=N(A.get(),e),s=N(A.get(),i),n=R(A.get(),r,s);return a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=0,a[4]=s[0],a[5]=s[1],a[6]=s[2],a[7]=0,a[8]=n[0],a[9]=n[1],a[10]=n[2],a[11]=0,a[12]=t[0],a[13]=t[1],a[14]=t[2],a[15]=1,a}(e.basis1,e.basis2,e.origin,i)}function wi(e,i,t,a=new ui){if(ue(e))return null;const r=ee(a.position)?a.position:new d;i.fromRenderCoords(e.origin,r,t),a.position=r;const s=i.worldUpAtPosition(e.origin,A.get()),n=i.worldBasisAtPosition(e.origin,1,A.get());return a.width=2*pe(e.basis1),a.height=2*pe(e.basis2),a.tilt=ge(vi(e,s)),a.heading=ge(function(e,i,t){return he(e.basis1,t,i)-bi}(e,s,n)),a}function vi(e,i){return he(i,e.basis2,e.basis1)+bi}function mi(e,i,t=ye()){if(ue(e)||ue(e.position))return null;let a=e.position;return e.position.hasZ||(a=e.position.clone(),a.z=we(ve(i.elevationProvider,e.position),0)),function(e,i,t,a,r,s,n=ye()){return s.toRenderCoords(e,n.origin)?(s.worldBasisAtPosition(n.origin,0,n.basis1),s.worldBasisAtPosition(n.origin,1,n.basis2),me(n.basis2,n.basis1,n.origin,n.plane),ce(n,-fe(i),be(n),n),ce(n,fe(t),n.basis1,n),_e(n.basis1,n.basis1,a/2),_e(n.basis2,n.basis2,r/2),Ve(n),n):(pi.error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}(a,e.heading,e.tilt,e.width,e.height,i.renderCoordsHelper,t)}l();const bi=Math.PI/2,fi=de.getLogger("esri.views.3d.interactive.graphics.Slice.SliceController");let _i=class extends Pe{constructor(e){super(e),this._handles=new xe,this._internalChange=!1,this._currentSlicePlane=null,this.state="pending"}get ready(){return"ready"===this.state}initialize(){this._handles.add(this.layerView.layerViewData.excludedLayers.on("before-add",(e=>{const i=e.item;null!=i&&(i instanceof Ee||i instanceof Re)?i instanceof Ee&&function(e){switch(e.type){case"building-scene":case"csv":case"direct-line-measurement":case"area-measurement":case"feature":case"geo-rss":case"geojson":case"graphics":case"group":case"integrated-mesh":case"kml":case"line-of-sight":case"map-notes":case"ogc-feature":case"point-cloud":case"route":case"slice":case"scene":case"stream":case"voxel":case"subtype-group":case"unknown":case"unsupported":case"wfs":case null:return!1;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"elevation":case"imagery":case"imagery-tile":case"map-image":case"open-street-map":case"tile":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":return!0;default:return Ce(e.type),!1}}(i)?(fi.error("excludedLayers",`Layer '${i.title}, id:${i.id}' of type '${i.type}' can not be individually excluded from slicing. Use 'excludeGroundSurface' instead.`),e.preventDefault()):this.layerView.layerViewData.excludedLayers.includes(i)&&e.preventDefault():(fi.error("excludedLayers","Invalid layer type, layer must derive from Layer or BuildingComponentSublayer"),e.preventDefault())}))),this._handles.add(Se(this.view,"ready",(()=>this._initialize()),!0))}_initialize(){switch(this.state){case"pending":break;case"destroyed":return;case"ready":throw new Error("state error")}var e,i;e=this.view,i=this,Vi.has(e)||Vi.set(e,{all:[],activeController:null}),Vi.get(e).all.push(i),this._handles.add([this.layerView.layerViewData.watch("plane",(()=>{this._internalChange||this._updateSlicePlaneFromBoundedPlane(),this._updateLayerViews()}),!0),this.layerView.layerViewData.watch("excludeGroundSurface",(()=>this._updateLayerViews()),!0),this.layerView.layerViewData.excludedLayers.on("change",(()=>this._updateLayerViews())),this.layerView.watch(["active","visible"],(()=>{this._updateActiveController(),this._updateViewSlicePlane()}),!0),this.view.allLayerViews.on("change",(()=>this._updateLayerViews()))]),this._handles.add([this.analysis.watch("plane",(()=>{this._internalChange||(this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane())}),!0)],"analysis"),this._set("state","ready"),this._updateActiveController(),this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane()}destroy(){switch(this.state){case"destroyed":case"pending":return}this.layerView.active=!1,function(e,i){if(!Vi.has(e))throw new Error("view expected in global slice register");const t=Vi.get(e),a=t.all.lastIndexOf(i);if(-1===a)throw new Error("controller expected in global slice register");t.all.splice(a,1),0===t.all.length&&Vi.delete(e)}(this.view,this),this._handles.destroy(),this.view.slicePlane=null,this.set("view",null),this._set("state","destroyed")}async whenReady(){return await Se(this,"ready"),this}_updateBoundedPlaneFromSlicePlane(){const e=this.analysis.plane,i=this._currentSlicePlane;if(ue(i)&&ue(e)||ee(i)&&ee(e)&&e.equals(i))return;let t=null,a=null;ee(e)&&(t=mi(e,this.view,ye()),ee(t)?a={heading:e.heading,tilt:e.tilt,position:e.position,width:e.width,height:e.height}:console.warn("Failed slice plane conversion.")),this._currentSlicePlane=a,ee(t)&&!this.analysis.tiltEnabled&&gi(t,this.view.renderCoordsHelper,t),this._internalChange=!0,this.layerView.layerViewData.plane=t,this._internalChange=!1}_updateSlicePlaneFromBoundedPlane(){const e=this.layerView.layerViewData.plane,i=wi(e,this.view.renderCoordsHelper,this.view.spatialReference,new ui);let t=null;ee(i)&&(t={heading:i.heading,tilt:i.tilt,position:i.position,width:i.width,height:i.height}),this._currentSlicePlane=t,ee(e)&&(this.analysis.tiltEnabled||gi(e,this.view.renderCoordsHelper,e)),this._internalChange=!0,this.analysis.plane=i,this._internalChange=!1,this._updateViewSlicePlane()}_updateActiveController(){if(Ci)return;const e=Pi(this.view);if(this.layerView.active)ee(e.activeController)&&e.activeController!==this?(Ci=!0,e.activeController.layerView.active=!1,Ci=!1):ee(e.activeController)&&e.activeController,this._updateLayerViews(),e.activeController=this;else{if(ee(e.activeController)&&e.activeController!==this)return;ee(e.activeController)&&e.activeController===this&&(e.activeController=null,this._updateLayerViews())}}_updateViewSlicePlane(){"ready"===this.state&&function(e){const i=Pi(e).activeController;ee(i)&&ee(i.layerView.layerViewData.plane)&&i.layerView.visible?e.slicePlane=i.layerView.layerViewData.plane:e.slicePlane=null}(this.view)}_updateLayerViews(){const e=ee(this.layerView.layerViewData.plane)&&this.layerView.visible&&this.layerView.active,i=[],t=e=>{"layers"in e?e.layers.forEach(t):i.push(e)};this.layerView.layerViewData.excludedLayers.forEach(t),this.view.allLayerViews.forEach((t=>{"slicePlaneEnabled"in t&&(t.slicePlaneEnabled=e&&i.indexOf(t.layer)<0),"sublayerViews"in t&&t.sublayerViews.forEach((t=>{t.slicePlaneEnabled=e&&i.indexOf(t.sublayer)<0}))})),null!=this.view.basemapTerrain&&(this.view.basemapTerrain.slicePlaneEnabled=e&&!this.layerView.layerViewData.excludeGroundSurface)}};b([te({readOnly:!0})],_i.prototype,"state",void 0),b([te()],_i.prototype,"view",void 0),b([te()],_i.prototype,"analysis",void 0),b([te()],_i.prototype,"layerView",void 0),b([te()],_i.prototype,"ready",null),_i=b([ne("esri.views.3d.interactive.graphics.Slice.SliceController")],_i);const Vi=new Map;let Ci=!1;function Pi(e){return Vi.get(e)}let xi=class extends Pe{constructor(e){super(e),this._handles=new xe,this._gridVisualElement=null,this._outlineVisualElement=null,this.state="pending"}get ready(){return"ready"===this.state}set showGrid(e){this._set("showGrid",e),this._updateMaterials()}set editable(e){this._set("editable",e),this._updateMaterials()}initialize(){this._initialize()}async _initialize(){switch(this.state){case"pending":break;case"destroyed":return;case"ready":throw new Error("state error")}if(await Se(this.view,"ready",!0),ue(this.layerView.layerViewData))throw new Error("expected internal object to be valid");var e;this._gridVisualElement=(e=this.view,new di({view:e,attached:!0,backgroundColor:[...ii],gridColor:ti,gridWidth:4,renderOccluded:4})),this._outlineVisualElement=function(e){return new Be({view:e,attached:!0,color:ei,width:1,writeDepthEnabled:!1,renderOccluded:4,geometry:[[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]]]})}(this.view),this._handles.add(De((()=>this.layerView.fullOpacity),(()=>this._updateMaterials())),"layer"),this._handles.add([this.layerView.watch("visible",(()=>this._updateMaterials()),!0),this.layerView.layerViewData.watch("plane",(()=>this._updatePlane()),!0),this.layerView.watch("active",(()=>this._updateMaterials()),!0)],"internal"),this._updatePlane(),this._set("state","ready")}destroy(){switch(this.state){case"destroyed":case"pending":return}this._handles.destroy(),this._gridVisualElement=ze(this._gridVisualElement),this._outlineVisualElement=ze(this._outlineVisualElement),this.set("view",null),this._set("state","destroyed")}async whenReady(){return await Se(this,"ready"),this}_update(){switch(this.state){case"pending":case"destroyed":return}}_updatePlane(){const e=this.layerView.layerViewData.plane,i=ee(e)?yi(e,Oe.get()):null;if(this._outlineVisualElement.width=1,ee(e)){const t=Le(A.get(),pe(e.basis1),pe(e.basis2),1),a=Te(Oe.get(),t),r=We(a,i,a);this._outlineVisualElement.transform=r,this._gridVisualElement.transform=r}this._updateMaterials()}_updateMaterials(){const e=this.layerView.layerViewData.plane&&this.layerView.visible,i=this.layerView.active,t=this.layerView.fullOpacity,a=Me(Ei,ei,t);this._outlineVisualElement.color=a,this._outlineVisualElement.width=this.editable?1:2,this._outlineVisualElement.stipplePattern=i?null:je(5);const r=Me(Ei,ii,t),s=ee(this.layerView.layerViewData)&&this.showGrid?ti:[0,0,0,0];this._gridVisualElement.backgroundColor=r,this._gridVisualElement.gridColor=s,this._gridVisualElement.visible=e,this._outlineVisualElement.visible=e}};b([te({readOnly:!0})],xi.prototype,"state",void 0),b([te()],xi.prototype,"view",void 0),b([te()],xi.prototype,"layer",void 0),b([te()],xi.prototype,"layerView",void 0),b([te()],xi.prototype,"ready",null),b([te({value:!1})],xi.prototype,"showGrid",null),b([te({value:!0})],xi.prototype,"editable",null),xi=b([ne("esri.views.3d.interactive.graphics.Slice.SliceView")],xi);const Ei=k();let Si=class extends Pe{constructor(){super(...arguments),this.plane=null,this.excludeGroundSurface=!1}get excludedLayers(){return this._get("excludedLayers")||new ke}set excludedLayers(e){this._set("excludedLayers",Ne(e,this._get("excludedLayers")))}};b([te()],Si.prototype,"plane",void 0),b([te()],Si.prototype,"excludeGroundSurface",void 0),b([te({cast:Fe})],Si.prototype,"excludedLayers",null),Si=b([ne("esri.views.3d.interactive.graphics.Slice.SliceInternal")],Si);let Di=class extends(Ge(Ue)){constructor(){super(...arguments),this.type="slice-3d",this.analysisView=null,this.analysisController=null,this._initialized=Ae(),this.layerViewData=new Si,this.active=!0,this.showGrid=!1,this.editable=!1}initialize(){this.analysisView=new xi({view:this.view,layer:this.layer,layerView:this}),this.analysisController=new _i({view:this.view,analysis:this.layer,layerView:this}),this._initialized.resolve()}destroy(){this.analysisView.destroy(),this.analysisView=null,this.analysisController.destroy(),this.analysisController=null}async when(){return this.destroyed?null:(await this._initialized.promise,this.destroyed?null:(await this.analysisView.whenReady(),this.destroyed?null:(await this.analysisController.whenReady(),this)))}get testData(){return{view:this.analysisView,controller:this.analysisController}}};b([te()],Di.prototype,"type",void 0),b([te()],Di.prototype,"layerViewData",void 0),b([te()],Di.prototype,"layer",void 0),b([te()],Di.prototype,"active",void 0),b([te({aliasOf:"analysisView.showGrid"})],Di.prototype,"showGrid",void 0),b([te({aliasOf:"analysisView.editable"})],Di.prototype,"editable",void 0),Di=b([ne("esri.views.3d.layers.SliceLayerView3D")],Di);var zi=Di,Oi=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",get SliceLayerView3D(){return Di},default:zi});export{Oi as S,ai as r,He as t};
//# sourceMappingURL=SliceLayerView3D.d6bfea66.js.map
