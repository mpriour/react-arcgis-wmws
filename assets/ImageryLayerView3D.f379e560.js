import{J as e,fC as a,M as t,F as i,H as s}from"./vendor.7103ff48.js";import{U as r}from"./DynamicLayerView3D.29c99608.js";import{u as n}from"./ImageryLayerView.444cfe29.js";import"./projectExtentUtils.e211dec5.js";import"./ImageMaterialTechnique.920f1ced.js";import"./RefreshableLayerView.7b9ab281.js";import"./popupUtils.99eeb504.js";let m=class extends(n(r)){constructor(){super(...arguments),this.type="imagery-3d",this.redrawDebounced=e((async e=>{this.redraw(((e,a)=>this._redrawImage(e,a)),e)}),2e3)}initialize(){this.handles.add([a(this.view.basemapTerrain,"ready",(()=>this.initializeMaximumDataResolution())),this.layer.on("redraw",(()=>this.redrawDebounced()))]),this.updatingHandles.add(this.layer,"exportImageServiceParameters.version",(()=>{this.updatingHandles.addPromise(this.refreshDebounced())})),this.updatingHandles.add(this,"timeExtent",(()=>this.updatingHandles.addPromise(this.refreshDebounced())))}initializeMaximumDataResolution(){const e=this.view.basemapTerrain.spatialReference,a=this.layer.fullExtent;a&&e.equals(a.spatialReference)&&(this.maximumDataResolution={x:this.layer.pixelSizeX,y:this.layer.pixelSizeY})}getFetchOptions(){return{timeExtent:this.timeExtent}}async processResult(e,a,t){a.imageElement?e.image=a.imageElement:(e.image=document.createElement("canvas"),e.pixelData=a.pixelData,await this._redrawImage(e,t))}async _redrawImage(e,a){if(!(e.image instanceof HTMLCanvasElement)||t(e.pixelData))return Promise.reject();const i=e.image,s=i.getContext("2d"),r=await this.layer.applyRenderer(e.pixelData,{signal:a}),n=this.layer.applyFilter(r).pixelBlock;if(t(n))return Promise.reject();i.width=n.width,i.height=n.height;const m=s.createImageData(n.width,n.height);m.data.set(n.getAsRGBA()),s.putImageData(m,0,0)}};m=i([s("esri.views.3d.layers.ImageryLayerView3D")],m);var l=m;export{l as default};
//# sourceMappingURL=ImageryLayerView3D.f379e560.js.map
