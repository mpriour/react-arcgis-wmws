{"version":3,"file":"Graphics3DGraphicLikeLayerView.f8e9955d.js","sources":["../../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DGraphicLikeLayerView.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../chunks/tslib.es6.js\";import e from\"../../../../Graphic.js\";import i from\"../../../../core/Accessor.js\";import s from\"../../../../core/Collection.js\";import r from\"../../../../core/Handles.js\";import{isSome as a,destroyMaybe as o,isNone as n}from\"../../../../core/maybe.js\";import{isAbortError as c}from\"../../../../core/promiseUtils.js\";import{init as h}from\"../../../../core/watchUtils.js\";import{property as p}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as l}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{diff as d}from\"../../../../core/accessorSupport/diffUtils.js\";import u from\"../../../../layers/Layer.js\";import{hydrateGraphic as g}from\"../../../../layers/graphics/hydratedFeatures.js\";import m from\"../../../../rest/support/Query.js\";import{SUSPEND_RESUME_EXTENT_OPTIMISM as y}from\"./constants.js\";import{Graphics3DCore as f}from\"./Graphics3DCore.js\";import b from\"./Graphics3DElevationAlignment.js\";import{Graphics3DObjectStates as j}from\"./Graphics3DObjectStates.js\";import w from\"./Graphics3DScaleVisibility.js\";import{enlargeExtent as C}from\"./graphicUtils.js\";import{WatchUpdatingTracking as S}from\"../../../support/WatchUpdatingTracking.js\";let v=class extends i{constructor(t){super(t),this.graphicsCore=null,this.elevationAlignment=new b,this.watchUpdatingTracking=new S,this.handles=new r,this.suspendResumeExtent=null}normalizeCtorArgs(t){let e=null;t.scaleVisibilityEnabled&&(delete(t={...t}).scaleVisibilityEnabled,e=new w);const i=new f({owner:t.owner,layer:t.layer,preferredUpdatePolicy:1,graphicSymbolSupported:!0});return{...t,graphicsCore:i,scaleVisibility:e}}initialize(){const t=this.scaleVisibility;a(t)&&\"minScale\"in this.layer&&this.watchUpdatingTracking.add(this.layer,\"scaleRangeId\",(()=>t.layerMinMaxScaleChangeHandler())),\"elevationInfo\"in this.layer&&this.watchUpdatingTracking.add(this.layer,\"elevationInfo\",((t,e)=>{d(t,e)&&this.watchUpdatingTracking.addPromise(this.graphicsCore.elevationInfoChange())}))}async setup(){const t=(t,e,i)=>this.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(t,e,i);if(this.elevationAlignment.setup(this.owner,t,this.graphicsCore,this.view.elevationProvider),a(this.scaleVisibility)&&\"minScale\"in this.layer){const e=this.owner.view.basemapTerrain;this.scaleVisibility.setup(this.owner,this.layer,t,this.graphicsCore,e)}this._set(\"objectStates\",new j(this.graphicsCore));try{await this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,objectStates:this.objectStates})}catch(e){if(c(e))return;throw e}this.destroyed||(this.handles.add(this.view.watch(\"clippingArea\",(()=>this.updateClippingExtent()),!0)),this.updateClippingExtent(),this.setupSuspendResumeExtent(),this.graphicsCore.startCreateGraphics())}destroy(){this.handles=o(this.handles),this.watchUpdatingTracking.destroy(),this._set(\"elevationAlignment\",o(this.elevationAlignment)),this._set(\"scaleVisibility\",o(this.scaleVisibility)),this._set(\"objectStates\",o(this.objectStates)),this._set(\"graphicsCore\",o(this.graphicsCore))}get suspended(){return!(!a(this.scaleVisibility)||!this.scaleVisibility.suspended)}get updating(){var t,e;return!!(null!=(t=this.graphicsCore)&&t.updating||a(this.scaleVisibility)&&this.scaleVisibility.updating||null!=(e=this.watchUpdatingTracking)&&e.updating)}getGraphicFromGraphicUid(t){if(this.owner.loadedGraphics){const e=this.owner.loadedGraphics.find((e=>e.uid===t));if(e){const t=this.layer instanceof u?this.layer:null;return g(e,t)}}}whenGraphicBounds(t,e){return this.graphicsCore?this.graphicsCore.whenGraphicBounds(t,e):Promise.reject()}computeAttachmentOrigin(t,e){return this.graphicsCore?this.graphicsCore.computeAttachmentOrigin(t,e):null}getSymbolLayerSize(t,e){return this.graphicsCore?this.graphicsCore.getSymbolLayerSize(t,e):null}maskOccludee(t){const{set:e,handle:i}=this.objectStates.acquireSet(1,null);return this.objectStates.setUid(e,t.uid),i}highlight(t){if(t instanceof m)return x;if(\"number\"==typeof t)return this.highlight([t]);if(t instanceof e)return this.highlight([t]);if(t instanceof s&&(t=t.toArray()),Array.isArray(t)&&t.length>0){if(t[0]instanceof e){const e=t.map((t=>t.uid)),{set:i,handle:s}=this.objectStates.acquireSet(0,null);return this.objectStates.setUids(i,e),s}if(\"number\"==typeof t[0]){const e=t,{set:i,handle:s}=this.objectStates.acquireSet(0,null);return this.objectStates.setObjectIds(i,e),s}}return x}updateClippingExtent(){const t=this.view.clippingArea;this.graphicsCore.setClippingExtent(t,this.view.spatialReference)&&this.graphicsCore.recreateAllGraphics()}updateSuspendResumeExtent(){n(this.scaleVisibility)||(this.suspendResumeExtent=C(this.graphicsCore.computedExtent,this.suspendResumeExtent,y,this.graphicsCore.extentPadding),this.scaleVisibility.setExtent(this.suspendResumeExtent))}setupSuspendResumeExtent(){n(this.scaleVisibility)||(h(this.graphicsCore,\"computedExtent\",(t=>this.updateSuspendResumeExtent()),!0),this.graphicsCore.watch(\"extentPadding\",(t=>this.updateSuspendResumeExtent())))}};t([p({constructOnly:!0})],v.prototype,\"owner\",void 0),t([p({constructOnly:!0})],v.prototype,\"layer\",void 0),t([p({readOnly:!0,aliasOf:\"owner.view\"})],v.prototype,\"view\",void 0),t([p({constructOnly:!0})],v.prototype,\"graphicsCore\",void 0),t([p({constructOnly:!0})],v.prototype,\"scaleVisibility\",void 0),t([p({readOnly:!0})],v.prototype,\"elevationAlignment\",void 0),t([p({readOnly:!0})],v.prototype,\"objectStates\",void 0),t([p({readOnly:!0})],v.prototype,\"watchUpdatingTracking\",void 0),t([p({readOnly:!0})],v.prototype,\"suspended\",null),t([p({readOnly:!0})],v.prototype,\"updating\",null),v=t([l(\"esri.views.3d.layers.graphics.Graphics3DGraphicLikeLayerView\")],v);const x={remove(){},pause(){},resume(){}};var E=v;export{E as default};\n"],"names":["v","i","constructor","t2","this","graphicsCore","elevationAlignment","b","watchUpdatingTracking","S","handles","r","suspendResumeExtent","normalizeCtorArgs","e2","scaleVisibilityEnabled","__spreadValues","w","i2","f","owner","layer","preferredUpdatePolicy","graphicSymbolSupported","scaleVisibility","initialize","add","layerMinMaxScaleChangeHandler","t3","addPromise","elevationInfoChange","spatialIndex","queryGraphicUIDsInExtent","setup","view","elevationProvider","a","basemapTerrain","_set","j","objectStates","c","destroyed","watch","updateClippingExtent","setupSuspendResumeExtent","startCreateGraphics","destroy","o","suspended","updating","getGraphicFromGraphicUid","loadedGraphics","find","e3","uid","u","g","whenGraphicBounds","Promise","reject","computeAttachmentOrigin","getSymbolLayerSize","maskOccludee","set","handle","acquireSet","setUid","highlight","m","x","e","s","toArray","Array","isArray","length","map","s2","setUids","setObjectIds","clippingArea","setClippingExtent","spatialReference","recreateAllGraphics","updateSuspendResumeExtent","C","computedExtent","y","extentPadding","setExtent","t","p","constructOnly","prototype","readOnly","aliasOf","l","remove","pause","resume","E"],"mappings":"+rBAIq1C,IAAIA,EAAE,cAAcC,EAAEC,YAAYC,SAASA,GAAGC,KAAKC,aAAa,KAAKD,KAAKE,mBAAmB,IAAIC,EAAEH,KAAKI,sBAAsB,IAAIC,EAAEL,KAAKM,QAAQ,IAAIC,EAAEP,KAAKQ,oBAAoB,KAAKC,kBAAkBV,OAAOW,EAAE,OAAOC,kCAAkCC,KAAIb,IAAIY,uBAAuBD,EAAE,IAAIG,SAASC,EAAE,IAAIC,EAAE,CAACC,MAAMjB,EAAEiB,MAAMC,MAAMlB,EAAEkB,MAAMC,sBAAsB,EAAEC,wBAAuB,kBAAepB,SAAJ,CAAME,aAAaa,EAAEM,gBAAgBV,WAAGW,mBAAmBtB,EAAEC,KAAKoB,kBAAkBrB,IAAI,aAAaC,KAAKiB,OAAOjB,KAAKI,sBAAsBkB,IAAItB,KAAKiB,MAAM,gBAAgB,IAAIlB,EAAEwB,kCAAkC,kBAAkBvB,KAAKiB,OAAOjB,KAAKI,sBAAsBkB,IAAItB,KAAKiB,MAAM,iBAAiB,CAACO,EAAEd,OAAOc,EAAEd,IAAIV,KAAKI,sBAAsBqB,WAAWzB,KAAKC,aAAayB,8CAA8C3B,EAAE,CAACyB,EAAEd,EAAEI,IAAId,KAAKC,aAAa0B,aAAaC,yBAAyBJ,EAAEd,EAAEI,MAAMd,KAAKE,mBAAmB2B,MAAM7B,KAAKgB,MAAMjB,EAAEC,KAAKC,aAAaD,KAAK8B,KAAKC,mBAAmBC,EAAEhC,KAAKoB,kBAAkB,aAAapB,KAAKiB,MAAM,OAAOP,EAAEV,KAAKgB,MAAMc,KAAKG,oBAAoBb,gBAAgBS,MAAM7B,KAAKgB,MAAMhB,KAAKiB,MAAMlB,EAAEC,KAAKC,aAAaS,QAAQwB,KAAK,eAAe,IAAIC,EAAEnC,KAAKC,yBAAyBD,KAAKC,aAAa4B,MAAM,CAAC3B,mBAAmBF,KAAKE,mBAAmBkB,gBAAgBpB,KAAKoB,gBAAgBgB,aAAapC,KAAKoC,qBAAqB1B,MAAM2B,EAAE3B,gBAAgBA,OAAO4B,iBAAiBhC,QAAQgB,IAAItB,KAAK8B,KAAKS,MAAM,gBAAgB,IAAIvC,KAAKwC,yBAAwB,IAAKxC,KAAKwC,uBAAuBxC,KAAKyC,2BAA2BzC,KAAKC,aAAayC,uBAAuBC,eAAerC,QAAQsC,EAAE5C,KAAKM,SAASN,KAAKI,sBAAsBuC,UAAU3C,KAAKkC,KAAK,qBAAqBU,EAAE5C,KAAKE,qBAAqBF,KAAKkC,KAAK,kBAAkBU,EAAE5C,KAAKoB,kBAAkBpB,KAAKkC,KAAK,eAAeU,EAAE5C,KAAKoC,eAAepC,KAAKkC,KAAK,eAAeU,EAAE5C,KAAKC,wCAAwC+B,EAAEhC,KAAKoB,mBAAmBpB,KAAKoB,gBAAgByB,8BAA8B9C,EAAEW,WAAW,SAASV,KAAKC,eAAeF,EAAE+C,UAAUd,EAAEhC,KAAKoB,kBAAkBpB,KAAKoB,gBAAgB0B,UAAU,SAAS9C,KAAKI,wBAAwBM,EAAEoC,UAAUC,yBAAyBhD,MAAMC,KAAKgB,MAAMgC,eAAe,OAAOtC,EAAEV,KAAKgB,MAAMgC,eAAeC,SAASC,EAAEC,MAAMpD,OAAOW,EAAE,OAAOc,EAAExB,KAAKiB,iBAAiBmC,EAAEpD,KAAKiB,MAAM,YAAYoC,EAAE3C,EAAEc,KAAK8B,kBAAkBvD,EAAEW,UAAUV,KAAKC,aAAaD,KAAKC,aAAaqD,kBAAkBvD,EAAEW,GAAG6C,QAAQC,SAASC,wBAAwB1D,EAAEW,UAAUV,KAAKC,aAAaD,KAAKC,aAAawD,wBAAwB1D,EAAEW,GAAG,KAAKgD,mBAAmB3D,EAAEW,UAAUV,KAAKC,aAAaD,KAAKC,aAAayD,mBAAmB3D,EAAEW,GAAG,KAAKiD,aAAa5D,SAAS6D,IAAIlD,EAAEmD,OAAO/C,GAAGd,KAAKoC,aAAa0B,WAAW,EAAE,aAAa9D,KAAKoC,aAAa2B,OAAOrD,EAAEX,EAAEoD,KAAKrC,EAAEkD,UAAUjE,MAAMA,aAAakE,SAASC,KAAK,iBAAiBnE,SAASC,KAAKgE,UAAU,CAACjE,OAAOA,aAAaoE,SAASnE,KAAKgE,UAAU,CAACjE,OAAOA,aAAaqE,MAAMrE,EAAEsE,WAAWC,MAAMC,QAAQxE,IAAIA,EAAEyE,OAAO,EAAE,IAAIzE,EAAE,aAAaoE,EAAE,OAAOzD,EAAEX,EAAE0E,QAAQjD,EAAE2B,OAAOS,IAAI9C,EAAE+C,OAAOa,GAAG1E,KAAKoC,aAAa0B,WAAW,EAAE,aAAa9D,KAAKoC,aAAauC,QAAQ7D,EAAEJ,GAAGgE,KAAK,iBAAiB3E,EAAE,GAAG,OAAOW,EAAEX,GAAG6D,IAAI9C,EAAE+C,OAAOa,GAAG1E,KAAKoC,aAAa0B,WAAW,EAAE,aAAa9D,KAAKoC,aAAawC,aAAa9D,EAAEJ,GAAGgE,UAAUR,EAAE1B,6BAA6BzC,EAAEC,KAAK8B,KAAK+C,kBAAkB5E,aAAa6E,kBAAkB/E,EAAEC,KAAK8B,KAAKiD,mBAAmB/E,KAAKC,aAAa+E,sBAAsBC,8BAA8BjF,KAAKoB,wBAAwBZ,oBAAoB0E,EAAElF,KAAKC,aAAakF,eAAenF,KAAKQ,oBAAoB4E,EAAEpF,KAAKC,aAAaoF,eAAerF,KAAKoB,gBAAgBkE,UAAUtF,KAAKQ,sBAAsBiC,6BAA6BzC,KAAKoB,qBAAqBpB,KAAKC,aAAa,qBAAqBD,KAAKiF,8BAA6B,GAAIjF,KAAKC,aAAasC,MAAM,oBAAoBvC,KAAKiF,iCAAiCM,EAAE,CAACC,EAAE,CAACC,eAAc,KAAM7F,EAAE8F,UAAU,aAAQ,GAAQH,EAAE,CAACC,EAAE,CAACC,eAAc,KAAM7F,EAAE8F,UAAU,aAAQ,GAAQH,EAAE,CAACC,EAAE,CAACG,UAAS,EAAGC,QAAQ,gBAAgBhG,EAAE8F,UAAU,YAAO,GAAQH,EAAE,CAACC,EAAE,CAACC,eAAc,KAAM7F,EAAE8F,UAAU,oBAAe,GAAQH,EAAE,CAACC,EAAE,CAACC,eAAc,KAAM7F,EAAE8F,UAAU,uBAAkB,GAAQH,EAAE,CAACC,EAAE,CAACG,UAAS,KAAM/F,EAAE8F,UAAU,0BAAqB,GAAQH,EAAE,CAACC,EAAE,CAACG,UAAS,KAAM/F,EAAE8F,UAAU,oBAAe,GAAQH,EAAE,CAACC,EAAE,CAACG,UAAS,KAAM/F,EAAE8F,UAAU,6BAAwB,GAAQH,EAAE,CAACC,EAAE,CAACG,UAAS,KAAM/F,EAAE8F,UAAU,YAAY,MAAMH,EAAE,CAACC,EAAE,CAACG,UAAS,KAAM/F,EAAE8F,UAAU,WAAW,MAAM9F,EAAE2F,EAAE,CAACM,EAAE,iEAAiEjG,GAAG,MAAMsE,EAAE,CAAC4B,WAAWC,UAAUC,YAAe,IAACC,EAAErG"}