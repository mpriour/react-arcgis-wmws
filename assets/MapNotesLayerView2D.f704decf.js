import{ih as e,B as i,D as s,A as t,bt as r,fr as a,M as o,F as n,H as p}from"./vendor.7103ff48.js";import{l as h}from"./LayerView2D.3bec42c6.js";import{r as c}from"./GraphicContainer.aef7333c.js";import{e as l}from"./BaseGraphicContainer.8758663f.js";import"./Container.f525a10f.js";import"./Utils.8f00ae04.js";import"./projectionSupport.c5c55ada.js";import"./json.62026198.js";import"./Matcher.4dbcd4b5.js";import"./definitions.e5e12ce7.js";import"./ComputedAttributeStorage.c6915def.js";import"./FeatureSetReader.bfb25a2d.js";import"./centroid.f07ef5b9.js";import"./visualVariablesUtils.7196204b.js";import"./visualVariablesUtils.f42dea16.js";import"./tileUtils.2adb3da0.js";import"./TileClipper.507f8905.js";import"./GeometryUtils.1bcb906c.js";import"./schemaUtils.c28cd36f.js";import"./MaterialKey.8df623c8.js";import"./CIMSymbolHelper.da5834c9.js";import"./Rect.db562a93.js";import"./BidiEngine.af5bfcbd.js";import"./MD5.86afbcc5.js";import"./cimAnalyzer.07de9cca.js";import"./FeatureContainer.c8d6e93f.js";import"./TileContainer.555234dd.js";import"./WGLContainer.6f073475.js";import"./brushes.b64b90a9.js";import"./ShaderCompiler.6905b522.js";import"./pixelUtils.5eddfa69.js";import"./GraphicsView.45ff2c67.js";const d="sublayers",f="layerView",u=Object.freeze({remove(){},pause(){},resume(){}});let m=class extends(h(e)){async fetchPopupFeatures(e){return(await Promise.all(Array.from(this.graphicsViews(),(i=>i.searchFeatures(e).then((e=>e.filter((e=>!!e.popupTemplate)))))))).flat()}*graphicsViews(){i(this._graphicsViewsFeatureCollectionMap)?yield*this._graphicsViewsFeatureCollectionMap.keys():i(this._graphicsViews)?yield*this._graphicsViews:yield*[]}async hitTest(e,s){if(this.suspended)return null;const t=Array.from(this.graphicsViews(),(async t=>{const r=await t.hitTest(e,s);if(r){if(i(this._graphicsViewsFeatureCollectionMap)){const e=this._graphicsViewsFeatureCollectionMap.get(t);!r.popupTemplate&&e.popupTemplate&&(r.popupTemplate=e.popupTemplate)}return r}return null}));return(await Promise.all(t)).filter((e=>!!e))[0]||null}highlight(e){let i;if("number"==typeof e?i=[e]:e instanceof s?i=[e.uid]:Array.isArray(e)&&e.length>0?i="number"==typeof e[0]?e:e.map((e=>e&&e.uid)):t.isCollection(e)&&(i=e.map((e=>e&&e.uid)).toArray()),i=i.filter((e=>null!=e)),!i.length)return u;for(const s of this.graphicsViews())s.addHighlight(i);return{remove:()=>{for(const e of this.graphicsViews())e.removeHighlight(i)}}}update(e){for(const i of this.graphicsViews())i.processUpdate(e)}attach(){const e=this.view,s=()=>this.requestUpdate(),t=this.layer.featureCollections;if(i(t)&&t.length){this._graphicsViewsFeatureCollectionMap=new Map;for(const i of t){const t=new c(this.view.featuresTilingScheme);t.fadeTransitionEnabled=!0;const a=new l({view:e,graphics:i.source,renderer:i.renderer,requestUpdateCallback:s,container:t});this._graphicsViewsFeatureCollectionMap.set(a,i),this.container.addChild(a.container),this.handles.add([r(i,"visible",(e=>a.container.visible=e)),r(a,"updating",(()=>this.notifyChange("updating")))],f)}}else i(this.layer.sublayers)&&this.handles.add(a(this.layer,"sublayers","change",(()=>this._createGraphicsViews()),(()=>this._createGraphicsViews()),(()=>this._destroyGraphicsViews())),d)}detach(){this._destroyGraphicsViews(),this.handles.remove(d)}moveStart(){}moveEnd(){}viewChange(){for(const e of this.graphicsViews())e.viewChange()}isUpdating(){for(const e of this.graphicsViews())if(e.updating)return!0;return!1}_destroyGraphicsViews(){this.container.removeAllChildren(),this.handles.remove(f);for(const e of this.graphicsViews())e.destroy();this._graphicsViews=null,this._graphicsViewsFeatureCollectionMap=null}_createGraphicsViews(){if(this._destroyGraphicsViews(),o(this.layer.sublayers))return;const e=[],i=this.view,s=()=>this.requestUpdate();for(const t of this.layer.sublayers){const a=new c(this.view.featuresTilingScheme);a.fadeTransitionEnabled=!0;const o=new l({view:i,graphics:t.graphics,requestUpdateCallback:s,container:a});this.handles.add([t.on("graphic-update",o.graphicUpdateHandler),r(t,"visible",(e=>o.container.visible=e)),r(o,"updating",(()=>this.notifyChange("updating")))],f),this.container.addChild(o.container),e.push(o)}this._graphicsViews=e}};m=n([p("esri.views.2d.layers.MapNotesLayerView2D")],m);var g=m;export{g as default};
//# sourceMappingURL=MapNotesLayerView2D.f704decf.js.map
