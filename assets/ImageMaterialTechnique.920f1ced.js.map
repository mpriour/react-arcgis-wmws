{"version":3,"file":"ImageMaterialTechnique.920f1ced.js","sources":["../../node_modules/@arcgis/core/chunks/ImageMaterial.glsl.js","../../node_modules/@arcgis/core/views/3d/webgl-engine/shaders/ImageMaterialTechnique.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{Slice as e}from\"../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl.js\";import{Transform as r}from\"../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl.js\";import{ReadLinearDepth as a}from\"../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl.js\";import{multipassTerrainTest as o}from\"../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl.js\";import{defaultMaskAlphaCutoff as i}from\"../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl.js\";import{ColorConversion as d}from\"../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl.js\";import{glsl as t}from\"../views/3d/webgl-engine/core/shaderModules/interfaces.js\";import{ShaderBuilder as l}from\"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder.js\";function s(s){const n=new l;return n.include(r,{linearDepth:!1}),n.vertex.uniforms.add(\"proj\",\"mat4\").add(\"view\",\"mat4\"),n.attributes.add(\"position\",\"vec3\"),n.attributes.add(\"uv0\",\"vec2\"),n.varyings.add(\"vpos\",\"vec3\"),s.multipassTerrainEnabled&&n.varyings.add(\"depth\",\"float\"),n.vertex.uniforms.add(\"textureCoordinateScaleFactor\",\"vec2\"),n.vertex.code.add(t`\n    void main(void) {\n      vpos = position;\n      ${s.multipassTerrainEnabled?\"depth = (view * vec4(vpos, 1.0)).z;\":\"\"}\n      vTexCoord = uv0 * textureCoordinateScaleFactor;\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  `),n.include(e,s),s.multipassTerrainEnabled&&(n.fragment.include(a),n.include(o,s)),n.fragment.uniforms.add(\"tex\",\"sampler2D\"),n.fragment.uniforms.add(\"opacity\",\"float\"),n.varyings.add(\"vTexCoord\",\"vec2\"),7===s.output?n.fragment.code.add(t`\n    void main() {\n      discardBySlice(vpos);\n      ${s.multipassTerrainEnabled?\"terrainDepthTest(gl_FragCoord, depth);\":\"\"}\n\n      float alpha = texture2D(tex, vTexCoord).a * opacity;\n      if (alpha  < ${t.float(i)}) {\n        discard;\n      }\n\n      gl_FragColor = vec4(alpha);\n    }\n    `):(n.fragment.include(d),n.fragment.code.add(t`\n    void main() {\n      discardBySlice(vpos);\n      ${s.multipassTerrainEnabled?\"terrainDepthTest(gl_FragCoord, depth);\":\"\"}\n      gl_FragColor = texture2D(tex, vTexCoord) * opacity;\n\n      if (gl_FragColor.a < ${t.float(i)}) {\n        discard;\n      }\n\n      gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      ${s.OITEnabled?\"gl_FragColor = premultiplyAlpha(gl_FragColor);\":\"\"}\n    }\n    `)),n}var n=Object.freeze({__proto__:null,build:s});export{n as I,s as b};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import{bindSliceUniformsWithOrigin as t}from\"../core/shaderLibrary/Slice.glsl.js\";import{bindMultipassTerrainTexture as r}from\"../core/shaderLibrary/shading/MultipassTerrainTest.glsl.js\";import{bindProjectionMatrix as i,bindView as s}from\"../core/shaderLibrary/util/View.glsl.js\";import{ReloadableShaderModule as a}from\"../core/shaderTechnique/ReloadableShaderModule.js\";import{ShaderTechnique as o}from\"../core/shaderTechnique/ShaderTechnique.js\";import{parameter as n,ShaderTechniqueConfiguration as l}from\"../core/shaderTechnique/ShaderTechniqueConfiguration.js\";import{Default3D as p}from\"../lib/DefaultVertexAttributeLocations.js\";import{OITBlending as c,OITDepthTest as u,OITDepthWrite as d,getOITPolygonOffset as h}from\"../lib/OrderIndependentTransparency.js\";import{Program as m}from\"../lib/Program.js\";import{stencilWriteMaskOn as b,stencilToolMaskBaseParams as f,stencilBaseAllZerosParams as g}from\"../lib/StencilUtils.js\";import{I as y}from\"../../../../chunks/ImageMaterial.glsl.js\";import{simpleBlendingParams as T,makePipelineState as P,cullingParams as v,defaultDepthWriteParams as j,defaultColorWriteParams as S}from\"../../../webgl/renderState.js\";class E extends o{initializeProgram(e){const t=E.shader.get(),r=this.configuration,i=t.build({output:r.output,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,OITEnabled:0===r.transparencyPassType,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new m(e.rctx,i,p)}bindPass(e,t){i(this.program,t.camera.projectionMatrix),this.program.setUniform1f(\"opacity\",e.opacity),t.multipassTerrainEnabled&&(this.program.setUniform2fv(\"cameraNearFar\",t.camera.nearFar),this.program.setUniform2fv(\"inverseViewport\",t.inverseViewport),r(this.program,t))}bindDraw(e){s(this.program,e),t(this.program,this.configuration,e),this.program.rebindTextures()}setPipelineState(e,t){const r=this.configuration,i=3===e,s=2===e;return P({blending:0!==r.output&&7!==r.output||!r.transparent?null:i?w:c(e),culling:v(r.cullFace),depthTest:{func:u(e)},depthWrite:i?r.writeDepth&&j:d(e),colorWrite:S,stencilWrite:r.sceneHasOcludees?b:null,stencilTest:r.sceneHasOcludees?t?f:g:null,polygonOffset:i||s?null:h(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}E.shader=new a(y,(()=>import(\"./ImageMaterial.glsl.js\")));const w=T(1,771);class O extends l{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}e([n({count:8})],O.prototype,\"output\",void 0),e([n({count:3})],O.prototype,\"cullFace\",void 0),e([n()],O.prototype,\"slicePlaneEnabled\",void 0),e([n()],O.prototype,\"transparent\",void 0),e([n()],O.prototype,\"enableOffset\",void 0),e([n()],O.prototype,\"writeDepth\",void 0),e([n()],O.prototype,\"sceneHasOcludees\",void 0),e([n({count:4})],O.prototype,\"transparencyPassType\",void 0),e([n()],O.prototype,\"multipassTerrainEnabled\",void 0),e([n()],O.prototype,\"cullAboveGround\",void 0);export{E as ImageMaterialTechnique,O as ImageMaterialTechniqueConfiguration};\n"],"names":["s2","n2","l","include","r","linearDepth","vertex","uniforms","add","attributes","varyings","multipassTerrainEnabled","code","t","e","fragment","a","o","output","float","i","d","OITEnabled","n","Object","freeze","__proto__","build","s","initializeProgram","e2","t2","E","shader","get","r2","this","configuration","slicePlaneEnabled","sliceHighlightDisabled","sliceEnabledForVertexPrograms","transparencyPassType","cullAboveGround","m","rctx","p","bindPass","program","camera","projectionMatrix","setUniform1f","opacity","setUniform2fv","nearFar","inverseViewport","bindDraw","rebindTextures","setPipelineState","P","blending","transparent","w","c","culling","v","cullFace","depthTest","func","u","depthWrite","writeDepth","j","colorWrite","S","stencilWrite","sceneHasOcludees","b","stencilTest","f","g","polygonOffset","h","enableOffset","initializePipeline","_occludeePipelineState","getPipelineState","pipeline","y","import","T","constructor","arguments","count","O","prototype"],"mappings":"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"}