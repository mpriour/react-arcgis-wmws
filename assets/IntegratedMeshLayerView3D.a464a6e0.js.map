{"version":3,"file":"IntegratedMeshLayerView3D.a464a6e0.js","sources":["../../node_modules/@arcgis/core/views/3d/layers/IntegratedMeshLayerView3D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import r from\"../../../Graphic.js\";import{isSome as t,isNone as o}from\"../../../core/maybe.js\";import{property as a}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as i}from\"../../../core/accessorSupport/decorators/subclass.js\";import{f as s,c as l}from\"../../../chunks/vec4f64.js\";import{area as n,width as h,height as c}from\"../../../geometry/support/aaBoundingRect.js\";import{I3SMeshView3D as d}from\"./I3SMeshView3D.js\";import{LayerView3D as p}from\"./LayerView3D.js\";import{updatingProgress as y}from\"../support/updatingProperties.js\";import u from\"../../layers/LayerView.js\";const g=.2;let v=class extends(d(p(u))){constructor(){super(...arguments),this.type=\"integrated-mesh-3d\",this.lodFactor=1,this._elevationContext=\"im\",this._isIntegratedMesh=!0,this._supportsLabeling=!1,this.drapeTargetType=1,this._overlayTexOffset=s(-1,-1,-1,-1),this._overlayTexScale=l(),this._overlayColor=null,this._overlayHighlight=null,this._overlayNormal=null}get progressiveLoadFactor(){return this.lodFactor>=1?g:1}setDrapingTextures(e){this._clearDrapingTexture(0),this._clearDrapingTexture(1);for(const r of e){const e=r.index,o=r.extent,a=r.needsColorWithoutRasterImage?r.getValidTarget(1):r.hasDrapedFeatureSource?r.getValidTarget(0):null;if(t(a)&&n(o)>0){this._overlayTexOffset[2*e]=-o[0]/h(o),this._overlayTexOffset[2*e+1]=-o[1]/c(o),this._overlayTexScale[2*e]=1/h(o),this._overlayTexScale[2*e+1]=1/c(o);const t=r.getValidTarget(2),i=r.getValidTarget(3);this._overlayColor=a.getTexture(),this._overlayHighlight=t?t.getTexture():null,this._overlayNormal=i?i.getTexture():null}}this._forAllNodes((e=>t(e)&&this._collection.updateMaterial(e.objectHandle,(e=>this._updateMaterialOverlay(e)))))}_clearDrapingTexture(e){this._overlayTexOffset[2*e]=-1,this._overlayTexOffset[2*e+1]=-1,this._overlayTexScale[2*e]=0,this._overlayTexScale[2*e+1]=0,this._overlayColor=null,this._overlayHighlight=null,this._overlayNormal=null}_updateMaterialOverlay(e){e.overlayColor=this._overlayColor,e.overlayHighlight=this._overlayHighlight,e.overlayNormal=this._overlayNormal,e.overlayTexOffset=this._overlayTexOffset,e.overlayTexScale=this._overlayTexScale}initialize(){this.updatingHandles.add(this.layer,\"modifications\",(()=>this._loadModifications()),2)}_createLayerGraphic(){const e=new r;return e.layer=this.layer,e.sourceLayer=this.layer,e}canResume(){return super.canResume()&&(!this._controller||this._controller.rootNodeVisible)}_loadModifications(){if(this.handles.remove(\"modifications\"),o(this.layer.modifications))return void(this._modifications=[]);const e=this.layer.modifications;this.handles.add(this.updatingHandles.addOnCollectionChange(e,(()=>this._modifications=e.toArray()),2),\"modifications\")}};e([a()],v.prototype,\"layer\",void 0),e([a({aliasOf:\"layer\"})],v.prototype,\"i3slayer\",void 0),e([a()],v.prototype,\"suspended\",void 0),e([a(y)],v.prototype,\"updatingProgress\",void 0),e([a({readOnly:!0,aliasOf:\"_controller.updatingProgress\"})],v.prototype,\"updatingProgressValue\",void 0),e([a({readOnly:!0,aliasOf:\"view.qualitySettings.sceneService.integratedMesh.lodFactor\"})],v.prototype,\"lodFactor\",void 0),e([a({readOnly:!0})],v.prototype,\"progressiveLoadFactor\",null),v=e([i(\"esri.views.3d.layers.SceneLayerView3D\")],v);var f=v;export{f as default};\n"],"names":["v","d","p","u","constructor","arguments","this","type","lodFactor","_elevationContext","_isIntegratedMesh","_supportsLabeling","drapeTargetType","_overlayTexOffset","s","_overlayTexScale","l","_overlayColor","_overlayHighlight","_overlayNormal","setDrapingTextures","e2","_clearDrapingTexture","r2","e3","index","o","extent","a","needsColorWithoutRasterImage","getValidTarget","hasDrapedFeatureSource","t","n","h","c","t2","i","getTexture","_forAllNodes","_collection","updateMaterial","objectHandle","_updateMaterialOverlay","e4","overlayColor","overlayHighlight","overlayNormal","overlayTexOffset","overlayTexScale","initialize","updatingHandles","add","layer","_loadModifications","_createLayerGraphic","r","sourceLayer","canResume","super","_controller","rootNodeVisible","handles","remove","modifications","_modifications","addOnCollectionChange","toArray","e","prototype","aliasOf","y","readOnly","f"],"mappings":"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"}