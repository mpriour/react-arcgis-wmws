{"version":3,"file":"FeatureSetReader.bfb25a2d.js","sources":["../../node_modules/@arcgis/core/views/2d/layers/features/support/StaticBitSet.js","../../node_modules/@arcgis/core/views/2d/layers/features/support/FeatureSetReader.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nclass t{constructor(t,e){this._mask=0,this._buf=t,this._mask=e}static fromBuffer(e,s){return new t(e,s)}static create(e,s=4294967295){const r=new Uint32Array(Math.ceil(e/32));return new t(r,s)}_getIndex(t){return Math.floor(t/32)}has(t){const e=this._mask&t;return!!(this._buf[this._getIndex(e)]&1<<e%32)}hasRange(t,e){let s=t,r=e;for(;s%32&&s!==r;){if(this.has(s))return!0;s++}for(;r%32&&s!==r;){if(this.has(s))return!0;r--}if(s===r)return!1;for(let h=s/32;h!==r/32;h++){if(this._buf[h])return!0}return!1}set(t){const e=this._mask&t,s=this._getIndex(e),r=1<<e%32;this._buf[s]|=r}setRange(t,e){let s=t,r=e;for(;s%32&&s!==r;)this.set(s++);for(;r%32&&s!==r;)this.set(r--);if(s!==r)for(let h=s/32;h!==r/32;h++)this._buf[h]=4294967295}unset(t){const e=this._mask&t,s=this._getIndex(e),r=1<<e%32;this._buf[s]&=4294967295^r}resize(t){const e=this._buf,s=new Uint32Array(Math.ceil(t/32));s.set(e),this._buf=s}or(t){for(let e=0;e<this._buf.length;e++)this._buf[e]|=t._buf[e];return this}and(t){for(let e=0;e<this._buf.length;e++)this._buf[e]&=t._buf[e];return this}xor(t){for(let e=0;e<this._buf.length;e++)this._buf[e]^=t._buf[e];return this}ior(t){for(let e=0;e<this._buf.length;e++)this._buf[e]|=~t._buf[e];return this}iand(t){for(let e=0;e<this._buf.length;e++)this._buf[e]&=~t._buf[e];return this}ixor(t){for(let e=0;e<this._buf.length;e++)this._buf[e]^=~t._buf[e];return this}any(){for(let t=0;t<this._buf.length;t++)if(this._buf[t])return!0;return!1}copy(t){for(let e=0;e<this._buf.length;e++)this._buf[e]=t._buf[e];return this}clone(){return new t(this._buf.slice(),this._mask)}clear(){for(let t=0;t<this._buf.length;t++)this._buf[t]=0}forEachSet(t){for(let e=0;e<this._buf.length;e++){let s=this._buf[e],r=32*e;if(s)for(;s;){1&s&&t(r),s>>>=1,r++}}}countSet(){let t=0;return this.forEachSet((e=>{t++})),t}}export{t as StaticBitSet};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport\"../../../../../geometry.js\";import\"../../../../../core/has.js\";import{isSome as e,isNone as t,unwrapOr as r}from\"../../../../../core/maybe.js\";import{getCentroidOptimizedGeometry as s}from\"../../../../../layers/graphics/centroid.js\";import{convertToGeometry as i}from\"../../../../../layers/graphics/featureConversionUtils.js\";import o from\"../../../../../layers/graphics/OptimizedGeometry.js\";import{StaticBitSet as n}from\"./StaticBitSet.js\";import{fromJSON as d}from\"../../../../../geometry/support/jsonUtils.js\";let a=0;class h{constructor(e){this.type=\"FeatureSetReader\",this.seen=!1,this.instance=0,this._tx=0,this._ty=0,this._sx=1,this._sy=1,this._deleted=null,this._joined=[],this._objectIdToIndex=null,this._level=0,this.instance=e}static createInstance(){return a++,a=a>65535?0:a,a}get isEmpty(){return e(this._deleted)&&this._deleted.countSet()===this.getSize()}set level(e){this._level=e}getAreaSimplificationThreshold(e){let t=0;e>4e3?t=2:e>2e3?t=1:(e>100||e>15)&&(t=.5);let r=8;return this._level<4?r=1:this._level<5?r=2:this._level<6&&(r=4),t*r}setArcadeSpatialReference(e){this._arcadeSpatialReference=e}attachStorage(e){this._storage=e}getQuantizationTransform(){throw new Error(\"Unable to find transform for featureSet\")}getStorage(){return this._storage}getComputedNumeric(e){return this.getComputedNumericAtIndex(0)}setComputedNumeric(e,t){return this.setComputedNumericAtIndex(t,0)}getComputedString(e){return this.getComputedStringAtIndex(0)}setComputedString(e,t){return this.setComputedStringAtIndex(0,t)}getComputedNumericAtIndex(e){return this._storage.getComputedNumericAtIndex(this.getDisplayId(),e)}setComputedNumericAtIndex(e,t){this._storage.setComputedNumericAtIndex(this.getDisplayId(),e,t)}getComputedStringAtIndex(e){return this._storage.getComputedStringAtIndex(this.getDisplayId(),e)}setComputedStringAtIndex(e,t){return this._storage.setComputedStringAtIndex(this.getDisplayId(),e,t)}transform(e,t,r,s){const i=this.copy();return i._tx+=e,i._ty+=t,i._sx*=r,i._sy*=s,i}readAttribute(e,t=!1){const r=this._readAttribute(e,t);if(void 0!==r)return r;for(const s of this._joined){s.setIndex(this.getIndex());const r=s._readAttribute(e,t);if(void 0!==r)return r}}readAttributes(){const e=this._readAttributes();for(const t of this._joined){t.setIndex(this.getIndex());const r=t._readAttributes();for(const t of Object.keys(r))e[t]=r[t]}return e}joinAttributes(e){this._joined.push(e)}readArcadeFeature(){return this}geometry(){const e=this.readHydratedGeometry(),t=i(e,this.geometryType,this.hasZ,this.hasM),r=d(t);return r&&(r.spatialReference=this._arcadeSpatialReference),r}field(e){return this.readAttribute(e,!0)}hasField(e){return!0}setField(e,t){}keys(){return[]}castToText(){return\"\"}removeIds(e){if(t(this._objectIdToIndex)){const e=new Map,t=this.getCursor();for(;t.next();)e.set(t.getObjectId(),t.getIndex());this._objectIdToIndex=e}const r=this._objectIdToIndex;for(const t of e)r.has(t)&&this.removeAtIndex(r.get(t))}removeAtIndex(e){t(this._deleted)&&(this._deleted=n.create(this.getSize())),this._deleted.set(e)}readGeometryForDisplay(){return this.readUnquantizedGeometry(!0)}readLegacyGeometryForDisplay(){return this.readLegacyGeometry(!0)}*features(){const e=this.getCursor();for(;e.next();)yield e.readOptimizedFeature()}_getExists(){return t(this._deleted)||!this._deleted.has(this.getIndex())}_computeCentroid(){if(\"esriGeometryPolygon\"!==this.geometryType)return null;const e=this.readUnquantizedGeometry();if(!e||e.hasIndeterminateRingOrder)return null;const t=r(this.getQuantizationTransform(),null);return s(new o,e,this.hasM,this.hasZ,t)}copyInto(e){e.seen=this.seen,e._storage=this._storage,e._arcadeSpatialReference=this._arcadeSpatialReference,e._joined=this._joined,e._tx=this._tx,e._ty=this._ty,e._sx=this._sx,e._sy=this._sy,e._deleted=this._deleted,e._objectIdToIndex=this._objectIdToIndex}}export{h as FeatureSetReader};\n"],"names":["constructor","t2","e2","_mask","this","_buf","s","t","r2","Uint32Array","Math","ceil","_getIndex","floor","has","hasRange","h2","set","setRange","unset","resize","or","length","and","xor","ior","iand","ixor","any","copy","clone","slice","clear","forEachSet","countSet","a","type","seen","instance","_tx","_ty","_sx","_sy","_deleted","_joined","_objectIdToIndex","_level","e","getSize","getAreaSimplificationThreshold","setArcadeSpatialReference","_arcadeSpatialReference","attachStorage","_storage","getQuantizationTransform","Error","getStorage","getComputedNumeric","getComputedNumericAtIndex","setComputedNumeric","setComputedNumericAtIndex","getComputedString","getComputedStringAtIndex","setComputedString","setComputedStringAtIndex","getDisplayId","transform","i","readAttribute","_readAttribute","setIndex","getIndex","r3","readAttributes","_readAttributes","t3","Object","keys","joinAttributes","push","readArcadeFeature","geometry","readHydratedGeometry","geometryType","hasZ","hasM","d","spatialReference","field","hasField","setField","castToText","removeIds","e3","Map","getCursor","next","getObjectId","removeAtIndex","get","n","create","readGeometryForDisplay","readUnquantizedGeometry","readLegacyGeometryForDisplay","readLegacyGeometry","readOptimizedFeature","_getExists","_computeCentroid","hasIndeterminateRingOrder","r","o","copyInto"],"mappings":"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"}