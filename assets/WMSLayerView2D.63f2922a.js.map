{"version":3,"file":"WMSLayerView2D.63f2922a.js","sources":["../../node_modules/@arcgis/core/views/2d/layers/WMSLayerView2D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Error.js\";import r from\"../../../core/Logger.js\";import{isAbortError as i}from\"../../../core/promiseUtils.js\";import{property as s}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as a}from\"../../../core/accessorSupport/decorators/subclass.js\";import o from\"../../../geometry/Extent.js\";import{BitmapContainer as n}from\"../engine/BitmapContainer.js\";import{LayerView2DMixin as p}from\"./LayerView2D.js\";import h from\"./support/ExportStrategy.js\";import m from\"../../layers/LayerView.js\";import{RefreshableLayerView as c}from\"../../layers/RefreshableLayerView.js\";import{WMSLayerView as d}from\"../../layers/WMSLayerView.js\";const l=r.getLogger(\"esri.views.2d.layers.WMSLayerView2D\");let u=class extends(d(c(p(m)))){initialize(){const{layer:e,view:r}=this;e.supportsSpatialReference(r.spatialReference)||this.addResolvingPromise(Promise.reject(new t(\"layerview:spatial-reference-incompatible\",\"The spatial references supported by this WMS layer are incompatible with the spatial reference of the view\",{layer:e})))}hitTest(){return null}update(e){this.strategy.update(e).catch((e=>{i(e)||l.error(e)}))}attach(){const{layer:e}=this,{imageMaxHeight:t,imageMaxWidth:r}=e;this._bitmapContainer=new n,this.container.addChild(this._bitmapContainer),this.strategy=new h({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:t,imageMaxWidth:r,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1}),this.handles.add(this.watch(\"exportImageVersion\",(()=>this.requestUpdate())),\"exportImageVersion\")}detach(){this.handles.remove(\"exportImageVersion\"),this.strategy.destroy(),this.container.removeChild(this._bitmapContainer),this._bitmapContainer.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQuery(e){const{view:t}=this,r=this._bitmapContainer,{x:i,y:s}=e,{spatialReference:a}=t;let n=null,p=0,h=0;if(r.children.some((e=>{const{width:t,height:r,resolution:m,x:c,y:d}=e,l=c+m*t,u=d-m*r;return i>=c&&i<=l&&s<=d&&s>=u&&(n=new o({xmin:c,ymin:u,xmax:l,ymax:d,spatialReference:a}),p=t,h=r,!0)})),!n)return null;const m=n.width/p,c=Math.round((i-n.xmin)/m),d=Math.round((n.ymax-s)/m);return{extent:n,width:p,height:h,x:c,y:d}}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(e,t,r,i){return this.layer.fetchImage(e,t,r,{timeExtent:this.timeExtent,...i})}};e([s()],u.prototype,\"strategy\",void 0),e([s()],u.prototype,\"updating\",void 0),u=e([a(\"esri.views.2d.layers.WMSLayerView2D\")],u);var y=u;export{y as default};\n"],"names":["l","r","getLogger","u","d","c","p","m","initialize","layer","e2","view","this","supportsSpatialReference","spatialReference","addResolvingPromise","Promise","reject","t","hitTest","update","strategy","catch","e3","error","attach","imageMaxHeight","imageMaxWidth","_bitmapContainer","n","container","addChild","h","fetchSource","fetchImage","bind","requestUpdate","imageRotationSupported","imageNormalizationSupported","hidpi","handles","add","watch","detach","remove","destroy","removeChild","removeAllChildren","moveStart","viewChange","moveEnd","createFetchPopupFeaturesQuery","t2","x","i","y","s2","a2","n2","children","some","width","t3","height","r2","resolution","m2","c2","d2","l2","u2","o","xmin","ymin","xmax","ymax","Math","round","extent","isUpdating","updating","updateRequested","__spreadValues","timeExtent","e","s","prototype","a"],"mappings":"o6BAIsyB,MAAMA,EAAEC,EAAEC,UAAU,uCAAuC,IAAIC,EAAE,cAAcC,EAAEC,EAAEC,EAAEC,MAAMC,mBAAmBC,MAAMC,EAAEC,KAAKV,GAAGW,OAAOC,yBAAyBZ,EAAEa,mBAAmBF,KAAKG,oBAAoBC,QAAQC,OAAO,IAAIC,EAAE,2CAA2C,6GAA6G,CAACT,MAAMC,MAAMS,iBAAiB,KAAKC,OAAOV,QAAQW,SAASD,OAAOV,GAAGY,aAAaC,IAAIvB,EAAEwB,MAAMD,MAAME,eAAehB,MAAMC,GAAGE,MAAMc,eAAeR,EAAES,cAAc1B,GAAGS,OAAOkB,iBAAiB,IAAIC,EAAEjB,KAAKkB,UAAUC,SAASnB,KAAKgB,kBAAkBhB,KAAKS,SAAS,IAAIW,EAAE,CAACF,UAAUlB,KAAKgB,iBAAiBK,YAAYrB,KAAKsB,WAAWC,KAAKvB,MAAMwB,cAAcxB,KAAKwB,cAAcD,KAAKvB,MAAMc,eAAeR,EAAES,cAAc1B,EAAEoC,wBAAuB,EAAGC,6BAA4B,EAAGC,OAAM,IAAK3B,KAAK4B,QAAQC,IAAI7B,KAAK8B,MAAM,sBAAsB,IAAI9B,KAAKwB,kBAAkB,sBAAsBO,cAAcH,QAAQI,OAAO,sBAAsBhC,KAAKS,SAASwB,UAAUjC,KAAKkB,UAAUgB,YAAYlC,KAAKgB,kBAAkBhB,KAAKgB,iBAAiBmB,oBAAoBC,aAAaC,cAAcC,eAAed,gBAAgBe,8BAA8BzC,SAASC,KAAKyC,GAAGxC,KAAKX,EAAEW,KAAKgB,kBAAkByB,EAAEC,EAAEC,EAAEC,GAAG9C,GAAGI,iBAAiB2C,GAAGL,MAAMM,EAAE,KAAKpD,EAAE,EAAE0B,EAAE,KAAK/B,EAAE0D,SAASC,gBAAgBC,MAAMC,EAAEC,OAAOC,EAAEC,WAAWC,EAAEb,EAAEc,EAAEZ,EAAEa,GAAG7C,EAAE8C,EAAEF,EAAED,EAAEJ,EAAEQ,EAAEF,EAAEF,EAAEF,SAASV,GAAGa,GAAGb,GAAGe,GAAGb,GAAGY,GAAGZ,GAAGc,MAAM,IAAIC,EAAE,CAACC,KAAKL,EAAEM,KAAKH,EAAEI,KAAKL,EAAEM,KAAKP,EAAEtD,iBAAiB2C,IAAInD,EAAEwD,EAAE9B,EAAEgC,GAAE,OAAQN,SAAS,WAAWnD,EAAEmD,EAAEG,MAAMvD,EAAED,EAAEuE,KAAKC,SAASnB,EAAEc,MAAMjE,GAAGH,EAAEwE,KAAKC,SAASF,KAAKnB,GAAGjD,SAAS,CAACuE,OAAOpB,EAAEG,MAAMvD,EAAEyD,OAAO/B,EAAEqB,EAAEhD,EAAEkD,EAAEnD,0BAA0BgC,gBAAgB2C,oBAAoBnE,KAAKS,SAAS2D,UAAUpE,KAAKqE,gBAAgB/C,WAAWxB,EAAE0C,EAAEnD,EAAEqD,UAAU1C,KAAKH,MAAMyB,WAAWxB,EAAE0C,EAAEnD,qHAAEiF,EAACC,WAAWvE,KAAKuE,YAAc7B,MAAM8B,EAAE,CAACC,KAAKlF,EAAEmF,UAAU,gBAAW,GAAQF,EAAE,CAACC,KAAKlF,EAAEmF,UAAU,gBAAW,GAAQnF,EAAEiF,EAAE,CAACG,EAAE,wCAAwCpF,GAAM,IAACoD,EAAEpD"}