var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,i=(e,a)=>{for(var t in a||(a={}))n.call(a,t)&&s(e,t,a[t]);if(l)for(var t of l(a))o.call(a,t)&&s(e,t,a[t]);return e},r=(e,l)=>a(e,t(l));import{bL as c,o1 as u,o2 as m,ew as p,o3 as h,z as d,o4 as f,o5 as y,o6 as v,bD as b}from"./vendor.7103ff48.js";const w="picture-fill",g=120,M=document.createElement("canvas");function x(e,a){var t,l;const n=null!=(null==a?void 0:a.size)?c(a.size):null,o=null!=(null==a?void 0:a.maxSize)?c(a.maxSize):null,s=null!=(null==a?void 0:a.opacity)?a.opacity:null,x=null!=(null==a?void 0:a.rotation)?a.rotation:"angle"in e?e.angle:null,k=u(e);let L=m(e);if(k&&!L){const e="type"in k?null:new p(k);"#ffffff"===(e?e.toHex():null)&&(L={color:"#bdc3c7",width:.75})}const z={shape:null,fill:null,stroke:L,offset:[0,0]};null!=(t=L)&&t.width&&(L.width=Math.min(L.width,80));const j=(null==(l=L)?void 0:l.width)||0;let O=null!=n&&(null==(null==a?void 0:a.scale)||(null==a?void 0:a.scale)),P=0,C=0,S=!1;switch(e.type){case"simple-marker":{const a=e.style,t=Math.min(null!=n?n:c(e.size),o||g);switch(P=t,C=t,a){case"circle":z.shape={type:"circle",cx:0,cy:0,r:.5*t},O||(P+=j,C+=j);break;case"cross":z.shape={type:"path",path:[{command:"M",values:[0,.5*C]},{command:"L",values:[P,.5*C]},{command:"M",values:[.5*P,0]},{command:"L",values:[.5*P,C]}]};break;case"diamond":z.shape={type:"path",path:[{command:"M",values:[0,.5*C]},{command:"L",values:[.5*P,0]},{command:"L",values:[P,.5*C]},{command:"L",values:[.5*P,C]},{command:"Z",values:[]}]},O||(P+=j,C+=j);break;case"square":z.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[P,0]},{command:"L",values:[P,C]},{command:"L",values:[0,C]},{command:"Z",values:[]}]},O||(P+=j,C+=j),x&&(S=!0);break;case"triangle":z.shape={type:"path",path:[{command:"M",values:[.5*P,0]},{command:"L",values:[P,C]},{command:"L",values:[0,C]},{command:"Z",values:[]}]},O||(P+=j,C+=j),x&&(S=!0);break;case"x":z.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[P,C]},{command:"M",values:[P,0]},{command:"L",values:[0,C]}]},x&&(S=!0);break;case"path":z.shape={type:"path",path:e.path||""},O||(P+=j,C+=j),x&&(S=!0),O=!0}break}case"simple-line":{const e=Math.min(null!=n?n:j,o||80),a=e>22?2*e:40;L.width=e,P=a,C=e,z.shape={type:"path",path:[{command:"M",values:[0,C]},{command:"L",values:[P,C]}]};break}case w:case"simple-fill":P=Math.min(null!=n?n:22,o||g)+j,C=P,O=!0,z.shape="object"==typeof(null==a?void 0:a.symbolConfig)&&null!=a&&a.symbolConfig.isSquareFill?h.squareFill[0]:h.fill[0];break;case"picture-marker":{let a=c(e.width),t=c(e.height);const l=null!=n?n:Math.max(a,t),s=a/t;a=s<=1?Math.ceil(l*s):l,t=s<=1?l:Math.ceil(l/s),P=Math.min(a,o||g),C=Math.min(t,o||g),z.shape={type:"image",x:-Math.round(P/2),y:-Math.round(C/2),width:P,height:C,src:e.url||""},x&&(S=!0);break}case"text":{const a=e,t=a.text||"Aa",l=a.font,s=Math.min(null!=n?n:c(l.size),o||g),i=function(e,a){const t=M.getContext("2d"),l=[];return a&&(a.weight&&l.push(a.weight),a.size&&l.push(a.size+"px"),a.family&&l.push(a.family)),t.font=l.join(" "),t.measureText(e).width}(t,{weight:l.weight,size:s,family:l.family}),r=/[\uE600-\uE6FF]/.test(t);P=r?s:i,C=s;let u=.25*function(e){if(0===e.length)return 0;if(e.length>2){const a=b(1),t=parseFloat(e);switch(e.slice(-2)){case"px":return t;case"pt":return t*a;case"in":return 72*t*a;case"pc":return 12*t*a;case"mm":return 2.8346456692913384*t*a;case"cm":return 28.346456692913385*t*a}}return parseFloat(e)}((l?s:0).toString());r&&(u+=5),z.shape={type:"text",text:t,x:0,y:u,align:"middle",decoration:l&&l.decoration,rotated:a.rotated,kerning:a.kerning},z.font=l&&{size:s,style:l.style,decoration:l.decoration,weight:l.weight,family:l.family};break}}if(!z.shape)return Promise.reject(new d("symbolPreview: renderPreviewHTML2D","symbol not supported."));const F=k,D=e.color;let E=null;return F&&"pattern"===F.type&&D&&e.type!==w?E=f(F.src,D.toCss(!0)).then((e=>(F.src=e,z.fill=F,z))):(z.fill=k,E=Promise.resolve(z)),E.then((e=>{const t=[[e]];if("object"==typeof(null==a?void 0:a.symbolConfig)&&null!=a&&a.symbolConfig.applyColorModulation){const a=.6*P;t.unshift([r(i({},e),{offset:[-a,0],fill:y(k,-.3)})]),t.push([r(i({},e),{offset:[a,0],fill:y(k,.3)})]),P+=2*a}return v(t,[P,C],{node:a&&a.node,scale:O,opacity:s,rotation:x,useRotationSize:S})}))}export{x as previewSymbol2D};
//# sourceMappingURL=previewSymbol2D.a4fac893.js.map
