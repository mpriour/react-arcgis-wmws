{"version":3,"file":"utils.eaa56ffd.js","sources":["../../node_modules/@arcgis/core/smartMapping/statistics/support/utils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport e from\"../../../core/Error.js\";import{isSome as n}from\"../../../core/maybe.js\";import{isNumericField as t,numericTypes as l}from\"../../../layers/support/fieldUtils.js\";function o(e){const n=null!=e.normalizationField||null!=e.normalizationType,t=null!=e.minValue||null!=e.maxValue,l=!!e.sqlExpression&&e.supportsSQLExpression;return!n&&!t&&!l}function i(e){const n=e.returnDistinct?[...new Set(e.values)]:e.values,t=n.filter((e=>null!=e)).length,l={count:t};return e.supportsNullCount&&(l.nullcount=n.length-t),l}function r(e){const{values:n,useSampleStdDev:t,supportsNullCount:l}=e;let o=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,r=null,u=null,s=null,a=null,c=0;const f=null==e.minValue?-1/0:e.minValue,d=null==e.maxValue?1/0:e.maxValue;for(const p of n)Number.isFinite(p)?p>=f&&p<=d&&(r+=p,o=Math.min(o,p),i=Math.max(i,p),c++):\"string\"==typeof p&&c++;if(c&&null!=r){u=r/c;let e=0;for(const t of n)Number.isFinite(t)&&t>=f&&t<=d&&(e+=(t-u)**2);a=t?c>1?e/(c-1):0:c>0?e/c:0,s=Math.sqrt(a)}else o=null,i=null;const m={avg:u,count:c,max:i,min:o,stddev:s,sum:r,variance:a};return l&&(m.nullcount=n.length-c),m}function u(e,n){return n?([\"avg\",\"stddev\",\"variance\"].forEach((n=>{null!=e[n]&&(e[n]=Math.ceil(e[n]))})),e):e}function s(e,n,t,l){let o=null;switch(n){case\"log\":0!==e&&(o=Math.log(e)*Math.LOG10E);break;case\"percent-of-total\":Number.isFinite(l)&&0!==l&&(o=e/l*100);break;case\"field\":Number.isFinite(t)&&0!==t&&(o=e/t);break;case\"natural-log\":e>0&&(o=Math.log(e));break;case\"square-root\":e>0&&(o=e**.5)}return o}function a(e){const n=e.field,t=e.normalizationType,l=e.normalizationField;let o;return\"log\"===t?o=\"(NOT \"+n+\" = 0)\":\"field\"===t?o=\"(NOT \"+l+\" = 0)\":\"natural-log\"!==t&&\"square-root\"!==t||(o=`(${n} > 0)`),o}function c(n,t){return new e(n,t)}function f(e,n,t){const l=null!=n?e+\" >= \"+n:\"\",o=null!=t?e+\" <= \"+t:\"\";let i=\"\";return i=l&&o?p(l,o):l||o,i?\"(\"+i+\")\":\"\"}function d(e,n,t,l){let o=null;return n?n.name!==e.objectIdField&&-1!==l.indexOf(n.type)||(o=c(t,\"'field' should be one of these types: \"+l.join(\",\"))):o=c(t,\"'field' is not defined in the layer schema\"),o}function m(e,n,o){let i;return n?n.name!==e.objectIdField&&t(n)||(i=c(o,\"'field' should be one of these numeric types: \"+l.join(\",\"))):i=c(o,\"'field' is not defined in the layer schema\"),i}function p(e,t){let l=n(e)?e:\"\";return n(t)&&t&&(l=l?\"(\"+l+\") AND (\"+t+\")\":t),l}function h(e,n,t){const l=g({layer:e,fields:n});if(l.length)return c(t,\"Unknown fields: \"+l.join(\", \")+\". You can only use fields defined in the layer schema\");const o=b({layer:e,fields:n});return o.length?c(t,\"Unsupported fields: \"+o.join(\", \")+\". You can only use fields that can be fetched i.e. AdapterFieldUsageInfo.supportsStatistics must be true\"):void 0}function g(e){const n=e.layer;return e.fields.filter((e=>!n.getField(e)))}function b(e){const n=e.layer;return e.fields.filter((e=>{const t=n.getFieldUsageInfo(e);return!t||!t.supportsStatistics}))}export{r as calculateStatistics,i as calculateStringStatistics,c as createError,s as getNormalizedValue,f as getRangeExpr,a as getSQLFilterForNormalization,o as isNullCountSupported,p as mergeWhereClauses,u as processStatsResult,h as verifyBasicFieldValidity,d as verifyFieldType,m as verifyNumericField};\n"],"names":["e","n","normalizationField","normalizationType","t","minValue","maxValue","l","sqlExpression","supportsSQLExpression","returnDistinct","Set","values","filter","e2","length","count","supportsNullCount","nullcount","useSampleStdDev","o2","Number","POSITIVE_INFINITY","i2","NEGATIVE_INFINITY","r2","u2","s2","a","c","f","d","p","isFinite","Math","min","max","t2","sqrt","m","avg","stddev","sum","variance","forEach","n2","ceil","log","LOG10E"],"mappings":"6BAI+K,WAAWA,SAASC,EAAE,MAAAD,EAAQE,oBAAoB,MAAAF,EAAQG,kBAAkBC,EAAE,MAAMJ,EAAEK,UAAU,MAAAL,EAAQM,SAASC,IAAIP,EAAEQ,eAAeR,EAAES,6BAA6BR,IAAIG,IAAIG,EAAE,WAAWP,SAASC,EAAED,EAAEU,eAAe,IAAI,IAAIC,IAAIX,EAAEY,SAASZ,EAAEY,OAAOR,EAAEH,EAAEY,WAAW,MAAMC,IAAIC,OAAOR,EAAE,CAACS,MAAMZ,UAAUJ,EAAEiB,sBAAsBC,UAAUjB,EAAEc,OAAOX,GAAGG,EAAE,WAAWP,SAASY,OAAOX,EAAEkB,gBAAgBf,EAAEa,kBAAkBV,GAAGP,MAAMoB,EAAEC,OAAOC,kBAAkBC,EAAEF,OAAOG,kBAAkBC,EAAE,KAAKC,EAAE,KAAKC,EAAE,KAAKC,EAAE,KAAKC,EAAE,QAAQC,EAAE,MAAA9B,EAAQK,UAAS,EAAA,EAAKL,EAAEK,SAAS0B,EAAE,MAAA/B,EAAQM,SAAS,EAAA,EAAIN,EAAEM,mBAAmB0B,KAAK/B,SAASgC,SAASD,GAAGA,GAAGF,GAAGE,GAAGD,OAAOC,EAAEZ,EAAEc,KAAKC,IAAIf,EAAEY,GAAGT,EAAEW,KAAKE,IAAIb,EAAES,GAAGH,KAAK,iBAAiBG,GAAGH,OAAOA,GAAG,MAAAJ,EAAQ,GAAGA,EAAEI,MAAMf,EAAE,YAAYuB,KAAKpC,SAASgC,SAASI,IAAIA,GAAGP,GAAGO,GAAGN,UAAUL,IAAI,KAAKtB,EAAEyB,EAAE,EAAEf,KAAK,GAAG,EAAEe,EAAE,EAAEf,EAAEe,EAAE,EAAEF,EAAEO,KAAKI,KAAKV,UAAU,KAAKL,EAAE,WAAWgB,EAAE,CAACC,IAAId,EAAEV,MAAMa,EAAEO,IAAIb,EAAEY,IAAIf,EAAEqB,OAAOd,EAAEe,IAAIjB,EAAEkB,SAASf,UAAUrB,MAAMW,UAAUjB,EAAEc,OAAOc,GAAGU,EAAE,WAAWvC,EAAEC,UAAUA,IAAI,MAAM,SAAS,YAAY2C,aAAa,MAAM5C,EAAE6C,OAAOA,GAAGX,KAAKY,KAAK9C,EAAE6C,QAAQ7C,GAAGA,EAAE,WAAWA,EAAEC,EAAEG,EAAEG,OAAOa,EAAE,YAAYnB,OAAO,MAAM,IAAID,MAAMkC,KAAKa,IAAI/C,GAAGkC,KAAKc,kBAAkB,0BAA0Bf,SAAS1B,IAAI,IAAIA,MAAMP,EAAEO,EAAE,eAAe,eAAe0B,SAAS7B,IAAI,IAAIA,MAAMJ,EAAEI,aAAa,gBAAgB,MAAM8B,KAAKa,IAAI/C,cAAc,gBAAgB,MAAMA,GAAG,WAAWoB"}