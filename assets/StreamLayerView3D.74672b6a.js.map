{"version":3,"file":"StreamLayerView3D.74672b6a.js","sources":["../../node_modules/@arcgis/core/layers/graphics/controllers/StreamController.js","../../node_modules/@arcgis/core/views/layers/StreamLayerView.js","../../node_modules/@arcgis/core/views/3d/layers/StreamLayerView3D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../geometry.js\";import t from\"../../../Graphic.js\";import r from\"../../../core/Accessor.js\";import{HandleOwnerMixin as o}from\"../../../core/HandleOwner.js\";import{isSome as s}from\"../../../core/maybe.js\";import{EsriPromiseMixin as i}from\"../../../core/Promise.js\";import{property as a}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as n}from\"../../../core/accessorSupport/decorators/subclass.js\";import c from\"../data/StreamFeatureManager.js\";import{createConnection as p}from\"../sources/connections/createConnection.js\";import{EventedSet as h}from\"../../../views/3d/support/EventedSet.js\";import{featureGeometryTypeKebabDictionary as d}from\"../../../geometry/support/typeUtils.js\";var l;const u=2500;let m=l=class extends t{getObjectId(){return this.objectId}clone(){return new l({objectId:this.objectId,...this.cloneProperties()})}};e([a({type:Number,json:{read:!0}})],m.prototype,\"objectId\",void 0),m=l=e([n(\"esri.layers.graphics.controllers.StreamGraphic\")],m);class y{constructor(e){this.onUpdate=e,this._idToGraphic=new Map}destroy(){this._idToGraphic.clear()}add(e){this._idToGraphic.set(e.objectId,e)}get(e){return this._idToGraphic.get(e)}forEach(e){this._idToGraphic.forEach(e)}removeById(e){const t=this._idToGraphic.get(e);return t?(t.sourceLayer=t.layer=null,this._idToGraphic.delete(e),t):null}update(e,t){this.onUpdate(e,t)}get size(){return this._idToGraphic.size}}let f=class extends(o(i(r))){constructor(){super(...arguments),this._updateInfo={websocket:0,client:0},this.graphics=new h}initialize(){this.addResolvingPromise(this.layer.when((()=>this._startup())))}destroy(){this.clear()}clear(){this._updateIntervalId&&(clearInterval(this._updateIntervalId),this._updateIntervalId=0),this.connection&&(this.connection.destroy(),this.connection=null),this.store&&(this.store.destroy(),this.store=null),this.graphics.clear(),this.handles.removeAll()}get updating(){return!this.connection||\"connected\"===this.connection.connectionStatus}_startup(){const{parsedUrl:e,spatialReference:t,definitionExpression:r,geometryDefinition:o,objectIdField:s,timeInfo:i,purgeOptions:a,maxReconnectionAttempts:n,maxReconnectionInterval:h,updateInterval:l}=this.layer,m=d.toJSON(this.layer.geometryType),f=t,g=this.layerView.view.spatialReference,_={geometry:o,where:r};this.clear(),this._set(\"connection\",p(e,f,g,m,_,n,h)),this._outSpatialReference=g.toJSON(),this.store=new y(this._onUpdate.bind(this)),this.featuresManager=new c(this.store,s,i.toJSON(),a),this.handles.add([this.connection.on(\"feature\",(e=>this._onFeature(e))),this.layer.watch(\"definitionExpression\",(()=>this._startup())),this.layer.watch(\"geometryDefinition\",(()=>this._startup())),this.layer.watch(\"purgeOptions\",(()=>this._startup()))]);let I=performance.now();this._updateIntervalId=setInterval((()=>{const e=performance.now(),t=e-I;if(t>u){I=e;const r=Math.round(this._updateInfo.client/(t/1e3)),o=Math.round(this._updateInfo.websocket/(t/1e3));this._updateInfo.client=0,this._updateInfo.websocket=0,this.layerView.emit(\"update-rate\",{client:r,websocket:o})}this.featuresManager.checkForUpdates()}),l)}_onFeature(e){this._updateInfo.websocket++,this.layerView.hasEventListener(\"data-received\")&&this.layerView.emit(\"data-received\",{attributes:e.attributes,centroid:e.centroid,geometry:e.geometry});try{s(e.geometry)&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._outSpatialReference);const t=m.fromJSON(e);t.sourceLayer=t.layer=this.layer,this.featuresManager.add(t)}catch{}}_onUpdate(e,t){s(t)&&this.graphics.removeMany(t),s(e)&&(this._updateInfo.client+=e.length,this.graphics.addMany(e))}};e([a()],f.prototype,\"connection\",void 0),e([a()],f.prototype,\"layer\",void 0),e([a()],f.prototype,\"layerView\",void 0),e([a({readOnly:!0})],f.prototype,\"updating\",null),f=e([n(\"esri.layers.graphics.controllers.StreamController\")],f);var g=f;export{g as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as o}from\"../../chunks/tslib.es6.js\";import{property as r}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/Logger.js\";import{subclass as t}from\"../../core/accessorSupport/decorators/subclass.js\";import e from\"./support/FeatureFilter.js\";const s=s=>{let c=class extends s{constructor(...o){super(...o),this.connectionError=null,this.connectionStatus=\"disconnected\",this.filter=null}};return o([r({readOnly:!0})],c.prototype,\"connectionError\",void 0),o([r({aliasOf:\"controller.connection.connectionStatus\",readOnly:!0})],c.prototype,\"connectionStatus\",void 0),o([r({type:e})],c.prototype,\"filter\",void 0),c=o([t(\"esri.layers.mixins.StreamLayerView\")],c),c};export{s as StreamLayerView,s as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../../chunks/tslib.es6.js\";import e from\"../../../core/Error.js\";import{property as o}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as t}from\"../../../core/accessorSupport/decorators/subclass.js\";import s from\"../../../layers/graphics/controllers/StreamController.js\";import i from\"../../../rest/support/Query.js\";import{FeatureLikeLayerView3D as a}from\"./FeatureLikeLayerView3D.js\";import{LayerView3D as n}from\"./LayerView3D.js\";import p from\"../../layers/LayerView.js\";import{StreamLayerView as l}from\"../../layers/StreamLayerView.js\";let c=class extends(l(a(n(p)))){constructor(){super(...arguments),this.type=\"stream-3d\",this.updatePolicy=0,this.hasZ=!0,this.hasM=!1}get connectionError(){const r=this.get(\"controller.connection.errorString\");if(r)return new e(\"stream-controller\",r)}createQuery(){return new i({outFields:[\"*\"],returnGeometry:!0,outSpatialReference:this.view.spatialReference})}queryLatestObservations(r,e){return this.queryEngine.executeQueryForLatestObservations(this._ensureQuery(r),null==e?void 0:e.signal)}createController(){return new s({layer:this.layer,layerView:this})}beforeSetController(){}};r([o({readOnly:!0})],c.prototype,\"updatePolicy\",void 0),r([o({readOnly:!0})],c.prototype,\"connectionError\",null),r([o()],c.prototype,\"controller\",void 0),r([o({readOnly:!0})],c.prototype,\"hasZ\",void 0),r([o({readOnly:!0})],c.prototype,\"hasM\",void 0),c=r([t(\"esri.views.3d.layers.StreamLayerView3D\")],c);var y=c;export{y as default};\n"],"names":["l","m","t","getObjectId","this","objectId","clone","__spreadValues","cloneProperties","e","a","type","Number","json","read","prototype","n","constructor","e2","onUpdate","_idToGraphic","Map","destroy","clear","add","set","get","forEach","removeById","t2","sourceLayer","layer","delete","update","size","f","o","i","r","arguments","_updateInfo","websocket","client","graphics","h","initialize","addResolvingPromise","when","_startup","_updateIntervalId","connection","store","handles","removeAll","connectionStatus","parsedUrl","spatialReference","definitionExpression","r2","geometryDefinition","objectIdField","s2","timeInfo","purgeOptions","a2","maxReconnectionAttempts","n2","maxReconnectionInterval","updateInterval","l2","m2","d","toJSON","geometryType","f2","g2","layerView","view","_","geometry","where","_set","p","_outSpatialReference","y","_onUpdate","bind","featuresManager","c","on","_onFeature","e3","watch","I","performance","now","setInterval","r3","Math","round","o2","emit","checkForUpdates","hasEventListener","attributes","centroid","fromJSON","removeMany","s","length","addMany","readOnly","g","c2","connectionError","filter","aliasOf","updatePolicy","hasZ","hasM","createQuery","outFields","returnGeometry","outSpatialReference","queryLatestObservations","queryEngine","executeQueryForLatestObservations","_ensureQuery","signal","createController","beforeSetController"],"mappings":"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"}