{"version":3,"file":"heatmapUtils.5045aee9.js","sources":["../../node_modules/@arcgis/core/renderers/support/heatmapUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport t from\"../../core/global.js\";import{clamp as e}from\"../../core/mathUtils.js\";const n=(()=>{if(!(\"document\"in t))return()=>null;const e=document.createElement(\"canvas\"),n=e.getContext(\"2d\"),r=512;return e.height=r,e.width=1,t=>{n.clearRect(0,0,1,e.height);const r=n.createLinearGradient(0,0,0,e.height);for(const{ratio:e,color:n}of t.colorStops)r.addColorStop(Math.max(e,.001),`rgba(${n[0]}, ${n[1]}, ${n[2]}, ${n[3]})`);return n.fillStyle=r,n.fillRect(0,0,1,e.height),n.getImageData(0,0,1,e.height).data}})();function r(t,e,n,r){const{blurRadius:o,fieldOffset:a,field:i}=e,u=new Float64Array(n*r),l=f(o),s=Math.round(3*o);let h,d=Number.NEGATIVE_INFINITY;const m=c(i,a);for(const{geometry:f,attributes:c}of t){const t=f.x-s,e=f.y-s,o=Math.max(0,t),a=Math.max(0,e),i=Math.min(r,f.y+s),g=Math.min(n,f.x+s),y=+m(c);for(let r=a;r<i;r++){const a=l[r-e];for(let e=o;e<g;e++){const o=l[e-t];h=u[r*n+e]+=a*o*y,h>d&&(d=h)}}}return{matrix:u.buffer,max:d}}function o(t,e,n,r){const{blurRadius:o,fieldOffset:a,field:i}=e,c=new Float64Array(n*r),l=f(o),s=Math.round(3*o);let h,d=Number.NEGATIVE_INFINITY;const m=u(i,a),g=new Set;for(const f of t){const t=f.getCursor();for(;t.next();){const e=t.getObjectId();if(g.has(e))continue;g.add(e);const o=t.readLegacyPointGeometry(),a=128;if(o.x<-a||o.x>=n+a||o.y<-a||o.y>r+a)continue;const i=+m(t),f=Math.round(o.x)-s,u=Math.round(o.y)-s,y=Math.max(0,f),M=Math.max(0,u),x=Math.min(r,Math.round(o.y)+s),b=Math.min(n,Math.round(o.x)+s);for(let t=M;t<x;t++){const e=l[t-u];for(let r=y;r<b;r++){const o=l[r-f];h=c[t*n+r]+=e*o*i,h>d&&(d=h)}}}}return{matrix:c.buffer,max:d}}function a(t,e,n,r,o,a){t.canvas.width=t.canvas.height=e,t.clearRect(0,0,e,e);const f=t.getImageData(0,0,e,e);n&&r&&f.data.set(new Uint8ClampedArray(i(e,n,r,o,a))),t.putImageData(f,0,0)}function i(t,n,r,o,a){const i=new Uint32Array(t*t),f=\"buffer\"in n?n:new Float64Array(n),c=\"buffer\"in r?new Uint32Array(r.buffer):new Uint32Array(new Uint8Array(r).buffer),u=c.length/(a-o);for(let l=0;l<f.length;l++){const t=f[l],n=Math.floor((t-o)*u);i[l]=c[e(n,0,c.length-1)]}return i.buffer}function f(t){const e=Math.round(3*t),n=2*t*t,r=new Float64Array(2*e+1);for(let o=0;o<=r.length;o++)r[o]=Math.exp(-((o-e)**2)/n)/Math.sqrt(2*Math.PI)*(t/2);return r}function c(t,e){return\"function\"==typeof t?t:t?\"string\"==typeof e?e=>-1*+e[t]:n=>+n[t]+e:()=>1}function u(t,e){return null!=t?\"string\"==typeof e?e=>-1*+e.readAttribute(t):n=>+n.readAttribute(t)+e:t=>1}export{r as calculateHeatmapIntensityInfo,o as calculateHeatmapIntensityInfoReaders,i as createHeatmapImageData,f as createKernel,c as createValueFunction,u as createValueFunctionCursor,a as drawHeatmap,n as generateGradient};\n"],"names":["n","t","e","document","createElement","n2","getContext","height","width","clearRect","r2","createLinearGradient","ratio","e2","color","n3","colorStops","addColorStop","Math","max","fillStyle","fillRect","getImageData","data","r","blurRadius","o2","fieldOffset","a2","field","i2","c","Float64Array","l","round","length","exp","sqrt","PI","f","s","h","d","Number","NEGATIVE_INFINITY","m","e3","readAttribute","u","g","Set","f2","t2","getCursor","next","getObjectId","has","add","o3","readLegacyPointGeometry","a3","x","y","i3","f3","u2","M","min","b","t3","e4","o4","matrix","buffer","canvas","set","Uint8ClampedArray","Uint32Array","Uint8Array","floor","i","putImageData"],"mappings":"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"}