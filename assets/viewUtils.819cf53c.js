import{lz as t,lA as e,lB as i,gZ as s,lC as r,lD as o,lE as n,z as a,lF as h,X as l,aZ as c,lG as d,lH as p,lI as u,lJ as f,lK as m,lL as x,fD as g,fF as _,cq as y,dQ as v,lM as w,lx as b,F as S,G as M,H as R,bq as P,br as T,B as I,cw as C,bZ as z,dR as k,lN as A,lO as j,a1 as $,cn as L,ly as U,cr as X,lP as Y,ko as B,lj as F,lm as q,gY as E,fN as N,fE as O,fd as D,lQ as G,lR as V}from"./vendor.7103ff48.js";import{t as Z}from"./LineVisualElement.a7c721d3.js";const H={readOnly:!0,get(){const e="metric",{view:i}=this;if(!i)return e;const s=i.get("map.portalItem.portal");if(s)switch(s.get("user.units")||s.units){case e:return e;case"english":return"imperial"}return t(i.spatialReference)||e}};class J{constructor(t,i){this.measure=e(i),this.value=t,this.unit=i}get isBaseUnit(){return i(this.unit)}toUnit(t){return new J(s(this.value,this.unit,t),t)}toBaseUnit(){return this.toUnit(r(this.unit))}}function Q(t){if(!t)return null;if(t.isGeographic&&t.wkid){const e=o[t.wkid];if(e)return e}if(t.wkt){const e=function(t){const e=n.exec(t);if(!e||2!==e.length)return null;const i=e[1].split(",");if(!i||i.length<3)return null;const s=parseFloat(i[1]),r=parseFloat(i[2]);return isNaN(s)||isNaN(r)?null:{a:s,f:0===r?0:1/r}}(t.wkt);if(e)return e}return null}function W(t){return null!==Q(t)}function K(t,e="meters"){if(!t)throw new a("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(t.some((t=>!W(t.spatialReference))))throw new a("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");const i=[];for(let r=0;r<t.length;r++){const o=t[r],{spatialReference:n}=o,a="polyline"===o.type?o.paths:o.rings;let h=0;for(let t=0;t<a.length;t++){const e=a[t];let i=0;for(let t=1;t<e.length;t++){const s=e[t-1][0],r=e[t][0],o=e[t-1][1],a=e[t][1];if(o!==a||s!==r){const t={distance:null};tt(t,[s,o],[r,a],n),i+=t.distance}}h+=i}h=s(h,"meters",e),i.push(h)}return i}function tt(t,e,i,s){const r=e[0]*h,o=e[1]*h,n=i[0]*h,a=i[1]*h,{a:c,b:d,f:p,radius:u}=function(t){const e=Q(t||l.WGS84);if(function(t){return"b"in t&&"eSq"in t&&"radius"in t}(e))return e;const i=e.a*(1-e.f);return Object.assign(e,{b:i,eSq:1-(i/e.a)**2,radius:(2*e.a+i)/3,densificationRatio:1e4/((2*e.a+i)/3)})}(s),f=n-r,m=Math.atan((1-p)*Math.tan(o)),x=Math.atan((1-p)*Math.tan(a)),g=Math.sin(m),_=Math.cos(m),y=Math.sin(x),v=Math.cos(x);let w,b,S,M,R,P,T,I,C,z,k=1e3,A=f;do{if(T=Math.sin(A),I=Math.cos(A),S=Math.sqrt(v*T*(v*T)+(_*y-g*v*I)*(_*y-g*v*I)),0===S)return t.distance=0,t.azimuth=void 0,t.reverseAzimuth=void 0,t;R=g*y+_*v*I,P=Math.atan2(S,R),C=_*v*T/S,b=1-C*C,M=R-2*g*y/b,isNaN(M)&&(M=0),z=p/16*b*(4+p*(4-3*b)),w=A,A=f+(1-z)*p*C*(P+z*S*(M+z*R*(2*M*M-1)))}while(Math.abs(A-w)>1e-12&&--k>0);if(0===k){const e=u,i=Math.acos(Math.sin(o)*Math.sin(a)+Math.cos(o)*Math.cos(a)*Math.cos(n-r))*e,s=n-r,l=Math.sin(s)*Math.cos(a),c=Math.cos(o)*Math.sin(a)-Math.sin(o)*Math.cos(a)*Math.cos(s),d=Math.atan2(l,c);return t.azimuth=d/h,t.distance=i,t.reverseAzimuth=void 0,t}const j=b*(c*c-d*d)/(d*d),$=j/1024*(256+j*(j*(74-47*j)-128)),L=d*(1+j/16384*(4096+j*(j*(320-175*j)-768)))*(P-$*S*(M+$/4*(R*(2*M*M-1)-$/6*M*(4*S*S-3)*(4*M*M-3)))),U=Math.atan2(v*Math.sin(A),_*y-g*v*Math.cos(A)),X=Math.atan2(_*Math.sin(A),_*y*Math.cos(A)-g*v);return t.azimuth=U/h,t.distance=L,t.reverseAzimuth=X/h,t}class et{constructor(t=null){this.spatialReference=t}get spatialReference(){return this._spatialReference}set spatialReference(t){t!==this._spatialReference&&(this._spatialReference=t,this._updateNormalizationFactors())}normalizeDistance(t){return t*this._metersPerDistanceUnit}normalizeElevation(t){return t*this._metersPerElevationUnit}normalizeArea(t){return t*this._squareMetersPerAreaUnit}_updateNormalizationFactors(){this._metersPerDistanceUnit=c(this._spatialReference,1),this._metersPerElevationUnit=c(this._spatialReference,1),this._squareMetersPerAreaUnit=this._metersPerDistanceUnit*this._metersPerDistanceUnit}}function it(t,e,i,s=2,r="abbr"){return d(t,e.toUnit(i).value,i,s,r)}function st(t,e,i=2,s="abbr"){if("length"!==e.measure)throw new Error("quantity is not a length");return m(t,e.value,e.unit,i,s)}function rt(t,e,i=2,s="abbr"){if("length"!==e.measure)throw new Error("quantity is not a length");return x(t,e.value,e.unit,i,s)}function ot(t,e,i=2,s="abbr"){if("length"!==e.measure)throw new Error("quantity is not a length");return u(t,e.value,e.unit,i,s)}function nt(t,e,i=2,s="abbr"){if("length"!==e.measure)throw new Error("quantity is not a length");return f(t,e.value,e.unit,i,s)}function at(t){if("angle"!==t.measure)throw new Error("quantity is not an angle");return p(t.value,t.unit)}function ht(t,e){if(g(e,0,0,0),t.length>0){for(let i=0;i<t.length;++i)_(e,e,t[i]);y(e,e,1/t.length)}}const lt=b(),ct=lt,dt=b(),pt=dt;let ut=(t,e,i)=>{for(let s=0,r=e.length;s<r;s++){let r=e[s];Array.isArray(r)?ut(t,r,i):null!=r&&!1!==r&&("string"==typeof r&&(r={vnodeSelector:"",properties:void 0,children:void 0,text:r.toString(),domNode:null}),i.push(r))}};function ft(t,e,i){if(Array.isArray(e))i=e,e=void 0;else if(e&&("string"==typeof e||e.hasOwnProperty("vnodeSelector"))||i&&("string"==typeof i||i.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let s,r;return i&&1===i.length&&"string"==typeof i[0]?s=i[0]:i&&(r=[],ut(t,i,r),0===r.length&&(r=void 0)),{vnodeSelector:t,properties:e,children:r,text:""===s?void 0:s,domNode:null}}let mt=class extends P{constructor(t){super(t),this.startX=0,this.startY=0,this.endX=0,this.endY=0,this.width=1,this.color=[0,0,0,.5],this.visible=!0}get startPosition(){return[this.startX,this.startY]}set startPosition(t){this._set("startX",t[0]),this._set("startY",t[1])}get endPosition(){return[this.endX,this.endY]}set endPosition(t){this._set("endX",t[0]),this._set("endY",t[1])}get strokeStyle(){const t=this.color;return`rgba(${t[0]}, ${t[1]}, ${t[2]}, ${t[3]})`}get lineCap(){return"round"}render(){const{height:t,left:e,top:i,width:s,x1:r,x2:o,y1:n,y2:a}=this.calculateCoordinates(xt),h=`stroke: ${this.strokeStyle}; stroke-width: ${this.width}; stroke-linecap: ${this.lineCap};`;return ft("div",{classes:{"esri-line-overlay-item":!0},styles:{left:e+"px",top:i+"px",width:s+"px",height:t+"px",visibility:this.visible?"visible":"hidden"}},[ft("svg",{width:s,height:t},[ft("line",{x1:r,y1:n,x2:o,y2:a,style:h})])])}renderCanvas(t){if(!this.visible)return;t.strokeStyle=this.strokeStyle,t.lineWidth=this.width,t.lineCap=this.lineCap;const e=this.calculateCoordinates(xt);t.beginPath(),t.moveTo(e.left+e.x1,e.top+e.y1),t.lineTo(e.left+e.x2,e.top+e.y2),t.stroke()}calculateCoordinates(t){const e=Math.min(this.startX,this.endX),i=Math.max(this.startX,this.endX),s=Math.min(this.startY,this.endY),r=Math.max(this.startY,this.endY),o=this.width;return t.left=e-o,t.top=s-o,t.width=i-e+2*o,t.height=Math.max(20,r-s+2*o),t.x1=this.startX-e+o,t.y1=this.startY-s+o,t.x2=this.endX-e+o,t.y2=this.endY-s+o,t}};S([M()],mt.prototype,"startX",void 0),S([M()],mt.prototype,"startY",void 0),S([M()],mt.prototype,"endX",void 0),S([M()],mt.prototype,"endY",void 0),S([M()],mt.prototype,"startPosition",null),S([M()],mt.prototype,"endPosition",null),S([M()],mt.prototype,"width",void 0),S([M()],mt.prototype,"color",void 0),S([M()],mt.prototype,"visible",void 0),S([M({readOnly:!0})],mt.prototype,"strokeStyle",null),mt=S([R("esri.views.overlay.LineOverlayItem")],mt);const xt={left:0,top:0,width:0,height:0,x1:0,y1:0,x2:0,y2:0};var gt=mt;const _t={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};let yt=class extends P{constructor(t){super(t),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this.backgroundColor="rgba(0, 0, 0, 0.6)",this.textColor="white",this.textShadowColor=[0,0,0],this.textShadowSize=1}get position(){return[this.x,this.y]}set position(t){this._set("x",t[0]),this._set("y",t[1])}get padding(){return.5*this.fontSize}render(){return ft("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",backgroundColor:this.backgroundColor,color:this.textColor,padding:this.padding+"px",borderRadius:this.padding+"px",textShadow:`0 0 ${this.textShadowSize}px rgb(${this.textShadowColor[0]}, ${this.textShadowColor[1]}, ${this.textShadowColor[2]})`}},[this.text])}renderCanvas(t){if(!this.visible)return;const e=t.font.replace(/^(.*?)px/,"");t.font=`${this.fontSize}px ${e}`;const i=this.padding,s=this.padding,r=t.measureText(this.text).width,o=this.fontSize,n=vt[this.anchor];t.textAlign="center",t.textBaseline="middle";const a=r+2*i,h=o+2*i,l=this.x+n.x*a,c=this.y+n.y*h;this.roundedRect(t,l,c,a,h,s),t.fillStyle=this.backgroundColor,t.fill();const d=this.x+(n.x+.5)*a,p=this.y+(n.y+.5)*h;this._renderTextShadow(t,this.text,d,p),t.fillStyle=this.textColor,t.fillText(this.text,d,p)}_renderTextShadow(t,e,i,s){t.lineJoin="miter",t.fillStyle=`rgba(${this.textShadowColor[0]}, ${this.textShadowColor[1]}, ${this.textShadowColor[2]}, ${1/wt.length})`;const r=this.textShadowSize;for(const[o,n]of wt)t.fillText(e,i+r*o,s+r*n)}roundedRect(t,e,i,s,r,o){t.beginPath(),t.moveTo(e,i+o),t.arcTo(e,i,e+o,i,o),t.lineTo(e+s-o,i),t.arcTo(e+s,i,e+s,i+o,o),t.lineTo(e+s,i+r-o),t.arcTo(e+s,i+r,e+s-o,i+r,o),t.lineTo(e+o,i+r),t.arcTo(e,i+r,e,i+r-o,o),t.closePath()}_cssClasses(){const t={"esri-text-overlay-item":!0};for(const e in _t)t[_t[e]]=this.anchor===e;return t}};S([M()],yt.prototype,"x",void 0),S([M()],yt.prototype,"y",void 0),S([M()],yt.prototype,"position",null),S([M()],yt.prototype,"text",void 0),S([M()],yt.prototype,"fontSize",void 0),S([M()],yt.prototype,"anchor",void 0),S([M()],yt.prototype,"visible",void 0),S([M()],yt.prototype,"padding",null),yt=S([R("esri.views.overlay.TextOverlayItem")],yt);const vt={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},wt=[];{const t=16;for(let e=0;e<360;e+=360/t)wt.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)])}var bt=yt;class St extends Z{constructor(t){super(t.view),this._handles=new T,this._textItem=null,this._calloutItem=null,this._showCallout=!0,this._showText=!0,this._geometry=null,this._text=null,this._fontSize=14,this._distance=25,this._anchor="right",this.applyProps(t)}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this._updateLabelPosition()}get textItem(){return this._textItem}get text(){return this._text}set text(t){this._text=t,this.attached&&(this._textItem.text=this._text)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=t,this.attached&&(this._textItem.fontSize=this._fontSize)}get distance(){return this._distance}set distance(t){this._distance!==t&&(this._distance=t,this._updateLabelPosition())}get anchor(){return this._anchor}set anchor(t){this._anchor!==t&&(this._anchor=t,this._updateLabelPosition())}overlaps(t){return!!this.attached&&this.textItem.visible&&t.textItem.visible&&this.view.overlay.overlaps(this._textItem,t.textItem)}_updateLabelPosition(){if(this.attached){if(this._showText=!1,this._showCallout=!1,I(this.geometry)&&this.view._stage)switch(this.geometry.type){case"point":if(this._computeLabelPositionFromPoint(this.geometry.point,$t)){if(this.geometry.callout){const t=this.view.state.camera,e=this.geometry.callout.distance;C(jt,jt,[0,this.geometry.callout.offset]),t.renderToScreen(jt,$t),z(kt,0,1),k(kt,kt,e*t.pixelRatio),C(kt,kt,jt),t.renderToScreen(kt,Lt),this._showCallout=this._updatePosition($t,Lt)}else this._textItem.position=[$t[0],$t[1]],this._textItem.anchor="center";this._showText=!0}break;case"corner":this._computeLabelPositionFromCorner(this.geometry,this._distance,$t,Lt)&&(this._showCallout=this._updatePosition($t,Lt),this._showText=!0);break;case"segment":this._computeLabelPositionFromSegment(this.geometry,this._distance,this._anchor,$t,Lt)&&(this._showText=!0,this._showCallout=this._updatePosition($t,Lt))}this.updateVisibility(this.visible)}}_computeLabelPositionFromPoint(t,e){const i=this.view.state.camera;return i.projectToRenderScreen(t,jt),!(jt[2]<0||jt[2]>1||(i.renderToScreen(jt,e),0))}_computeLabelPositionFromCorner(t,e,i,s){if(!t)return!1;const r=this.view.state.camera;return Mt(t.left,1,r,Ct),A(Ct,Ct),Mt(t.right,0,r,zt),C(kt,Ct,zt),A(kt,kt),w(kt,kt),r.projectToRenderScreen(t.left.endRenderSpace,jt),!(jt[2]<0||jt[2]>1||(r.renderToScreen(jt,i),k(kt,kt,e*r.pixelRatio),C(kt,kt,jt),r.renderToScreen(kt,s),0))}_computeLabelPositionFromSegment(t,e,i,s,r){if(!t)return!1;const o=t.segment,n=this.view.state.camera;(function(t,e,i,s){s.projectToRenderScreen(t,lt),s.projectToRenderScreen(e,dt),v(i,pt,ct),w(i,i)})(o.startRenderSpace,o.endRenderSpace,Ct,n),z(kt,-Ct[1],Ct[0]);let a=!1;switch(i){case"top":a=kt[1]<0;break;case"bottom":a=kt[1]>0;break;case"left":a=kt[0]>0;break;case"right":a=kt[0]<0}if(a&&A(kt,kt),0===j(kt))switch(i){case"top":kt[1]=1;break;case"bottom":kt[1]=-1;break;case"left":kt[0]=-1;break;case"right":kt[0]=1}return o.eval(Ft[t.sampleLocation],At),n.projectToRenderScreen(At,jt),!(jt[2]<0||jt[2]>1||(n.renderToScreen(jt,s),k(kt,kt,e*n.pixelRatio),C(kt,kt,jt),n.renderToScreen(kt,r),0))}_updatePosition(t,e){if(e){const i=e[0]-t[0],s=e[1]-t[1];return this._textItem.position=[e[0],e[1]],this._textItem.anchor=Math.abs(i)>Math.abs(s)?i>0?"left":"right":s>0?"top":"bottom",this._calloutItem.startPosition=[t[0],t[1]],this._calloutItem.endPosition=[e[0],e[1]],!0}return this._textItem.position=[t[0],t[1]],this._textItem.anchor="center",!1}createResources(){this._textItem=new bt({visible:!0}),this._textItem.text=$(this._text),this._textItem.fontSize=this._fontSize,this._calloutItem=new gt({visible:!0,width:2}),this._updateLabelPosition(),this.view.overlay.items.addMany([this._textItem,this._calloutItem]),this._handles.add(this.view.state.watch("camera",(()=>this._updateLabelPosition())))}destroyResources(){this.view.overlay&&!this.view.overlay.destroyed&&this.view.overlay.items.removeMany([this._textItem,this._calloutItem]),this._handles.removeAll()}updateVisibility(t){this._textItem.visible=this._showText&&t,this._calloutItem.visible=this._showCallout&&t}}function Mt(t,e,i,s){t.eval(e,Pt,It),_(Tt,Pt,It),i.projectToRenderScreen(Pt,Ut),i.projectToRenderScreen(Tt,Yt),v(s,Bt,Xt),w(s,s)}function Rt(t){switch(t){case"top":return"bottom";case"right":return"left";case"bottom":return"top";case"left":return"right"}}const Pt=L(),Tt=L(),It=L(),Ct=U(),zt=U(),kt=U(),At=L(),jt=b(),$t=X(),Lt=X(),Ut=b(),Xt=Ut,Yt=b(),Bt=Yt,Ft={start:0,center:.5,end:1};class qt{constructor(t=L(),e=L()){this.startRenderSpace=t,this.endRenderSpace=e,this.type="euclidean"}eval(t,e,i){return Y(e,this.startRenderSpace,this.endRenderSpace,t),i&&(B(i,this.endRenderSpace,this.startRenderSpace),F(i,i)),e}createRenderGeometry(t,e){const i=[],s=[],r=(e,r)=>{const o=Ot;B(o,e,t),i.push([o[0],o[1],o[2]]),s.push([r[0],r[1],r[2]])},o=e.worldUpAtPosition(this.eval(.5,Nt),q.get());return r(this.startRenderSpace,o),r(this.endRenderSpace,o),{points:i,normals:s}}}class Et{constructor(t,e,i){this.startRenderSpace=t,this.endRenderSpace=e,this.renderSpatialReference=i,this.type="geodesic",this._start=L(),this._end=L(),this._pcpf=E(i),this._project=N(i,this._pcpf),this._projectIn(t,this._start),this._projectIn(e,this._end)}_projectIn(t,e){this._project?O(t,this.renderSpatialReference,e,this._pcpf):D(e,t)}eval(t,e,i){if(this._project)if(i){const s=Ot;G(this._start,this._end,t,e,s),_(Dt,e,s),O(e,this._pcpf,e,this.renderSpatialReference),O(Dt,this._pcpf,Dt,this.renderSpatialReference),B(i,Dt,e),F(i,i)}else V(this._start,this._end,t,e),O(e,this._pcpf,e,this.renderSpatialReference);else Y(e,this._start,this._end,t),i&&(B(i,this._end,this._start),F(i,i));return e}createRenderGeometry(t,e){const i=[],s=[],r=(e,r)=>{const o=Dt;B(o,e,t),i.push([o[0],o[1],o[2]]),s.push([r[0],r[1],r[2]])};for(let o=0;o<128;++o){const t=o/127,i=Nt,s=Ot;this.eval(t,i),e.worldUpAtPosition(i,s),r(i,s)}return{points:i,normals:s}}}const Nt=L(),Ot=L(),Dt=L();function Gt(t,e){if(g(e,0,0,0),t.length>0){for(let i=0;i<t.length;++i)_(e,e,t[i]);y(e,e,1/t.length)}}function Vt(t,e,i,s){s.projectToRenderScreen(t,Zt),s.projectToRenderScreen(e,Jt),v(i,Qt,Ht),w(i,i)}const Zt=b(),Ht=Zt,Jt=b(),Qt=Jt;export{K as M,tt as R,qt as _,st as a,nt as b,Rt as c,H as d,J as e,Et as f,at as g,ot as h,Gt as i,ht as j,Vt as k,it as l,W as m,rt as s,et as t,St as v};
//# sourceMappingURL=viewUtils.819cf53c.js.map
