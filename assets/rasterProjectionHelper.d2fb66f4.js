import{n7 as e,n8 as n,j$ as t,z as a,P as i,i7 as o,hS as r,M as s,aZ as l,B as c,aL as x,n9 as u}from"./vendor.7103ff48.js";const f=5e-4,m=function(e,n){const t=(e.isWGS84||e.isWebMercator)&&(n.isWGS84||n.isWebMercator);return!(e.equals(n)||t)},h={3395:20037508.342789244,3410:17334193.943686873,3832:3339584.723798206,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,8858:7396237.374497803,8859:2465412.4581659334,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53025:7276828.3848298555,53031:10384677.558821043,53034:20015086.79602057,53036:7389443.187332862,53037:2463147.729110953,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54025:7311399.09166516,54031:10396310.810074743,54034:20037508.342789244,54050:808820.9223376509,54053:1920897.3915568967,54079:20037508.342789244,54080:20037508.342789244,54100:20037508.342789244,54101:20037508.342789244,102038:4297258.582585486,102299:5013965.117483125};async function p(){if(e()||!n())return null;await t()}function y(n,t,i){if(!m(n.spatialReference,t))return null;if(!e())throw new a("rasterprojectionhelper-projectResolution","projection engine is not loaded");return i?u(t,n.spatialReference,n):u(n.spatialReference,t,n)}function M(n,t,l,c=null){if(n.spatialReference.equals(t))return n;const x=m(n.spatialReference,t);if(x&&!e())throw new a("rasterprojectionhelper-projectResolution","projection engine is not loaded");const u=l.center,f=new i({xmin:u.x-n.x/2,xmax:u.x+n.x/2,ymin:u.y-n.y/2,ymax:u.y+n.y/2,spatialReference:n.spatialReference}),h=x?o(f,t,c):r(f,t);return s(h)?null:{x:h.xmax-h.xmin,y:h.ymax-h.ymin}}function d(e,n=.01){return l(e)?n/l(e):0}function g(n,t,i=null,l=!0){const c=n.spatialReference;if(c.equals(t))return n;let x=r(n,t);if(s(x)){if(!e())throw new a("rasterprojectionhelper-projectResolution","projection engine is not loaded");x=o(n,t,i)}if(l&&t.isGeographic){const[e,t]=v(c,!0),a=d(c);a&&null!=e&&null!=t&&(Math.abs(n.x-e)<a&&Math.abs(180-x.x)<f?x.x-=360:Math.abs(n.x-t)<a&&Math.abs(180+x.x)<f&&(x.x+=360))}return x}function w(e){const n=j(e[0].spatialReference);if(e.length<2||!c(n))return e[0];let{xmin:t,xmax:a,ymin:o,ymax:r}=e[0];for(let i=1;i<e.length;i++){const t=e[i];a=t.xmax+n*i,o=Math.min(o,t.ymin),r=Math.max(r,t.ymax)}return new i({xmin:t,xmax:a,ymin:o,ymax:r,spatialReference:e[0].spatialReference})}function R(e,n,t=null,a=!0){if(e.spatialReference.equals(n))return e;const i=N(e),o=j(e.spatialReference,!0);return c(o)&&0!==i?w(e.clone().normalize().map((e=>b(e,n,t,a)))):b(e,n,t,a)}function b(n,t,i=null,l=!0){const c=n.spatialReference;if(c.equals(t))return n;if(m(c,t)&&!e())throw new a("rasterprojectionhelper-projectExtent","projection engine is not loaded");let u=r(n,t);s(u)&&(u=o(n,t,i));let[h,p]=v(c,!0);if(u&&l&&c.isWebMercator&&t.isGeographic&&null!=h&&null!=p){const e=.001,a=1e3;if(Math.abs(n.xmin-h)<e&&Math.abs(p-n.xmax)>a&&Math.abs(180-u.xmax)<f){u.xmin=-180;const e=[];e.push(new x(n.xmax,n.ymin,c)),e.push(new x(n.xmax,(n.ymin+n.ymax)/2,c)),e.push(new x(n.xmax,n.ymax,c));const a=e.map((e=>g(e,t,i))).filter((e=>!isNaN(null==e?void 0:e.x))).map((e=>e.x));u.xmax=Math.max.apply(null,a)}if(Math.abs(n.xmax-p)<e&&Math.abs(h-n.xmin)>a&&Math.abs(180+u.xmin)<f){u.xmax=180;const e=[];e.push(new x(n.xmin,n.ymin,c)),e.push(new x(n.xmin,(n.ymin+n.ymax)/2,c)),e.push(new x(n.xmin,n.ymax,c));const a=e.map((e=>g(e,t,i))).filter((e=>!isNaN(null==e?void 0:e.x))).map((e=>e.x));u.xmin=Math.min.apply(null,a)}}[h,p]=v(t,!0);const y=d(t);return y&&null!=h&&null!=p&&(Math.abs(u.xmin-h)<y&&(u.xmin=h),Math.abs(u.xmax-p)<y&&(u.xmax=p)),u}function j(e,n=!1){const t=n?20037508.342787:20037508.342788905;return e.isWebMercator?2*t:e.wkid&&e.isGeographic?360:2*h[e.wkid]||null}function v(e,n=!1){const t=[],a=j(e,n);return c(a)&&(t.push(-a/2),t.push(a/2)),t}function S(e,n,t,a){let i=(e-n)/t;return i-Math.floor(i)!=0?i=Math.floor(i):a&&(i-=1),i}function N(e,n=!1){const t=j(e.spatialReference);if(!c(t))return 0;const a=n?0:-t/2;return S(e.xmax,a,t,!0)-S(e.xmin,a,t,!1)}function W(e){const n=e.storageInfo.origin.x,t=j(e.spatialReference,!0);if(!c(t))return{originX:n,halfWorldWidth:null,pyramidsInfo:null};const a=t/2,{nativePixelSize:i,storageInfo:o,extent:r}=e,{maximumPyramidLevel:s,blockWidth:l,pyramidScalingFactor:x}=o;let u=i.x;const f=[],m=c(e.transform)&&"gcs-shift"===e.transform.type,h=n+a,p=m?t-n:a-n;for(let c=0;c<=s;c++){const e=(r.xmax-n)/u/l,a=e-Math.floor(e)==0?e:Math.ceil(e),i=(t/2-n)/u/l,o=i-Math.floor(i)==0?i:Math.ceil(i),s=Math.floor(h/u/l),c=Math.round(h/u)%l,m=(l-Math.round(p/u)%l)%l;f.push({resolutionX:u,blockWidth:l,datsetColumnCount:a,worldColumnCountFromOrigin:o,leftMargin:c,rightPadding:m,originColumnOffset:s}),u*=x}return{originX:n,halfWorldWidth:a,pyramidsInfo:f,hasGCSSShiftTransform:m}}function z(n,t,i,o=null,r=null,s=!1,l=[32,32]){if(m(n.spatialReference,t.spatialReference)&&!e())throw new a("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(n&&t&&i))return null;const{xmin:u,ymin:f,xmax:h,ymax:p}=n,y=n.spatialReference,M=t.spatialReference,d=j(M);s=s||"gcs-shift"===(null==r?void 0:r.type);const w={x:l[0]*i.x,y:l[1]*i.y},R={cols:Math.ceil((h-u)/w.x-.1/l[0])+1,rows:Math.ceil((p-f)/w.y-.1/l[1])+1},b=w.x,v=w.y,S=[];let N,W=!1;for(let e=0;e<R.cols;e++){const n=[];for(let a=0;a<R.rows;a++){let i=g(new x({x:u+b*e,y:p-v*a,spatialReference:y}),M,o);r&&(i=r.inverseTransform(i)),n.push(i),e>0&&s&&i&&N[a]&&c(d)&&i.x<N[a].x&&(i.x+=d),i?(S.push((i.x-t.xmin)/(t.xmax-t.xmin)),S.push((t.ymax-i.y)/(t.ymax-t.ymin))):(S.push(NaN),S.push(NaN),W=!0)}N=n}const z=function(e,n){const t=(e[0]+e[4]+e[4*n.cols]+e[4*n.cols+4])/4,a=(e[1]+e[5]+e[4*n.rows+1]+e[4*n.rows+5])/4;return[Math.abs(t-e[2*n.rows+2]),Math.abs(a-e[2*n.rows+3])]}(S,R),G=new Float32Array((R.cols-1)*(R.rows-1)*2*6),P=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),C=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let e=0;e<R.cols-1;e++){for(let n=0;n<R.rows-1;n++){let t=e*R.rows*2+2*n;const a=S[t],i=S[t+1],o=S[t+2],r=S[t+3];t+=2*R.rows;const s=S[t],l=S[t+1],c=S[t+2],x=S[t+3];let u=0,f=12*(n*(R.cols-1)+e);for(let e=0;e<3;e++)G[f++]=P[u++]*a+P[u++]*o+P[u++]*c;u=0;for(let e=0;e<3;e++)G[f++]=P[u++]*i+P[u++]*r+P[u++]*x;u=0;for(let e=0;e<3;e++)G[f++]=C[u++]*a+C[u++]*s+C[u++]*c;u=0;for(let e=0;e<3;e++)G[f++]=C[u++]*i+C[u++]*l+C[u++]*x}if(W)for(let e=0;e<G.length;e++)isNaN(G[e])&&(G[e]=-1)}return{offsets:S,error:z,coefficients:G,spacing:l,size:[R.cols-1,R.rows-1]}}function G(e){const n=e.clone().normalize();return 1===n.length?n[0]:w(n)}function P(e,n,t){const{storageInfo:a,pixelSize:i}=n;let o,r=!1;const{pyramidResolutions:s}=a;if(c(s)&&s.length){const a=(e.x+e.y)/2,l=s[s.length-1],c=(l.x+l.y)/2,u=(i.x+i.y)/2;if(a<=u)o=0;else if(a>=c)o=s.length,r=a/c>8;else{let e,n=u;for(let i=1;i<=s.length;i++){if(e=(s[i-1].x+s[i-1].y)/2,a<=e){a===e?o=i:"down"===t?(o=i-1,r=a/n>8):o="up"===t||a-n>e-a||a/n>2?i:i-1;break}n=e}}const f=0===o?i:s[o-1];return{pyramidLevel:o,pyramidResolution:new x({x:f.x,y:f.y,spatialReference:n.spatialReference}),excessiveReading:r}}const l=Math.log(e.x/i.x)/Math.LN2,u=Math.log(e.y/i.y)/Math.LN2,f=n.storageInfo.maximumPyramidLevel||0;o="down"===t?Math.floor(Math.min(l,u)):"up"===t?Math.ceil(Math.max(l,u)):Math.round((l+u)/2),o<0?o=0:o>f&&(r=o>f+3,o=f);const m=2**o;return{pyramidLevel:o,pyramidResolution:new x({x:m*n.nativePixelSize.x,y:m*n.nativePixelSize.y,spatialReference:n.spatialReference}),excessiveReading:r}}function C(e,n,t=512,a=!0){const{extent:i,spatialReference:o,pixelSize:r}=e,s=M(new x({x:r.x,y:r.y,spatialReference:o}),n,i);if(null==s)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const c=(s.x+s.y)/2,u=l(n),f=c*u*96*39.37,m=n.isGeographic?256/t*295828763.7958547:256/t*591657527.591555;let h="vector-magdir"===e.dataType||"vector-uv"===e.dataType;const p=R(i,n);h||a&&(n.isGeographic||n.isWebMercator)&&(h=p.xmin*p.xmax<0);let y,d=f;const g=1.001;if(h){d=m;const e=n.isGeographic?1341104507446289e-21:.29858214164761665,t=e*(96*u*39.37),a=n.isGeographic?4326:3857;y=M(new x({x:e,y:e,spatialReference:{wkid:a}}),o,p),y.x*=d/t,y.y*=d/t}else{y={x:r.x,y:r.y};const n=Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2);let t=0;for(;d<m*(g/2)&&t<n;)t++,d*=2,y.x*=2,y.y*=2;Math.max(d,m)/Math.min(d,m)<=g&&(d=m)}const w=[d],b=[{x:y.x,y:y.y}],j=Math.min(70.5310735,f)/g;for(;d>=j;)d/=2,y.x/=2,y.y/=2,w.push(d),b.push({x:y.x,y:y.y});return{projectedPixelSize:s,scales:w,srcResolutions:b,isCustomTilingScheme:!h}}export{G as C,W as G,P as L,p as M,z as P,g as R,R as b,y as d,M as g,C as k,N as z};
//# sourceMappingURL=rasterProjectionHelper.d2fb66f4.js.map
