{"version":3,"file":"arcgisLayers.72e8689f.js","sources":["../../node_modules/@arcgis/core/layers/support/arcgisLayers.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport e from\"../../request.js\";import r from\"../../core/Error.js\";import{isNone as a,isSome as t}from\"../../core/maybe.js\";import{getFilename as l,urlToObject as n}from\"../../core/urlUtils.js\";import{parse as s,parseNonStandardSublayerUrl as o}from\"./arcgisLayerUrl.js\";import{layerLookupMap as u}from\"./lazyLayerLoader.js\";async function i(e){var r;const a=null==(r=e.properties)?void 0:r.customParameters,t=await d(e.url,a),l={...e.properties,url:e.url};if(!t.sublayerIds)return null!=t.layerOrTableId&&(l.layerId=t.layerOrTableId,l.sourceJSON=t.sourceJSON),new t.Constructor(l);const n=new(0,(await import(\"../GroupLayer.js\")).default)({title:t.parsedUrl.title});return c(n,t,l),n}function y(e,r){return e?e.find((e=>e.id===r)):null}function c(e,r,a){function l(e,l){const n={...a,layerId:e,sublayerTitleMode:\"service-name\"};return t(l)&&(n.sourceJSON=l),new r.Constructor(n)}r.sublayerIds.forEach((a=>{const t=l(a,y(r.sublayerInfos,a));e.add(t)})),r.tableIds.forEach((a=>{const t=l(a,y(r.tableInfos,a));e.tables.add(t)}))}async function d(e,t){let l=s(e);if(a(l)&&(l=await f(e,t)),a(l))throw new r(\"arcgis-layers:url-mismatch\",\"The url '${url}' is not a valid arcgis resource\",{url:e});const{serverType:n,sublayer:o}=l;let u;const i={FeatureServer:\"FeatureLayer\",StreamServer:\"StreamLayer\",VectorTileServer:\"VectorTileLayer\"};switch(n){case\"MapServer\":u=null!=o?\"FeatureLayer\":S(e,t).then((e=>e?\"TileLayer\":\"MapImageLayer\"));break;case\"ImageServer\":u=w(e,t).then((e=>{const r=e.tileInfo&&e.tileInfo.format;return e.tileInfo?!r||\"LERC\"!==r.toUpperCase()||e.cacheType&&\"elevation\"!==e.cacheType.toLowerCase()?\"ImageryTileLayer\":\"ElevationLayer\":\"ImageryLayer\"}));break;case\"SceneServer\":u=w(l.url.path,t).then((e=>{const r={Point:\"SceneLayer\",\"3DObject\":\"SceneLayer\",IntegratedMesh:\"IntegratedMeshLayer\",PointCloud:\"PointCloudLayer\",Building:\"BuildingSceneLayer\"};if(e&&Array.isArray(e.layers)&&e.layers.length>0){const a=e.layers[0].layerType;if(null!=r[a])return r[a]}return\"SceneLayer\"}));break;default:u=i[n]}const y={FeatureLayer:!0,SceneLayer:!0},c=\"FeatureServer\"===n,d={parsedUrl:l,Constructor:null,layerOrTableId:c?o:null,sublayerIds:null,tableIds:null},p=await u;if(y[p]&&null==o){const r=await v(e,n,t);c&&(d.sublayerInfos=r.layerInfos,d.tableInfos=r.tableInfos);if(1!==r.layerIds.length+r.tableIds.length)d.sublayerIds=r.layerIds,d.tableIds=r.tableIds;else if(c){var I,b;d.layerOrTableId=null!=(I=r.layerIds[0])?I:r.tableIds[0],d.sourceJSON=null!=(b=r.layerInfos[0])?b:r.tableInfos[0]}}return d.Constructor=await m(p),d}async function f(e,r){var a;const s=await w(e,r);let u=null,i=null;const y=s.type;if(\"Feature Layer\"===y||\"Table\"===y?(u=\"FeatureServer\",i=s.id):\"indexedVector\"===y?u=\"VectorTileServer\":s.hasOwnProperty(\"mapName\")?u=\"MapServer\":s.hasOwnProperty(\"bandCount\")&&s.hasOwnProperty(\"pixelSizeX\")?u=\"ImageServer\":s.hasOwnProperty(\"maxRecordCount\")&&s.hasOwnProperty(\"allowGeometryUpdates\")?u=\"FeatureServer\":s.hasOwnProperty(\"streamUrls\")?u=\"StreamServer\":p(s)?(u=\"SceneServer\",i=s.id):s.hasOwnProperty(\"layers\")&&p(null==(a=s.layers)?void 0:a[0])&&(u=\"SceneServer\"),!u)return null;const c=null!=i?o(e):null;return{title:t(c)&&s.name||l(e),serverType:u,sublayer:i,url:{path:t(c)?c.serviceUrl:n(e).path}}}function p(e){return(null==e?void 0:e.hasOwnProperty(\"store\"))&&e.hasOwnProperty(\"id\")&&\"number\"==typeof e.id}async function v(e,r,a){var t,l;let n,s=!1;if(\"FeatureServer\"===r){const r=await b(e,a);s=!!r.layersJSON,n=r.layersJSON||r.serviceJSON}else n=await w(e,a);const o=null==(t=n)?void 0:t.layers,u=null==(l=n)?void 0:l.tables;return{layerIds:(null==o?void 0:o.map((e=>e.id)).reverse())||[],tableIds:(null==u?void 0:u.map((e=>e.id)).reverse())||[],layerInfos:s?o:[],tableInfos:s?u:[]}}function I(e){return!e.type||\"Feature Layer\"===e.type}async function b(e,r){var a,t;let l=await w(e,r);l=l||{},l.layers=(null==(a=l.layers)?void 0:a.filter(I))||[];const n={serviceJSON:l};if(l.currentVersion<10.5)return n;const s=await w(e+\"/layers\",r);return n.layersJSON={layers:(null==s||null==(t=s.layers)?void 0:t.filter(I))||[],tables:(null==s?void 0:s.tables)||[]},n}async function m(e){return(0,u[e])()}async function S(e,r){return(await w(e,r)).tileInfo}async function w(r,a){return(await e(r,{responseType:\"json\",query:{f:\"json\",...a}})).data}export{i as fromUrl};\n"],"names":["async","e","r2","a2","properties","customParameters","t2","t","l","s","a","r","s2","w","u","i2","y2","type","id","hasOwnProperty","p","layers","c2","o","title","name","serverType","sublayer","url","path","serviceUrl","n","f","FeatureServer","StreamServer","VectorTileServer","tileInfo","S","then","e2","format","toUpperCase","cacheType","toLowerCase","Point","IntegratedMesh","PointCloud","Building","Array","isArray","length","layerType","FeatureLayer","SceneLayer","d2","parsedUrl","Constructor","layerOrTableId","sublayerIds","tableIds","p2","r3","filter","I","serviceJSON","currentVersion","layersJSON","tables","b","layerIds","map","reverse","layerInfos","tableInfos","v","sublayerInfos","I2","b2","sourceJSON","m","d","__spreadProps","layerId","import","default","l2","sublayerTitleMode","forEach","a3","y","add","c","find","responseType","query","__spreadValues","data"],"mappings":"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"}