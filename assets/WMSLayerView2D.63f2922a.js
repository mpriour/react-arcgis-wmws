var e=Object.defineProperty,t=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,a=(t,i,r)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[i]=r;import{bb as s,z as o,bv as n,P as p,F as h,G as m,H as l,ih as d}from"./vendor.7103ff48.js";import{t as c}from"./BitmapContainer.f66ff0c9.js";import{l as f}from"./LayerView2D.3bec42c6.js";import{S as y}from"./ExportStrategy.b9685efa.js";import{a as u}from"./RefreshableLayerView.7b9ab281.js";import{a as b}from"./WMSLayerView.3410e49f.js";import"./brushes.b64b90a9.js";import"./definitions.e5e12ce7.js";import"./Utils.8f00ae04.js";import"./ShaderCompiler.6905b522.js";import"./GeometryUtils.1bcb906c.js";import"./MaterialKey.8df623c8.js";import"./pixelUtils.5eddfa69.js";import"./WGLContainer.6f073475.js";import"./Container.f525a10f.js";import"./Bitmap.8c3290a1.js";import"./ExportWMSImageParameters.4c82f1d3.js";const g=s.getLogger("esri.views.2d.layers.WMSLayerView2D");let w=class extends(b(u(f(d)))){initialize(){const{layer:e,view:t}=this;e.supportsSpatialReference(t.spatialReference)||this.addResolvingPromise(Promise.reject(new o("layerview:spatial-reference-incompatible","The spatial references supported by this WMS layer are incompatible with the spatial reference of the view",{layer:e})))}hitTest(){return null}update(e){this.strategy.update(e).catch((e=>{n(e)||g.error(e)}))}attach(){const{layer:e}=this,{imageMaxHeight:t,imageMaxWidth:i}=e;this._bitmapContainer=new c,this.container.addChild(this._bitmapContainer),this.strategy=new y({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:t,imageMaxWidth:i,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1}),this.handles.add(this.watch("exportImageVersion",(()=>this.requestUpdate())),"exportImageVersion")}detach(){this.handles.remove("exportImageVersion"),this.strategy.destroy(),this.container.removeChild(this._bitmapContainer),this._bitmapContainer.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQuery(e){const{view:t}=this,i=this._bitmapContainer,{x:r,y:a}=e,{spatialReference:s}=t;let o=null,n=0,h=0;if(i.children.some((e=>{const{width:t,height:i,resolution:m,x:l,y:d}=e,c=l+m*t,f=d-m*i;return r>=l&&r<=c&&a<=d&&a>=f&&(o=new p({xmin:l,ymin:f,xmax:c,ymax:d,spatialReference:s}),n=t,h=i,!0)})),!o)return null;const m=o.width/n,l=Math.round((r-o.xmin)/m),d=Math.round((o.ymax-a)/m);return{extent:o,width:n,height:h,x:l,y:d}}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(e,s,o,n){return this.layer.fetchImage(e,s,o,((e,s)=>{for(var o in s||(s={}))i.call(s,o)&&a(e,o,s[o]);if(t)for(var o of t(s))r.call(s,o)&&a(e,o,s[o]);return e})({timeExtent:this.timeExtent},n))}};h([m()],w.prototype,"strategy",void 0),h([m()],w.prototype,"updating",void 0),w=h([l("esri.views.2d.layers.WMSLayerView2D")],w);var x=w;export{x as default};
//# sourceMappingURL=WMSLayerView2D.63f2922a.js.map
