{"version":3,"file":"Graphics3DFrustumVisibility.283af435.js","sources":["../../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DFrustumVisibility.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Accessor.js\";import s from\"../../../../core/Handles.js\";import{init as i}from\"../../../../core/watchUtils.js\";import{property as r}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as n}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{getReferenceEllipsoid as o}from\"../../../../geometry/projectionEllipsoid.js\";import{FrustumExtentIntersection as a}from\"../../support/FrustumExtentIntersection.js\";import{TaskPriority as l}from\"../../../support/Scheduler.js\";const h=1.2;let u=class extends t{constructor(){super(...arguments),this.suspended=!1,this.extent=null,this.extentIntersectionDirty=!0,this._isVisibleBelowSurface=!1,this.handles=new s,this.layerView=null,this.updating=!0}setup(e){this.layerView=e,this.extentIntersection=new a({renderCoordsHelper:e.view.renderCoordsHelper});const t=e.view,s=t.basemapTerrain,r=t.resourceController.scheduler;this.handles.add([t.on(\"resize\",(()=>this.viewChange())),t.state.watch(\"camera\",(()=>this.viewChange()),!0),r.registerTask(l.FRUSTUM_VISIBILITY,this),s.on(\"elevation-bounds-change\",(()=>this.elevationBoundsChange()))]),\"local\"===t.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([i(s,[\"opacity\",\"wireframe\"],(()=>this.updateIsVisibleBelowSurface())),i(t,\"map.ground.navigationConstraint.type\",(()=>this.updateIsVisibleBelowSurface()))])}destroy(){this.layerView=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)}_setDirty(){this.updating||this._set(\"updating\",!0)}setExtent(e){this.extent=e,this.extentIntersectionDirty=!0,this._setDirty()}viewChange(){this._setDirty()}elevationBoundsChange(){this._setDirty(),this.extentIntersectionDirty=!0}set isVisibleBelowSurface(e){this._isVisibleBelowSurface=e,this._setDirty(),this.extentIntersectionDirty=!0}updateIsVisibleBelowSurface(){const e=this.layerView.view,t=e.basemapTerrain,s=\"local\"===e.viewingMode,i=e.map.ground&&e.map.ground.navigationConstraint&&\"none\"===e.map.ground.navigationConstraint.type;this.isVisibleBelowSurface=s||!t.opaque||i}updateExtentIntersection(){if(!this.extentIntersectionDirty)return;this.extentIntersectionDirty=!1;const e=this.layerView.view;let t;if(this._isVisibleBelowSurface)t=-.3*o(e.spatialReference).radius;else{const{min:s,max:i}=e.basemapTerrain.elevationBounds;t=s-Math.max(1,(i-s)*(h-1))}this.extentIntersection.update(this.extent,e.spatialReference,t)}get running(){return this.updating}runTask(){if(this._set(\"updating\",!1),!this.extent)return void this._set(\"suspended\",!1);this.updateExtentIntersection();const e=this.layerView.view.frustum,t=o(this.layerView.view.spatialReference).radius;this._set(\"suspended\",!this.extentIntersection.isVisibleInFrustum(e,t))}};e([r({readOnly:!0})],u.prototype,\"suspended\",void 0),e([r({readOnly:!0})],u.prototype,\"updating\",void 0),u=e([n(\"esri.views.3d.layers.graphics.Graphics3DFrustumVisibility\")],u);var p=u;export{p as default};\n"],"names":["u","t","constructor","arguments","this","suspended","extent","extentIntersectionDirty","_isVisibleBelowSurface","handles","s","layerView","updating","setup","e2","extentIntersection","a","renderCoordsHelper","view","basemapTerrain","r","resourceController","scheduler","add","on","viewChange","state","watch","registerTask","l","FRUSTUM_VISIBILITY","elevationBoundsChange","viewingMode","isVisibleBelowSurface","i","updateIsVisibleBelowSurface","destroy","_setDirty","_set","setExtent","i2","map","ground","navigationConstraint","type","opaque","updateExtentIntersection","o","spatialReference","radius","min","max","elevationBounds","Math","update","runTask","frustum","isVisibleInFrustum","e","readOnly","prototype","n","p"],"mappings":"uGAIqtB,IAAIA,EAAE,cAAcC,EAAEC,uBAAuBC,WAAWC,KAAKC,WAAU,EAAGD,KAAKE,OAAO,KAAKF,KAAKG,yBAAwB,EAAGH,KAAKI,wBAAuB,EAAGJ,KAAKK,QAAQ,IAAIC,EAAEN,KAAKO,UAAU,KAAKP,KAAKQ,UAAS,EAAGC,MAAMC,QAAQH,UAAUG,EAAEV,KAAKW,mBAAmB,IAAIC,EAAE,CAACC,mBAAmBH,EAAEI,KAAKD,2BAA2BhB,EAAEa,EAAEI,KAAKR,EAAET,EAAEkB,eAAeC,EAAEnB,EAAEoB,mBAAmBC,eAAeb,QAAQc,IAAI,CAACtB,EAAEuB,GAAG,UAAU,IAAIpB,KAAKqB,eAAexB,EAAEyB,MAAMC,MAAM,UAAU,IAAIvB,KAAKqB,eAAc,GAAIL,EAAEQ,aAAaC,EAAEC,mBAAmB1B,MAAMM,EAAEc,GAAG,2BAA2B,IAAIpB,KAAK2B,4BAA4B,UAAA9B,EAAY+B,YAAY5B,KAAK6B,uBAAsB,EAAG7B,KAAKK,QAAQc,IAAI,CAACW,EAAExB,EAAE,CAAC,UAAU,cAAc,IAAIN,KAAK+B,gCAAgCD,EAAEjC,EAAE,wCAAwC,IAAIG,KAAK+B,kCAAkCC,eAAezB,UAAU,KAAKP,KAAKE,OAAO,KAAKF,KAAKW,mBAAmB,KAAKX,KAAKK,eAAeA,QAAQ2B,UAAUhC,KAAKK,QAAQ,MAAM4B,iBAAiBzB,UAAUR,KAAKkC,KAAK,YAAW,GAAIC,UAAUzB,QAAQR,OAAOQ,EAAEV,KAAKG,yBAAwB,EAAGH,KAAKiC,YAAYZ,kBAAkBY,YAAYN,6BAA6BM,YAAYjC,KAAKG,yBAAwB,4BAA6BO,QAAQN,uBAAuBM,EAAEV,KAAKiC,YAAYjC,KAAKG,yBAAwB,EAAG4B,oCAAoCrB,EAAEV,KAAKO,UAAUO,KAAKjB,EAAEa,EAAEK,eAAeT,EAAE,UAAAI,EAAYkB,YAAYQ,EAAE1B,EAAE2B,IAAIC,QAAQ5B,EAAE2B,IAAIC,OAAOC,sBAAsB,SAAS7B,EAAE2B,IAAIC,OAAOC,qBAAqBC,UAAUX,sBAAsBvB,IAAIT,EAAE4C,QAAQL,EAAEM,+BAA+B1C,KAAKG,oCAAoCA,yBAAwB,QAASO,EAAEV,KAAKO,UAAUO,SAASjB,KAAKG,KAAKI,6BAA6BuC,EAAEjC,EAAEkC,kBAAkBC,WAAW,OAAOC,IAAIxC,EAAEyC,IAAIX,GAAG1B,EAAEK,eAAeiC,kBAAkB1C,EAAE2C,KAAKF,IAAI,KAAKzC,IAAhyD,IAAsyD,SAASK,mBAAmBuC,OAAOlD,KAAKE,OAAOQ,EAAEkC,iBAAiB/C,wBAAwBG,KAAKQ,SAAS2C,aAAanD,KAAKkC,KAAK,YAAW,IAAKlC,KAAKE,mBAAmBF,KAAKkC,KAAK,aAAY,QAASQ,iCAAiChC,EAAEV,KAAKO,UAAUO,KAAKsC,QAAQvD,EAAE8C,EAAE3C,KAAKO,UAAUO,KAAK8B,kBAAkBC,YAAYX,KAAK,aAAalC,KAAKW,mBAAmB0C,mBAAmB3C,EAAEb,MAAMyD,EAAE,CAACtC,EAAE,CAACuC,UAAS,KAAM3D,EAAE4D,UAAU,iBAAY,GAAQF,EAAE,CAACtC,EAAE,CAACuC,UAAS,KAAM3D,EAAE4D,UAAU,gBAAW,GAAQ5D,EAAE0D,EAAE,CAACG,EAAE,8DAA8D7D,GAAM,IAAC8D,EAAE9D"}