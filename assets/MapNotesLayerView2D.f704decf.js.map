{"version":3,"file":"MapNotesLayerView2D.f704decf.js","sources":["../../node_modules/@arcgis/core/views/2d/layers/MapNotesLayerView2D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import s from\"../../../Graphic.js\";import i from\"../../../core/Collection.js\";import{isSome as r,isNone as t}from\"../../../core/maybe.js\";import{init as a,on as o}from\"../../../core/watchUtils.js\";import\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as h}from\"../../../core/accessorSupport/decorators/subclass.js\";import{LayerView2DMixin as n}from\"./LayerView2D.js\";import p from\"./graphics/GraphicContainer.js\";import c from\"./graphics/GraphicsView2D.js\";import l from\"../../layers/LayerView.js\";const u=\"sublayers\",d=\"layerView\",f=Object.freeze({remove(){},pause(){},resume(){}});let g=class extends(n(l)){async fetchPopupFeatures(e){return(await Promise.all(Array.from(this.graphicsViews(),(s=>s.searchFeatures(e).then((e=>e.filter((e=>!!e.popupTemplate)))))))).flat()}*graphicsViews(){r(this._graphicsViewsFeatureCollectionMap)?yield*this._graphicsViewsFeatureCollectionMap.keys():r(this._graphicsViews)?yield*this._graphicsViews:yield*[]}async hitTest(e,s){if(this.suspended)return null;const i=Array.from(this.graphicsViews(),(async i=>{const t=await i.hitTest(e,s);if(t){if(r(this._graphicsViewsFeatureCollectionMap)){const e=this._graphicsViewsFeatureCollectionMap.get(i);!t.popupTemplate&&e.popupTemplate&&(t.popupTemplate=e.popupTemplate)}return t}return null}));return(await Promise.all(i)).filter((e=>!!e))[0]||null}highlight(e){let r;if(\"number\"==typeof e?r=[e]:e instanceof s?r=[e.uid]:Array.isArray(e)&&e.length>0?r=\"number\"==typeof e[0]?e:e.map((e=>e&&e.uid)):i.isCollection(e)&&(r=e.map((e=>e&&e.uid)).toArray()),r=r.filter((e=>null!=e)),!r.length)return f;for(const s of this.graphicsViews())s.addHighlight(r);return{remove:()=>{for(const e of this.graphicsViews())e.removeHighlight(r)}}}update(e){for(const s of this.graphicsViews())s.processUpdate(e)}attach(){const e=this.view,s=()=>this.requestUpdate(),i=this.layer.featureCollections;if(r(i)&&i.length){this._graphicsViewsFeatureCollectionMap=new Map;for(const r of i){const i=new p(this.view.featuresTilingScheme);i.fadeTransitionEnabled=!0;const t=new c({view:e,graphics:r.source,renderer:r.renderer,requestUpdateCallback:s,container:i});this._graphicsViewsFeatureCollectionMap.set(t,r),this.container.addChild(t.container),this.handles.add([a(r,\"visible\",(e=>t.container.visible=e)),a(t,\"updating\",(()=>this.notifyChange(\"updating\")))],d)}}else r(this.layer.sublayers)&&this.handles.add(o(this.layer,\"sublayers\",\"change\",(()=>this._createGraphicsViews()),(()=>this._createGraphicsViews()),(()=>this._destroyGraphicsViews())),u)}detach(){this._destroyGraphicsViews(),this.handles.remove(u)}moveStart(){}moveEnd(){}viewChange(){for(const e of this.graphicsViews())e.viewChange()}isUpdating(){for(const e of this.graphicsViews())if(e.updating)return!0;return!1}_destroyGraphicsViews(){this.container.removeAllChildren(),this.handles.remove(d);for(const e of this.graphicsViews())e.destroy();this._graphicsViews=null,this._graphicsViewsFeatureCollectionMap=null}_createGraphicsViews(){if(this._destroyGraphicsViews(),t(this.layer.sublayers))return;const e=[],s=this.view,i=()=>this.requestUpdate();for(const r of this.layer.sublayers){const t=new p(this.view.featuresTilingScheme);t.fadeTransitionEnabled=!0;const o=new c({view:s,graphics:r.graphics,requestUpdateCallback:i,container:t});this.handles.add([r.on(\"graphic-update\",o.graphicUpdateHandler),a(r,\"visible\",(e=>o.container.visible=e)),a(o,\"updating\",(()=>this.notifyChange(\"updating\")))],d),this.container.addChild(o.container),e.push(o)}this._graphicsViews=e}};g=e([h(\"esri.views.2d.layers.MapNotesLayerView2D\")],g);var w=g;export{w as default};\n"],"names":["u","d","f","Object","freeze","remove","pause","resume","g","n","l","e2","Promise","all","Array","from","this","graphicsViews","s","searchFeatures","then","e3","filter","e4","popupTemplate","flat","_graphicsViewsFeatureCollectionMap","keys","r","_graphicsViews","suspended","i2","async","i3","t2","hitTest","get","highlight","r2","uid","isArray","length","map","i","isCollection","toArray","addHighlight","removeHighlight","update","processUpdate","attach","view","requestUpdate","layer","featureCollections","Map","p","featuresTilingScheme","fadeTransitionEnabled","c","graphics","source","renderer","requestUpdateCallback","container","set","addChild","handles","add","a","visible","notifyChange","sublayers","o","_createGraphicsViews","_destroyGraphicsViews","detach","moveStart","moveEnd","viewChange","isUpdating","updating","removeAllChildren","destroy","t","on","graphicUpdateHandler","push","e","h","w"],"mappings":"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"}