{"version":3,"file":"Container.f525a10f.js","sources":["../../node_modules/@arcgis/core/layers/effects/EffectList.js","../../node_modules/@arcgis/core/views/2d/engine/Container.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{getNamedColor as e}from\"../../colorUtils.js\";import t from\"../../core/Error.js\";import{clone as s}from\"../../core/lang.js\";import r from\"../../core/Logger.js\";import{BloomEffect as n,DropShadowEffect as f,BlurEffect as c,HueRotateEffect as i,OpacityEffect as l,ColorMatrixEffect as o}from\"./effects.js\";import{parse as a}from\"./parser.js\";const h=-1;class u{constructor(e=200){this.duration=e,this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this._effect=\"\",this._effects=[],this._scale=0}get effect(){return this._effect}set effect(e){if(e=e||\"\",this._effect===e)return;this._effect=e;const t=_(e);Array.isArray(t)?this._transitionTo(t):(this._transitionTo([]),r.getLogger(\"esri.views.layers.effects.EffectList\").warn(\"Invalid Effect\",{effect:e,error:t}))}get hasEffects(){return this.transitioning||!!this._effects.length}get effects(){return this._effects}get scale(){return this._scale}get transitioning(){return null!==this._to}transitionStep(e,t){this._applyTimeTransition(e),this._updateForScale(t)}_transitionTo(e){this.scale>0&&d(this._current,e,this.scale)?(this._final=e,this._to=s(e),y(this._current,this._to,this.scale),this._from=s(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=e),this._effects=this._current[0]?s(this._current[0].effects):[]}_applyTimeTransition(e){if(!this._to)return;this._time+=e;const t=Math.min(1,this._time/this.duration);for(let s=0;s<this._current.length;s++){const e=this._current[s],r=this._from[s],n=this._to[s];e.scale=w(r.scale,n.scale,t);for(let s=0;s<e.effects.length;s++){const f=e.effects[s],c=r.effects[s],i=n.effects[s];f.interpolate(c,i,t)}}1===t&&(this._current=this._final,this._effects=this._current[0]?s(this._current[0].effects):[],this._from=this._to=this._final=null)}_updateForScale(e){if(0===this._current.length)return;this._scale=e;const t=this._current,s=this._current.length-1;let r,n,f=1;if(1===t.length||e>=t[0].scale)n=r=t[0].effects;else if(e<=t[s].scale)n=r=t[s].effects;else for(let c=0;c<s;c++){const s=t[c],i=t[c+1];if(s.scale>=e&&i.scale<=e){f=(e-s.scale)/(i.scale-s.scale),r=s.effects,n=i.effects;break}}for(let c=0;c<this._effects.length;c++){this._effects[c].interpolate(r[c],n[c],f)}}}function _(e){if(!e)return[];if(\"string\"==typeof e){const t=a(e);return t.error?t.error:[{scale:h,effects:t.effects}]}const s=[];for(const r of e){if(!isFinite(r.scale)||r.scale<=0)return new t(\"effect:invalid-scale\",\"scale must be finite and greater than 0\",{stop:r});const e=a(r.value);if(e.error)return e.error;s.push({scale:r.scale,effects:e.effects})}s.sort(((e,t)=>t.effects.length-e.effects.length));for(let r=0;r<s.length-1;r++){if(!p(s[r].effects,s[r+1].effects))return new t(\"effect:interpolation-impossible\",\"Cannot interpolate by scale between 2 lists of mixed effects\",{a:s[r].effects,b:s[r+1].effects});m(s[r].effects,s[r+1].effects)}return s.sort(((e,t)=>t.scale-e.scale)),s}function g(t){switch(t.type){case\"grayscale\":case\"sepia\":case\"invert\":return new o(t.type,0);case\"saturate\":case\"brightness\":case\"contrast\":return new o(t.type,1);case\"opacity\":return new l(1);case\"hue-rotate\":return new i(0);case\"blur\":return new c(0);case\"drop-shadow\":return new f(0,0,0,[...e(\"transparent\")]);case\"bloom\":return new n(0,0,0)}}function p(e,t){const s=e.length>t.length?e:t;return(e.length>t.length?t:e).every(((e,t)=>e.type===s[t].type))}function m(e,t){const s=e.length>t.length?e:t,r=e.length>t.length?t:e;for(let n=r.length;n<s.length;n++)r.push(g(s[n]))}function d(e,t,s){var r,n,f,c;if(null==(r=e[0])||!r.effects||null==(n=t[0])||!n.effects)return!0;return!(((null==(f=e[0])?void 0:f.scale)===h||(null==(c=t[0])?void 0:c.scale)===h)&&(e.length>1||t.length>1)&&s<=0)&&p(e[0].effects,t[0].effects)}function y(e,t,s){var r,n;const f=e.length>t.length?e:t,c=e.length>t.length?t:e,i=c[c.length-1],l=null!=(r=null==i?void 0:i.scale)?r:s,o=null!=(n=null==i?void 0:i.effects)?n:[];for(let a=c.length;a<f.length;a++)c.push({scale:l,effects:[...o]});for(let a=0;a<f.length;a++)c[a].scale=c[a].scale===h?s:c[a].scale,f[a].scale=f[a].scale===h?s:f[a].scale,m(c[a].effects,f[a].effects)}function w(e,t,s){return e+(t-e)*s}export{d as canInterpolateEffectStops,p as canInterpolateEffects,_ as convertEffectToStops,u as default,y as normalizeEffectStops,m as normalizeEffects};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport e from\"../../../core/has.js\";import{c as t}from\"../../../chunks/mat3f32.js\";import s from\"../../../layers/effects/EffectList.js\";import{DisplayObject as i}from\"./DisplayObject.js\";const r=e(\"mapview-transitions-duration\");class n extends i{constructor(){super(...arguments),this._childrenSet=new Set,this._needsSort=!1,this.children=[],this._effectList=null}get blendMode(){return this._blendMode}set blendMode(e){this._blendMode=e,this.requestRender()}get clips(){return this._clips}set clips(e){this._clips=e,this.children.forEach((t=>t.clips=e))}get computedEffects(){var e,t;return null!=(e=null==(t=this._effectList)?void 0:t.effects)?e:null}get effect(){var e,t;return null!=(e=null==(t=this._effectList)?void 0:t.effect)?e:\"\"}set effect(e){(this._effectList||e)&&(this._effectList||(this._effectList=new s(r)),this._effectList.effect=e,this.requestRender())}updateTransitionProperties(e,t){super.updateTransitionProperties(e,t),this._effectList&&(this._effectList.transitionStep(e,t),this._effectList.transitioning&&this.requestRender())}doRender(e){const t=this.createRenderParams(e);this.renderChildren(t)}addChild(e){return this.addChildAt(e,this.children.length)}addChildAt(e,t=this.children.length){if(!e)return e;if(this.contains(e))return e;this._needsSort=!0;const s=e.parent;return s&&s!==this&&s.removeChild(e),t>=this.children.length?this.children.push(e):this.children.splice(t,0,e),this._childrenSet.add(e),e.parent=this,e.stage=this.stage,this!==this.stage&&(e.clips=this.clips),this.requestRender(),e}contains(e){return this._childrenSet.has(e)}removeAllChildren(){this._childrenSet.clear(),this._needsSort=!0;for(const e of this.children)this!==this.stage&&(e.clips=null),e.stage=null,e.parent=null;this.children.length=0}removeChild(e){return this.contains(e)?this.removeChildAt(this.children.indexOf(e)):e}removeChildAt(e){if(e<0||e>=this.children.length)return null;this._needsSort=!0;const t=this.children.splice(e,1)[0];return this._childrenSet.delete(t),this!==this.stage&&(t.clips=null),t.stage=null,t.parent=null,t}sortChildren(e){this._needsSort&&(this.children.sort(e),this._needsSort=!1)}_createTransforms(){return{dvs:t()}}onAttach(){super.onAttach();const e=this.stage;for(const t of this.children)t.stage=e}onDetach(){super.onDetach();for(const e of this.children)e.stage=null}renderChildren(e){for(const t of this.children)t.beforeRender(e);for(const t of this.children)t.processRender(e);for(const t of this.children)t.afterRender(e)}createRenderParams(e){return{...e,blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:e.globalOpacity*this.computedOpacity,inFadeTransition:this.inFadeTransition}}}export{n as Container};\n"],"names":["h","constructor","e","duration","this","_from","_to","_final","_current","_time","_effect","_effects","_scale","t","a","error","scale","effects","s2","r2","isFinite","stop","e2","value","push","sort","length","p","b","_","isArray","_transitionTo","r","getLogger","warn","effect","transitioning","transitionStep","_applyTimeTransition","_updateForScale","n2","f2","c2","d","s","i","l2","o","a2","m","y","Math","min","w","s3","interpolate","type","l","c","f","n","every","t2","g","arguments","_childrenSet","Set","_needsSort","children","_effectList","_blendMode","requestRender","_clips","forEach","clips","updateTransitionProperties","doRender","createRenderParams","renderChildren","addChild","addChildAt","contains","parent","removeChild","splice","add","stage","has","removeAllChildren","clear","removeChildAt","indexOf","delete","sortChildren","_createTransforms","dvs","onAttach","onDetach","beforeRender","processRender","afterRender","blendMode","computedEffects","globalOpacity","computedOpacity","inFadeTransition"],"mappings":"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"}