{"version":3,"file":"TileLayer.ee6a175d.js","sources":["../../node_modules/@arcgis/core/layers/TileLayer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import\"../geometry.js\";import r from\"../request.js\";import t from\"../core/Error.js\";import{HandleOwnerMixin as s}from\"../core/HandleOwner.js\";import{isSome as i}from\"../core/maybe.js\";import{MultiOriginJSONMixin as o}from\"../core/MultiOriginJSONSupport.js\";import{throwIfAbortError as a}from\"../core/promiseUtils.js\";import{urlToObject as l,objectToQuery as n,makeAbsolute as p}from\"../core/urlUtils.js\";import{property as c}from\"../core/accessorSupport/decorators/property.js\";import\"../core/has.js\";import{cast as u}from\"../core/accessorSupport/decorators/cast.js\";import\"../core/Logger.js\";import{reader as m}from\"../core/accessorSupport/decorators/reader.js\";import{subclass as h}from\"../core/accessorSupport/decorators/subclass.js\";import{writer as d}from\"../core/accessorSupport/decorators/writer.js\";import y from\"./Layer.js\";import{APIKeyMixin as f}from\"./mixins/APIKeyMixin.js\";import{ArcGISCachedService as v}from\"./mixins/ArcGISCachedService.js\";import{ArcGISMapService as g}from\"./mixins/ArcGISMapService.js\";import{ArcGISService as S}from\"./mixins/ArcGISService.js\";import{BlendLayer as _}from\"./mixins/BlendLayer.js\";import{CustomParametersMixin as j}from\"./mixins/CustomParametersMixin.js\";import{OperationalLayer as b}from\"./mixins/OperationalLayer.js\";import{PortalLayer as T}from\"./mixins/PortalLayer.js\";import{RefreshableLayer as w}from\"./mixins/RefreshableLayer.js\";import{ScaleRangeLayer as O}from\"./mixins/ScaleRangeLayer.js\";import{SublayersOwner as L}from\"./mixins/SublayersOwner.js\";import{parse as R,isHostedAgolService as x,isArcGISUrl as P}from\"./support/arcgisLayerUrl.js\";import{url as U}from\"./support/commonProperties.js\";import A from\"./support/Sublayer.js\";import W from\"../geometry/SpatialReference.js\";const I=[\"Canvas/World_Dark_Gray_Base\",\"Canvas/World_Dark_Gray_Reference\",\"Canvas/World_Light_Gray_Base\",\"Canvas/World_Light_Gray_Reference\",\"Elevation/World_Hillshade\",\"Elevation/World_Hillshade_Dark\",\"Ocean/World_Ocean_Base\",\"Ocean/World_Ocean_Reference\",\"Ocean_Basemap\",\"Reference/World_Boundaries_and_Places\",\"Reference/World_Boundaries_and_Places_Alternate\",\"Reference/World_Transportation\",\"World_Imagery\",\"World_Street_Map\",\"World_Topo_Map\"];let M=class extends(_(L(O(b(T(v(g(S(o(s(w(f(j(y)))))))))))))){constructor(...e){super(...e),this.listMode=\"show\",this.isReference=null,this.operationalLayerType=\"ArcGISTiledMapServiceLayer\",this.resampling=!0,this.sourceJSON=null,this.spatialReference=null,this.path=null,this.sublayers=null,this.type=\"tile\",this.url=null}normalizeCtorArgs(e,r){return\"string\"==typeof e?{url:e,...r}:e}load(e){const r=i(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:[\"Map Service\"]},e).catch(a).then((()=>this._fetchService(r)))),Promise.resolve(this)}get attributionDataUrl(){var e;const r=null==(e=this.parsedUrl)?void 0:e.path.toLowerCase();return r&&this._getDefaultAttribution(this._getMapName(r))}readSpatialReference(e,r){return(e=e||r.tileInfo&&r.tileInfo.spatialReference)&&W.fromJSON(e)}writeSublayers(e,r,t,s){if(!this.loaded||!e)return;const i=e.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).toArray(),o=[],a={writeSublayerStructure:!1,...s};i.forEach((e=>{const r=e.write({},a);o.push(r)}));o.some((e=>Object.keys(e).length>1))&&(r.layers=o)}get tileServers(){return this._getDefaultTileServers(this.parsedUrl.path)}castTileServers(e){return Array.isArray(e)?e.map((e=>l(e).path)):null}fetchTile(e,t,s,i={}){const{signal:o}=i,a=this.getTileUrl(e,t,s),l={responseType:\"image\",signal:o,query:{...this.refreshParameters}};return r(a,l).then((e=>e.data))}getTileUrl(e,r,t){const s=!this.tilemapCache&&this.supportsBlankTile,i=n({...this.parsedUrl.query,blankTile:!s&&null,...this.customParameters,token:this.apiKey}),o=this.tileServers;return`${o&&o.length?o[r%o.length]:this.parsedUrl.path}/tile/${e}/${r}/${t}${i?\"?\"+i:\"\"}`}_fetchService(e){return new Promise(((s,o)=>{if(this.sourceJSON){if(null!=this.sourceJSON.bandCount&&null!=this.sourceJSON.pixelSizeX)throw new t(\"tile-layer:unsupported-url\",\"use ImageryTileLayer to open a tiled image service\");return void s({data:this.sourceJSON})}if(!this.parsedUrl)throw new t(\"tile-layer:undefined-url\",\"layer's url is not defined\");const a=R(this.parsedUrl.path);if(i(a)&&\"ImageServer\"===a.serverType)throw new t(\"tile-layer:unsupported-url\",\"use ImageryTileLayer to open a tiled image service\");r(this.parsedUrl.path,{query:{f:\"json\",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},responseType:\"json\",signal:e}).then(s,o)})).then((r=>{if(r.ssl&&(this.url=this.url.replace(/^http:/i,\"https:\")),this.sourceJSON=r.data,this.read(r.data,{origin:\"service\",url:this.parsedUrl}),10.1===this.version&&!x(this.url))return this._fetchServerVersion(this.url,e).then((e=>{this.read({currentVersion:e})})).catch((()=>{}))}))}_fetchServerVersion(e,s){if(!P(e))return Promise.reject();const i=e.replace(/(.*\\/rest)\\/.*/i,\"$1\")+\"/info\";return r(i,{query:{f:\"json\",...this.customParameters,token:this.apiKey},responseType:\"json\",signal:s}).then((e=>{if(e.data&&e.data.currentVersion)return e.data.currentVersion;throw new t(\"tile-layer:version-not-available\")}))}_getMapName(e){const r=e.match(/^(?:https?:)?\\/\\/(server\\.arcgisonline\\.com|services\\.arcgisonline\\.com|ibasemaps-api\\.arcgis\\.com)\\/arcgis\\/rest\\/services\\/([^\\/]+(\\/[^\\/]+)*)\\/mapserver/i);return r&&r[2]}_getDefaultAttribution(e){if(!e)return;let r;e=e.toLowerCase();for(let t=0,s=I.length;t<s;t++)if(r=I[t],r.toLowerCase().indexOf(e)>-1)return p(\"//static.arcgis.com/attribution/\"+r)}_getDefaultTileServers(e){const r=-1!==e.search(/^(?:https?:)?\\/\\/server\\.arcgisonline\\.com/i),t=-1!==e.search(/^(?:https?:)?\\/\\/services\\.arcgisonline\\.com/i);return r||t?[e,e.replace(r?/server\\.arcgisonline/i:/services\\.arcgisonline/i,r?\"services.arcgisonline\":\"server.arcgisonline\")]:[]}get hasOverriddenFetchTile(){return!this.fetchTile.__isDefault__}};e([c({readOnly:!0})],M.prototype,\"attributionDataUrl\",null),e([c({type:[\"show\",\"hide\",\"hide-children\"]})],M.prototype,\"listMode\",void 0),e([c({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],M.prototype,\"isReference\",void 0),e([c({readOnly:!0,type:[\"ArcGISTiledMapServiceLayer\"]})],M.prototype,\"operationalLayerType\",void 0),e([c({type:Boolean})],M.prototype,\"resampling\",void 0),e([c()],M.prototype,\"sourceJSON\",void 0),e([c({type:W})],M.prototype,\"spatialReference\",void 0),e([m(\"spatialReference\",[\"spatialReference\",\"tileInfo\"])],M.prototype,\"readSpatialReference\",null),e([c({type:String,json:{origins:{\"web-scene\":{read:!0,write:!0}},read:!1}})],M.prototype,\"path\",void 0),e([c({readOnly:!0})],M.prototype,\"sublayers\",void 0),e([d(\"sublayers\",{layers:{type:[A]}})],M.prototype,\"writeSublayers\",null),e([c({json:{read:!1,write:!1}})],M.prototype,\"popupEnabled\",void 0),e([c()],M.prototype,\"tileServers\",null),e([u(\"tileServers\")],M.prototype,\"castTileServers\",null),e([c({readOnly:!0,json:{read:!1}})],M.prototype,\"type\",void 0),e([c(U)],M.prototype,\"url\",void 0),M=e([h(\"esri.layers.TileLayer\")],M),M.prototype.fetchTile.__isDefault__=!0;var C=M;export{C as default};\n"],"names":["I","M","_","L","O","b","T","v","g","S","o","s","w","f","j","y","constructor","e2","this","listMode","isReference","operationalLayerType","resampling","sourceJSON","spatialReference","path","sublayers","type","url","normalizeCtorArgs","r2","__spreadValues","load","r","i","signal","addResolvingPromise","loadFromPortal","supportedTypes","catch","a","then","_fetchService","Promise","resolve","parsedUrl","toLowerCase","_getDefaultAttribution","_getMapName","readSpatialReference","tileInfo","W","fromJSON","writeSublayers","t","s2","loaded","i2","slice","reverse","flatten","e3","toArray","o2","a2","writeSublayerStructure","forEach","r3","write","push","some","Object","keys","length","layers","_getDefaultTileServers","castTileServers","Array","isArray","map","l","fetchTile","getTileUrl","l2","responseType","query","refreshParameters","data","tilemapCache","supportsBlankTile","n","__spreadProps","blankTile","customParameters","token","apiKey","tileServers","bandCount","pixelSizeX","R","serverType","ssl","replace","read","origin","version","x","_fetchServerVersion","currentVersion","P","reject","match","indexOf","p","search","__isDefault__","e","c","readOnly","prototype","Boolean","json","enabled","overridePolicy","m","String","origins","d","A","u","U","h","C"],"mappings":"q2BAIsvD,MAAMA,EAAE,CAAC,8BAA8B,mCAAmC,+BAA+B,oCAAoC,4BAA4B,iCAAiC,yBAAyB,8BAA8B,gBAAgB,wCAAwC,kDAAkD,iCAAiC,gBAAgB,mBAAmB,kBAAkB,IAAIC,EAAE,cAAcC,EAAEC,EAAEC,EAAEC,EAAEC,EAAEC,EAAEC,EAAEC,EAAEC,EAAEC,EAAEC,EAAEC,EAAEC,EAAEC,gBAAgBC,eAAeC,YAAYA,GAAGC,KAAKC,SAAS,OAAOD,KAAKE,YAAY,KAAKF,KAAKG,qBAAqB,6BAA6BH,KAAKI,YAAW,EAAGJ,KAAKK,WAAW,KAAKL,KAAKM,iBAAiB,KAAKN,KAAKO,KAAK,KAAKP,KAAKQ,UAAU,KAAKR,KAAKS,KAAK,OAAOT,KAAKU,IAAI,KAAKC,kBAAkBZ,EAAEa,SAAS,iBAAiBb,EAAEc,GAACH,IAAIX,GAAKa,GAAGb,EAAEe,KAAKf,SAASgB,EAAEC,EAAEjB,GAAGA,EAAEkB,OAAO,YAAYjB,KAAKkB,oBAAoBlB,KAAKmB,eAAe,CAACC,eAAe,CAAC,gBAAgBrB,GAAGsB,MAAMC,GAAGC,MAAM,IAAIvB,KAAKwB,cAAcT,MAAMU,QAAQC,QAAQ1B,mCAAmCD,QAAQa,EAAE,SAASZ,KAAK2B,gBAAW,EAAO5B,EAAEQ,KAAKqB,qBAAqBhB,GAAGZ,KAAK6B,uBAAuB7B,KAAK8B,YAAYlB,IAAImB,qBAAqBhC,EAAEa,YAAYb,GAAGa,EAAEoB,UAAUpB,EAAEoB,SAAS1B,mBAAmB2B,EAAEC,SAASnC,GAAGoC,eAAepC,EAAEa,EAAEwB,EAAEC,OAAOrC,KAAKsC,SAASvC,eAAewC,EAAExC,EAAEyC,QAAQC,UAAUC,SAAS,EAAElC,UAAUmC,KAAKA,GAAGA,EAAEC,UAAUH,YAAYG,UAAUC,EAAE,GAAGC,EAAEjC,GAACkC,wBAAuB,GAAMV,KAAKW,mBAAmBC,EAAEN,EAAEO,MAAM,GAAGJ,KAAKK,KAAKF,QAAQG,SAASC,OAAOC,KAAKX,GAAGY,OAAO,QAAQC,OAAOX,4BAA4B7C,KAAKyD,uBAAuBzD,KAAK2B,UAAUpB,MAAMmD,gBAAgB3D,UAAU4D,MAAMC,QAAQ7D,GAAGA,EAAE8D,QAAQC,EAAEnB,GAAGpC,OAAO,KAAKwD,UAAUhE,EAAEqC,EAAEC,EAAEE,EAAE,UAAUtB,OAAO4B,GAAGN,EAAEO,EAAE9C,KAAKgE,WAAWjE,EAAEqC,EAAEC,GAAG4B,EAAE,CAACC,aAAa,QAAQjD,OAAO4B,EAAEsB,MAAMtD,KAAIb,KAAKoE,2BAA2BrD,EAAE+B,EAAEmB,GAAG1C,SAASoB,EAAE0B,OAAOL,WAAWjE,EAAEa,EAAEwB,SAASC,GAAGrC,KAAKsE,cAActE,KAAKuE,kBAAkBhC,EAAEiC,EAAEC,WAAIzE,KAAK2B,UAAUwC,OAAnB,CAAyBO,WAAWrC,GAAG,OAAQrC,KAAK2E,kBAApD,CAAqEC,MAAM5E,KAAK6E,UAAShC,EAAE7C,KAAK8E,kBAAkB,GAAGjC,GAAGA,EAAEU,OAAOV,EAAEjC,EAAEiC,EAAEU,QAAQvD,KAAK2B,UAAUpB,aAAaR,KAAKa,KAAKwB,IAAIG,EAAE,IAAIA,EAAE,KAAKf,cAAczB,UAAU,IAAI0B,SAAS,CAACY,EAAEQ,QAAQ7C,KAAKK,WAAW,IAAI,MAAML,KAAKK,WAAW0E,WAAW,MAAA/E,KAAWK,WAAW2E,iBAAiB,IAAI5C,EAAE,6BAA6B,kEAAkEC,EAAE,CAACgC,KAAKrE,KAAKK,iBAAiBL,KAAK2B,gBAAgB,IAAIS,EAAE,2BAA2B,oCAAoCU,EAAEmC,EAAEjF,KAAK2B,UAAUpB,SAASS,EAAE8B,IAAI,gBAAAA,EAAkBoC,iBAAiB,IAAI9C,EAAE,6BAA6B,wDAAwDpC,KAAK2B,UAAUpB,KAAK,CAAC4D,MAAMM,OAAC9E,EAAE,QAAUK,KAAK2B,UAAUwC,OAASnE,KAAK2E,kBAA1C,CAA2DC,MAAM5E,KAAK6E,SAAQX,aAAa,OAAOjD,OAAOlB,IAAIwB,KAAKc,EAAEQ,MAAMtB,aAAaX,EAAEuE,WAAWzE,IAAIV,KAAKU,IAAI0E,QAAQ,UAAU,WAAWpF,KAAKK,WAAWO,EAAEyD,KAAKrE,KAAKqF,KAAKzE,EAAEyD,KAAK,CAACiB,OAAO,UAAU5E,IAAIV,KAAK2B,YAAY,OAAO3B,KAAKuF,UAAUC,EAAExF,KAAKU,YAAYV,KAAKyF,oBAAoBzF,KAAKU,IAAIX,GAAGwB,eAAe8D,KAAK,CAACK,eAAe/C,OAAOtB,OAAO,YAAYoE,oBAAoB1F,EAAEsC,OAAOsD,EAAE5F,UAAU0B,QAAQmE,eAAerD,EAAExC,EAAEqF,QAAQ,kBAAkB,MAAM,eAAerE,EAAEwB,EAAE,CAAC4B,MAAMM,KAAC9E,EAAE,QAAUK,KAAK2E,kBAAlB,CAAmCC,MAAM5E,KAAK6E,SAAQX,aAAa,OAAOjD,OAAOoB,IAAId,aAAaoB,EAAE0B,MAAM1B,EAAE0B,KAAKqB,sBAAsB/C,EAAE0B,KAAKqB,qBAAqB,IAAItD,EAAE,uCAAuCN,YAAY/B,SAASa,EAAEb,EAAE8F,MAAM,uKAAuKjF,GAAGA,EAAE,GAAGiB,uBAAuB9B,OAAOA,aAAaa,IAAIb,EAAE6B,sBAAsBQ,EAAE,EAAEC,EAAEvD,EAAEyE,OAAOnB,EAAEC,EAAED,OAAOxB,EAAE9B,EAAEsD,GAAGxB,EAAEgB,cAAckE,QAAQ/F,aAAagG,EAAE,mCAAmCnF,GAAG6C,uBAAuB1D,SAASa,OAAEb,EAAOiG,OAAO,+CAA+C5D,OAAOrC,EAAEiG,OAAO,wDAAwDpF,GAAGwB,EAAE,CAACrC,EAAEA,EAAEqF,QAAQxE,EAAE,wBAAwB,0BAA0BA,EAAE,wBAAwB,wBAAwB,uCAAuCZ,KAAK+D,UAAUkC,gBAAgBC,EAAE,CAACC,EAAE,CAACC,UAAS,KAAMrH,EAAEsH,UAAU,qBAAqB,MAAMH,EAAE,CAACC,EAAE,CAAC1F,KAAK,CAAC,OAAO,OAAO,oBAAoB1B,EAAEsH,UAAU,gBAAW,GAAQH,EAAE,CAACC,EAAE,CAAC1F,KAAK6F,QAAQC,KAAK,CAAClB,MAAK,EAAGnC,MAAM,CAACsD,SAAQ,EAAGC,eAAe,KAAK,CAACD,SAAQ,SAAUzH,EAAEsH,UAAU,mBAAc,GAAQH,EAAE,CAACC,EAAE,CAACC,UAAS,EAAG3F,KAAK,CAAC,iCAAiC1B,EAAEsH,UAAU,4BAAuB,GAAQH,EAAE,CAACC,EAAE,CAAC1F,KAAK6F,WAAWvH,EAAEsH,UAAU,kBAAa,GAAQH,EAAE,CAACC,KAAKpH,EAAEsH,UAAU,kBAAa,GAAQH,EAAE,CAACC,EAAE,CAAC1F,KAAKwB,KAAKlD,EAAEsH,UAAU,wBAAmB,GAAQH,EAAE,CAACQ,EAAE,mBAAmB,CAAC,mBAAmB,cAAc3H,EAAEsH,UAAU,uBAAuB,MAAMH,EAAE,CAACC,EAAE,CAAC1F,KAAKkG,OAAOJ,KAAK,CAACK,QAAQ,CAAC,YAAY,CAACvB,MAAK,EAAGnC,OAAM,IAAKmC,MAAK,MAAOtG,EAAEsH,UAAU,YAAO,GAAQH,EAAE,CAACC,EAAE,CAACC,UAAS,KAAMrH,EAAEsH,UAAU,iBAAY,GAAQH,EAAE,CAACW,EAAE,YAAY,CAACrD,OAAO,CAAC/C,KAAK,CAACqG,OAAO/H,EAAEsH,UAAU,iBAAiB,MAAMH,EAAE,CAACC,EAAE,CAACI,KAAK,CAAClB,MAAK,EAAGnC,OAAM,MAAOnE,EAAEsH,UAAU,oBAAe,GAAQH,EAAE,CAACC,KAAKpH,EAAEsH,UAAU,cAAc,MAAMH,EAAE,CAACa,EAAE,gBAAgBhI,EAAEsH,UAAU,kBAAkB,MAAMH,EAAE,CAACC,EAAE,CAACC,UAAS,EAAGG,KAAK,CAAClB,MAAK,MAAOtG,EAAEsH,UAAU,YAAO,GAAQH,EAAE,CAACC,EAAEa,IAAIjI,EAAEsH,UAAU,WAAM,GAAQtH,EAAEmH,EAAE,CAACe,EAAE,0BAA0BlI,GAAGA,EAAEsH,UAAUtC,UAAUkC,eAAc,EAAM,IAACiB,EAAEnI"}