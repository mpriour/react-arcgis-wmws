{"version":3,"file":"previewSymbol2D.a4fac893.js","sources":["../../node_modules/@arcgis/core/symbols/support/previewSymbol2D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport e from\"../../Color.js\";import t from\"../../core/Error.js\";import{pt2px as a,px2pt as l}from\"../../core/screenUtils.js\";import{getFill as n,getStroke as o,getPatternUrlWithColor as s}from\"./gfxUtils.js\";import{shapes as i,adjustColorBrightness as r}from\"./previewUtils.js\";import{renderSymbol as c}from\"./renderUtils.js\";const m=\"picture-fill\",u=\"picture-marker\",p=\"simple-fill\",h=\"simple-line\",d=\"simple-marker\",f=\"text\",v=\"Aa\",y=22,g=120,w=80,M=40,b=document.createElement(\"canvas\");function x(e,t){const a=b.getContext(\"2d\"),l=[];return t&&(t.weight&&l.push(t.weight),t.size&&l.push(t.size+\"px\"),t.family&&l.push(t.family)),a.font=l.join(\" \"),a.measureText(e).width}const k=7.2/2.54,L=72/2.54;function z(e){if(0===e.length)return 0;if(e.length>2){const t=l(1),a=parseFloat(e);switch(e.slice(-2)){case\"px\":return a;case\"pt\":return a*t;case\"in\":return 72*a*t;case\"pc\":return 12*a*t;case\"mm\":return a*k*t;case\"cm\":return a*L*t}}return parseFloat(e)}function j(l,b){var k,L;const j=null!=(null==b?void 0:b.size)?a(b.size):null,C=null!=(null==b?void 0:b.maxSize)?a(b.maxSize):null,F=null!=(null==b?void 0:b.opacity)?b.opacity:null,S=null!=(null==b?void 0:b.rotation)?b.rotation:\"angle\"in l?l.angle:null,E=n(l);let P=o(l);if(E&&!P){const t=\"type\"in E?null:new e(E);\"#ffffff\"===(t?t.toHex():null)&&(P={color:\"#bdc3c7\",width:.75})}const U={shape:null,fill:null,stroke:P,offset:[0,0]};null!=(k=P)&&k.width&&(P.width=Math.min(P.width,w));const q=(null==(L=P)?void 0:L.width)||0;let Z=null!=j&&(null==(null==b?void 0:b.scale)||(null==b?void 0:b.scale)),H=0,T=0,A=!1;switch(l.type){case d:{const e=l.style,t=Math.min(null!=j?j:a(l.size),C||g);switch(H=t,T=t,e){case\"circle\":U.shape={type:\"circle\",cx:0,cy:0,r:.5*t},Z||(H+=q,T+=q);break;case\"cross\":U.shape={type:\"path\",path:[{command:\"M\",values:[0,.5*T]},{command:\"L\",values:[H,.5*T]},{command:\"M\",values:[.5*H,0]},{command:\"L\",values:[.5*H,T]}]};break;case\"diamond\":U.shape={type:\"path\",path:[{command:\"M\",values:[0,.5*T]},{command:\"L\",values:[.5*H,0]},{command:\"L\",values:[H,.5*T]},{command:\"L\",values:[.5*H,T]},{command:\"Z\",values:[]}]},Z||(H+=q,T+=q);break;case\"square\":U.shape={type:\"path\",path:[{command:\"M\",values:[0,0]},{command:\"L\",values:[H,0]},{command:\"L\",values:[H,T]},{command:\"L\",values:[0,T]},{command:\"Z\",values:[]}]},Z||(H+=q,T+=q),S&&(A=!0);break;case\"triangle\":U.shape={type:\"path\",path:[{command:\"M\",values:[.5*H,0]},{command:\"L\",values:[H,T]},{command:\"L\",values:[0,T]},{command:\"Z\",values:[]}]},Z||(H+=q,T+=q),S&&(A=!0);break;case\"x\":U.shape={type:\"path\",path:[{command:\"M\",values:[0,0]},{command:\"L\",values:[H,T]},{command:\"M\",values:[H,0]},{command:\"L\",values:[0,T]}]},S&&(A=!0);break;case\"path\":U.shape={type:\"path\",path:l.path||\"\"},Z||(H+=q,T+=q),S&&(A=!0),Z=!0}break}case h:{const e=Math.min(null!=j?j:q,C||w),t=e>y?2*e:M;P.width=e,H=t,T=e,U.shape={type:\"path\",path:[{command:\"M\",values:[0,T]},{command:\"L\",values:[H,T]}]};break}case m:case p:H=Math.min(null!=j?j:y,C||g)+q,T=H,Z=!0,U.shape=\"object\"==typeof(null==b?void 0:b.symbolConfig)&&null!=b&&b.symbolConfig.isSquareFill?i.squareFill[0]:i.fill[0];break;case u:{let e=a(l.width),t=a(l.height);const n=null!=j?j:Math.max(e,t),o=e/t;e=o<=1?Math.ceil(n*o):n,t=o<=1?n:Math.ceil(n/o),H=Math.min(e,C||g),T=Math.min(t,C||g),U.shape={type:\"image\",x:-Math.round(H/2),y:-Math.round(T/2),width:H,height:T,src:l.url||\"\"},S&&(A=!0);break}case f:{const e=l,t=e.text||v,n=e.font,o=Math.min(null!=j?j:a(n.size),C||g),s=x(t,{weight:n.weight,size:o,family:n.family}),i=/[\\uE600-\\uE6FF]/.test(t);H=i?o:s,T=o;let r=.25*z((n?o:0).toString());i&&(r+=5),U.shape={type:\"text\",text:t,x:0,y:r,align:\"middle\",decoration:n&&n.decoration,rotated:e.rotated,kerning:e.kerning},U.font=n&&{size:o,style:n.style,decoration:n.decoration,weight:n.weight,family:n.family};break}}if(!U.shape)return Promise.reject(new t(\"symbolPreview: renderPreviewHTML2D\",\"symbol not supported.\"));const D=E,R=l.color;let B=null;return D&&\"pattern\"===D.type&&R&&l.type!==m?B=s(D.src,R.toCss(!0)).then((e=>(D.src=e,U.fill=D,U))):(U.fill=E,B=Promise.resolve(U)),B.then((e=>{const t=[[e]];if(\"object\"==typeof(null==b?void 0:b.symbolConfig)&&null!=b&&b.symbolConfig.applyColorModulation){const a=.6*H;t.unshift([{...e,offset:[-a,0],fill:r(E,-.3)}]),t.push([{...e,offset:[a,0],fill:r(E,.3)}]),H+=2*a}return c(t,[H,T],{node:b&&b.node,scale:Z,opacity:F,rotation:S,useRotationSize:A})}))}export{j as previewSymbol2D};\n"],"names":["m","g","b","document","createElement","l","b2","k2","L2","j2","size","a","C","maxSize","F","opacity","S","rotation","angle","E","n","P","o","t2","e","toHex","color","width","U","shape","fill","stroke","offset","Math","min","q","Z","scale","H","T","A","type","e2","style","cx","cy","r","path","command","values","symbolConfig","isSquareFill","i","squareFill","height","max","o2","ceil","x","round","y","src","url","text","font","s2","getContext","weight","push","family","join","measureText","test","length","parseFloat","slice","z","toString","align","decoration","rotated","kerning","Promise","reject","t","D","R","B","s","toCss","then","resolve","applyColorModulation","unshift","__spreadProps","c","node","useRotationSize"],"mappings":"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"}