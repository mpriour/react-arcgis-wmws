import{ig as e,ih as t,m9 as i,jr as r,B as a,f_ as o,dd as s,de as l,D as d,M as n,F as h,G as y,j9 as c,H as p}from"./vendor.7103ff48.js";import{z as u}from"./I3SMeshView3D.281bef64.js";import"./I3SAttributeOverrides.2845d552.js";import"./I3SUtil.fa3bb0fc.js";import"./I3SBinaryReader.da331753.js";import"./SceneModification.76e9eced.js";import"./persistable.2e27d0f9.js";import"./Graphics3DScaleVisibility.1e789161.js";import"./optimizedFeatureQueryEngineAdapter.7a815640.js";import"./centroid.f07ef5b9.js";import"./PooledRBush.78e40fd7.js";import"./SceneLayerWorker.3656b416.js";import"./attributeUtils.808b8273.js";let v=class extends(u(e(t))){constructor(){super(...arguments),this.type="integrated-mesh-3d",this.lodFactor=1,this._elevationContext="im",this._isIntegratedMesh=!0,this._supportsLabeling=!1,this.drapeTargetType=1,this._overlayTexOffset=i(-1,-1,-1,-1),this._overlayTexScale=r(),this._overlayColor=null,this._overlayHighlight=null,this._overlayNormal=null}get progressiveLoadFactor(){return this.lodFactor>=1?.2:1}setDrapingTextures(e){this._clearDrapingTexture(0),this._clearDrapingTexture(1);for(const t of e){const e=t.index,i=t.extent,r=t.needsColorWithoutRasterImage?t.getValidTarget(1):t.hasDrapedFeatureSource?t.getValidTarget(0):null;if(a(r)&&o(i)>0){this._overlayTexOffset[2*e]=-i[0]/s(i),this._overlayTexOffset[2*e+1]=-i[1]/l(i),this._overlayTexScale[2*e]=1/s(i),this._overlayTexScale[2*e+1]=1/l(i);const a=t.getValidTarget(2),o=t.getValidTarget(3);this._overlayColor=r.getTexture(),this._overlayHighlight=a?a.getTexture():null,this._overlayNormal=o?o.getTexture():null}}this._forAllNodes((e=>a(e)&&this._collection.updateMaterial(e.objectHandle,(e=>this._updateMaterialOverlay(e)))))}_clearDrapingTexture(e){this._overlayTexOffset[2*e]=-1,this._overlayTexOffset[2*e+1]=-1,this._overlayTexScale[2*e]=0,this._overlayTexScale[2*e+1]=0,this._overlayColor=null,this._overlayHighlight=null,this._overlayNormal=null}_updateMaterialOverlay(e){e.overlayColor=this._overlayColor,e.overlayHighlight=this._overlayHighlight,e.overlayNormal=this._overlayNormal,e.overlayTexOffset=this._overlayTexOffset,e.overlayTexScale=this._overlayTexScale}initialize(){this.updatingHandles.add(this.layer,"modifications",(()=>this._loadModifications()),2)}_createLayerGraphic(){const e=new d;return e.layer=this.layer,e.sourceLayer=this.layer,e}canResume(){return super.canResume()&&(!this._controller||this._controller.rootNodeVisible)}_loadModifications(){if(this.handles.remove("modifications"),n(this.layer.modifications))return void(this._modifications=[]);const e=this.layer.modifications;this.handles.add(this.updatingHandles.addOnCollectionChange(e,(()=>this._modifications=e.toArray()),2),"modifications")}};h([y()],v.prototype,"layer",void 0),h([y({aliasOf:"layer"})],v.prototype,"i3slayer",void 0),h([y()],v.prototype,"suspended",void 0),h([y(c)],v.prototype,"updatingProgress",void 0),h([y({readOnly:!0,aliasOf:"_controller.updatingProgress"})],v.prototype,"updatingProgressValue",void 0),h([y({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.integratedMesh.lodFactor"})],v.prototype,"lodFactor",void 0),h([y({readOnly:!0})],v.prototype,"progressiveLoadFactor",null),v=h([p("esri.views.3d.layers.SceneLayerView3D")],v);var g=v;export{g as default};
//# sourceMappingURL=IntegratedMeshLayerView3D.a464a6e0.js.map
