{"version":3,"file":"Rasterizer.12b7ee42.js","sources":["../../node_modules/@arcgis/core/symbols/cim/Rasterizer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{SymbolHelper as e,CIMSymbolHelper as r}from\"./CIMSymbolHelper.js\";import t from\"./Rect.js\";import{getSDFInfo as a,buildSDF as n}from\"./SDFHelper.js\";import{resampleHermite as i}from\"./utils.js\";const s=512;class o{dispose(){this._rasterizationCanvas=null}rasterizeJSONResource(i,s,o){if(this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement(\"canvas\")),\"simple-fill\"===i.type||\"esriSFS\"===i.type){const[r,t,a]=e.rasterizeSimpleFill(this._rasterizationCanvas,i.style,s);return{size:[t,a],image:new Uint32Array(r.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0}}if(\"simple-line\"===i.type||\"esriSLS\"===i.type){const[r,t,a]=e.rasterizeSimpleLine(i.style,i.cap);return{size:[t,a],image:new Uint32Array(r.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}let m,l,f;if(\"simple-marker\"===i.type||\"esriSMS\"===i.type||\"line-marker\"===i.type?(m=r.fromSimpleMarker(i),f=a(m)):\"CIMHatchFill\"===i.type?(m=r.fromCIMHatchFill(i),l=new t(m.frame.xmin,-m.frame.ymax,m.frame.xmax-m.frame.xmin,m.frame.ymax-m.frame.ymin)):i.markerPlacement&&\"CIMMarkerPlacementInsidePolygon\"===i.markerPlacement.type?(m=r.fromCIMInsidePolygon(i),l=new t(m.frame.xmin,-m.frame.ymax,m.frame.xmax-m.frame.xmin,m.frame.ymax-m.frame.ymin)):(m=i,f=a(m)),f&&!o){const[e,r,t]=n(f);return e?{size:[r,t],image:new Uint32Array(e.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}:null}const[c,h,p,y,u]=r.rasterize(this._rasterizationCanvas,m,l,!o);return c?{size:[h,p],image:new Uint32Array(c.buffer),sdf:!1,simplePattern:!1,anchorX:y,anchorY:u}:null}rasterizeImageResource(e,r,t,a){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement(\"canvas\")),this._rasterizationCanvas.width=e,this._rasterizationCanvas.height=r;const n=this._rasterizationCanvas.getContext(\"2d\");t instanceof ImageData?n.putImageData(t,0,0):(t.setAttribute(\"width\",`${e}px`),t.setAttribute(\"height\",`${r}px`),n.drawImage(t,0,0,e,r));const o=n.getImageData(0,0,e,r),m=new Uint8Array(o.data);if(a)for(const i of a)if(i&&i.oldColor&&4===i.oldColor.length&&i.newColor&&4===i.newColor.length){const[e,r,t,a]=i.oldColor,[n,s,o,l]=i.newColor;if(e===n&&r===s&&t===o&&a===l)continue;for(let i=0;i<m.length;i+=4)e===m[i]&&r===m[i+1]&&t===m[i+2]&&a===m[i+3]&&(m[i]=n,m[i+1]=s,m[i+2]=o,m[i+3]=l)}let l;for(let i=0;i<m.length;i+=4)l=m[i+3]/255,m[i]=m[i]*l,m[i+1]=m[i+1]*l,m[i+2]=m[i+2]*l;let f=m,c=e,h=r;const p=s;if(c>=p||h>=p){const t=c/h;t>1?(c=p,h=Math.round(p/t)):(h=p,c=Math.round(p*t)),f=new Uint8Array(4*c*h);const a=new Uint8ClampedArray(f.buffer);i(m,e,r,a,c,h,!1)}return{size:[c,h],image:new Uint32Array(f.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}export{o as default};\n"],"names":["dispose","_rasterizationCanvas","rasterizeJSONResource","i2","s2","o2","this","document","createElement","type","r2","t2","a","e","rasterizeSimpleFill","style","size","image","Uint32Array","buffer","sdf","simplePattern","anchorX","anchorY","rasterizeSimpleLine","cap","m","l","f","r","fromSimpleMarker","fromCIMHatchFill","t","frame","xmin","ymax","xmax","ymin","markerPlacement","fromCIMInsidePolygon","n","c","h","p","y","u","rasterize","rasterizeImageResource","width","height","getContext","ImageData","putImageData","setAttribute","drawImage","getImageData","m2","Uint8Array","data","oldColor","length","newColor","e2","r3","t3","a2","n2","o3","l2","i3","h2","p2","Math","round","Uint8ClampedArray"],"mappings":"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"}