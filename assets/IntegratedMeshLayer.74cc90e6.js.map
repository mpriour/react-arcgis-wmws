{"version":3,"file":"IntegratedMeshLayer.74cc90e6.js","sources":["../../node_modules/@arcgis/core/layers/support/SceneModifications.js","../../node_modules/@arcgis/core/layers/IntegratedMeshLayer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../chunks/tslib.es6.js\";import o from\"../../request.js\";import e from\"../../core/Collection.js\";import{JSONSupportMixin as t}from\"../../core/JSONSupport.js\";import{get as s}from\"../../core/maybe.js\";import{urlToObject as i}from\"../../core/urlUtils.js\";import{property as c}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/Logger.js\";import{subclass as p}from\"../../core/accessorSupport/decorators/subclass.js\";import a from\"./SceneModification.js\";var m;let n=m=class extends(t(e.ofType(a))){constructor(r){super(r),this.url=null}toJSON(r){return this.toArray().map((o=>o.toJSON(r))).filter((r=>!!r.geometry))}clone(){return new m({url:this.url,items:this.items.map((r=>r.clone()))})}_readModifications(r,o){for(const e of r)this.add(a.fromJSON(e,o))}static fromJSON(r,o){const e=new m;return e._readModifications(r,o),e}static async fromUrl(r,e,t){const c={url:i(r),origin:\"service\"},p=await o(r,{responseType:\"json\",signal:s(t,\"signal\")}),n=e.toJSON(),f=[];for(const o of p.data)f.push(a.fromJSON({...o,geometry:{...o.geometry,spatialReference:n}},c));return new m({url:r,items:f})}};r([c({type:String})],n.prototype,\"url\",void 0),n=m=r([p(\"esri.layers.support.SceneModifications\")],n);var f=n;export{f as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import t from\"../core/Error.js\";import r from\"../core/Handles.js\";import{get as o,isSome as i,isNone as s}from\"../core/maybe.js\";import{MultiOriginJSONMixin as a}from\"../core/MultiOriginJSONSupport.js\";import{throwIfAbortError as n}from\"../core/promiseUtils.js\";import{on as p}from\"../core/watchUtils.js\";import{property as d}from\"../core/accessorSupport/decorators/property.js\";import\"../core/has.js\";import\"../core/accessorSupport/ensureType.js\";import\"../core/Logger.js\";import{reader as m}from\"../core/accessorSupport/decorators/reader.js\";import{subclass as c}from\"../core/accessorSupport/decorators/subclass.js\";import{persistable as y}from\"../core/accessorSupport/decorators/persistable.js\";import l from\"./Layer.js\";import{APIKeyMixin as h}from\"./mixins/APIKeyMixin.js\";import{ArcGISService as f}from\"./mixins/ArcGISService.js\";import{OperationalLayer as u}from\"./mixins/OperationalLayer.js\";import{PortalLayer as v}from\"./mixins/PortalLayer.js\";import{ScaleRangeLayer as g}from\"./mixins/ScaleRangeLayer.js\";import{SceneService as S}from\"./mixins/SceneService.js\";import{elevationInfo as j}from\"./support/commonProperties.js\";import{I3SNodePageDefinition as w,I3SMaterialDefinition as T,I3STextureSetDefinition as x,I3SGeometryDefinition as L}from\"./support/I3SLayerDefinitions.js\";import _ from\"./support/SceneModifications.js\";import{f as I}from\"../chunks/persistableUrlUtils.js\";let O=class extends(S(f(u(v(g(a(h(l)))))))){constructor(...e){super(...e),this.handles=new r,this.geometryType=\"mesh\",this.operationalLayerType=\"IntegratedMeshLayer\",this.type=\"integrated-mesh\",this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.profile=\"mesh-pyramids\",this.modifications=null,this._modificationsSource=null,this.elevationInfo=null,this.path=null}destroy(){this.handles.destroy()}initialize(){this.handles.add(p(this,\"modifications\",\"after-changes\",(()=>this.modifications=this.modifications),null,null,!0))}normalizeCtorArgs(e,t){return\"string\"==typeof e?{url:e,...t}:e}readModifications(e,t,r){this._modificationsSource={url:I(e,r),context:r}}async load(e){return this.addResolvingPromise(this._doLoad(e)),this}async _doLoad(e){const t=o(e,\"signal\");try{await this.loadFromPortal({supportedTypes:[\"Scene Service\"]},e)}catch(r){n(r)}if(await this._fetchService(t),i(this._modificationsSource)){const t=await _.fromUrl(this._modificationsSource.url,this.spatialReference,e);this.setAtOrigin(\"modifications\",t,this._modificationsSource.context.origin),this._modificationsSource=null}await this._fetchIndexAndUpdateExtent(this.nodePages,t)}beforeSave(){if(!s(this._modificationsSource))return this.load().then((()=>{}),(()=>{}))}async saveAs(e,t){return this._debouncedSaveOperations(1,{...t,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:\"integrated-mesh\"},e)}async save(){const e={getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:\"integrated-mesh\"};return this._debouncedSaveOperations(0,e)}validateLayer(e){if(e.layerType&&\"IntegratedMesh\"!==e.layerType)throw new t(\"integrated-mesh-layer:layer-type-not-supported\",\"IntegratedMeshLayer does not support this layer type\",{layerType:e.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new t(\"layer:service-version-not-supported\",\"Service version is not supported.\",{serviceVersion:this.version.versionString,supportedVersions:\"1.x\"});if(this.version.major>1)throw new t(\"layer:service-version-too-new\",\"Service version is too new.\",{serviceVersion:this.version.versionString,supportedVersions:\"1.x\"})}_getTypeKeywords(){return[\"IntegratedMeshLayer\"]}};e([d({type:String,readOnly:!0})],O.prototype,\"geometryType\",void 0),e([d({type:[\"show\",\"hide\"]})],O.prototype,\"listMode\",void 0),e([d({type:[\"IntegratedMeshLayer\"]})],O.prototype,\"operationalLayerType\",void 0),e([d({json:{read:!1},readOnly:!0})],O.prototype,\"type\",void 0),e([d({type:w,readOnly:!0})],O.prototype,\"nodePages\",void 0),e([d({type:[T],readOnly:!0})],O.prototype,\"materialDefinitions\",void 0),e([d({type:[x],readOnly:!0})],O.prototype,\"textureSetDefinitions\",void 0),e([d({type:[L],readOnly:!0})],O.prototype,\"geometryDefinitions\",void 0),e([d({readOnly:!0})],O.prototype,\"serviceUpdateTimeStamp\",void 0),e([d({type:_}),y({origins:[\"web-scene\",\"portal-item\"],type:\"resource\",prefix:\"modifications\"})],O.prototype,\"modifications\",void 0),e([m([\"web-scene\",\"portal-item\"],\"modifications\")],O.prototype,\"readModifications\",null),e([d(j)],O.prototype,\"elevationInfo\",void 0),e([d({type:String,json:{origins:{\"web-scene\":{read:!0,write:!0},\"portal-item\":{read:!0,write:!0}},read:!1}})],O.prototype,\"path\",void 0),O=e([c(\"esri.layers.IntegratedMeshLayer\")],O);var M=O;export{M as default};\n"],"names":["m","n","t","e","ofType","a","constructor","r2","this","url","toJSON","toArray","map","o","filter","r3","geometry","clone","items","_readModifications","e2","add","fromJSON","t2","c2","i","origin","p2","responseType","signal","s","n2","f2","data","push","__spreadProps","spatialReference","r","c","type","String","prototype","p","f","O","S","u","v","g","h","l","handles","geometryType","operationalLayerType","nodePages","materialDefinitions","textureSetDefinitions","geometryDefinitions","serviceUpdateTimeStamp","profile","modifications","_modificationsSource","elevationInfo","path","destroy","initialize","normalizeCtorArgs","__spreadValues","readModifications","I","context","addResolvingPromise","_doLoad","loadFromPortal","supportedTypes","_fetchService","t3","_","fromUrl","setAtOrigin","_fetchIndexAndUpdateExtent","beforeSave","load","then","_debouncedSaveOperations","getTypeKeywords","_getTypeKeywords","portalItemLayerType","validateLayer","layerType","isNaN","version","major","minor","serviceVersion","versionString","supportedVersions","d","readOnly","json","read","w","T","x","L","y","origins","prefix","j","write","M"],"mappings":"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"}