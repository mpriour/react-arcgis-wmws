{"version":3,"file":"ImageryTileLayerView.2c066d1b.js","sources":["../../node_modules/@arcgis/core/views/layers/ImageryTileLayerView.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import t from\"../../Graphic.js\";import r from\"../../core/Error.js\";import{isSome as i}from\"../../core/maybe.js\";import{property as o}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/Logger.js\";import{subclass as a}from\"../../core/accessorSupport/decorators/subclass.js\";import{getDefaultDatumTransformationForDataset as s,projectExtent as n}from\"../../layers/support/rasterFunctions/rasterProjectionHelper.js\";import{getFetchPopupTemplate as l}from\"./support/popupUtils.js\";const u=u=>{let p=class extends u{constructor(){super(...arguments),this._rasterFieldPrefix=\"Raster.\",this.layer=null,this.view=null,this.fullExtent=null,this.tileInfo=null,this.datumTransformation=null}get hasTilingEffects(){return this.layer.renderer&&\"dynamicRangeAdjustment\"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}async fetchPopupFeatures(e,o){const{layer:a}=this;if(!e)return Promise.reject(new r(\"imageryTileLayerView:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:a}));const{popupEnabled:s}=a,n=l(a,o);if(!s||!i(n))throw new r(\"imageryTileLayerView:fetchPopupFeatures\",\"Missing required popupTemplate or popupEnabled\",{popupEnabled:s,popupTemplate:n});const u=[],{value:p,magdirValue:m}=await a.identify(e);let f=\"\";if(p&&p.length){var c,h;f=\"imagery-tile\"===a.type&&a.hasStandardTime()&&null!=p[0]?p.map((e=>a.getStandardTimeValue(e))).join(\", \"):p.join(\", \");const e={ObjectId:0},r=\"Raster.ServicePixelValue\";e[r]=this._formatAttributeValue(f,r);const i=null==(c=a.rasterInfo)||null==(h=c.attributeTable)?void 0:h.features;if(i&&i.length>0){const t=i.filter((e=>{const t=e.attributes.value||e.attributes.Value||e.attributes.VALUE;return String(t)===f}));if(t.length>0){const r=t[0];if(r)for(const t in r.attributes)if(r.attributes.hasOwnProperty(t)){const i=this._rasterFieldPrefix+t;e[i]=this._formatAttributeValue(r.attributes[t],i)}}}const o=a.rasterInfo.dataType;\"vector-magdir\"!==o&&\"vector-uv\"!==o||(e[\"Raster.Magnitude\"]=null==m?void 0:m[0],e[\"Raster.Direction\"]=null==m?void 0:m[1]);const s=new t(this.fullExtent.clone(),null,e);s.layer=a,s.sourceLayer=s.layer,u.push(s)}return u}updateFullExtent(){const e=this.layer.tileInfo;let t;e&&e.spatialReference||(t=new r(\"layerview:tiling-information-missing\",\"The layer doesn't provide tiling information\",{layer:this.layer}));const i=s(this.layer.fullExtent,this.view.spatialReference,!1),o=n(this.layer.fullExtent,this.view.spatialReference,i);return null==o&&(t=new r(\"layerview:projection-not-supported\",\"The layer extent cannot be projected to the view's spatial reference\",{layer:this.layer})),this._set(\"fullExtent\",o),this.datumTransformation||(this.datumTransformation=s(this.layer.fullExtent,this.view.spatialReference,!0)),t?Promise.reject(t):Promise.resolve()}_formatAttributeValue(e,t){if(\"string\"==typeof e){const r=this.layer.popupTemplate&&this.layer.popupTemplate.fieldInfos,i=this._getFieldInfo(r,t),o=i&&i.format;if(o){let t,r;return e.trim().indexOf(\",\")>-1?(t=\",\",r=t+\" \",this._formatDelimitedString(e,t,r,o)):e.trim().indexOf(\" \")>-1?(t=r=\" \",this._formatDelimitedString(e,t,r,o)):this._formatNumberFromString(e,o)}}return e}_getFieldInfo(e,t){if(!e||!e.length||!t)return;const r=t.toLowerCase();let i;return e.some((e=>!(!e.fieldName||e.fieldName.toLowerCase()!==r&&e.fieldName.toLowerCase()!==r.replace(/ /g,\"_\"))&&(i=e,!0))),i}_formatDelimitedString(e,t,r,i){return e&&t&&r&&i?e.trim().split(t).map((e=>this._formatNumberFromString(e,i))).join(r):e}_formatNumberFromString(e,t){if(!e||!t)return e;const r=Number(e);return isNaN(r)?e:t.format(r)}};return e([o()],p.prototype,\"layer\",void 0),e([o()],p.prototype,\"view\",void 0),e([o()],p.prototype,\"fullExtent\",void 0),e([o()],p.prototype,\"tileInfo\",void 0),e([o({readOnly:!0})],p.prototype,\"hasTilingEffects\",null),p=e([a(\"esri.views.layers.ImageryTileLayerView\")],p),p};export{u as ImageryTileLayerView,u as default};\n"],"names":["u","p","u2","constructor","arguments","this","_rasterFieldPrefix","layer","view","fullExtent","tileInfo","datumTransformation","renderer","dynamicRangeAdjustment","e2","o","a","Promise","reject","r","popupEnabled","s","n2","l","i","popupTemplate","u3","value","p2","magdirValue","m","identify","f","length","c","h","type","hasStandardTime","map","getStandardTimeValue","e4","join","e3","ObjectId","r2","_formatAttributeValue","rasterInfo","attributeTable","features","t","filter","t2","attributes","Value","VALUE","String","r3","hasOwnProperty","i2","o2","dataType","s2","clone","sourceLayer","push","updateFullExtent","spatialReference","n","_set","resolve","fieldInfos","_getFieldInfo","format","trim","indexOf","_formatDelimitedString","_formatNumberFromString","toLowerCase","some","fieldName","replace","split","Number","isNaN","e","prototype","readOnly"],"mappings":"yLAIinB,MAACA,UAAUC,EAAE,cAAcC,EAAEC,uBAAuBC,WAAWC,KAAKC,mBAAmB,UAAUD,KAAKE,MAAM,KAAKF,KAAKG,KAAK,KAAKH,KAAKI,WAAW,KAAKJ,KAAKK,SAAS,KAAKL,KAAKM,oBAAoB,mCAAmCN,KAAKE,MAAMK,UAAU,2BAA2BP,KAAKE,MAAMK,UAAUP,KAAKE,MAAMK,SAASC,gDAAgDC,EAAEC,SAASR,MAAMS,GAAGX,SAASS,SAASG,QAAQC,OAAO,IAAIC,EAAE,0CAA0C,gCAAgC,CAACZ,MAAMS,WAAWI,aAAaC,GAAGL,EAAEM,EAAEC,EAAEP,EAAED,OAAOM,IAAIG,EAAEF,SAAS,IAAIH,EAAE,0CAA0C,iDAAiD,CAACC,aAAaC,EAAEI,cAAcH,UAAUI,EAAE,IAAIC,MAAMC,EAAEC,YAAYC,SAASd,EAAEe,SAASjB,OAAOkB,EAAE,MAAMJ,GAAGA,EAAEK,OAAO,KAAKC,EAAEC,IAAI,iBAAAnB,EAAmBoB,MAAMpB,EAAEqB,mBAAmB,MAAAT,EAAQ,GAAGA,EAAEU,QAAQtB,EAAEuB,qBAAqBC,KAAKC,KAAK,MAAMb,EAAEa,KAAK,YAAYC,EAAE,CAACC,SAAS,GAAGC,EAAE,6BAA6BA,GAAGvC,KAAKwC,sBAAsBb,EAAEY,SAASpB,EAAE,SAASR,EAAE8B,aAAa,SAASZ,EAAEa,qBAAgB,EAAOZ,EAAEa,YAAYxB,GAAGA,EAAES,OAAO,EAAE,OAAOgB,EAAEzB,EAAE0B,kBAAkBC,EAAEX,EAAEY,WAAWzB,OAAOa,EAAEY,WAAWC,OAAOb,EAAEY,WAAWE,aAAaC,OAAOJ,KAAKnB,QAAQiB,EAAEhB,OAAO,EAAE,OAAOuB,EAAEP,EAAE,MAAMO,YAAYL,KAAKK,EAAEJ,cAAcI,EAAEJ,WAAWK,eAAeN,GAAG,OAAOO,EAAErD,KAAKC,mBAAmB6C,IAAIO,GAAGrD,KAAKwC,sBAAsBW,EAAEJ,WAAWD,GAAGO,WAAWC,EAAE3C,EAAE8B,WAAWc,SAAS,kBAAkBD,GAAG,cAAcA,MAAM,oBAAoB,MAAA7B,OAAQ,EAAOA,EAAE,GAAGY,EAAE,oBAAoB,MAAAZ,OAAQ,EAAOA,EAAE,UAAU+B,EAAE,IAAIZ,EAAE5C,KAAKI,WAAWqD,QAAQ,KAAKpB,KAAKnC,MAAMS,EAAE6C,EAAEE,YAAYF,EAAEtD,MAAMmB,EAAEsC,KAAKH,UAAUnC,EAAEuC,yBAAyBnD,EAAET,KAAKE,MAAMG,aAAauC,KAAKnC,EAAEoD,qBAAqB,IAAI/C,EAAE,uCAAuC,+CAA+C,CAACZ,MAAMF,KAAKE,eAAeiB,EAAEH,EAAEhB,KAAKE,MAAME,WAAWJ,KAAKG,KAAK0D,kBAAiB,GAAInD,EAAEoD,EAAE9D,KAAKE,MAAME,WAAWJ,KAAKG,KAAK0D,iBAAiB1C,UAAU,MAAAT,MAAY,IAAII,EAAE,qCAAqC,uEAAuE,CAACZ,MAAMF,KAAKE,SAASF,KAAK+D,KAAK,aAAarD,GAAGV,KAAKM,2BAA2BA,oBAAoBU,EAAEhB,KAAKE,MAAME,WAAWJ,KAAKG,KAAK0D,kBAAiB,IAAKjB,EAAEhC,QAAQC,OAAO+B,GAAGhC,QAAQoD,UAAUxB,sBAAsB/B,EAAEmC,MAAM,iBAAiBnC,EAAE,OAAO8B,EAAEvC,KAAKE,MAAMkB,eAAepB,KAAKE,MAAMkB,cAAc6C,WAAW9C,EAAEnB,KAAKkE,cAAc3B,EAAEK,GAAGlC,EAAES,GAAGA,EAAEgD,UAAUzD,EAAE,KAAKoC,EAAEK,SAAS1C,EAAE2D,OAAOC,QAAQ,WAAW,IAAIlB,EAAEL,EAAE,IAAI9C,KAAKsE,uBAAuB7D,EAAEqC,EAAEK,EAAEzC,IAAID,EAAE2D,OAAOC,QAAQ,WAAWlB,EAAE,IAAInD,KAAKsE,uBAAuB7D,EAAEqC,EAAEK,EAAEzC,IAAIV,KAAKuE,wBAAwB9D,EAAEC,WAAWD,EAAEyD,cAAczD,EAAEmC,OAAOnC,IAAIA,EAAEmB,SAASgB,eAAeL,EAAEK,EAAE4B,kBAAkBrD,SAASV,EAAEgE,YAAYpC,EAAEqC,WAAWrC,EAAEqC,UAAUF,gBAAgBjC,GAAGF,EAAEqC,UAAUF,gBAAgBjC,EAAEoC,QAAQ,KAAK,SAAUtC,EAAE,MAAMlB,EAAEmD,uBAAuB7D,EAAEmC,EAAEL,EAAEpB,UAAUV,GAAGmC,GAAGL,GAAGpB,EAAEV,EAAE2D,OAAOQ,MAAMhC,GAAGX,QAAQjC,KAAKuE,wBAAwBlC,EAAElB,KAAKiB,KAAKG,GAAG9B,EAAE8D,wBAAwB9D,EAAEmC,OAAOnC,IAAImC,SAASnC,QAAQ8B,EAAEsC,OAAOpE,UAAUqE,MAAMvC,GAAG9B,EAAEmC,EAAEuB,OAAO5B,YAAYwC,EAAE,CAACrE,KAAKd,EAAEoF,UAAU,aAAQ,GAAQD,EAAE,CAACrE,KAAKd,EAAEoF,UAAU,YAAO,GAAQD,EAAE,CAACrE,KAAKd,EAAEoF,UAAU,kBAAa,GAAQD,EAAE,CAACrE,KAAKd,EAAEoF,UAAU,gBAAW,GAAQD,EAAE,CAACrE,EAAE,CAACuE,UAAS,KAAMrF,EAAEoF,UAAU,mBAAmB,MAAMpF,EAAEmF,EAAE,CAACpE,EAAE,2CAA2Cf,GAAGA"}