import{E as t,B as e}from"./vendor.7103ff48.js";import{i as n,u as r}from"./pixelUtils.5eddfa69.js";const o=new Map;o.set("meter-per-second",1),o.set("kilometer-per-hour",.277778),o.set("knots",.514444),o.set("feet-per-second",.3048),o.set("mile-per-hour",.44704);const a=180/Math.PI,s=new t({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function i(t,e){return o.get(t)/o.get(e)||1}function h(t){return(450-t)%360}function l(t,e="geographic"){const[n,r]=t,o=Math.sqrt(n*n+r*r);let s=Math.atan2(r,n)*a;return s=(360+s)%360,"geographic"===e&&(s=h(s)),[o,s]}function c(t,e="geographic"){let n=t[1];"geographic"===e&&(n=h(n)),n%=360;const r=t[0];return[r*Math.cos(n/a),r*Math.sin(n/a)]}function u(t,e,o="geographic",a=1){if(!n(t))return t;const{pixels:s,width:i,height:h}=t,u=i*h,f=s[0],p=s[1],m=r.createEmptyBand(t.pixelType,u),M=r.createEmptyBand(t.pixelType,u);let d=0;for(let n=0;n<h;n++)for(let t=0;t<i;t++)"vector-uv"===e?([m[d],M[d]]=l([f[d],p[d]],o),m[d]*=a):([m[d],M[d]]=c([f[d],p[d]],o),m[d]*=a,M[d]*=a),d++;const x=new r({pixelType:t.pixelType,width:t.width,height:t.height,mask:t.mask,validPixelCount:t.validPixelCount,maskIsAlpha:t.maskIsAlpha,pixels:[m,M]});return x.updateStatistics(),x}function f(t,e,r=1){if(1===r||!n(t))return t;const o=t.clone(),{pixels:a,width:s,height:i}=o,h=a[0],l=a[1];let c=0;for(let n=0;n<i;n++)for(let t=0;t<s;t++)"vector-uv"===e?(h[c]*=r,l[c]*=r):h[c]*=r,c++;return o.updateStatistics(),o}function p(t,n,r,o,a){if(!e(a)||!a.spatialReference.equals(t.spatialReference))return{extent:t,width:n,height:r,resolution:t.width/n};const s=a.xmin,i=a.ymax;o=Math.max(o||0,30);const h=Math.ceil(n*(1/o)),l=Math.ceil(r*(1/o)),c=((t.xmax-t.xmin)/h+(t.ymax-t.ymin)/l)/2;return t.xmin=s+Math.floor((t.xmin-s)/c)*c,t.xmax=s+Math.ceil((t.xmax-s)/c)*c,t.ymin=i+Math.floor((t.ymin-i)/c)*c,t.ymax=i+Math.ceil((t.ymax-i)/c)*c,{extent:t,width:Math.round(t.width/c),height:Math.round(t.height/c),resolution:c}}const m=function(t=0,e=0,n=Math.PI,r=!0){r&&(n=(2*Math.PI-n)%(2*Math.PI));const o=r?-1:1,a=13*o,s=-7*o,i=-2*o,h=-16*o,l=29,[c,u]=d(0,e+a,n,l),[f,p]=d(t-5.5,e+s,n,l),[m,M]=d(t+5.5,e+s,n,l),[x,g]=d(t-1.5,e+i,n,l),[k,w]=d(t+1.5,e+i,n,l),[y,P]=d(t-1.5,e+h,n,l),[b,I]=d(t+1.5,e+h,n,l);return[c,u,f,p,x,g,k,w,m,M,y,P,b,I]}(0,0,0);function M(t=0,e=Math.PI,n=!0){n&&(e=(2*Math.PI-e)%(2*Math.PI));const r=n?-1:1,o=5*r,a=20*r,s=25*r,i=45,h=2*r;let[l,c]=[5,0-a],[u,f]=[l+2,c],[p,m]=[u-0,f+h],[M,x]=[-5,0-s],[g,k]=[M+0,x-h],w=Math.ceil(t/5),y=Math.floor(w/10);w-=8*y;const P=[],b=[];for(let E=0;E<w/2;E++,y--){y<=0&&w%2==1&&E===(w-1)/2&&(M=0,g=M+0,x=(x+c)/2,k=x-h);const[t,n]=d(M,x,e,i);if(y>0){const[r,o]=d(u,x,e,i),[a,s]=d(l,c,e,i);P.push(r),P.push(o),P.push(t),P.push(n),P.push(a),P.push(s)}else{const[r,o]=d(u,f,e,i),[a,s]=d(p,m,e,i),[h,l]=d(g,k,e,i);b.push(t),b.push(n),b.push(h),b.push(l),b.push(a),b.push(s),b.push(r),b.push(o)}x+=o,c+=o,f+=o,m+=o,k+=o}const[I,v]=d(5,0+a,e,i),[A,_]=d(7,0+a,e,i),[U,S]=d(5,0-s,e,i),[D,F]=d(7,0-s,e,i);return{pennants:P,barbs:b,shaft:[I,v,A,_,U,S,D,F]}}function d(t,e,n,r=1){const o=Math.sqrt(t*t+e*e)/r,a=(2*Math.PI+Math.atan2(e,t))%(2*Math.PI);return[o,(2*Math.PI+a-n)%(2*Math.PI)]}const x=[0,1,3,6,10,16,21,27,33,40,47,55,63],g=[0,.5,1,1.5,2],k=[0,.25,.5,1,1.5,2,2.5,3,3.5,4];function w(t,e,n,r){const o=i(r||"knots",n);let a;for(a=1;a<e.length;a++)if(a===e.length-1){if(t<e[a]*o)break}else if(t<=e[a]*o)break;return Math.min(a-1,e.length-2)}function y(t,e,n,r,o){let a=0;switch(e){case"beaufort_kn":a=w(t,x,"knots",n);break;case"beaufort_km":a=w(t,x,"kilometer-per-hour",n);break;case"beaufort_ft":a=w(t,x,"feet-per-second",n);break;case"beaufort_m":a=w(t,x,"meter-per-second",n);break;case"classified_arrow":a=w(t,o,r,n);break;case"ocean_current_m":a=w(t,g,"meter-per-second",n);break;case"ocean_current_kn":a=w(t,k,"knots",n)}return a}const P=[];function b(t,e){let n=0,r=0;const{width:o,height:a,mask:s}=t,i=t.pixels[0],h=[],l=[],c="wind_speed"===e.style?5:Number.MAX_VALUE;for(let u=0;u<a;u++)for(let t=0;t<o;t++){const e=u*o+t;if((!s||s[u*o+t])&&i[e]<c){for(let r=0;r<4;r++)h[n++]=(t+.5)/o,h[n++]=(u+.5)/a,h[n++]=r<2?-.5:.5,h[n++]=r%2==0?-.5:.5,h[n++]=0,h[n++]=i[e];const s=4*(n/24-1);l[r++]=s,l[r++]=s+1,l[r++]=s+2,l[r++]=s+1,l[r++]=s+2,l[r++]=s+3}}return{vertexData:new Float32Array(h),indexData:new Uint32Array(l)}}function I(t,e){return"simple_scalar"===e.style?b(t,e):"wind_speed"===e.style?function(t,e){if(0===P.length)for(let s=0;s<30;s++)P.push(M(5*s,0));const n=i(s.fromJSON(e.inputUnit),"knots"),{width:r,height:o,mask:a}=t,h=t.pixels[0],l=t.pixels[1],c=[],u=[];let f=0,p=0;for(let s=0;s<o;s++)for(let t=0;t<r;t++){const e=s*r+t,i=h[e]*n;if((!a||a[s*r+t])&&i>=5){var m;const n=null!=(m=(l[e]+360)%360/180*Math.PI)?m:2*Math.PI*Math.random(),{pennants:a,barbs:h,shaft:M}=P[Math.min(Math.floor(i/5),29)];if(a.length+h.length===0)continue;let d=c.length/6;const x=(t+.5)/r,g=(s+.5)/o;for(let t=0;t<a.length;t+=2)c[f++]=x,c[f++]=g,c[f++]=a[t],c[f++]=a[t+1]+n,c[f++]=0,c[f++]=i;for(let t=0;t<h.length;t+=2)c[f++]=x,c[f++]=g,c[f++]=h[t],c[f++]=h[t+1]+n,c[f++]=0,c[f++]=i;for(let t=0;t<M.length;t+=2)c[f++]=x,c[f++]=g,c[f++]=M[t],c[f++]=M[t+1]+n,c[f++]=0,c[f++]=i;for(let t=0;t<a.length/6;t++)u[p++]=d,u[p++]=d+1,u[p++]=d+2,d+=3;for(let t=0;t<h.length/8;t++)u[p++]=d,u[p++]=d+1,u[p++]=d+2,u[p++]=d+1,u[p++]=d+2,u[p++]=d+3,d+=4;u[p++]=d+0,u[p++]=d+1,u[p++]=d+2,u[p++]=d+1,u[p++]=d+3,u[p++]=d+2,d+=4}}return{vertexData:new Float32Array(c),indexData:new Uint32Array(u)}}(t,e):function(t,e){const{style:n,inputUnit:r,outputUnit:o,breakValues:a}=e,i=s.fromJSON(r),h=s.fromJSON(o);let l=0,c=0;const{width:u,height:f,mask:p}=t,M=t.pixels[0],d=t.pixels[1],x=p?p.filter((t=>t>0)).length:u*f,g=new Float32Array(42*x),k=new Uint32Array(15*x);for(let s=0;s<f;s++)for(let t=0;t<u;t++){const e=s*u+t;if(!p||p[s*u+t]){var w;const r=null!=(w=(d[e]+360)%360/180*Math.PI)?w:2*Math.PI*Math.random(),o=y(M[e],n,i,h,a);for(let n=0;n<m.length;n+=2)g[l++]=(t+.5)/u,g[l++]=(s+.5)/f,g[l++]=m[n],g[l++]=m[n+1]+r,g[l++]=o,g[l++]=M[e];const p=7*(l/42-1);k[c++]=p,k[c++]=p+1,k[c++]=p+2,k[c++]=p+0,k[c++]=p+4,k[c++]=p+3,k[c++]=p+0,k[c++]=p+2,k[c++]=p+3,k[c++]=p+2,k[c++]=p+5,k[c++]=p+3,k[c++]=p+5,k[c++]=p+6,k[c++]=p+3}}return{vertexData:g,indexData:k}}(t,e)}function v(t,e,n,o=[0,0],a=.5){const{width:s,height:i,mask:h}=t,[u,f]=t.pixels,[p,m]=o,M=Math.round((s-p)/n),d=Math.round((i-m)/n),x=M*d,g=new Float32Array(x),k=new Float32Array(x),w=new Uint8Array(x),y="vector-uv"===e;for(let r=0;r<d;r++)for(let t=0;t<M;t++){let e=0;const o=r*M+t,d=Math.max(0,r*n+m),x=Math.max(0,t*n+p),P=Math.min(i,d+n),b=Math.min(s,x+n);for(let t=d;t<P;t++)for(let n=x;n<b;n++){const r=t*s+n;if(!h||h[r]){e++;const t=y?[u[r],f[r]]:[u[r],(360+f[r])%360],[n,a]=y?t:c(t);g[o]+=n,k[o]+=a}}if(e>=(P-d)*(b-x)*(1-a)){w[o]=1;const[t,n]=l([g[o]/e,k[o]/e]);g[o]=t,k[o]=n}else w[o]=0,g[o]=0,k[o]=0}const P=new r({width:M,height:d,pixels:[g,k],mask:w});return P.updateStatistics(),P}export{v as S,I as U,b as _,l as c,u as f,i as h,s as i,p as m,f as p};
//# sourceMappingURL=vectorFieldUtils.7ace4039.js.map
