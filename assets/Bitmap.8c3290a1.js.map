{"version":3,"file":"Bitmap.8c3290a1.js","sources":["../../node_modules/@arcgis/core/views/2d/engine/ImageryBitmapSource.js","../../node_modules/@arcgis/core/views/2d/engine/Bitmap.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{isSome as e,isNone as t}from\"../../../core/maybe.js\";class i{constructor(e,t,i){this.pixelBlock=e,this.extent=t,this.originalPixelBlock=i}get width(){return e(this.pixelBlock)?this.pixelBlock.width:0}get height(){return e(this.pixelBlock)?this.pixelBlock.height:0}render(e){const i=this.pixelBlock;if(t(i))return;const l=this.filter({pixelBlock:i});if(t(l.pixelBlock))return;const r=l.pixelBlock.getAsRGBA(),o=e.createImageData(l.pixelBlock.width,l.pixelBlock.height);o.data.set(r),e.putImageData(o,0,0)}getRenderedRasterPixels(){const e=this.filter({pixelBlock:this.pixelBlock});return t(e.pixelBlock)?null:{width:e.pixelBlock.width,height:e.pixelBlock.height,renderedRasterPixels:new Uint8Array(e.pixelBlock.getAsRGBA().buffer)}}}export{i as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../core/maybe.js\";import{b as e,c as i,r as s,j as r,m as h}from\"../../../chunks/mat3.js\";import{c as n}from\"../../../chunks/mat3f32.js\";import{f as o}from\"../../../chunks/vec2f32.js\";import\"../../webgl/BufferObject.js\";import\"../../webgl/FramebufferObject.js\";import\"../../../core/has.js\";import\"../../webgl/checkWebGLError.js\";import\"../../webgl/enums.js\";import\"../../../chunks/builtins.js\";import\"../../webgl/renderState.js\";import u from\"../../webgl/Texture.js\";import\"../../webgl/VertexArrayObject.js\";import{DisplayObject as a}from\"./DisplayObject.js\";import d from\"./ImageryBitmapSource.js\";function c(t){return t&&\"render\"in t}function l(t){return t&&!(\"render\"in t)}function m(t){const e=document.createElement(\"canvas\");return e.width=t.width,e.height=t.height,t.render(e.getContext(\"2d\")),e}function g(t,e,i){const s={target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071};return e&&i&&(s.width=e,s.height=i),new u(t,s)}class x extends a{constructor(t=null,e,i=!0){super(),this.requestRenderOnSourceChangedEnabled=i,this._textureInvalidated=!0,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.blendFunction=e,this.source=t,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null)}get isSourceScaled(){return this.width!==this.sourceWidth||this.height!==this.sourceHeight}get height(){return void 0!==this._height?this._height:this.sourceHeight}set height(t){this._height=t}get source(){return this._source}set source(t){this._source=t,this.invalidateTexture()}get sourceHeight(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height}get sourceWidth(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width}get width(){return void 0!==this._width?this._width:this.sourceWidth}set width(t){this._width=t}beforeRender(t){super.beforeRender(t),this.updateTexture(t.context)}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRenderOnSourceChangedEnabled&&this.requestRender())}_createTransforms(){return{dvs:n()}}setTransform(t){const n=e(this.transforms.dvs),[u,a]=t.toScreenNoRotation([0,0],[this.x,this.y]),d=this.resolution/this.pixelRatio/t.resolution,c=d*this.width,l=d*this.height,m=Math.PI*this.rotation/180;i(n,n,o(u,a)),i(n,n,o(c/2,l/2)),s(n,n,-m),i(n,n,o(-c/2,-l/2)),r(n,n,o(c,l)),h(this.transforms.dvs,t.displayViewMat3,n)}setSamplingProfile(t){this._texture&&(t.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(t.samplingMode))}bind(t,e){this._texture&&t.bindTexture(this._texture,e)}updateTexture(e){var i;if(!this.stage)return null==(i=this._texture)||i.dispose(),void(this._texture=null);if(!this._textureInvalidated)return;this._textureInvalidated=!1,this._texture||(this.source?this._texture=g(e,this.sourceWidth,this.sourceHeight):this._texture=g(e));const s=this.source;if(s){if(this._texture.resize(this.sourceWidth,this.sourceHeight),c(s))if(s instanceof d){const e=s.getRenderedRasterPixels();this._texture.setData(t(e)?e.renderedRasterPixels:null)}else this._texture.setData(m(s));else l(s)&&this._texture.setData(s);this.ready()}else this._texture.setData(null)}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}}export{x as Bitmap,c as isImageSource,m as rasterize};\n"],"names":["constructor","e","t2","i2","pixelBlock","this","extent","originalPixelBlock","width","height","render","t","l2","filter","r2","getAsRGBA","o2","createImageData","data","set","putImageData","getRenderedRasterPixels","renderedRasterPixels","Uint8Array","buffer","s","target","pixelFormat","internalFormat","dataType","wrapMode","u","a","requestRenderOnSourceChangedEnabled","_textureInvalidated","stencilRef","coordScale","_height","pixelRatio","resolution","rotation","_source","_width","x","y","blendFunction","source","requestRender","bind","destroy","_texture","dispose","sourceWidth","sourceHeight","invalidateTexture","HTMLImageElement","naturalHeight","naturalWidth","beforeRender","updateTexture","context","_createTransforms","dvs","n","setTransform","transforms","a2","toScreenNoRotation","d","c2","m2","Math","PI","o","i","r","h","displayViewMat3","setSamplingProfile","mips","descriptor","hasMipmap","generateMipmap","setSamplingMode","samplingMode","bindTexture","stage","g","resize","e2","setData","document","createElement","getContext","m","ready","onAttach","onDetach"],"mappings":"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"}