{"version":3,"file":"TileIndex.3ffc9499.js","sources":["../../node_modules/@arcgis/core/views/2d/engine/vectorTiles/TileIndex.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{isAbortError as e}from\"../../../../core/promiseUtils.js\";import{TilemapCache as t}from\"../../../../layers/support/TilemapCache.js\";import l from\"../../tiling/TileKey.js\";class r{constructor(e){if(e instanceof t)this._tilemapCache=e;else{if(!e||!(\"index\"in e))throw new Error(\"Invalid tilemap!\");this._tilemap=e.index}}dataKey(t,r){if(this._tilemapCache){const{level:i,row:o,col:a}=t,s=new l(t);return this._tilemapCache.fetchAvailabilityUpsample(i,o,a,s,r).then((()=>(s.world=t.world,s))).catch((t=>{if(e(t))throw t;return null}))}return this._getIndexedDataKey(t)}forEach(e,t,l,r,i){this._callback=i,this._maxLevel=t+e,this._forEach(this._tilemap,t,l,r)}_forEach(e,t,l,r){0!==e&&(this._callback(t,l,r),t!==this._maxLevel&&\"object\"==typeof e&&(this._forEach(e[0],t+1,2*l,2*r),this._forEach(e[1],t+1,2*l,2*r+1),this._forEach(e[2],t+1,2*l+1,2*r),this._forEach(e[3],t+1,2*l+1,2*r+1)))}_getIndexedDataKey(e){const t=[e];if(e.level<0||e.row<0||e.col<0||e.row>>e.level>0||e.col>>e.level>0)return Promise.resolve(null);let r=e;for(;0!==r.level;)r=new l(r.level-1,r.row>>1,r.col>>1,r.world),t.push(r);let i,o,a=this._tilemap,s=t.pop();if(1===a)return Promise.resolve(s);for(;t.length;)if(i=t.pop(),o=(1&i.col)+((1&i.row)<<1),a){if(0===a[o]){s=null;break}if(1===a[o]){s=i;break}s=i,a=a[o]}return Promise.resolve(s)}}export{r as default};\n"],"names":["constructor","e2","t","_tilemapCache","Error","_tilemap","index","dataKey","r2","this","level","i","row","o","col","a","s","l","fetchAvailabilityUpsample","then","world","catch","e","t2","_getIndexedDataKey","forEach","_callback","_maxLevel","_forEach","Promise","resolve","push","pop","length"],"mappings":"iGAIiL,QAAQA,YAAYC,MAAMA,aAAaC,OAAOC,cAAcF,MAAM,KAAKA,eAAeA,SAAS,IAAIG,MAAM,yBAAyBC,SAASJ,EAAEK,OAAOC,QAAQL,EAAEM,MAAMC,KAAKN,cAAc,OAAOO,MAAMC,EAAEC,IAAIC,EAAEC,IAAIC,GAAGb,EAAEc,EAAE,IAAIC,EAAEf,UAAUO,KAAKN,cAAce,0BAA0BP,EAAEE,EAAEE,EAAEC,EAAER,GAAGW,MAAM,OAAOC,MAAMlB,EAAEkB,MAAMJ,KAAKK,cAAcC,EAAEC,SAASA,SAAS,eAAed,KAAKe,mBAAmBtB,GAAGuB,QAAQxB,EAAEC,EAAEe,EAAET,EAAEG,QAAQe,UAAUf,EAAEF,KAAKkB,UAAUzB,EAAED,EAAEQ,KAAKmB,SAASnB,KAAKJ,SAASH,EAAEe,EAAET,GAAGoB,SAAS3B,EAAEC,EAAEe,EAAET,GAAG,IAAIP,SAASyB,UAAUxB,EAAEe,EAAET,GAAGN,IAAIO,KAAKkB,WAAW,iBAAiB1B,SAAS2B,SAAS3B,EAAE,GAAGC,EAAE,EAAE,EAAEe,EAAE,EAAET,GAAGC,KAAKmB,SAAS3B,EAAE,GAAGC,EAAE,EAAE,EAAEe,EAAE,EAAET,EAAE,GAAGC,KAAKmB,SAAS3B,EAAE,GAAGC,EAAE,EAAE,EAAEe,EAAE,EAAE,EAAET,GAAGC,KAAKmB,SAAS3B,EAAE,GAAGC,EAAE,EAAE,EAAEe,EAAE,EAAE,EAAET,EAAE,KAAKgB,mBAAmBF,SAASpB,EAAE,CAACoB,MAAMA,EAAEZ,MAAM,GAAGY,EAAEV,IAAI,GAAGU,EAAER,IAAI,GAAGQ,EAAEV,KAAKU,EAAEZ,MAAM,GAAGY,EAAER,KAAKQ,EAAEZ,MAAM,SAASmB,QAAQC,QAAQ,UAAUtB,EAAEc,OAAO,IAAId,EAAEE,SAAS,IAAIO,EAAET,EAAEE,MAAM,EAAEF,EAAEI,KAAK,EAAEJ,EAAEM,KAAK,EAAEN,EAAEY,OAAOlB,EAAE6B,KAAKvB,OAAOG,EAAEE,EAAEE,EAAEN,KAAKJ,SAASW,EAAEd,EAAE8B,SAAS,IAAAjB,SAAac,QAAQC,QAAQd,QAAQd,EAAE+B,WAAWtB,EAAET,EAAE8B,MAAMnB,KAAKF,EAAEG,SAASH,EAAEC,MAAM,GAAGG,EAAE,IAAI,IAAIA,EAAEF,GAAG,GAAG,cAAc,IAAIE,EAAEF,GAAG,GAAGF,UAAUA,EAAEI,EAAEA,EAAEF,UAAUgB,QAAQC,QAAQd"}