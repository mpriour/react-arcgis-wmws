var e=Object.defineProperty,t=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,a=(t,i,r)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[i]=r;import{F as s,H as o,bb as n,nT as p,bv as h,G as d,ih as m}from"./vendor.7103ff48.js";import{t as l}from"./BitmapContainer.f66ff0c9.js";import{l as c}from"./LayerView2D.3bec42c6.js";import{a as f,e as b}from"./BaseGraphicContainer.8758663f.js";import{I as g}from"./Utils.8f00ae04.js";import{S as u}from"./ExportStrategy.b9685efa.js";import{c as j}from"./MapImageLayerView.db6681ad.js";import{a as v}from"./RefreshableLayerView.7b9ab281.js";import{a as y}from"./drapedUtils.fabca730.js";import"./brushes.b64b90a9.js";import"./definitions.e5e12ce7.js";import"./ShaderCompiler.6905b522.js";import"./GeometryUtils.1bcb906c.js";import"./MaterialKey.8df623c8.js";import"./pixelUtils.5eddfa69.js";import"./WGLContainer.6f073475.js";import"./Container.f525a10f.js";import"./projectionSupport.c5c55ada.js";import"./json.62026198.js";import"./Matcher.4dbcd4b5.js";import"./ComputedAttributeStorage.c6915def.js";import"./FeatureSetReader.bfb25a2d.js";import"./centroid.f07ef5b9.js";import"./visualVariablesUtils.7196204b.js";import"./visualVariablesUtils.f42dea16.js";import"./tileUtils.2adb3da0.js";import"./TileClipper.507f8905.js";import"./schemaUtils.c28cd36f.js";import"./CIMSymbolHelper.da5834c9.js";import"./Rect.db562a93.js";import"./BidiEngine.af5bfcbd.js";import"./MD5.86afbcc5.js";import"./cimAnalyzer.07de9cca.js";import"./FeatureContainer.c8d6e93f.js";import"./TileContainer.555234dd.js";import"./GraphicsView.45ff2c67.js";import"./Bitmap.8c3290a1.js";import"./clickToleranceUtils.85f9bed9.js";import"./popupUtils.99eeb504.js";let w=class extends f{renderChildren(e){if(e.drawPhase!==g.HIGHLIGHT)return;if(this.attributeView.bindTextures(e.context),!this.children.some((e=>e.hasData)))return;super.renderChildren(e);const{painter:t}=e,i=t.effects.highlight;i.bind(e),e.context.setColorMask(!0,!0,!0,!0),e.context.clear(16384),this._renderChildren(e,i.defines.concat(["highlightAll"])),i.draw(e),i.unbind()}};w=s([o("esri.views.2d.layers.support.HighlightGraphicContainer")],w);var C=w;const U=n.getLogger("esri.views.2d.layers.MapImageLayerView2D");let x=class extends(j(v(c(m)))){constructor(){super(...arguments),this._highlightGraphics=new p}hitTest(){return null}update(e){this.strategy.update(e).catch((e=>{h(e)||U.error(e)}))}attach(){const{imageMaxWidth:e,imageMaxHeight:t,version:i}=this.layer,r=i>=10.3,a=i>=10;this._bitmapContainer=new l,this.container.addChild(this._bitmapContainer);const s=new b({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new C(this.view.featuresTilingScheme)});this.container.addChild(s.container),this.strategy=new u({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:e,imageMaxHeight:t,imageRotationSupported:r,imageNormalizationSupported:a,hidpi:!0}),this.handles.add(this.watch("exportImageVersion",(()=>this.requestUpdate())),"exportImageVersion"),this.handles.add(this.watch("view.floors",(()=>this.requestUpdate())),"view.floors"),this.requestUpdate()}detach(){this.handles.remove("exportImageVersion"),this.handles.remove("view.floors"),this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}highlight(e,t){return this._highlightGraphics.add(e),{remove:()=>{this._highlightGraphics.remove(e)}}}createFetchPopupFeaturesQueryGeometry(e,t){return y(e,t,this.view)}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(e,s,o,n){return this.layer.fetchImage(e,s,o,((e,s)=>{for(var o in s||(s={}))i.call(s,o)&&a(e,o,s[o]);if(t)for(var o of t(s))r.call(s,o)&&a(e,o,s[o]);return e})({timeExtent:this.timeExtent,floors:this.view.floors},n))}};s([d()],x.prototype,"strategy",void 0),s([d()],x.prototype,"updating",void 0),x=s([o("esri.views.2d.layers.MapImageLayerView2D")],x);var G=x;export{G as default};
//# sourceMappingURL=MapImageLayerView2D.467222f0.js.map
