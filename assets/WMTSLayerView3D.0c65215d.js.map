{"version":3,"file":"WMTSLayerView3D.0c65215d.js","sources":["../../node_modules/@arcgis/core/views/3d/layers/WMTSLayerView3D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Error.js\";import i from\"../../../core/Logger.js\";import{whenTrueOnce as r}from\"../../../core/watchUtils.js\";import{property as s}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as o}from\"../../../core/accessorSupport/decorators/subclass.js\";import{LayerView3D as a}from\"./LayerView3D.js\";import{TiledLayerView3D as l}from\"./TiledLayerView3D.js\";import n from\"../../layers/LayerView.js\";import{RefreshableLayerView as h}from\"../../layers/RefreshableLayerView.js\";const p=i.getLogger(\"esri.views.3d.layers.WMTSLayerView3d\");let c=class extends(h(l(a(n)))){constructor(){super(...arguments),this.type=\"wmts-3d\"}get hasMixedImageFormats(){return!0}initialize(){const e=r(this.view,\"basemapTerrain.tilingSchemeDone\").then((()=>{const e=()=>new t(\"layerview:no-compatible-tiling-scheme\",\"None of the tiling schemes supported by the service are compatible with the scene.\");if(!this.view.basemapTerrain.tilingSchemeLocked)throw e();const i=this.view.basemapTerrain.tilingScheme,r=this.layer.activeLayer;let s;if(r&&r.tileMatrixSet){s=r.tileMatrixSet;const e=s.tileInfo,t=this._getTileInfoSupportError(e,s.fullExtent)||this._getTileInfoCompatibilityError(e,i);if(t)throw t}else{if(s=this._getCompatibleTileMatrixSet(),!s)throw e();r.tileMatrixSetId=s.id}this._set(\"tileInfo\",s.tileInfo),this._set(\"fullExtent\",s.fullExtent),this.layer.fullExtent=s.fullExtent}));this.addResolvingPromise(e),this.when((()=>this._initialized()))}refresh(){this.emit(\"data-changed\")}canResume(){if(!super.canResume())return!1;const e=this.layer.activeLayer.tileMatrixSet;return e&&!this._getTileInfoError(e.tileInfo,e.fullExtent)}async doRefresh(){this.suspended||this.emit(\"data-changed\")}_initialized(){this.updatingHandles.add(this,\"layer.activeLayer.styleId\",(()=>this.refresh())),this.updatingHandles.add(this,\"tileMatrixSet\",(()=>this.refresh())),this.updatingHandles.add(this.layer,\"activeLayer\",(e=>{let t=e.tileMatrixSet;if(t){const e=this._getTileInfoError(t.tileInfo,t.fullExtent);e&&(p.error(\"The selected tile matrix set is not compatible with the view\",e),t=null)}else t=this._getCompatibleTileMatrixSet(),t?e.tileMatrixSetId=t.id:p.error(\"The layer does not provide a tiling scheme that is compatible with the view\");this.notifyChange(\"suspended\"),this.canResume()&&this.refresh()}))}_getCompatibleTileMatrixSet(){return this.layer.activeLayer.tileMatrixSets.find((e=>{const t=e.tileInfo;return!this._getTileInfoError(t,e.fullExtent)}))}_getTileInfoError(e,t){return this._getTileInfoSupportError(e,t)||this._getTileInfoCompatibilityError(e,this.view.basemapTerrain.tilingScheme)}};e([s({readOnly:!0})],c.prototype,\"hasMixedImageFormats\",null),e([s()],c.prototype,\"fullExtent\",void 0),e([s()],c.prototype,\"layer\",void 0),e([s()],c.prototype,\"suspended\",void 0),e([s()],c.prototype,\"tileInfo\",void 0),c=e([o(\"esri.views.3d.layers.WMTSLayerView3D\")],c);var d=c;export{d as default};\n"],"names":["p","i","getLogger","c","h","l","a","n","constructor","arguments","this","type","initialize","e2","r","view","then","e3","t","basemapTerrain","tilingSchemeLocked","tilingScheme","layer","activeLayer","s2","tileMatrixSet","e4","tileInfo","_getTileInfoSupportError","fullExtent","_getTileInfoCompatibilityError","_getCompatibleTileMatrixSet","tileMatrixSetId","id","_set","addResolvingPromise","when","_initialized","refresh","emit","canResume","super","_getTileInfoError","suspended","updatingHandles","add","error","notifyChange","tileMatrixSets","find","e","s","readOnly","prototype","o","d"],"mappings":"6JAIuoB,MAAMA,EAAEC,EAAEC,UAAU,wCAAwC,IAAIC,EAAE,cAAcC,EAAEC,EAAEC,EAAEC,MAAMC,uBAAuBC,WAAWC,KAAKC,KAAK,4CAA2C,EAAGC,mBAAmBC,EAAEC,EAAEJ,KAAKK,KAAK,mCAAmCC,MAAM,WAAWC,EAAE,IAAI,IAAIC,EAAE,wCAAwC,0FAA0FR,KAAKK,KAAKI,eAAeC,yBAAyBH,UAAUhB,EAAES,KAAKK,KAAKI,eAAeE,aAAaP,EAAEJ,KAAKY,MAAMC,gBAAgBC,KAAKV,GAAGA,EAAEW,cAAc,GAAGX,EAAEW,oBAAoBC,EAAEF,EAAEG,SAAST,EAAER,KAAKkB,yBAAyBF,EAAEF,EAAEK,aAAanB,KAAKoB,+BAA+BJ,EAAEzB,MAAMiB,QAAQA,MAAM,IAAIM,EAAEd,KAAKqB,+BAA+BP,QAAQP,MAAMe,gBAAgBR,EAAES,QAAQC,KAAK,WAAWV,EAAEG,UAAUjB,KAAKwB,KAAK,aAAaV,EAAEK,YAAYnB,KAAKY,MAAMO,WAAWL,EAAEK,mBAAmBM,oBAAoBtB,GAAGH,KAAK0B,MAAM,IAAI1B,KAAK2B,iBAAiBC,eAAeC,KAAK,gBAAgBC,gBAAgBC,MAAMD,mBAAkB,QAAS3B,EAAEH,KAAKY,MAAMC,YAAYE,qBAAqBZ,IAAIH,KAAKgC,kBAAkB7B,EAAEc,SAASd,EAAEgB,mCAAmCc,WAAWjC,KAAK6B,KAAK,gBAAgBF,oBAAoBO,gBAAgBC,IAAInC,KAAK,6BAA6B,IAAIA,KAAK4B,YAAY5B,KAAKkC,gBAAgBC,IAAInC,KAAK,iBAAiB,IAAIA,KAAK4B,YAAY5B,KAAKkC,gBAAgBC,IAAInC,KAAKY,MAAM,uBAAuBJ,EAAEL,EAAEY,iBAAiBP,EAAE,OAAOD,EAAEP,KAAKgC,kBAAkBxB,EAAES,SAAST,EAAEW,kBAAkBiB,MAAM,+DAA+D7B,GAAGC,EAAE,aAAaR,KAAKqB,8BAA8Bb,EAAEL,EAAEmB,gBAAgBd,EAAEe,GAAGjC,EAAE8C,MAAM,oFAAoFC,aAAa,aAAarC,KAAK8B,aAAa9B,KAAK4B,aAAaP,qCAAqCrB,KAAKY,MAAMC,YAAYyB,eAAeC,gBAAgB/B,EAAEL,EAAEc,gBAAgBjB,KAAKgC,kBAAkBxB,EAAEL,EAAEgB,eAAea,kBAAkB7B,EAAEK,UAAUR,KAAKkB,yBAAyBf,EAAEK,IAAIR,KAAKoB,+BAA+BjB,EAAEH,KAAKK,KAAKI,eAAeE,gBAAgB6B,EAAE,CAACC,EAAE,CAACC,UAAS,KAAMjD,EAAEkD,UAAU,uBAAuB,MAAMH,EAAE,CAACC,KAAKhD,EAAEkD,UAAU,kBAAa,GAAQH,EAAE,CAACC,KAAKhD,EAAEkD,UAAU,aAAQ,GAAQH,EAAE,CAACC,KAAKhD,EAAEkD,UAAU,iBAAY,GAAQH,EAAE,CAACC,KAAKhD,EAAEkD,UAAU,gBAAW,GAAQlD,EAAE+C,EAAE,CAACI,EAAE,yCAAyCnD,GAAM,IAACoD,EAAEpD"}